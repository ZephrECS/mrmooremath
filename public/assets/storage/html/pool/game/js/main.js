"use strict";(()=>{const O=function(){if("undefined"==typeof window)return null;const r={};ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return null!==t&&"object"==typeof t&&t.buffer instanceof ArrayBuffer}),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window);var s=function(t,e){return s=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}),s(t,e)};function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function d(t,o,r,h){return new(r=r||Promise)(function(i,e){function s(t){try{a(h.next(t))}catch(t){e(t)}}function n(t){try{a(h.throw(t))}catch(t){e(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,(e instanceof r?e:new r(function(t){t(e)})).then(s,n))}a((h=h.apply(t,o||[])).next())})}function c(s,n){var a,o,r,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,o&&(r=2&e[0]?o.return:e[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,o=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=0<r.length&&r[r.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3]))h.label=e[1];else if(6===e[0]&&h.label<r[1])h.label=r[1],r=e;else{if(!(r&&h.label<r[2])){r[2]&&h.ops.pop(),h.trys.pop();continue}h.label=r[2],h.ops.push(e)}}e=n.call(s,h)}catch(t){e=[6,t],o=0}finally{a=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}}function h(t,e){e.statusMessage=t.statusText,e.statusCode=t.status,e.data=t.body}function e(t,e,n){n=n||{};var a,i,o=n.body;return n.method=t,n.headers=n.headers||{},o instanceof FormData||o&&"object"==typeof o&&(n.headers["content-type"]="application/json",n.body=JSON.stringify(o)),n.withCredentials&&(n.credentials="include"),n.timeout&&(i=new AbortController,n.signal=i.signal,a=setTimeout(i.abort,n.timeout)),new Promise((t,s)=>{fetch(e,n).then((e,i)=>{clearTimeout(a),h(e,e),i=400<=e.status?s:t,o=e.headers.get("content-type"),o&&~o.indexOf("application/json")?e.text().then(t=>{try{e.data=JSON.parse(t,n.reviver),i(e)}catch(t){t.headers=e.headers,h(e,t),s(t)}}):i(e)}).catch(t=>{t.timeout=i&&i.signal.aborted,s(t)})})}var i,n=e.bind(e,"GET"),a=e.bind(e,"POST"),o=e.bind(e,"PATCH"),l=e.bind(e,"DELETE"),u=e.bind(e,"PUT"),p=n,n=o,g=a,o=u,a=e,u={del:l,get:p,patch:n,post:g,put:o,send:a},O=Object.freeze(Object.assign(Object.create(null),u,{default:u,del:l,get:p,patch:n,post:g,put:o,send:a})),L=(i=Error,t(m,i),m);function m(t,e){e=i.call(this,e)||this;return e.name="ServerError",e.code=t,e}function y(t,e){if(this._offset=e,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}function v(t,e,i){var s,n=typeof i,a=0,o=0,r=0,h=0,l=0;if("string"==n){if(h=function(t){for(var e,i=0,s=0,n=t.length;s<n;s++)e=t.charCodeAt(s),e<128?i+=1:e<2048?i+=2:e<55296||57344<=e?i+=3:(s++,i+=4);return i}(i),h<32)t.push(160|h),l=1;else if(h<256)t.push(217,h),l=2;else if(h<65536)t.push(218,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("String too long");t.push(219,h>>24,h>>16,h>>8,h),l=5}return e.push({_str:i,_length:h,_offset:t.length}),l+h}if("number"==n)return Math.floor(i)===i&&isFinite(i)?0<=i?i<128?(t.push(i),1):i<256?(t.push(204,i),2):i<65536?(t.push(205,i>>8,i),3):i<4294967296?(t.push(206,i>>24,i>>16,i>>8,i),5):(o=i/Math.pow(2,32)>>0,r=i>>>0,t.push(207,o>>24,o>>16,o>>8,o,r>>24,r>>16,r>>8,r),9):-32<=i?(t.push(i),1):-128<=i?(t.push(208,i),2):-32768<=i?(t.push(209,i>>8,i),3):-2147483648<=i?(t.push(210,i>>24,i>>16,i>>8,i),5):(o=Math.floor(i/Math.pow(2,32)),r=i>>>0,t.push(211,o>>24,o>>16,o>>8,o,r>>24,r>>16,r>>8,r),9):(t.push(203),e.push({_float:i,_length:8,_offset:t.length}),9);if("object"==n){if(null===i)return t.push(192),1;if(Array.isArray(i)){if(h=i.length,h<16)t.push(144|h),l=1;else if(h<65536)t.push(220,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Array too large");t.push(221,h>>24,h>>16,h>>8,h),l=5}for(a=0;a<h;a++)l+=v(t,e,i[a])}else{if(i instanceof Date)return s=i.getTime(),o=Math.floor(s/Math.pow(2,32)),r=s>>>0,t.push(215,0,o>>24,o>>16,o>>8,o,r>>24,r>>16,r>>8,r),10;if(i instanceof ArrayBuffer){if(h=i.byteLength,h<256)t.push(196,h),l=2;else if(h<65536)t.push(197,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Buffer too large");t.push(198,h>>24,h>>16,h>>8,h),l=5}return e.push({_bin:i,_length:h,_offset:t.length}),l+h}if("function"==typeof i.toJSON)return v(t,e,i.toJSON());for(var d=[],c="",u=Object.keys(i),a=0,p=u.length;a<p;a++)c=u[a],"function"!=typeof i[c]&&d.push(c);if(h=d.length,h<16)t.push(128|h),l=1;else if(h<65536)t.push(222,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Object too large");t.push(223,h>>24,h>>16,h>>8,h),l=5}for(a=0;a<h;a++)c=d[a],l+=v(t,e,c),l+=v(t,e,i[c])}return l}if("boolean"==n)return t.push(i?195:194),1;if("undefined"==n)return t.push(212,0,0),3;throw new Error("Could not encode")}y.prototype._array=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this._parse();return e},y.prototype._map=function(t){for(var e,i={},s=0;s<t;s++)e=this._parse(),i[e]=this._parse();return i},y.prototype._str=function(t){var e=function(t,e,i){for(var s="",n=0,a=e,o=e+i;a<o;a++){var r=t.getUint8(a);if(0==(128&r))s+=String.fromCharCode(r);else if(192==(224&r))s+=String.fromCharCode((31&r)<<6|63&t.getUint8(++a));else if(224==(240&r))s+=String.fromCharCode((15&r)<<12|(63&t.getUint8(++a))<<6|(63&t.getUint8(++a))<<0);else{if(240!=(248&r))throw new Error("Invalid byte "+r.toString(16));n=(7&r)<<18|(63&t.getUint8(++a))<<12|(63&t.getUint8(++a))<<6|(63&t.getUint8(++a))<<0,65536<=n?(n-=65536,s+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):s+=String.fromCharCode(n)}}return s}(this._view,this._offset,t);return this._offset+=t,e},y.prototype._bin=function(t){var e=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,e},y.prototype._parse=function(){var t,e=this._view.getUint8(this._offset++),i=0,s=0,n=0,a=0;if(e<192)return e<128?e:e<144?this._map(15&e):e<160?this._array(15&e):this._str(31&e);if(223<e)return-1*(255-e+1);switch(e){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:return i=this._view.getUint8(this._offset),s=this._view.getInt8(this._offset+1),this._offset+=2,[s,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),s=this._view.getInt8(this._offset+2),this._offset+=3,[s,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),s=this._view.getInt8(this._offset+4),this._offset+=5,[s,this._bin(i)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return n=this._view.getUint32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,n+a;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return n=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,n+a;case 212:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?void(this._offset+=1):[s,this._bin(1)];case 213:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(2)];case 214:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(4)];case 215:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?(n=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,new Date(n+a)):[s,this._bin(8)];case 216:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")};var H=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},z=(_.prototype.send=function(t){t instanceof ArrayBuffer?this.ws.send(t):Array.isArray(t)&&this.ws.send(new Uint8Array(t).buffer)},_.prototype.connect=function(t){this.ws=new H(t,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},_.prototype.close=function(t,e){this.ws.close(t,e)},_);function _(t){this.events=t}f.prototype.send=function(t){this.transport.send(t)},f.prototype.connect=function(t){this.transport.connect(t)},f.prototype.close=function(t,e){this.transport.close(t,e)};var G=f;function f(){this.events={},this.transport=new z(this.events)}var w={};function b(t,e){w[t]=e}function x(t){var e=w[t];if(e)return e;throw new Error("missing serializer: "+t)}r.Protocol=void 0,u=r.Protocol||(r.Protocol={}),u[u.HANDSHAKE=9]="HANDSHAKE",u[u.JOIN_ROOM=10]="JOIN_ROOM",u[u.ERROR=11]="ERROR",u[u.LEAVE_ROOM=12]="LEAVE_ROOM",u[u.ROOM_DATA=13]="ROOM_DATA",u[u.ROOM_STATE=14]="ROOM_STATE",u[u.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",u[u.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",r.ErrorCode=void 0,l=r.ErrorCode||(r.ErrorCode={}),l[l.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",l[l.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",l[l.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",l[l.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",l[l.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",l[l.AUTH_FAILED=4215]="AUTH_FAILED",l[l.APPLICATION_ERROR=4216]="APPLICATION_ERROR";S.prototype.register=function(t,e){return this.handlers.push(t),this},S.prototype.invoke=function(){for(var e=this,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];this.handlers.forEach(function(t){return t.apply(e,i)})},S.prototype.invokeAsync=function(){for(var e=this,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];return Promise.all(this.handlers.map(function(t){return t.apply(e,i)}))},S.prototype.remove=function(t){t=this.handlers.indexOf(t);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},S.prototype.clear=function(){this.handlers=[]};var N=S;function S(){this.handlers=[]}function k(){var n=new N;function t(t){return n.register(t,null===this)}return t.once=function(i){var s=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i.apply(this,t),n.remove(s)};n.register(s)},t.remove=function(t){return n.remove(t)},t.invoke=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.invoke.apply(n,t)},t.invokeAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.invokeAsync.apply(n,t)},t.clear=function(){return n.clear()},t}n=function(k,t){function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function i(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;0<=r;r--)(n=t[r])&&(o=(a<3?n(o):3<a?n(e,i,o):n(e,i))||o);3<a&&o&&Object.defineProperty(e,i,o)}function h(t,e){for(var i=0,s=e.length,n=t.length;i<s;i++,n++)t[n]=e[i];return t}function T(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,e){return"symbol"==typeof e||isNaN(e)?t[e]:t.at(e)},set:function(t,e,i){var s;return"symbol"==typeof e||isNaN(e)?t[e]=i:(s=Array.from(t.$items.keys()),s=parseInt(s[e]||e),null==i?t.deleteAt(s):t.setAt(s,i)),!0},deleteProperty:function(t,e){return"number"==typeof e?t.deleteAt(e):delete t[e],!0}}),t}function H(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,e){return"symbol"!=typeof e&&void 0===t[e]?t.get(e):t[e]},set:function(t,e,i){return"symbol"!=typeof e&&-1===e.indexOf("$")&&"onAdd"!==e&&"onRemove"!==e&&"onChange"!==e?t.set(e,i):t[e]=i,!0},deleteProperty:function(t,e){return t.delete(e),!0}}),t}function e(t,e){it[t]=e}function F(t){return it[t]}function d(o,r){return void 0===r&&(r=st),function(e,i){var e=e.constructor,t=(e._context=r,r.has(e)||r.add(e),e._definition);if(t.addField(i,o),t.descriptors[i]){if(t.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '"+i+"' definition on '"+e.name+"'.\nCheck @type() annotation")}catch(t){e=t.stack.split("\n")[4].trim();throw new Error(t.message+" "+e)}}var s=R.is(o),n=!s&&A.is(o),a=("string"==typeof o||v.is(o)||(e=Object.values(o)[0],"string"==typeof e)||r.has(e)||r.add(e),"_"+i);t.descriptors[a]={enumerable:!1,configurable:!1,writable:!0},t.descriptors[i]={get:function(){return this[a]},set:function(t){t!==this[a]&&(null!=t?(!s||t instanceof R||(t=new(R.bind.apply(R,h([void 0],t)))),!n||t instanceof A||(t=new A(t)),void 0===t.$proxy&&(n?t=H(t):s&&(t=T(t))),this.$changes.change(i),t.$changes&&t.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])):this.$changes.delete(i),this[a]=t)},enumerable:!0,configurable:!0}}}function z(t,e,i){for(var s,n=0,a=i.length;n<a;n++)s=i.charCodeAt(n),s<128?t[e++]=s:(s<2048?t[e++]=192|s>>6:(s<55296||57344<=s?t[e++]=224|s>>12:(n++,s=65536+((1023&s)<<10|1023&i.charCodeAt(n)),t[e++]=240|s>>18,t[e++]=128|s>>12&63),t[e++]=128|s>>6&63),t[e++]=128|63&s)}function G(t,e){t.push(255&e)}function C(t,e){t.push(255&e)}function N(t,e){t.push(255&e),t.push(e>>8&255)}function n(t,e){t.push(255&e),t.push(e>>8&255)}function s(t,e){t.push(255&e),t.push(e>>8&255),t.push(e>>16&255),t.push(e>>24&255)}function a(t,e){var i=e>>24,s=e>>16,n=e>>8;t.push(255&e),t.push(255&n),t.push(255&s),t.push(255&i)}function V(t,e){var i=Math.floor(e/Math.pow(2,32)),e=e>>>0;a(t,e),a(t,i)}function j(t,e){var i=e/Math.pow(2,32)>>0,e=e>>>0;a(t,e),a(t,i)}function U(t,e){nt[0]=e,s(t,f[0])}function o(t,e){at[0]=e,s(t,f[0]),s(t,f[1])}function B(t,e){e=e||"";var i=function(t){for(var e,i=0,s=0,n=t.length;s<n;s++)e=t.charCodeAt(s),e<128?i+=1:e<2048?i+=2:e<55296||57344<=e?i+=3:(s++,i+=4);return i}(e),s=0;if(i<32)t.push(160|i),s=1;else if(i<256)t.push(217),C(t,i),s=2;else if(i<65536)t.push(218),n(t,i),s=3;else{if(!(i<4294967296))throw new Error("String too long");t.push(219),a(t,i),s=5}return z(t,t.length,e),s+i}function P(t,e){return isNaN(e)?P(t,0):isFinite(e)?e!==(0|e)?(t.push(203),o(t,e),9):0<=e?e<128?(C(t,e),1):e<256?(t.push(204),C(t,e),2):e<65536?(t.push(205),n(t,e),3):e<4294967296?(t.push(206),a(t,e),5):(t.push(207),j(t,e),9):-32<=e?(t.push(224|e+32),1):-128<=e?(t.push(208),G(t,e),2):-32768<=e?(t.push(209),N(t,e),3):-2147483648<=e?(t.push(210),s(t,e),5):(t.push(211),V(t,e),9):P(t,0<e?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}function W(t,e){return r(t,e)<<24>>24}function r(t,e){return t[e.offset++]}function $(t,e){return c(t,e)<<16>>16}function c(t,e){return t[e.offset++]|t[e.offset++]<<8}function u(t,e){return t[e.offset++]|t[e.offset++]<<8|t[e.offset++]<<16|t[e.offset++]<<24}function p(t,e){return u(t,e)>>>0}function Y(t,e){var i=p(t,e),t=u(t,e)*Math.pow(2,32);return t+i}function q(t,e){var i=p(t,e),t=p(t,e)*Math.pow(2,32);return t+i}function X(t,e){return w[0]=u(t,e),ot[0]}function J(t,e){return w[0]=u(t,e),w[1]=u(t,e),rt[0]}function Q(t,e){var i,s=t[e.offset++],s=(s<192?i=31&s:217===s?i=r(t,e):218===s?i=c(t,e):219===s&&(i=p(t,e)),function(t,e,i){for(var s="",n=0,a=e,o=e+i;a<o;a++){var r=t[a];0==(128&r)?s+=String.fromCharCode(r):192==(224&r)?s+=String.fromCharCode((31&r)<<6|63&t[++a]):224==(240&r)?s+=String.fromCharCode((15&r)<<12|(63&t[++a])<<6|(63&t[++a])<<0):240==(248&r)?(n=(7&r)<<18|(63&t[++a])<<12|(63&t[++a])<<6|(63&t[++a])<<0,65536<=n?(n-=65536,s+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):s+=String.fromCharCode(n)):console.error("Invalid byte "+r.toString(16))}return s}(t,e.offset,i));return e.offset+=i,s}function D(t,e){var i=t[e.offset++];return i<128?i:202===i?X(t,e):203===i?J(t,e):204===i?r(t,e):205===i?c(t,e):206===i?p(t,e):207===i?q(t,e):208===i?W(t,e):209===i?$(t,e):210===i?u(t,e):211===i?Y(t,e):223<i?-1*(255-i+1):void 0}function K(t,e){return 255===t[e.offset-1]&&(t[e.offset]<128||202<=t[e.offset]&&t[e.offset]<=211)}function Z(t,e,i,s){if(!(t instanceof e))throw new L("a '"+e.name+"' was expected, but '"+t.constructor.name+"' was provided in "+i.constructor.name+"#"+s)}var E,g,tt,m,et,R,A,it,y,_,st,f,nt,at,I,w,ot,rt,ht,M,O,lt,dt,L,v,b,x,S;E=t,g=function(t,e){return g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}),g(t,e)},E.OPERATION=void 0,t=E.OPERATION||(E.OPERATION={}),t[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR",tt=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(t,e,i){void 0===i&&(i=!0),this.refs.set(t,e),i&&(this.refCounts[t]=(this.refCounts[t]||0)+1)},t.prototype.removeRef=function(t){this.refCounts[t]=this.refCounts[t]-1,this.deletedRefs.add(t)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var n=this;this.deletedRefs.forEach(function(t){if(n.refCounts[t]<=0){var e=n.refs.get(t);if(e instanceof v)for(var i in e._definition.schema)"string"!=typeof e._definition.schema[i]&&e[i]&&e[i].$changes&&n.removeRef(e[i].$changes.refId);else{var s=e.$changes.parent._definition,s=s.schema[s.fieldsByIndex[e.$changes.parentIndex]];"function"==typeof Object.values(s)[0]&&Array.from(e.values()).forEach(function(t){return n.removeRef(t.$changes.refId)})}n.refs.delete(t),delete n.refCounts[t]}}),this.deletedRefs.clear()},t}(),m=function(){function t(t,e,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=t,this.setParent(e,i)}return t.prototype.setParent=function(t,e,i){var s=this;if(this.indexes||(this.indexes=this.ref instanceof v?this.ref._definition.indexes:{}),this.parent=t,this.parentIndex=i,e)if(this.root=e,this.ref instanceof v){var n,a=this.ref._definition;for(n in a.schema){var o,r=this.ref[n];r&&r.$changes&&(o=a.indexes[n],r.$changes.setParent(this.ref,e,o))}}else"object"==typeof this.ref&&this.ref.forEach(function(t,e){t instanceof v&&(t=t.$changes,e=s.ref.$changes.indexes[e],t.setParent(s.ref,s.root,e))})},t.prototype.operation=function(t){this.changes.set(--this.currentCustomOperation,t)},t.prototype.change=function(t,e){void 0===e&&(e=E.OPERATION.ADD);var i="number"==typeof t?t:this.indexes[t],t=(this.assertValidIndex(i,t),this.changes.get(i));t&&t.op!==E.OPERATION.DELETE&&t.op!==E.OPERATION.TOUCH||this.changes.set(i,{op:t&&t.op===E.OPERATION.DELETE?E.OPERATION.DELETE_AND_ADD:e,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},t.prototype.touch=function(t){var e="number"==typeof t?t:this.indexes[t];this.assertValidIndex(e,t),this.changes.has(e)||this.changes.set(e,{op:E.OPERATION.TOUCH,index:e}),this.allChanges.add(e),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(t){var e;return this.ref._definition?(e=this.ref._definition,e.schema[e.fieldsByIndex[t]]):(e=this.parent._definition,t=e.schema[e.fieldsByIndex[this.parentIndex]],Object.values(t)[0])},t.prototype.getChildrenFilter=function(){var t=this.parent._definition.childFilters;return t&&t[this.parentIndex]},t.prototype.getValue=function(t){return this.ref.getByIndex(t)},t.prototype.delete=function(t){var e="number"==typeof t?t:this.indexes[t];void 0===e?console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+t+" ("+e+")"):(t=this.getValue(e),this.changes.set(e,{op:E.OPERATION.DELETE,index:e}),this.allChanges.delete(e),delete this.caches[e],t&&t.$changes&&(t.$changes.parent=void 0),this.changed=!0,this.touchParents())},t.prototype.discard=function(t,e){var i=this;void 0===t&&(t=!1),void 0===e&&(e=!1),this.ref instanceof v||this.changes.forEach(function(t){t.op===E.OPERATION.DELETE&&(t=i.ref.getIndex(t.index),delete i.indexes[t])}),this.changes.clear(),this.changed=t,e&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach(function(t){t=e.getValue(t.index);t&&t.$changes&&t.$changes.discardAll()}),this.discard()},t.prototype.cache=function(t,e){this.caches[t]=e},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(t,e){if(void 0===t)throw new Error('ChangeTree: missing index for field "'+e+'"')},t}(),et=function(t,e){t=t.toString(),e=e.toString();return t<e?-1:e<t?1:0},R=function(){function s(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,t)}return s.is=function(t){return Array.isArray(t)},Object.defineProperty(s.prototype,"length",{get:function(){return this.$items.size},set:function(t){0===t?this.clear():this.splice(t,this.length-t)},enumerable:!1,configurable:!0}),s.prototype.push=function(){for(var e,i=this,t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return t.forEach(function(t){e=i.$refId++,i.setAt(e,t)}),e},s.prototype.pop=function(){var t,e=Array.from(this.$indexes.values()).pop();if(void 0!==e)return this.$changes.delete(e),this.$indexes.delete(e),t=this.$items.get(e),this.$items.delete(e),t},s.prototype.at=function(t){t=Array.from(this.$items.keys())[t];return this.$items.get(t)},s.prototype.setAt=function(t,e){void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,t);var i=null!=(i=null==(i=this.$changes.indexes[t])?void 0:i.op)?i:E.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this.$changes.change(t,i)},s.prototype.deleteAt=function(t){t=Array.from(this.$items.keys())[t];return void 0!==t&&this.$deleteAt(t)},s.prototype.$deleteAt=function(t){return this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t)},s.prototype.clear=function(t){var e=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(t){e.$changes.root.removeRef(t.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},s.prototype.concat=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return new(s.bind.apply(s,h([void 0],(t=Array.from(this.$items.values())).concat.apply(t,e))))},s.prototype.join=function(t){return Array.from(this.$items.values()).join(t)},s.prototype.reverse=function(){var i=this,s=Array.from(this.$items.keys()),t=Array.from(this.$items.values()).reverse();return t.forEach(function(t,e){i.setAt(s[e],t)}),this},s.prototype.shift=function(){var t,e=Array.from(this.$items.keys()),e=e.shift();if(void 0!==e)return t=this.$items.get(e),this.$deleteAt(e),t},s.prototype.slice=function(t,e){return new(s.bind.apply(s,h([void 0],Array.from(this.$items.values()).slice(t,e))))},s.prototype.sort=function(t){var i=this,s=(void 0===t&&(t=et),Array.from(this.$items.keys())),t=Array.from(this.$items.values()).sort(t);return t.forEach(function(t,e){i.setAt(s[e],t)}),this},s.prototype.splice=function(t,e){void 0===e&&(e=this.length-t);for(var i=2;i<arguments.length;i++)i-2,0;for(var s=Array.from(this.$items.keys()),n=[],a=t;a<t+e;a++)n.push(this.$items.get(s[a])),this.$deleteAt(s[a]);return n},s.prototype.unshift=function(){for(var i=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var s=this.length,n=t.length,a=Array.from(this.$items.values());return t.forEach(function(t,e){i.setAt(e,t)}),a.forEach(function(t,e){i.setAt(n+e,t)}),s+n},s.prototype.indexOf=function(t,e){return Array.from(this.$items.values()).indexOf(t,e)},s.prototype.lastIndexOf=function(t,e){return void 0===e&&(e=this.length-1),Array.from(this.$items.values()).lastIndexOf(t,e)},s.prototype.every=function(t,e){return Array.from(this.$items.values()).every(t,e)},s.prototype.some=function(t,e){return Array.from(this.$items.values()).some(t,e)},s.prototype.forEach=function(t,e){Array.from(this.$items.values()).forEach(t,e)},s.prototype.map=function(t,e){return Array.from(this.$items.values()).map(t,e)},s.prototype.filter=function(t,e){return Array.from(this.$items.values()).filter(t,e)},s.prototype.reduce=function(t,e){return Array.from(this.$items.values()).reduce(t,e)},s.prototype.reduceRight=function(t,e){return Array.from(this.$items.values()).reduceRight(t,e)},s.prototype.find=function(t,e){return Array.from(this.$items.values()).find(t,e)},s.prototype.findIndex=function(t,e){return Array.from(this.$items.values()).findIndex(t,e)},s.prototype.fill=function(t,e,i){throw new Error("ArraySchema#fill() not implemented")},s.prototype.copyWithin=function(t,e,i){throw new Error("ArraySchema#copyWithin() not implemented")},s.prototype.toString=function(){return this.$items.toString()},s.prototype.toLocaleString=function(){return this.$items.toLocaleString()},s.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},s.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},s.prototype.entries=function(){return this.$items.entries()},s.prototype.keys=function(){return this.$items.keys()},s.prototype.values=function(){return this.$items.values()},s.prototype.includes=function(t,e){return Array.from(this.$items.values()).includes(t,e)},s.prototype.flatMap=function(t,e){throw new Error("ArraySchema#flatMap() is not supported.")},s.prototype.flat=function(t){throw new Error("ArraySchema#flat() is not supported.")},s.prototype.setIndex=function(t,e){this.$indexes.set(t,e)},s.prototype.getIndex=function(t){return this.$indexes.get(t)},s.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},s.prototype.deleteByIndex=function(t){var e=this.$indexes.get(t);this.$items.delete(e),this.$indexes.delete(t)},s.prototype.toArray=function(){return Array.from(this.$items.values())},s.prototype.toJSON=function(){return this.toArray().map(function(t){return"function"==typeof t.toJSON?t.toJSON():t})},s.prototype.clone=function(t){t=new(t?s.bind.apply(s,h([void 0],Array.from(this.$items.values()))):s.bind.apply(s,h([void 0],this.map(function(t){return t.$changes?t.clone():t}))));return t},s.prototype.triggerAll=function(){v.prototype.triggerAll.apply(this)},s}(),A=function(){function e(t){var i=this;if(this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t)if(t instanceof Map)t.forEach(function(t,e){return i.set(e,t)});else for(var e in t)this.set(e,t[e])}return e.is=function(t){return void 0!==t.map},e.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),e.prototype.set=function(t,e){if(null==e)throw new Error("MapSchema#set('"+t+"', "+e+"): trying to set "+e+" value on '"+t+"'.");var i=void 0!==this.$changes.indexes[t],s=i?this.$changes.indexes[t]:this.$refId++,n=i?E.OPERATION.REPLACE:E.OPERATION.ADD,a=void 0!==e.$changes;return a&&e.$changes.setParent(this,this.$changes.root,s),i?a&&this.$items.get(t)!==e&&(n=E.OPERATION.ADD):(this.$changes.indexes[t]=s,this.$indexes.set(s,t)),this.$items.set(t,e),this.$changes.change(t,n),this},e.prototype.get=function(t){return this.$items.get(t)},e.prototype.delete=function(t){return this.$changes.delete(t),this.$items.delete(t)},e.prototype.clear=function(t){var e=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(t){e.$changes.root.removeRef(t.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){return this.$items.has(t)},e.prototype.forEach=function(t){this.$items.forEach(t)},e.prototype.entries=function(){return this.$items.entries()},e.prototype.keys=function(){return this.$items.keys()},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,e){this.$indexes.set(t,e)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var e=this.$indexes.get(t);this.$items.delete(e),this.$indexes.delete(t)},e.prototype.toJSON=function(){var i={};return this.forEach(function(t,e){i[e]="function"==typeof t.toJSON?t.toJSON():t}),i},e.prototype.clone=function(t){var i;return t?i=Object.assign(new e,this):(i=new e,this.forEach(function(t,e){t.$changes?i.set(e,t.clone()):i.set(e,t)})),i},e.prototype.triggerAll=function(){v.prototype.triggerAll.apply(this)},e}(),it={},y=function(){function i(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return i.create=function(t){var e=new i;return e.schema=Object.assign({},t&&t.schema||{}),e.indexes=Object.assign({},t&&t.indexes||{}),e.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),e.descriptors=Object.assign({},t&&t.descriptors||{}),e.deprecated=Object.assign({},t&&t.deprecated||{}),e},i.prototype.addField=function(t,e){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=t,this.indexes[t]=i,this.schema[t]=Array.isArray(e)?{array:e[0]}:e},i.prototype.addFilter=function(t,e){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[t]]=e,this.indexesWithFilters.push(this.indexes[t]),!0},i.prototype.addChildrenFilter=function(t,e){var i=this.indexes[t],s=this.schema[t];if(F(Object.keys(s)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=e,!0;console.warn("@filterChildren: field '"+t+"' can't have children. Ignoring filter.")},i.prototype.getChildrenFilter=function(t){return this.childFilters&&this.childFilters[this.indexes[t]]},i.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},i}(),_=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(t){return this.schemas.has(t)},t.prototype.get=function(t){return this.types[t]},t.prototype.add=function(t,e){void 0===e&&(e=this.schemas.size),t._definition=y.create(t._definition),t._typeid=e,this.types[e]=t,this.schemas.set(t,e)},t.create=function(e){return void 0===e&&(e=new t),function(t){return d(t,e)}},t}(),st=new _,f=new Int32Array(2),nt=new Float32Array(f.buffer),at=new Float64Array(f.buffer),I=Object.freeze({__proto__:null,utf8Write:z,int8:G,uint8:C,int16:N,uint16:n,int32:s,uint32:a,int64:V,uint64:j,float32:function(t,e){U(t,e)},float64:function(t,e){o(t,e)},writeFloat32:U,writeFloat64:o,boolean:function(t,e){return C(t,e?1:0)},string:B,number:P}),w=new Int32Array(2),ot=new Float32Array(w.buffer),rt=new Float64Array(w.buffer),ht=Object.freeze({__proto__:null,int8:W,uint8:r,int16:$,uint16:c,int32:u,uint32:p,float32:X,float64:J,int64:Y,uint64:q,readFloat32:X,readFloat64:J,boolean:function(t,e){return 0<r(t,e)},string:Q,stringCheck:function(t,e){t=t[e.offset];return t<192&&160<t||217===t||218===t||219===t},number:D,numberCheck:function(t,e){t=t[e.offset];return t<128||202<=t&&t<=211},arrayCheck:function(t,e){return t[e.offset]<160},switchStructureCheck:K}),M=function(){function i(t){var e=this;this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach(function(t){return e.add(t)})}return i.is=function(t){return void 0!==t.collection},i.prototype.add=function(t){var e=this.$refId++,i=void 0!==t.$changes;return i&&t.$changes.setParent(this,this.$changes.root,e),this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,t),this.$changes.change(e),e},i.prototype.at=function(t){t=Array.from(this.$items.keys())[t];return this.$items.get(t)},i.prototype.entries=function(){return this.$items.entries()},i.prototype.delete=function(t){for(var e,i,s=this.$items.entries();(i=s.next())&&!i.done;)if(t===i.value[1]){e=i.value[0];break}return void 0!==e&&(this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e))},i.prototype.clear=function(t){var e=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(t){e.$changes.root.removeRef(t.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(e){return Array.from(this.$items.values()).some(function(t){return t===e})},i.prototype.forEach=function(s){var n=this;this.$items.forEach(function(t,e,i){return s(t,e,n)})},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(t,e){this.$indexes.set(t,e)},i.prototype.getIndex=function(t){return this.$indexes.get(t)},i.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},i.prototype.deleteByIndex=function(t){var e=this.$indexes.get(t);this.$items.delete(e),this.$indexes.delete(t)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){var i=[];return this.forEach(function(t,e){i.push("function"==typeof t.toJSON?t.toJSON():t)}),i},i.prototype.clone=function(t){var e;return t?e=Object.assign(new i,this):(e=new i,this.forEach(function(t){t.$changes?e.add(t.clone()):e.add(t)})),e},i.prototype.triggerAll=function(){v.prototype.triggerAll.apply(this)},i}(),O=function(){function i(t){var e=this;this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach(function(t){return e.add(t)})}return i.is=function(t){return void 0!==t.set},i.prototype.add=function(t){var e,i;return!this.has(t)&&(e=this.$refId++,void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,e),i=null!=(i=null==(i=this.$changes.indexes[e])?void 0:i.op)?i:E.OPERATION.ADD,this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,t),this.$changes.change(e,i),e)},i.prototype.entries=function(){return this.$items.entries()},i.prototype.delete=function(t){for(var e,i,s=this.$items.entries();(i=s.next())&&!i.done;)if(t===i.value[1]){e=i.value[0];break}return void 0!==e&&(this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e))},i.prototype.clear=function(t){var e=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(t){e.$changes.root.removeRef(t.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(t){for(var e,i=this.$items.values(),s=!1;(e=i.next())&&!e.done;)if(t===e.value){s=!0;break}return s},i.prototype.forEach=function(s){var n=this;this.$items.forEach(function(t,e,i){return s(t,e,n)})},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(t,e){this.$indexes.set(t,e)},i.prototype.getIndex=function(t){return this.$indexes.get(t)},i.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},i.prototype.deleteByIndex=function(t){var e=this.$indexes.get(t);this.$items.delete(e),this.$indexes.delete(t)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){var i=[];return this.forEach(function(t,e){i.push("function"==typeof t.toJSON?t.toJSON():t)}),i},i.prototype.clone=function(t){var e;return t?e=Object.assign(new i,this):(e=new i,this.forEach(function(t){t.$changes?e.add(t.clone()):e.add(t)})),e},i.prototype.triggerAll=function(){v.prototype.triggerAll.apply(this)},i}(),lt=function(){function t(){this.handlers=[]}return t.prototype.register=function(t,e){return this.handlers.push(t),this},t.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach(function(t){return t.apply(void 0,e)})},t.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map(function(t){return t.apply(void 0,e)}))},t.prototype.remove=function(t){t=this.handlers.indexOf(t);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},t.prototype.clear=function(){this.handlers=[]},t}(),dt=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(t){this.refIds.has(t)||(this.refIds.add(t),this.containerIndexes.set(t,new Set))},e.get=function(t){return void 0===t.$filterState&&(t.$filterState=new e),t.$filterState},e}(),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e}(Error),v=function(){function T(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Object.defineProperties(this,{$changes:{value:new m(this,void 0,new tt),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),t[0]&&this.assign(t[0])}return T.onError=function(t){console.error(t)},T.is=function(t){return t._definition&&void 0!==t._definition.schema},T.prototype.assign=function(t){return Object.assign(this,t),this},Object.defineProperty(T.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),T.prototype.listen=function(t,e){var i=this;return this.$listeners[t]||(this.$listeners[t]=new lt),this.$listeners[t].register(e),function(){return i.$listeners[t].remove(e)}},T.prototype.decode=function(t,e,i,s){void 0===e&&(e={offset:0}),void 0===i&&(i=this),void 0===s&&(s=new Map);var n=this.$changes.root,a=t.length,o=[];for(n.refs.set(0,this),s.set(0,o);e.offset<a;){var r=t[e.offset++];if(255==r){var h=D(t,e),l=n.refs.get(h);if(!l)throw new Error('"refId" not found: '+h);i=l,o=[],s.set(h,o)}else{var l=i.$changes,h=void 0!==i._definition,d=h?r>>6<<6:r;if(d===E.OPERATION.CLEAR)i.clear(!0);else{var r=h?r%(d||255):D(t,e),c=h?i._definition.fieldsByIndex[r]:"",u=l.getType(r),p=void 0,g=void 0,m=void 0;if(h?g=i["_"+c]:(g=i.getByIndex(r),(d&E.OPERATION.ADD)===E.OPERATION.ADD?(m=i instanceof A?Q(t,e):r,i.setIndex(r,m)):m=i.getIndex(r)),(d&E.OPERATION.DELETE)===E.OPERATION.DELETE&&(d!==E.OPERATION.DELETE_AND_ADD&&i.deleteByIndex(r),g&&g.$changes&&n.removeRef(g.$changes.refId),p=null),void 0===c){console.warn("@colyseus/schema: definition mismatch");for(var y={offset:e.offset};e.offset<a&&(!K(t,e)||(y.offset=e.offset+1,!n.refs.has(D(t,y))));)e.offset++}else{if(d!==E.OPERATION.DELETE)if(T.is(u)){var _,f=D(t,e),p=n.refs.get(f);d!==E.OPERATION.REPLACE&&(_=this.getSchemaType(t,e,u),p||(p=this.createTypeInstance(_),p.$changes.refId=f,g&&(p.onChange=g.onChange,p.onRemove=g.onRemove,p.$listeners=g.$listeners,g.$changes.refId)&&f!==g.$changes.refId&&n.removeRef(g.$changes.refId)),n.addRef(f,p,p!==g))}else if("string"==typeof u)_=u,f=t,w=e,p=ht[_](f,w);else{var w=F(Object.keys(u)[0]),u=D(t,e),v=n.refs.has(u)?g||n.refs.get(u):new w.constructor;if(p=v.clone(!0),p.$changes.refId=u,g&&(p.onAdd=g.onAdd,p.onRemove=g.onRemove,p.onChange=g.onChange,g.$changes.refId)&&u!==g.$changes.refId){n.removeRef(g.$changes.refId);for(var b=[],x=g.entries();(S=x.next())&&!S.done;){var S=S.value,k=S[0],S=S[1];b.push({op:E.OPERATION.DELETE,field:k,value:void 0,previousValue:S})}s.set(g.$changes.refId,b)}n.addRef(u,p,v!==g),w.getProxy&&(p=w.getProxy(p))}var C,u=g!==p;null!=p&&(p.$changes&&p.$changes.setParent(l.ref,l.root,r),i instanceof T?i[c]=p:i instanceof A?(k=m,i.$items.set(k,p)):i instanceof R?i.setAt(r,p):i instanceof M?(C=i.add(p),i.setIndex(r,C)):i instanceof O&&(C=i.add(p),!1!==C)&&i.setIndex(r,C)),u&&o.push({op:d,field:c,dynamicIndex:m,value:p,previousValue:g})}}}}return this._triggerChanges(s),n.garbageCollectDeletedRefs(),s},T.prototype.encode=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=[]),void 0===i&&(i=!1);for(var s=this.$changes,n=new WeakSet,a=[s],o=1,r=0;r<o;r++){for(var h=a[r],l=h.ref,d=l instanceof T,c=(h.ensureRefId(),n.add(h),h!==s&&(h.changed||t)&&(C(e,255),P(e,h.refId)),t?Array.from(h.allChanges):Array.from(h.changes.values())),u=0,p=c.length;u<p;u++){var g=t?{op:E.OPERATION.ADD,index:c[u]}:c[u],m=g.index,y=d?l._definition.fieldsByIndex&&l._definition.fieldsByIndex[m]:m,_=e.length;if(g.op!==E.OPERATION.TOUCH)if(d)C(e,m|g.op);else{if(C(e,g.op),g.op===E.OPERATION.CLEAR)continue;P(e,m)}if(d||(g.op&E.OPERATION.ADD)!=E.OPERATION.ADD||l instanceof A&&(f=h.ref.$indexes.get(m),B(e,f)),g.op!==E.OPERATION.DELETE){var f=h.getType(m),w=h.getValue(m);if(w&&w.$changes&&!n.has(w.$changes)&&(a.push(w.$changes),w.$changes.ensureRefId(),o++),g.op!==E.OPERATION.TOUCH){if(T.is(f))Z(w,f,l,y),P(e,w.$changes.refId),(g.op&E.OPERATION.ADD)===E.OPERATION.ADD&&this.tryEncodeTypeId(e,f,w.constructor);else if("string"==typeof f){g=void 0,v=void 0,b=void 0,x=void 0,S=void 0,k=void 0;var g=f,v=e,b=w,x=l,S=y,k=(!function(t,e,i,s){var n,a=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":n="number",isNaN(t)&&console.log('trying to encode "NaN" in '+i.constructor.name+"#"+s);break;case"string":n="string",a=!0;break;case"boolean":return}if(typeof t!==n&&(!a||null!==t))throw e="'"+JSON.stringify(t)+"'"+(t&&t.constructor&&" ("+t.constructor.name+")"||""),new L("a '"+n+"' was expected, but "+e+" was provided in "+i.constructor.name+"#"+s)}(b,g,x,S),I[g]);if(!k)throw new L("a '"+g+"' was expected, but "+b+" was provided in "+x.constructor.name+"#"+S);k(v,b)}else{g=F(Object.keys(f)[0]);Z(l["_"+y],g.constructor,l,y),P(e,w.$changes.refId)}i&&h.cache(m,e.slice(_))}}}t||i||h.discard()}return e},T.prototype.encodeAll=function(t){return this.encode(!0,[],t)},T.prototype.applyFilters=function(y,_){void 0===_&&(_=!1);for(var f=this,w=new Set,v=dt.get(y),b=[this.$changes],x=1,S=[],t=0;t<x;t++)!function(t){var e=b[t];if(w.has(e.refId))return;var i=e.ref,s=i instanceof T,t=(C(S,255),P(S,e.refId),v.refIds.has(e)),n=_||!t,a=(v.addRefId(e),v.containerIndexes.get(e)),o=n?Array.from(e.allChanges):Array.from(e.changes.values());!_&&s&&i._definition.indexesWithFilters&&(t=i._definition.indexesWithFilters,t.forEach(function(t){!a.has(t)&&e.allChanges.has(t)&&(n?o.push(t):o.push({op:E.OPERATION.ADD,index:t}))}));for(var r=0,h=o.length;r<h;r++){var l=n?{op:E.OPERATION.ADD,index:o[r]}:o[r];if(l.op===E.OPERATION.CLEAR)C(S,l.op);else{var d=l.index;if(l.op===E.OPERATION.DELETE)s?C(S,l.op|d):(C(S,l.op),P(S,d));else{var c,u=e.getValue(d),p=e.getType(d);if(s){var g=i._definition.filters&&i._definition.filters[d];if(g&&!g.call(i,y,u,f)){u&&u.$changes&&w.add(u.$changes.refId);continue}}else{var m=e.parent,g=e.getChildrenFilter();if(g&&!g.call(m,y,i.$indexes.get(d),u,f)){u&&u.$changes&&w.add(u.$changes.refId);continue}}u.$changes&&(b.push(u.$changes),x++),l.op!==E.OPERATION.TOUCH?l.op===E.OPERATION.ADD||s?(S=S.concat(e.caches[d]),a.add(d)):a.has(d)?S=S.concat(e.caches[d]):(a.add(d),C(S,E.OPERATION.ADD),P(S,d),i instanceof A&&(c=e.ref.$indexes.get(d),B(S,c)),u.$changes?P(S,u.$changes.refId):I[p](S,u)):u.$changes&&!s&&(C(S,E.OPERATION.ADD),P(S,d),i instanceof A&&(c=e.ref.$indexes.get(d),B(S,c)),P(S,u.$changes.refId))}}}}(t);return S},T.prototype.clone=function(){var t,e=new this.constructor,i=this._definition.schema;for(t in i)"object"==typeof this[t]&&"function"==typeof this[t].clone?e[t]=this[t].clone():e[t]=this[t];return e},T.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var t=new Map;T.prototype._triggerAllFillChanges.call(this,this,t);try{T.prototype._triggerChanges.call(this,t)}catch(t){T.onError(t)}}},T.prototype.toJSON=function(){var t,e=this._definition.schema,i=this._definition.deprecated,s={};for(t in e)i[t]||null===this[t]||void 0===this[t]||(s[t]="function"==typeof this[t].toJSON?this[t].toJSON():this["_"+t]);return s},T.prototype.discardAllChanges=function(){this.$changes.discardAll()},T.prototype.getByIndex=function(t){return this[this._definition.fieldsByIndex[t]]},T.prototype.deleteByIndex=function(t){this[this._definition.fieldsByIndex[t]]=void 0},T.prototype.tryEncodeTypeId=function(t,e,i){e._typeid!==i._typeid&&(C(t,213),P(t,i._typeid))},T.prototype.getSchemaType=function(t,e,i){var s;return 213===t[e.offset]&&(e.offset++,s=this.constructor._context.get(D(t,e))),s||i},T.prototype.createTypeInstance=function(t){t=new t;return t.$changes.root=this.$changes.root,t},T.prototype._triggerAllFillChanges=function(t,e){if(!e.has(t.$changes.refId)){var i=[];if(e.set(t.$changes.refId||0,i),t instanceof T){var s,n=t._definition.schema;for(s in n){var a="_"+s,o=t[a];void 0!==o&&(i.push({op:E.OPERATION.ADD,field:s,value:o,previousValue:void 0}),void 0!==o.$changes)&&T.prototype._triggerAllFillChanges.call(this,o,e)}}else for(var r=t.entries();(h=r.next())&&!h.done;){var h=h.value,l=h[0],o=h[1];i.push({op:E.OPERATION.ADD,field:l,dynamicIndex:l,value:o,previousValue:void 0}),void 0!==o.$changes&&T.prototype._triggerAllFillChanges.call(this,o,e)}}},T.prototype._triggerChanges=function(t){var p=this;t.forEach(function(t,e){var i,s,n,a,o,r;if(0<t.length){for(var h=p.$changes.root.refs.get(e),l=h instanceof T,d=0;d<t.length;d++){var c=t[d],u=h.$listeners&&h.$listeners[c.field];if(l||(c.op===E.OPERATION.ADD&&void 0===c.previousValue?null!=(s=(i=h).onAdd)&&s.call(i,c.value,null!=(s=c.dynamicIndex)?s:c.field):c.op===E.OPERATION.DELETE?void 0!==c.previousValue&&null!=(s=(i=h).onRemove)&&s.call(i,c.previousValue,null!=(n=c.dynamicIndex)?n:c.field):c.op===E.OPERATION.DELETE_AND_ADD?(void 0!==c.previousValue&&null!=(a=(n=h).onRemove)&&a.call(n,c.previousValue,c.dynamicIndex),null!=(o=(a=h).onAdd)&&o.call(a,c.value,c.dynamicIndex)):c.op!==E.OPERATION.REPLACE&&c.value===c.previousValue||null!=(r=(o=h).onChange)&&r.call(o,c.value,c.dynamicIndex)),(c.op&E.OPERATION.DELETE)===E.OPERATION.DELETE&&c.previousValue instanceof T&&c.previousValue.onRemove&&c.previousValue.onRemove(),u)try{u.invoke(c.value,c.previousValue)}catch(t){T.onError(t)}}if(l&&h.onChange)try{h.onChange(t)}catch(t){T.onError(t)}}})},T._definition=y.create(),T}(),b=new _,x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),i([d("string",b)],e.prototype,"name",void 0),i([d("string",b)],e.prototype,"type",void 0),i([d("number",b)],e.prototype,"referencedType",void 0),e}(v),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=new R,t}return l(t,e),i([d("number",b)],t.prototype,"id",void 0),i([d([x],b)],t.prototype,"fields",void 0),t}(v),t=function(e){function u(){var t=null!==e&&e.apply(this,arguments)||this;return t.types=new R,t}return l(u,e),u.encode=function(t){var e,t=t.constructor,i=new u,s=(i.rootType=t._typeid,t._context.types);for(e in s){var n,a=new S,o=(a.id=Number(e),n=void 0,d=void 0,c=void 0,h=void 0,l=void 0,a),r=s[e]._definition.schema;for(n in r){var h,l,d=new x,c=(d.name=n,void 0);"string"==typeof r[n]?c=r[n]:(h=r[n],l=void 0,v.is(h)?(c="ref",l=r[n]):(c=Object.keys(h)[0],"string"==typeof h[c]?c+=":"+h[c]:l=h[c]),d.referencedType=l?l._typeid:-1),d.type=c,o.fields.push(d)}i.types.push(o)}return i.encodeAll()},u.decode=function(t,e){var i,a=new _,s=new u,o=(s.decode(t,e),s.types.reduce(function(t,e){i=v,l(n,i);var i,s=n;function n(){return null!==i&&i.apply(this,arguments)||this}e=e.id;return t[e]=s,a.add(s,e),t},{})),n=(s.types.forEach(function(t){var n=o[t.id];t.fields.forEach(function(t){var e,i,s;(void 0!==t.referencedType?(i=t.type,s=o[t.referencedType],s||(e=t.type.split(":"),i=e[0],s=e[1]),d("ref"===i?s:(e={},e[i]=s,e),a)):d(t.type,a))(n.prototype,t.name)})}),o[s.rootType]),r=new n;for(i in n._definition.schema){var h=n._definition.schema[i];"string"!=typeof h&&(r[i]=new("function"==typeof h?h:F(Object.keys(h)[0]).constructor))}return r},i([d([S],b)],u.prototype,"types",void 0),i([d("number",b)],u.prototype,"rootType",void 0),u}(v),e("map",{constructor:A,getProxy:H}),e("array",{constructor:R,getProxy:T}),e("set",{constructor:O}),e("collection",{constructor:M}),E.ArraySchema=R,E.CollectionSchema=M,E.Context=_,E.MapSchema=A,E.Reflection=t,E.ReflectionField=x,E.ReflectionType=S,E.Schema=v,E.SchemaDefinition=y,E.SetSchema=O,E.decode=ht,E.defineTypes=function(t,e,i){void 0===i&&(i=t._context||st);for(var s in e)d(e[s],i)(t.prototype,s);return t},E.deprecated=function(i,t){void 0===i&&(i=!0);return function(t,e){t=t.constructor,t=t._definition;t.deprecated[e]=!0,i&&(t.descriptors[e]={get:function(){throw new Error(e+" is deprecated.")},set:function(t){},enumerable:!1,configurable:!0})}},E.dumpChanges=function(t){for(var e=[t.$changes],t={},s=t,i=0;i<1;i++)!function(t){var i=e[t];i.changes.forEach(function(t){var e=i.ref,t=t.index,e=e._definition?e._definition.fieldsByIndex[t]:e.$indexes.get(t);s[e]=i.getValue(t)})}(i);return t},E.encode=I,E.filter=function(s){return function(t,e){var t=t.constructor,i=t._definition;i.addFilter(e,s)&&(t._context.useFilters=!0)}},E.filterChildren=function(s){return function(t,e){var t=t.constructor,i=t._definition;i.addChildrenFilter(e,s)&&(t._context.useFilters=!0)}},E.hasFilter=function(t){return t._context&&t._context.useFilters},E.registerType=e,E.type=d,Object.defineProperty(E,"__esModule",{value:!0})},o={exports:{}},n(o,o.exports);var C,T=o.exports,V=(F.prototype.connect=function(t){var e=this;this.connection=new G,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(t){e.hasJoined?(e.onLeave.invoke(t.code),e.destroy()):(console.warn("Room connection was closed unexpectedly ("+t.code+"): "+t.reason),e.onError.invoke(t.code,t.reason))},this.connection.events.onerror=function(t){console.warn("Room, onError ("+t.code+"): "+t.reason),e.onError.invoke(t.code,t.reason)},this.connection.connect(t)},F.prototype.leave=function(t){void 0===t&&(t=!0),this.connection?t?this.connection.send([r.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(4e3)},F.prototype.onMessage=function(t,e){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),e)},F.prototype.send=function(t,e){var i,s=[r.Protocol.ROOM_DATA];"string"==typeof t?T.encode.string(s,t):T.encode.number(s,t),void 0!==e?(t=function(t){var e=[],i=[],t=v(e,i,t),t=new ArrayBuffer(t),s=new DataView(t),n=0,a=0,o=-1;0<i.length&&(o=i[0]._offset);for(var r,h,l,d=0,c=e.length;d<c;d++)if(s.setUint8(a+d,e[d]),d+1===o){if(r=i[n],h=r._length,l=a+o,r._bin)for(var u=new Uint8Array(r._bin),p=0;p<h;p++)s.setUint8(l+p,u[p]);else if(r._str){m=void 0,y=void 0,_=void 0,g=void 0,f=void 0,w=void 0;for(var g,m=s,y=l,_=r._str,f=0,w=_.length;f<w;f++)g=_.charCodeAt(f),g<128?m.setUint8(y++,g):(g<2048?m.setUint8(y++,192|g>>6):(g<55296||57344<=g?m.setUint8(y++,224|g>>12):(f++,g=65536+((1023&g)<<10|1023&_.charCodeAt(f)),m.setUint8(y++,240|g>>18),m.setUint8(y++,128|g>>12&63)),m.setUint8(y++,128|g>>6&63)),m.setUint8(y++,128|63&g))}else void 0!==r._float&&s.setFloat64(l,r._float);n++,a+=h,i[n]&&(o=i[n]._offset)}return t}(e),i=new Uint8Array(s.length+t.byteLength),i.set(new Uint8Array(s),0),i.set(new Uint8Array(t),s.length)):i=new Uint8Array(s),this.connection.send(i.buffer)},Object.defineProperty(F.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),F.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},F.prototype.onMessageCallback=function(t){var e,i,s,n,a=Array.from(new Uint8Array(t.data)),o=a[0];o===r.Protocol.JOIN_ROOM?(i=1,this.serializerId=function(t,e){for(var i=t[e++],s="",n=0,a=e,o=e+i;a<o;a++){var r=t[a];if(0==(128&r))s+=String.fromCharCode(r);else if(192==(224&r))s+=String.fromCharCode((31&r)<<6|63&t[++a]);else if(224==(240&r))s+=String.fromCharCode((15&r)<<12|(63&t[++a])<<6|(63&t[++a])<<0);else{if(240!=(248&r))throw new Error("Invalid byte "+r.toString(16));n=(7&r)<<18|(63&t[++a])<<12|(63&t[++a])<<6|(63&t[++a])<<0,65536<=n?(n-=65536,s+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):s+=String.fromCharCode(n)}}return s}(a,1),i+=function(t){void 0===t&&(t="");for(var e,i=0,s=0,n=t.length;s<n;s++)e=t.charCodeAt(s),e<128?i+=1:e<2048?i+=2:e<55296||57344<=e?i+=3:(s++,i+=4);return i+1}(this.serializerId),this.serializer||(e=x(this.serializerId),this.serializer=new e),a.length>i&&this.serializer.handshake&&this.serializer.handshake(a,{offset:i}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([r.Protocol.JOIN_ROOM])):o===r.Protocol.ERROR?(e={offset:1},i=T.decode.number(a,e),n=T.decode.string(a,e),this.onError.invoke(i,n)):o===r.Protocol.LEAVE_ROOM?this.leave():o===r.Protocol.ROOM_DATA_SCHEMA?(e={offset:1},i=this.serializer.getState().constructor._context,s=i.get(T.decode.number(a,e)),n=new s,n.decode(a,e),this.dispatchMessage(s,n)):o===r.Protocol.ROOM_STATE?(a.shift(),this.setState(a)):o===r.Protocol.ROOM_STATE_PATCH?(a.shift(),this.patch(a)):o===r.Protocol.ROOM_DATA&&(i={offset:1},s=T.decode.stringCheck(a,i)?T.decode.string(a,i):T.decode.number(a,i),n=a.length>i.offset?function(t,e){void 0===e&&(e=0);var e=new y(t,e),i=e._parse();if(e._offset!==t.byteLength)throw new Error(t.byteLength-e._offset+" trailing bytes");return i}(t.data,i.offset):void 0,this.dispatchMessage(s,n))},F.prototype.setState=function(t){this.serializer.setState(t),this.onStateChange.invoke(this.serializer.getState())},F.prototype.patch=function(t){this.serializer.patch(t),this.onStateChange.invoke(this.serializer.getState())},F.prototype.dispatchMessage=function(t,e){var i=this.getMessageHandlerKey(t);this.onMessageHandlers.events[i]?this.onMessageHandlers.emit(i,e):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,e):console.warn("onMessage not registered for type '"+t+"'.")},F.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},F.prototype.getMessageHandlerKey=function(t){switch(typeof t){case"function":return"$"+t._typeid;case"string":return t;case"number":return"i"+t;default:throw new Error("invalid message type.")}},F);function F(t,e){var i=this;this.onStateChange=k(),this.onError=k(),this.onLeave=k(),this.onJoin=k(),this.hasJoined=!1,this.onMessageHandlers={events:{},emit(t,...e){(this.events[t]||[]).forEach(t=>t(...e))},on(t,e){return(this.events[t]=this.events[t]||[]).push(e),()=>this.events[t]=(this.events[t]||[]).filter(t=>t!==e)}},this.id=null,this.name=t,e&&(this.serializer=new(x("schema")),this.rootSchema=e,this.serializer.state=new e),this.onError(function(t,e){return console.warn("colyseus.js - onError => ("+t+") "+e)}),this.onLeave(function(){return i.removeAllListeners()})}function B(){return C=C||("undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(t,e){this.cache[t]=e},getItem:function(t){this.cache[t]},removeItem:function(t){delete this.cache[t]}}),C}var P="colyseus-auth-token",j=(r.Platform=void 0,a=r.Platform||(r.Platform={}),a.ios="ios",a.android="android",Object.defineProperty(D.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),D.prototype.login=function(o){return void 0===o&&(o={}),d(this,void 0,void 0,function(){var s,n,a;return c(this,function(t){switch(t.label){case 0:return s=Object.assign({},o),this.hasToken&&(s.token=this.token),[4,this.request("post","/auth",s)];case 1:for(a in n=t.sent(),this.token=n.token,e=P,i=this.token,B().setItem(e,i),n)this.hasOwnProperty(a)&&(this[a]=n[a]);return this.registerPingService(),[2,this]}var e,i})})},D.prototype.save=function(){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return t.sent(),[2,this]}})})},D.prototype.getFriends=function(){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,t.sent()]}})})},D.prototype.getOnlineFriends=function(){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,t.sent()]}})})},D.prototype.getFriendRequests=function(){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,t.sent()]}})})},D.prototype.sendFriendRequest=function(e){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}})})},D.prototype.acceptFriendRequest=function(e){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}})})},D.prototype.declineFriendRequest=function(e){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}})})},D.prototype.blockUser=function(e){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:e})];case 1:return[2,t.sent()]}})})},D.prototype.unblockUser=function(e){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:e})];case 1:return[2,t.sent()]}})})},D.prototype.request=function(a,o,r,h,l){return void 0===r&&(r={}),void 0===l&&(l={}),d(this,void 0,void 0,function(){var e,i,s,n;return c(this,function(t){switch(t.label){case 0:for(i in l.Accept="application/json",this.hasToken&&(l.Authorization="Bearer "+this.token),e=[],r)e.push(i+"="+r[i]);return s=0<e.length?"?"+e.join("&"):"",n={headers:l},h&&(n.body=h),[4,O[a](""+this.endpoint+o+s,n)];case 1:return[2,t.sent().data]}})})},D.prototype.logout=function(){var t;this.token=void 0,t=P,B().removeItem(t),this.unregisterPingService()},D.prototype.registerPingService=function(t){var e=this;void 0===t&&(t=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return e.request("get","/auth")},t)},D.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},D);function D(t){var e,i=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=t.replace("ws","http"),t=P,e=function(t){return i.token=t},t=B().getItem(t),"undefined"!=typeof Promise&&t instanceof Promise?t.then(function(t){return e(t)}):e(t)}E=Error,t(R,E);var E,U=R;function R(t,e){t=E.call(this,t)||this;return t.code=e,Object.setPrototypeOf(t,R.prototype),t}var W="undefined"!=typeof window&&void 0!==window.location?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",u=(Object.defineProperty(A.prototype,"auth",{get:function(){return this._auth||(this._auth=new j(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),A.prototype.joinOrCreate=function(e,i,s){return void 0===i&&(i={}),d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,i,s)];case 1:return[2,t.sent()]}})})},A.prototype.create=function(e,i,s){return void 0===i&&(i={}),d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.createMatchMakeRequest("create",e,i,s)];case 1:return[2,t.sent()]}})})},A.prototype.join=function(e,i,s){return void 0===i&&(i={}),d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.createMatchMakeRequest("join",e,i,s)];case 1:return[2,t.sent()]}})})},A.prototype.joinById=function(e,i,s){return void 0===i&&(i={}),d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,i,s)];case 1:return[2,t.sent()]}})})},A.prototype.reconnect=function(e,i,s){return d(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,{sessionId:i},s)];case 1:return[2,t.sent()]}})})},A.prototype.getAvailableRooms=function(i){return void 0===i&&(i=""),d(this,void 0,void 0,function(){var e;return c(this,function(t){switch(t.label){case 0:return e=this.endpoint.replace("ws","http")+"/matchmake/"+i,[4,p(e,{headers:{Accept:"application/json"}})];case 1:return[2,t.sent().data]}})})},A.prototype.consumeSeatReservation=function(e,i){return d(this,void 0,void 0,function(){var s;return c(this,function(t){return s=this.createRoom(e.room.name,i),s.id=e.room.roomId,s.sessionId=e.sessionId,s.connect(this.buildEndpoint(e.room,{sessionId:s.sessionId})),[2,new Promise(function(t,i){function e(t,e){return i(new L(t,e))}s.onError.once(e),s.onJoin.once(function(){s.onError.remove(e),t(s)})})]})})},A.prototype.createMatchMakeRequest=function(i,s,n,a){return void 0===n&&(n={}),d(this,void 0,void 0,function(){var e;return c(this,function(t){switch(t.label){case 0:return e=this.endpoint.replace("ws","http")+"/matchmake/"+i+"/"+s,this._auth&&this._auth.hasToken&&(n.token=this._auth.token),[4,g(e,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if(e=t.sent().data,e.error)throw new U(e.error,e.code);return[2,this.consumeSeatReservation(e,a)]}})})},A.prototype.createRoom=function(t,e){return new V(t,e)},A.prototype.buildEndpoint=function(t,e){void 0===e&&(e={});var i,s=[];for(i in e)e.hasOwnProperty(i)&&s.push(i+"="+e[i]);return this.endpoint+"/"+t.processId+"/"+t.roomId+"?"+s.join("&")},A);function A(t){void 0===t&&(t=W),this.endpoint=t}I.prototype.setState=function(t){this.state.decode(t)},I.prototype.getState=function(){return this.state},I.prototype.patch=function(t){this.state.decode(t)},I.prototype.teardown=function(){var t;null!=(t=null==(t=this.state)?void 0:t.$changes)&&t.root.clearRefs()},I.prototype.handshake=function(t,e){var i;this.state?(i=new T.Reflection,i.decode(t,e)):this.state=T.Reflection.decode(t,e)};l=I;function I(){}M.prototype.setState=function(t){},M.prototype.getState=function(){return null},M.prototype.patch=function(t){},M.prototype.teardown=function(){},M.prototype.handshake=function(t){};n=M;function M(){}return b("schema",l),b("none",n),r.Auth=j,r.Client=u,r.Room=V,r.SchemaSerializer=l,r.registerSerializer=b,r}();const l=function(){function t(t,...e){n.enabled&&s[t].apply(s,e)}function e(t,...e){for(n[t].apply(n,e),i=0;i<a.length;++i)a[i][t].apply(a[i],e)}let i,s=console,n={enabled:!0,log:t.bind(null,"log"),info:t.bind(null,"info"),warn:t.bind(null,"warn"),error:t.bind(null,"error"),trace:t.bind(null,"trace"),debug:t.bind(null,"debug")},a=[],o={channels:a,console:n,log:e.bind(null,"log"),info:e.bind(null,"info"),warn:e.bind(null,"warn"),error:e.bind(null,"error"),trace:e.bind(null,"trace"),debug:e.bind(null,"debug")};return o}();class h{constructor(){this.invoke=this.fire,this.count=0,this._delegates=[],this._invoking=0,this._dirty=0}add(t,e){if(null!==e&&"object"!=typeof e&&"function"!=typeof e)throw new Error("Invalid target, must be an object or null!");if(0<=this.indexOf(t,e))throw new Error("Delegate already added!");this._delegates.push({callback:t,target:e,state:this._dirty=this._invoking?1:0}),this.count++}remove(t,e){t=this.indexOf(t,e);if(t<0)throw new Error("Delegate is not added!");this._invoking?this._dirty=this._delegates[t].state=-1:this._delegates.splice(t,1),this.count--}clear(){if(this._invoking){for(let t=0;t<this._delegates.length;++t)this._delegates[t].state=-1;this._dirty=1}else this.count=this._delegates.length=0}contains(t,e){return 0<=this.indexOf(t,e)}fire(){if(this._invoking)throw new Error("Delegate is already being invoked!");if(this.count){this._invoking=1;for(let t=0;t<this._delegates.length;++t)this._delegates[t].state||this._delegates[t].callback.apply(this._delegates[t].target,arguments);if(this._invoking=0,this._dirty){for(let t=0;t<this._delegates.length;++t)-1===this._delegates[t].state?this._delegates.splice(t--,1):1===this._delegates[t].state&&(this._delegates[t].state=0);this._dirty=0}}}indexOf(e,i){for(let t=0;t<this._delegates.length;++t)if(-1!==this._delegates[t].state&&this._delegates[t].target===i&&this._delegates[t].callback===e)return t;return-1}}class L extends class{constructor(){this.list=null,this.next=null,this.previous=null}}{constructor(t=null){super(),this.value=t}}class H{constructor(t){this.first=null,this.last=null,this.count=0,t&&this.append(t)}append(t){if(null!==t.list)throw new Error("The node is already in a list!");return 0<this.count?(this.last.next=t,t.previous=this.last):this.first=t,this.last=t,t.list=this,this.count++,t}prepend(t){if(null!==t.list)throw new Error("The node is already in a list!");return 0<this.count?(this.first.previous=t,t.next=this.first):this.last=t,this.first=t,t.list=this,this.count++,t}remove(t){if(t.list!==this)throw new Error("Node is not in this list!");return 1===this.count?this.first=this.last=null:t===this.first?(this.first=t.next,this.first.previous=null):t===this.last?(this.last=t.previous,this.last.next=null):(t.previous.next=t.next,t.next.previous=t.previous),t.list=t.next=t.previous=null,this.count--,t}removeFirst(){return 0<this.count?this.remove(this.first):null}removeLast(){return 0<this.count?this.remove(this.last):null}clear(){let t=this.first;for(;t;){var e=t.next;t.list=t.next=t.previous=null,t=e}this.first=this.last=null,this.count=0}}class z{constructor(){this._pool=[],this._count=0}get count(){return this._count}remove(){let t=null;return 0<this._count&&(t=this._pool[this._count-1],this._pool[this._count-1]=null,this._count--),t}add(t){if(!t)throw new Error("Cannot add null or empty to pool!");this._pool.length>this._count?this._pool[this._count]=t:this._pool.push(t),this._count++}}var G;class N{constructor(t=null){null===t&&(t=Math.floor(Math.random()*G.m)),this.seed=t}current(){return this.seed/G.m}next(){return this.seed=(G.a*this.seed+G.c)%G.m,this.seed/G.m}nextInt(t=0,e=G.m){return e++,Math.floor(this.next()*(e-t)+t)}nextItem(t){return t[Math.floor(this.next()*t.length)]}removeNextItem(t){return t.splice(Math.floor(this.next()*t.length),1)[0]}static current(){return this.seed/this.m}static next(){return this.seed=(this.a*this.seed+this.c)%this.m,this.seed/this.m}static nextInt(t=0,e=this.m){return e++,Math.floor(this.next()*(e-t)+t)}static nextItem(t){return t[Math.floor(this.next()*t.length)]}static removeNextItem(t){return t.splice(Math.floor(this.next()*t.length),1)[0]}}G=N,N.seed=Math.floor(2147483647*Math.random()),N.m=2147483647,N.MAX_SEED=G.m,N.a=1103515245,N.c=12345;var p;function V(){}const j={error:!1};"undefined"!=typeof window&&window.addEventListener("error",function t(e){if(document.getElementById("game-script").src===e.filename){window.removeEventListener("error",t),j.error=!0;try{d.dispose()}catch(e){}document.getElementById("preloader").classList.remove("close"),document.getElementById("preloader").classList.add("error"),document.getElementById("preloader-msg").innerHTML="Sorry, the game crashed. Press here to reload."}});class U{constructor(t,e,i,s,n){this.state=0,this._promiseSet=!1,this.onfulfilled=this.onfulfilled.bind(this),this.onrejected=this.onrejected.bind(this),e!==V&&e.prototype&&l.warn("EventPromiseEntry success handler is not bound"),i!==V&&i.prototype&&l.warn("EventPromiseEntry failure handler is not bound"),s!==V&&s.prototype&&l.warn("EventPromiseEntry cancelSuccess handler is not bound"),n!==V&&n.prototype&&l.warn("EventPromiseEntry cancelFailure handler is not bound"),this._successTarget=e,this._failureTarget=i,this._cancelSuccessTarget=s,this._cancelFailureTarget=n,t&&this.setPromise(t)}setPromise(t){0===this.state&&(this._promiseSet?l.warn("EventPromiseEntry promise was already set!"):t.then(this.onfulfilled,this.onrejected).catch(this.onrejected))}cancel(){0===this.state&&(this.state=3,d.disposePromiseEntry(this))}onfulfilled(t){0===this.state?(this.state=1,this._successTarget(t),d.disposePromiseEntry(this)):3===this.state&&this._cancelSuccessTarget(t)}onrejected(t){0===this.state?(this.state=2,this._failureTarget(t),d.disposePromiseEntry(this)):3===this.state&&this._cancelFailureTarget(t)}}const d=new class{constructor(){this.listenerCount=0,this.timeoutCount=0,this._listenerEntries=[],this._timeoutEntries=[],this._promiseEntries=[],this._isDisposed=!1;let t=!1;var e=Object.defineProperty({},"passive",{get:function(){return t=!0,!0}});self.addEventListener("testPassive",null,e),self.removeEventListener("testPassive",null,e),this.isEventOptionsSupported=t}dispose(){if(!this._isDisposed){for(;0<this._listenerEntries.length;)this.remove(this._listenerEntries[0].target,this._listenerEntries[0].type,this._listenerEntries[0].callback);for(;0<this._timeoutEntries.length;)this.clearTimeout(this._timeoutEntries[0].callback);for(;0<this._promiseEntries.length;)this.disposePromiseEntry(this._promiseEntries[0]);this._isDisposed=!0}}promise(t,e,i,s=V,n=V){t=new U(t,e,i,s,n);return this._isDisposed?(l.warn("Tried to add a EventManager.promise after disposed!"),t.cancel()):this._promiseEntries.push(t),t}disposePromiseEntry(t){this._promiseEntries.length;t.cancel(),this._promiseEntries.splice(this._promiseEntries.indexOf(t),1)}add(t,e,i,s=!1,n=!0){if(!this._isDisposed){if(i.prototype)throw new Error("Must be bound!");if(0<=this.indexOf(t,e,i))throw new Error("Event handler already added!");this._listenerEntries.push({target:t,type:e,callback:i,capture:s,passive:n}),this.listenerCount++,this.isEventOptionsSupported?t.addEventListener(e,i,{capture:s,passive:n}):s?t.addEventListener(e,i,!0):t.addEventListener(e,i)}}remove(t,e,i){if(!this._isDisposed){var s=this.indexOf(t,e,i);if(s<0)throw new Error("Event handler is not added!");var n=this._listenerEntries[s];this._listenerEntries.splice(s,1),this.listenerCount--,this.isEventOptionsSupported?t.removeEventListener(e,i,{capture:n.capture,passive:n.passive}):n.capture?t.removeEventListener(e,i,!0):t.removeEventListener(e,i)}}contains(t,e,i){return 0<=this.indexOf(t,e,i)}indexOf(e,i,s){for(let t=0;t<this._listenerEntries.length;++t)if(this._listenerEntries[t].target===e&&this._listenerEntries[t].type===i&&this._listenerEntries[t].callback===s)return t;return-1}setTimeout(i,s,t,...n){if(this._isDisposed)return;if(i.prototype)throw new Error("Must be bound!");if(0<=this.indexOfTimeout(i))throw new Error("Timeout handler already added!");let a={callback:i,duration:s,args:n,id:null,repeat:t},o=(this._timeoutEntries.push(a),this.timeoutCount++,this);let r=a.id=setTimeout(function t(){var e=o.indexOfTimeout(i);o._timeoutEntries.splice(e,1),a.id=null,o.timeoutCount--,a.repeat&&(o._timeoutEntries.push(a),o.timeoutCount++,r=a.id=setTimeout(t,s)),a.callback.apply(null,n)},s)}clearTimeout(t){if(!this._isDisposed){t=this.indexOfTimeout(t);if(t<0)throw new Error("Timeout handler is not added!");var e=this._timeoutEntries[t];this._timeoutEntries.splice(t,1),this.timeoutCount--,clearTimeout(e.id),e.id=null}}containsTimeout(t){return 0<=this.indexOfTimeout(t)}indexOfTimeout(e){for(let t=0;t<this._timeoutEntries.length;++t)if(this._timeoutEntries[t].callback===e)return t;return-1}};class u{get isRunning(){return null!==this._worker}static register(t){if(this._runnables[t.classpath])throw new Error("Runnable already registered at classpath: "+t.classpath);this._runnables[t.classpath]=t}static dispose(){for(;0<this.active.length;)this.active[0].stop()}static sendMessage(t,e=null){if(this.isMainThread)throw new Error("On Main Thread!");t={type:t,data:e};self.postMessage(t)}static self_message(t){if(t.data.start){if(this._started)throw new Error("Already started!");this._started=!0;var e=this._runnables[t.data.start];if(!e)throw new Error("Could not find runnable with classpath: "+t.data.start);e.main(t.data.args)}else{e=t.data;this.onMessage.invoke(e)}}constructor(t){if(this.onMessage=new h,this._workerURL=null,this._worker=null,this._runnable=null,!u.isSupported)throw new Error("Threads are not supported!");if(!u.isMainThread)throw new Error("Child threads are not supported!");this.worker_message=this.worker_message.bind(this),this.worker_error=this.worker_error.bind(this),this._runnable=t}start(t){if(null!==this._worker)throw new Error("Already running!");if(u.active.length>=u.maxThreads)throw new Error("Maximum threads already started!");u.active.push(this),this._worker=new Worker(c.script.src),d.add(this._worker,"message",this.worker_message),d.add(this._worker,"error",this.worker_error),this._worker.postMessage({start:this._runnable.classpath,args:t})}stop(){if(null===this._worker)throw new Error("Not running!");d.remove(this._worker,"message",this.worker_message),d.remove(this._worker,"error",this.worker_error),this._worker.terminate(),this._worker=null,this._workerURL&&(URL.revokeObjectURL(this._workerURL),this._workerURL=null),u.active.splice(u.active.indexOf(this),1)}sendMessage(t,e=null){if(null===this._worker)throw new Error("Not running!");t={type:t,data:e};this._worker.postMessage(t)}worker_message(t){t=t.data;this.onMessage.invoke(t)}worker_error(t){throw t.error}}u.onMessage=new h,u.isSupported=!0,u.isMainThread=!1,u.maxThreads=0,u.active=[],u._started=!1,u._runnables={},u.staticConstructor=function(e){if(e.self_message=e.self_message.bind(e),"undefined"!=typeof Worker&&"undefined"!=typeof URL&&URL.createObjectURL?e.isSupported=!0:e.isSupported=!1,"undefined"!=typeof Window?e.isMainThread=!0:e.isMainThread=!1,e.isSupported&&e.isMainThread){let t=navigator.hardwareConcurrency||4;isNaN(t)||t<1?t=1:16<t&&(t=16),e.maxThreads=t}else e.maxThreads=0;e.isMainThread||d.add(self,"message",e.self_message)}(u);const W=u.isMainThread?new class{constructor(){var t,e=document,i=window,s=document.fonts&&document.fonts.add&&document.fonts.delete&&"undefined"!=typeof FontFace&&!!FontFace.prototype.load;this.fontFace={support:s?"W3C":"Unsupported",isSupported:s},this.webAudio={support:self.AudioContext?"W3C":self.webkitAudioContext?"WebKit":"Unsupported",isSupported:!(!self.AudioContext&&!self.webkitAudioContext)},i.PointerEvent&&"onpointerdown"in i?this.pointerEvents={support:"W3C",isSupported:!0,pointerover:"pointerover",pointerenter:"pointerenter",pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",pointercancel:"pointercancel",pointerout:"pointerout",pointerleave:"pointerleave"}:this.pointerEvents={support:"Unsupported",isSupported:!1},e.pointerLockElement!==t?this.pointerLock={support:"W3C",isSupported:!0,pointerLockElement:"pointerLockElement",requestPointerLock:"requestPointerLock",exitPointerLock:"exitPointerLock",pointerlockchange:"pointerlockchange",pointerlockerror:"pointerlockerror"}:e.webkitPointerLockElement!==t?this.pointerLock={support:"WebKit",isSupported:!0,pointerLockElement:"webkitPointerLockElement",requestPointerLock:"webkitRequestPointerLock",exitPointerLock:"webkitExitPointerLock",pointerlockchange:"webkitpointerlockchange",pointerlockerror:"webkitpointerlockerror"}:e.mozPointerLockElement!==t?this.pointerLock={support:"Moz",isSupported:!0,pointerLockElement:"mozPointerLockElement",requestPointerLock:"mozRequestPointerLock",exitPointerLock:"mozExitPointerLock",pointerlockchange:"mozpointerlockchange",pointerlockerror:"mozpointerlockerror"}:this.pointerLock={support:"Unsupported",isSupported:!1},e.fullscreenEnabled!==t?this.fullscreen={support:"W3C",isSupported:!0,fullscreenEnabled:"fullscreenEnabled",fullscreenElement:"fullscreenElement",requestFullscreen:"requestFullscreen",exitFullscreen:"exitFullscreen",fullscreenchange:"fullscreenchange",fullscreenerror:"fullscreenerror"}:e.webkitFullscreenEnabled!==t?this.fullscreen={support:"WebKit",isSupported:!0,fullscreenEnabled:"webkitFullscreenEnabled",fullscreenElement:"webkitFullscreenElement",requestFullscreen:"webkitRequestFullscreen",exitFullscreen:"webkitExitFullscreen",fullscreenchange:"webkitfullscreenchange",fullscreenerror:"webkitfullscreenerror"}:e.mozFullScreenEnabled!==t?this.fullscreen={support:"Moz",isSupported:!0,fullscreenEnabled:"mozFullScreenEnabled",fullscreenElement:"mozFullScreenElement",requestFullscreen:"mozRequestFullScreen",exitFullscreen:"mozCancelFullScreen",fullscreenchange:"mozfullscreenchange",fullscreenerror:"mozfullscreenerror"}:e.msFullscreenEnabled!==t?this.fullscreen={support:"MS",isSupported:!0,fullscreenEnabled:"msFullscreenEnabled",fullscreenElement:"msFullscreenElement",requestFullscreen:"msRequestFullscreen",exitFullscreen:"msExitFullscreen",fullscreenchange:"MSFullscreenChange",fullscreenerror:"MSFullscreenError"}:this.fullscreen={support:"Unsupported",isSupported:!1},e.visibilityState!==t?this.pageVisibility={support:"W3C",isSupported:!0,visibilityState:"visibilityState",visibilitychange:"visibilitychange"}:e.webkitVisibilityState!==t?this.pageVisibility={support:"WebKit",isSupported:!0,visibilityState:"webkitVisibilityState",visibilitychange:"webkitvisibilitychange"}:e.mozVisibilityState!==t?this.pageVisibility={support:"Moz",isSupported:!0,visibilityState:"mozVisibilityState",visibilitychange:"mozvisibilitychange"}:e.msVisibilityState!==t?this.pageVisibility={support:"MS",isSupported:!0,visibilityState:"msVisibilityState",visibilitychange:"msvisibilitychange"}:this.pageVisibility={support:"Unsupported",isSupported:!1}}}:null;class v{static dist(t,e,i,s){return vt.warn("Vector2::dist","Vector2::distance"),this.distance(t,i,e,s)}static distance(t,e,i,s){return t=i-t,e=s-e,Math.sqrt(t*t+e*e)}static dotProduct(t,e,i,s){return vt.warn("Vector2::dotProduct","Vector2::dot"),this.dot(t,i,e,s)}static dot(t,e,i,s){return t*i+e*s}constructor(t,e){this.x=t||0,this.y=e||0}set(t,e){return this.x=t,this.y=e,this}copy(t){return this.x=t.x,this.y=t.y,this}unit(t,e=1,i=!1){return i?(this.x=Math.cos(t*b.DEG_TO_RAD)*e,this.y=Math.sin(t*b.DEG_TO_RAD)*e):(this.x=b.cosDegrees(t)*e,this.y=b.sinDegrees(t)*e),this}normalize(t=1){var e=this.length();return 0<e&&(this.x/=e,this.y/=e),this.x*=t,this.y*=t,this}scale(t){return this.x*=t,this.y*=t,this}add(t){return this.x+=t.x,this.y+=t.y,this}addValues(t,e){return this.x+=t,this.y+=e,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}subtractValues(t,e){return this.x-=t,this.y-=e,this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}floorTo(t){return t=Math.pow(10,t),this.x=Math.floor(this.x*t)/t,this.y=Math.floor(this.y*t)/t,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundTo(t){return t=Math.pow(10,t),this.x=Math.round(this.x*t)/t,this.y=Math.round(this.y*t)/t,this}rotation(){let t=Math.atan2(this.y,this.x)*b.RAD_TO_DEG;return t<0&&(t+=360),t}distance(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}distanceSquared(t){return(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}right(){var t=this.x;return this.x=this.y,this.y=-t,this}left(){var t=this.x;return this.x=-this.y,this.y=t,this}inverse(){return this.x*=-1,this.y*=-1,this}dotProduct(t){return vt.warn("Vector2::dotProduct","Vector2::dot"),this.dot(t)}dot(t){return this.x*t.x+this.y*t.y}crossProduct(t){return vt.warn("Vector2::crossProduct","Vector2::cross"),this.cross(t)}cross(t){return this.x*t.y-this.y*t.x}clone(){return new v(this.x,this.y)}toVector3(){return new g(this.x,this.y,0)}equals(t,e){return"number"==typeof t?this.x===t&&this.y===e:this.x===t.x&&this.y===t.y}interpolate(t,e){return e=e||new v,e.x=this.x*t,e.y=this.y*t,e}toString(){return"[Vector2 (x="+this.x+" y="+this.y+")]"}}class g{constructor(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}normalize(t=1){var e=this.length();return 0<e&&(this.x/=e,this.y/=e,this.z/=e),this.x*=t,this.y*=t,this.z*=t,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addValues(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtractValues(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}negate(){return vt.warn("Vector3::negate","Vector3::inverse"),this.inverse()}inverse(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){var e=this.x,i=this.y;return this.x=i*t.z-this.z*t.y,this.y=this.z*t.x-e*t.z,this.z=e*t.y-i*t.x,this}tangents(t,e){var i,s=this.length();0<s?(i=g._helper,s=1/s,i.set(this.x*s,this.y*s,this.z*s),s=g._helper2,Math.abs(i.x)<.9?s.set(1,0,0):s.set(0,1,0),t.copy(i).cross(s),e.copy(i).cross(t)):(t.set(1,0,0),e.set(0,1,0))}isAntiparallelTo(t,e){return g._helper.copy(this).inverse(),g._helper.almostEquals(t,e)}clone(){return new g(this.x,this.y,this.z)}toVector2(){return new v(this.x,this.y)}equals(t,e,i){return"number"==typeof t?this.x===t&&this.y===e&&this.z===i:this.x===t.x&&this.y===t.y&&this.z===t.z}almostEquals(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)}}g._helper=new g,g._helper2=new g;class ${constructor(){this.isInvalid=!0,this.l=0,this.r=0,this.t=0,this.b=0,this.w=0,this.h=0}setInvalid(){return this.isInvalid=!(this.l=this.r=this.t=this.b=this.w=this.h=0),this}setPoints(e){if(0===e.length)this.isInvalid=!(this.l=this.r=this.t=this.b=this.w=this.h=0);else{this.isInvalid=!1,this.l=this.r=e[0].x,this.t=this.b=e[0].y;for(let t=1;t<e.length;++t)e[t].x<this.l?this.l=e[t].x:e[t].x>this.r&&(this.r=e[t].x),e[t].y<this.t?this.t=e[t].y:e[t].y>this.b&&(this.b=e[t].y);this.w=this.r-this.l,this.h=this.b-this.t}return this}setXYWH(t,e,i,s){return i<0&&(i*=-1,t-=i),s<0&&(s*=-1,e-=s),this.r=(this.l=t)+(this.w=i),this.b=(this.t=e)+(this.h=s),this}setXYXY(t,e,i,s){return this.w=t<i?(this.r=i)-(this.l=t):(this.r=t)-(this.l=i),this.h=e<s?(this.b=s)-(this.t=e):(this.b=e)-(this.t=s),this}setXYXYRadius(t,e,i,s,n){return this.l=Math.min(t,i)-n,this.r=Math.max(t,i)+n,this.t=Math.min(e,s)-n,this.b=Math.max(e,s)+n,this.w=this.r-this.l,this.h=this.b-this.t,this}test(t){return this.l<t.r&&this.r>t.l&&this.t<t.b&&this.b>t.t?2:this.l<=t.r&&this.r>=t.l&&this.t<=t.b&&this.b>=t.t?1:0}}const b=new class{constructor(){this.DEG_TO_RAD=Math.PI/180,this.RAD_TO_DEG=180/Math.PI,this.TWO_PI=2*Math.PI,this._lutCosDegrees=[],this._lutSinDegrees=[],this._v1=new v,this._v2=new v,this._lutCosDegrees.length=this._lutSinDegrees.length=3600;for(let t=0;t<3600;++t)this._lutCosDegrees[t]=Math.cos(this.DEG_TO_RAD*t/10),this._lutSinDegrees[t]=Math.sin(this.DEG_TO_RAD*t/10)}isInteger(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}isNonNegativeInteger(t){return this.isInteger(t)&&0<=t}isPowerOf2(t){return 0==(t&t-1)}truncate(t){return t=+t,isFinite(t)?t-t%1||(t<0?-0:0===t?t:0):t}roundTo(t,e){return t=+t,isFinite(t)&&(e=Math.pow(10,e),t*=e,t=Math.round(t),t/=e),t}clamp(t,e,i){return Math.max(e,Math.min(t,i))}cosDegrees(t){return t*=10,t=t+(0<=t?.5:-.5)<<0,t%=3600,t=-0===t?0:t,t=0<=t?t:t+3600,this._lutCosDegrees[t]}sinDegrees(t){return t*=10,t=t+(0<=t?.5:-.5)<<0,t%=3600,t=-0===t?0:t,t=0<=t?t:t+3600,this._lutSinDegrees[t]}areObjectsConverging(t,e,i,s){return this._v1.set(s.x-e.x,s.y-e.y).dot(this._v2.set(i.x-t.x,i.y-t.y))<0}interpolateAlongValues(t,e){if(e.length%2!=0)throw new Error("Odd number of values!");if(e.length<2)return new v(e[0],e[1]);if(t<=0)return new v(e[0],e[1]);if(1<=t)return new v(e[e.length-2],e[e.length-1]);var i=[];for(let t=0;t<e.length;t+=2)i.push(new v(e[t],e[t+1]));let s=0;var n=[0];for(let t=1;t<i.length;++t){var a=i[t-1],o=i[t];s+=o.distance(a),n.push(s)}if(0===s)return new v(e[0],e[1]);var r=t*s;for(let t=1;t<n.length;++t){var h,l,d,c=n[t],u=n[t-1];if(u<r&&r<=c)return h=i[t-1],l=i[t],l.subtract(h),d=r-u,c=c-u,u=new v,l.interpolate(d/c,u),u.add(h),u}throw new Error("Should never happen!")}normalizeDegrees(t){for(;t<0;)t+=360;for(;360<=t;)t-=360;return t}lineLineIntersection(t,e,i,s){var n;return t.x===e.x&&t.y===e.y||i.x===s.x&&i.y===s.y||(n=(s.y-i.y)*(e.x-t.x)-(s.x-i.x)*(e.y-t.y),0==n)?null:(s=((s.x-i.x)*(t.y-i.y)-(s.y-i.y)*(t.x-i.x))/n,i=t.x+s*(e.x-t.x),n=t.y+s*(e.y-t.y),new v(i,n))}};{var Y=p=p||{};Math.PI,Y.none=function(t,e,i,s){return i*t/s+e};let u;function q(t,e,i,s,n,a){var o=.025*i,r=t,h=e,l=i+o,d=.7*s,c=t-d,e=e+i+o,i=-o,o=s-d;return t<=d?n(r,h,l,d):a(c,e,i,o)}s=u=Y.Quadratic||(Y.Quadratic={}),s.easeIn=function(t,e,i,s){return i*(t/=s)*t+e},s.easeOut=function(t,e,i,s){return-i*(t/=s)*(t-2)+e},s.easeInOut=function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},s=Y.Cubic||(Y.Cubic={}),s.easeOut=function(t,e,i,s){return t/=s,(1-Math.pow(1-t,3))*i+e},s.easeIn=function(t,e,i,s){return t/=s,t*t*t*i+e},s=Y.Circ||(Y.Circ={}),s.easeOut=function(t,e,i,s){return t/=s,Math.sqrt(1-Math.pow(t-1,2))*i+e},s=Y.Quart||(Y.Quart={}),s.easeOut=function(t,e,i,s){return t/=s,(1-Math.pow(1-t,4))*i+e},s.easeIn=function(t,e,i,s){return t/=s,Math.pow(t,4)*i+e},s=Y.Quint||(Y.Quint={}),s.easeOut=function(t,e,i,s){return t/=s,(1-Math.pow(1-t,5))*i+e},s.easeIn=function(t,e,i,s){return t/=s,Math.pow(t,5)*i+e},s=Y.Expo||(Y.Expo={}),s.easeOut=function(t,e,i,s){return t/=s,(1==t?1:1-Math.pow(2,-10*t))*i+e},s=Y.Overshoot||(Y.Overshoot={}),s.softEaseOut=function(t,e,i,s){return q(t,e,i,s,u.easeOut,Y.none)},s.medEaseOut=function(t,e,i,s){return t=t,e=e,i=i,s=s,n=u.easeOut,a=Y.none,o=.05*i,r=t,h=e,l=i+o,d=.7*s,c=t-d,e=e+i+o,i=-o,o=s-d,t<=d?n(r,h,l,d):a(c,e,i,o);var n,a,o,r,h,l,d,c},s.softEaseInOut=function(t,e,i,s){return q(t,e,i,s,u.easeIn,u.easeOut)},s.eastOutPct30=function(t,e,i,s){return t=t,e=e,i=i,s=s,n=u.easeOut,a=Y.none,o=.3*i,r=t,h=e,l=i+o,d=.7*s,c=t-d,e=e+i+o,i=-o,o=s-d,t<=d?n(r,h,l,d):a(c,e,i,o);var n,a,o,r,h,l,d,c},s=Y.Bounce||(Y.Bounce={}),s.easeOut=function(t,e,i,s){let n=t/s,a=(t=7.5625,s=2.75,0);return n<=0?e:1<=n?e+i:(a=n<1/s?t*n*n:n<2/s?t*(n-=1.5/s)*n+.75:n<2.5/s?t*(n-=2.25/s)*n+.9375:t*(n-=2.625/s)*n+.984375,a*i+e)},s=Y.Rock||(Y.Rock={}),s.easeOut=function(t,e,i,s){return s/=7,t<=s?u.easeIn(t,e,i,s):t<=2*s?u.easeOut(t-s,e+i,.5*i,s):t<=3*s?u.easeIn(t-2*s,e+1.5*i,-i/2,s):t<=4*s?u.easeOut(t-3*s,e+i,-i/4,s):t<=5*s?u.easeIn(t-4*s,e+.75*i,i/4,s):t<=6*s?u.easeOut(t-5*s,e+i,i/8,s):u.easeIn(t-6*s,e+1.125*i,-i/8,s)}}class X{get hasMoreLoops(){return this.total<0||this.count<this.total}constructor(t=-1,e=!1){this.total=0,this.count=0,this.total=t,this.reverseDirection=e}loop(t,e=!0){e?(this.count++,t.time-=t.duration):(this.count--,t.time+=t.duration),this.reverseDirection&&(e=t.start,t.start=t.end,t.end=e)}}class n{get duration(){return this._duration}set duration(t){if(t<=0)throw new Error("Supplied duration must be greater than 0!");this._duration=t}get value(){return this.ease.safeForExclusiveValues?this.ease(this.time-this.delay,this.start,this.end-this.start,this._duration):this.time<=this.delay?this.start:this.time-this.delay>=this.duration?this.end:this.ease(this.time-this.delay,this.start,this.end-this.start,this._duration)}get position(){return this.time<=this.delay?0:this.time-this.delay>=this.duration?1:(this.time-this.delay)/this._duration}get easedPosition(){return this.ease.safeForExclusiveValues?this.ease((this.time-this.delay)/this._duration,0,1,1):this.time<=this.delay?0:this.time-this.delay>=this.duration?1:this.ease((this.time-this.delay)/this._duration,0,1,1)}get isFinished(){return this.time>=this._duration+this.delay&&(!this.looper||!this.looper.hasMoreLoops)}constructor(t,e,i,s=0,n=null,a=null){this.onStarted=new h,this.onLooped=new h,this.onReverseLooped=new h,this.onFinished=new h,this._duration=1,this.time=0,this.delay=s,this.start=t,this.end=e,this.duration=i,this.ease=n||p.none,this.looper=a}underflow(){for(;this.time<0;)this.looper?(this.looper.loop(this,!1),this.onReverseLooped.count&&this.onReverseLooped.invoke(this)):this.time=0}overflow(){for(;this.time>this._duration+this.delay;)this.looper&&this.looper.hasMoreLoops?(this.looper.loop(this,!0),this.onLooped.count&&this.onLooped.invoke(this)):(this.time=this._duration+this.delay,this.onFinished.count&&this.onFinished.invoke(this))}reachedEnding(){this.looper&&this.looper.hasMoreLoops||this.onFinished.count&&this.onFinished.invoke(this)}update(t){let e=!1;return this.time<=this.delay&&(e=!0),this.time+=t,e&&this.time>this.delay&&this.onStarted.invoke(this),this.time<0?this.underflow():this.time===this._duration+this.delay?this.reachedEnding():this.time>this._duration+this.delay&&this.overflow(),this.value}}class J{constructor(t=0,e=0,i=50){this.origin=new v(t,e),this.radius=i}containsVector(t){return t.distanceSquared(this.origin)<this.radius*this.radius}}class Q{get isIdentity(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty}constructor(t=1,e=0,i=0,s=1,n=0,a=0){this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=a}set(t,e,i,s,n,a){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=a,this}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}identity(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this}setTransform(t,e,i,s,n,a,o,r,h){this.a=this.d=1,this.b=this.c=this.tx=this.ty=0;let l,d;return d=n%360?(l=b.cosDegrees(n),b.sinDegrees(n)):(l=1,0),a||o?(this.append(b.cosDegrees(o),b.sinDegrees(o),-b.sinDegrees(a),b.cosDegrees(a),t,e),this.append(l*i,d*i,-d*s,l*s,0,0)):this.append(l*i,d*i,-d*s,l*s,t,e),(r||h)&&(this.tx-=r*this.a+h*this.c,this.ty-=r*this.b+h*this.d),this}invert(){var t=this.a,e=this.tx,i=t*this.d-this.b*this.c;return this.tx=(this.c*this.ty-this.d*e)/i,this.ty=-(this.a*this.ty-this.b*e)/i,this.a=this.d/i,this.b=-this.b/i,this.c=-this.c/i,this.d=t/i,this}append(t,e,i,s,n,a){var o=this.a,r=this.b,h=this.c,l=this.d;return 1===t&&0===e&&0===i&&1===s||(this.a=o*t+h*e,this.b=r*t+l*e,this.c=o*i+h*s,this.d=r*i+l*s),this.tx=o*n+h*a+this.tx,this.ty=r*n+l*a+this.ty,this}appendMatrix(t){var e=this.a,i=this.b,s=this.c,n=this.d;return 1===t.a&&0===t.b&&0===t.c&&1===t.d||(this.a=e*t.a+s*t.b,this.b=i*t.a+n*t.b,this.c=e*t.c+s*t.d,this.d=i*t.c+n*t.d),this.tx=e*t.tx+s*t.ty+this.tx,this.ty=i*t.tx+n*t.ty+this.ty,this}appendTransform(t,e,i,s,n,a,o,r,h){let l,d;return d=n%360?(l=b.cosDegrees(n),b.sinDegrees(n)):(l=1,0),a||o?(this.append(b.cosDegrees(o),b.sinDegrees(o),-b.sinDegrees(a),b.cosDegrees(a),t,e),this.append(l*i,d*i,-d*s,l*s,0,0)):this.append(l*i,d*i,-d*s,l*s,t,e),(r||h)&&(this.tx-=r*this.a+h*this.c,this.ty-=r*this.b+h*this.d),this}prepend(t,e,i,s,n,a){var o=this.a,r=this.c,h=this.tx;return this.a=t*o+i*this.b,this.b=e*o+s*this.b,this.c=t*r+i*this.d,this.d=e*r+s*this.d,this.tx=t*h+i*this.ty+n,this.ty=e*h+s*this.ty+a,this}prependMatrix(t){var e=this.a,i=this.c,s=this.tx;return this.a=t.a*e+t.c*this.b,this.b=t.b*e+t.d*this.b,this.c=t.a*i+t.c*this.d,this.d=t.b*i+t.d*this.d,this.tx=t.a*s+t.c*this.ty+t.tx,this.ty=t.b*s+t.d*this.ty+t.ty,this}prependTransform(t,e,i,s,n,a,o,r,h){t=Q._helper.setTransform(t,e,i,s,n,a,o,r,h);return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)}transformVector(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.c+this.tx,t.y=e*this.b+i*this.d+this.ty,t}clone(){return new Q(this.a,this.b,this.c,this.d,this.tx,this.ty)}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"}}Q._helper=new Q;class K{constructor(t,e,i,s){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0===s?1:s}identity(){this.x=this.y=this.z=0,this.w=1}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setFromVectors(t,e){var i,s;return t.isAntiparallelTo(e)?(i=K._helperVec1,s=K._helperVec2,t.tangents(i,s),this.setFromAxisAngle(i,Math.PI)):(s=t.cross(e),this.x=s.x,this.y=s.y,this.z=s.z,this.w=Math.sqrt(Math.pow(t.length(),2)*Math.pow(e.length(),2))+t.dot(e),this.normalize()),this}setFromAxisAngle(t,e){var i=Math.sin(.5*e);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=Math.cos(.5*e),this}setFromEuler(t,e,i,s){s=s||0;var n=Math.cos(t/2),a=Math.cos(e/2),o=Math.cos(i/2),t=Math.sin(t/2),e=Math.sin(e/2),i=Math.sin(i/2);return 0===s?(this.x=t*a*o+n*e*i,this.y=n*e*o-t*a*i,this.z=n*a*i+t*e*o,this.w=n*a*o-t*e*i):1===s?(this.x=t*a*o+n*e*i,this.y=n*e*o-t*a*i,this.z=n*a*i-t*e*o,this.w=n*a*o+t*e*i):2===s?(this.x=t*a*o-n*e*i,this.y=n*e*o+t*a*i,this.z=n*a*i+t*e*o,this.w=n*a*o-t*e*i):3===s?(this.x=t*a*o-n*e*i,this.y=n*e*o+t*a*i,this.z=n*a*i-t*e*o,this.w=n*a*o+t*e*i):4===s?(this.x=t*a*o+n*e*i,this.y=n*e*o+t*a*i,this.z=n*a*i-t*e*o,this.w=n*a*o-t*e*i):5===s&&(this.x=t*a*o-n*e*i,this.y=n*e*o-t*a*i,this.z=n*a*i+t*e*o,this.w=n*a*o+t*e*i),this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}normalize(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0==t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}integrate(t,e,i){var s=t.x*i.x,n=t.y*i.y,t=t.z*i.z,i=this.x,a=this.y,o=this.z,r=this.w,e=.5*e;return this.x+=e*(s*r+n*o-t*a),this.y+=e*(n*r+t*i-s*o),this.z+=e*(t*r+s*a-n*i),this.w+=e*(-s*i-n*a-t*o),this}vmult(t,e){return vt.warn("Quaternion::vmult","Quaternion::transformVector"),e=e||new g,e.copy(t),this.transformVector(e)}transformVector(t){var e=t.x,i=t.y,s=t.z,n=this.x,a=this.y,o=this.z,r=this.w,h=r*e+a*s-o*i,l=r*i+o*e-n*s,d=r*s+n*i-a*e,e=-n*e-a*i-o*s;return t.x=h*r+e*-n+l*-o-d*-a,t.y=l*r+e*-a+d*-n-h*-o,t.z=d*r+e*-o+h*-a-l*-n,t}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}}K._helperVec1=new g,K._helperVec2=new g;class r{get isEmpty(){return 0===this.width||0===this.height}get bottom(){return this.y+this.height}get right(){return this.x+this.width}constructor(t,e,i,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0}set(t,e,i,s){return this.x=t,this.y=e,this.width=i,this.height=s,this}copy(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this}containsVector(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height}extend(t){var e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),s=Math.max(this.x+this.width,t.x+t.width),t=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.y=i,this.width=s,this.height=t,this}equals(t){return t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}clone(){return new r(this.x,this.y,this.width,this.height)}toString(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"}}class Z{constructor(t,e,i,s,n,a){this.p1=new v(t||0,e||0),this.p2=new v(i||0,s||0),this.p3=new v(n||0,a||0)}containsVector(t){var e,i,s;return this.p1.x===this.p2.x&&this.p1.x===this.p3.x&&this.p1.y===this.p2.y&&this.p1.y===this.p3.y?t.x===this.p1.x&&t.y===this.p1.y:(s=Z.sign(t,this.p1,this.p2),e=Z.sign(t,this.p2,this.p3),t=Z.sign(t,this.p3,this.p1),i=s<0||e<0||t<0,s=0<s||0<e||0<t,!(i&&s))}static sign(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)}copy(t){return this.p1.copy(t.p1),this.p2.copy(t.p2),this.p3.copy(t.p3),this}set(t,e,i,s,n,a){return this.p1.set(t,e),this.p2.set(i,s),this.p3.set(n,a),this}isEmpty(){var t=this.p1.x*(this.p2.y-this.p3.y)+this.p2.x*(this.p3.y-this.p1.y)+this.p3.x*(this.p1.y-this.p2.y);return 0==t}bisector(t,e){e=e||new v;let i=this.p3,s=this.p1,n=this.p2;2===t?(i=this.p1,s=this.p2,n=this.p3):3===t&&(i=this.p2,s=this.p3,n=this.p1);t=(Math.atan2(i.y-s.y,i.x-s.x)+Math.atan2(n.y-s.y,n.x-s.x))/2;return e.x=s.x+Math.cos(t),e.y=s.y+Math.sin(t),e}}const a=new class{genCombosTable(e){var i=[];i.length=e.length+1;for(let t=0;t<i.length;++t)i[t]=this.genCombos(e,t);return i}genCombos(t,e){var i=[],s=(i.length=e,[]);return this.genCombosRecursion(t,0,e,i,0,s),s}genCombosRecursion(e,i,s,n,a,o){if(a===s)o.push(n.slice());else for(let t=i;t<e.length;++t)n[a]=e[t],this.genCombosRecursion(e,t+1,s,n,a+1,o)}validateNonNullObject(t,e){return null===t||"object"!=typeof t?e:t}validateBoolean(t,e){return null==t||!0!==t&&!1!==t?e:t}validateString(t,e){return"string"!=typeof t?e:t}validateIntArrayMinInclusive(e,i,s){if(!Array.isArray(e))return s;for(let t=0;t<e.length;++t){var n=e[t];if(null==n)return s;if("number"!=typeof n)return s;if(n<i)return s;n|=0,e[t]=n}return e}validateIntMinInclusive(t,e,i){return null==t||"number"!=typeof t||t<e?i:0|t}validateNumberMinInclusive(t,e,i){return null==t||"number"!=typeof t||t<e?i:t}validateNumberRangeInclusive(t,e,i,s){return null==t||"number"!=typeof t||t<e||i<t?s:t}validateOneOf(t,e,i){return 0<=e.indexOf(t)?t:i}isInt(t){return Number.isSafeInteger(t)}isIntMin(t,e){return Number.isSafeInteger(t)&&e<=t}isIntMax(t,e){return Number.isSafeInteger(t)&&t<=e}isIntMinMax(t,e,i){return Number.isSafeInteger(t)&&e<=t&&t<=i}dataURLToArrayBuffer(t){var e=t.indexOf(";base64,"),t=t.substr(e+8);return this.base64ToArrayBuffer(t)}base64ToArrayBuffer(t){var e=window.atob(t),i=e.length,s=new Uint8Array(i);for(let t=0;t<i;++t)s[t]=e.charCodeAt(t);return s.buffer}bytesToBase64(i){let s="";for(let e=0;e<i.length;e+=8192){let t=e+8192;t>i.length&&(t=i.length),s+=String.fromCharCode.apply(null,i.subarray(e,t))}return btoa(s)}toNumericString(t,e=0){let i=!1,s=(t<0&&(i=!0,t*=-1),t.toString()),n="";if(0<=s.indexOf(".")&&(t=s.split("."),n=t[1],s=t[0]),0===e)n="";else if(0<e)if(n.length>e)n=n.substring(0,e);else for(;n.length<e;)n+="0";let a=3;for(;;){if(!(s.length>a))break;s=s.substr(0,s.length-a)+","+s.substr(s.length-a),a+=4}t=i?"-":"";return""!==n&&null!==n&&void 0!==n?t+s+"."+n:t+s}toPlaceString(t,e=!1){return(e?a.toNumericString(t):t)+this.getPlaceSuffix(t)}getPlaceSuffix(t){return 4<=t&&t<=20?"th":(t=t%10,1==t?"st":2==t?"nd":3==t?"rd":"th")}buildEvent(t,e,i){let s;try{s=new self[t](e,i)}catch(t){}if(!s){if(!self.document)return null;for(var n in s=self.document.createEvent("Event"),s.initEvent(e,i.bubbles,i.cancelable),i)void 0===s[n]&&(s[n]=i[n])}return s}toTimerString(e,i=0){var t=Math.floor(e/1e3),s=Math.floor(t/60/60),n=Math.floor((t-60*s*60)/60),a=Math.floor(t-(60*s*60+60*n));e=(e-1e3*t)/1e3;let o="",r=(0<s&&(o=s.toString()+":"),n.toString()),h=(1===r.length&&(r="0"+r),a.toString());if(1===h.length&&(h="0"+h),0<i){e=Math.floor(e*Math.pow(10,i));let t=e.toString();for(;t.length<i;)t="0"+t;return o+r+":"+h+"."+t}return o+r+":"+h}dhmsTimeString(t){var e=t/1e3,i=t/1e3/60,s=t/1e3/60/60,t=t/1e3/60/60/24;return 1<=t?this.toNumericString(Math.floor(t),0)+"d":1<=s?this.toNumericString(Math.floor(s),0)+"h":1<=i?this.toNumericString(Math.floor(i),0)+"m":this.toNumericString(Math.floor(e),0)+"s"}toAgoString(t){var t=Date.now()-t,e=t/1e3,i=t/1e3/60,s=t/1e3/60/60,t=t/1e3/60/60/24;return 1<=t?this.toNumericString(Math.floor(t),0)+"d ago":1<=s?this.toNumericString(Math.floor(s),0)+"h ago":1<=i?this.toNumericString(Math.floor(i),0)+"m ago":e<10?"just now":"< 1m ago"}openLink(t,i,s=null){if(s=s||"_blank",t)l.info("opening as native app link"),window.open(i,"_system");else{t=window.open(i,"_blank");if(void 0===t){l.info("popup blocker got link, opening via hidden link ("+s+"): "+i);let e=null;try{e=document.getElementById("com.battleline.util.hiddenLink")}catch(t){e=null}e||(e=document.createElement("a"),e.id="com.battleline.util.hiddenLink",e.style.display="none",e.href="",e.target="_blank",document.body.insertBefore(e,document.body.firstChild));t=document.createEvent("Event");e.href=i,e.target=s,t.initEvent("click",!0,!1),e.dispatchEvent(t)}}}openRating(){"GameBundle"===c.embed.type?c.script.onOpenRating&&c.script.onOpenRating():a.openLink(!1,"https://www.247games.com/games-feedback/")}getTimeLeftInDay(){var t=new Date;return 864e5-(60*t.getHours()*60*1e3+60*t.getMinutes()*1e3+1e3*t.getSeconds()+t.getMilliseconds())}toURL(t){let e=null;try{e=new URL(t)}catch(t){e=null}return e}};const tt=new class{constructor(){if(this.isMobileDevice=!1,u.isMainThread){var t=document.getElementById("game-script");if(t.hasAttribute("data-runtime")){t=t.getAttribute("data-runtime");if(!(0<=["Web App"].indexOf(t)))throw new Error("Unknown runtime: "+t);this.runtime=t}else this.runtime="Web App"}else this.runtime="Thread";if(this.isWebRuntime="Web App"===this.runtime,"Thread"===this.runtime)this.os="UNKNOWN",this.device="UNKNOWN",this.browser="UNKNOWN";else{if(!this.isWebRuntime)throw new Error("Not implemented!");t=navigator.userAgent.toLowerCase();this.os=this.detectOS(t),this.device=this.detectDevice(t),this.browser=this.detectBrowser(t)}let e="GameSite";u.isMainThread&&(window.games247.game?e=window.games247.game.embed.type:(t=window.games247,"GameBundle"===t.gameEmbedType?e="GameBundle":"android-auto"===t.nativeAppType?e="AndroidAuto":"exe"===t.nativeAppType?e="StandaloneExe":t.isEmbed&&(e="ExternalSite"))),this.isMobileDevice=u.isMainThread&&("Handheld"===this.device||"Tablet"===this.device||"AndroidAuto"===e)}detectOS(t){return 0<=t.indexOf("cros")?"Chrome OS":0<=t.indexOf("android")?0<=t.indexOf("kindle")||0<=t.indexOf("; kf")||0<=t.indexOf("silk/")?"Fire OS":"Android":0<=t.indexOf("iphone")&&t.indexOf("like iphone")<0||0<=t.indexOf("ipad")&&t.indexOf("like ipad")<0||0<=t.indexOf("ipod")&&t.indexOf("like ipod")<0?"Apple iOS":0<=t.indexOf("mac os x ")?navigator.maxTouchPoints?"Apple iOS":"Mac OS":0<=t.indexOf("windows phone os ")?"Windows Phone":0<=t.indexOf("windows")?"Windows":"UNKNOWN"}detectDevice(t){return"Chrome OS"===this.os||"Mac OS"===this.os||"Windows"===this.os?"Computer":"Apple iOS"===this.os?0<=t.indexOf("ipod")||0<=t.indexOf("iphone")?"Handheld":"Tablet":"Fire OS"===this.os?"Tablet":"Android"===this.os?0<=t.indexOf("mobile")?"Handheld":"Tablet":"Windows Phone"===this.os?"Handheld":"UNKNOWN"}detectBrowser(t){return navigator.brave&&navigator.brave.isBrave?"Brave":0<=t.indexOf("silk/")?"Silk":0<=t.indexOf("[fban/")||0<=t.indexOf("[fb_iab/")?"Facebook":0<=t.indexOf("edge/")?"Edge":0<=t.indexOf("edg/")?"Edge Chromium":0<=t.indexOf("firefox/")||0<=t.indexOf("fxios/")?"Firefox":0<=t.indexOf("opr/")||0<=t.indexOf("opera/")?"Opera":0<=t.indexOf("vivaldi/")?"Vivaldi":0<=t.indexOf("samsungbrowser/")?"Samsung":0<=t.indexOf("chrome/")||0<=t.indexOf("crios/")?"Chrome":"Apple iOS"===this.os||"Mac OS"===this.os?"Safari":0<=t.indexOf("trident/")||0<=t.indexOf("msie")?"IE":"UNKNOWN"}};class et{constructor(){this.major=0,this.minor=0,this.build=0,this.revision=0,this.str="0.0.0.0",this.name="Unknown"}fromName(t){this.str="0.0.0.0",this.major=this.minor=this.build=this.revision=0,this.name=t}fromVersionString(t,e){this.str=t,this.name=e||"";e=t.split(".");return this.major=0<e.length?parseInt(e[0],10):0,this.minor=1<e.length?parseInt(e[1],10):0,this.build=2<e.length?parseInt(e[2],10):0,this.revision=3<e.length?parseInt(e[3],10):0,this}fromVersionNumbers(t,e,i,s,n){return this.major=t||0,this.minor=e||0,this.build=i||0,this.revision=s||0,this.name=n||"",this.str="",void 0!==t&&(this.str+=t),void 0!==e&&(this.str+="."+e),void 0!==i&&(this.str+="."+i),void 0!==s&&(this.str+="."+s),this}static compare(t,e){return t.major<e.major?-1:t.major>e.major?1:t.minor<e.minor?-1:t.minor>e.minor?1:t.build<e.build?-1:t.build>e.build?1:t.revision<e.revision?-1:t.revision>e.revision?1:0}toString(){let t="";return""!==this.name&&(t+=this.name+" "),t+this.str}}class it{constructor(t,e,i,s,n,a){this.family=t,this.weight=e,this.style=i,this.ascent=s,this.descent=n,this.unitsPerEm=a}cssFont(t){return this.style+" "+this.weight+" "+t+"px "+this.family}}const st=u.isMainThread?function(){let e;var t="$isSupported",i="true";e=self.localStorage;try{e.setItem(t,i),e.getItem(t)!==i?e=null:e.removeItem(t),e.constructor.prototype.mode=0}catch(t){e=null}if(!e){l.warn("LocalStorage is unsupported.");try{e=self.sessionStorage,e.getItem(t)!==i?e=null:e.removeItem(t),e.constructor.prototype.mode=1}catch(t){e=null}}return e||l.warn("SessionStorage is unsupported."),e=e||new class{constructor(){this.mode=2,this._keys=[],this._data={}}get length(){return this._keys.length}clear(){this._keys=[],this._data={}}getItem(t){return t+="",this._data.hasOwnProperty(t)?this._data[t]:null}key(t){return 0<=t&&t<this._keys.length?this._keys[t]:null}removeItem(t){t+="",this._data.hasOwnProperty(t)&&(this._keys.splice(this._keys.indexOf(t),1),delete this._data[t])}setItem(t,e){t+="",e+="",this._data.hasOwnProperty(t)||this._keys.push(t),this._data[t]=e}},e}():null;class nt{constructor(t){this.name=t}write(t){let e;try{e=JSON.stringify(t)}catch(t){l.warn("Storable ("+this.name+"): Error stringifying data. Defaulting to empty object.",t),e="{}"}try{st.setItem(this.name,e)}catch(t){l.warn("Storable ("+this.name+"): Error setting json.",+t)}}read(){let e,i=null;try{e=st.getItem(this.name)}catch(t){l.warn("Storable ("+this.name+"): Error getting json. Defaulting to empty object.",t),e="{}"}void 0!==e&&null!==e&&"null"!==e&&"undefined"!==e&&""!==e||(e="{}");try{i=JSON.parse(e)}catch(t){l.warn("Storable ("+this.name+"): Error parsing json ("+e+"). Defaulting to empty object.",t),i={}}return null!==i&&void 0!==i&&"object"==typeof i||(i={}),i}destroy(){try{st.removeItem(this.name)}catch(t){l.warn("Storable ("+this.name+"): Error destroying.",t)}}}const c=u.isMainThread?new class{constructor(){this.onPauseChange=new h,this.defaultPreferFullscreen=tt.isMobileDevice,this.preferFullscreen=this.defaultPreferFullscreen,this.appMenuTriggered=!1,this.embed=(()=>{if(!window.games247.game){let t="GameSite";var e=window.games247;"GameBundle"===e.gameEmbedType?t="GameBundle":"android-auto"===e.nativeAppType?t="AndroidAuto":"exe"===e.nativeAppType?t="StandaloneExe":e.isEmbed&&(t="ExternalSite"),window.games247.game={embed:{type:t,variant:"None"}}}e={get type(){return window.games247.game.embed.type},get variant(){return window.games247.game.embed.variant},paused:!1,volume:1};return e})(),this.pauseElement_click=this.pauseElement_click.bind(this),this.script=document.getElementById("game-script"),this.element=document.getElementById("app-player"),this.pauseElement=document.getElementById("pause")}initialize(){"GameBundle"!==c.embed.type&&tt.isMobileDevice&&"AndroidAuto"!==c.embed.type&&"StandaloneExe"!==c.embed.type?this.isPaused=!0:this.isPaused=!1,this.isPaused&&(this.pauseElement.style.display="block"),d.add(this.pauseElement,"click",this.pauseElement_click,!0,!0)}updateState(t){"GameBundle"!==c.embed.type&&"AndroidAuto"!==c.embed.type&&"StandaloneExe"!==c.embed.type||(t=!1),this.isPaused!==t&&(this.isPaused=t,this.isPaused?this.pauseElement.style.display="block":this.pauseElement.style.display="none",k.AppPlayer_pauseChange(),0<this.onPauseChange.count)&&this.onPauseChange.invoke()}closeSplash(){if(document.getElementById("preloader").classList.add("close"),"AndroidAuto"===c.embed.type)if(void 0!==navigator.splashscreen)navigator.splashscreen.hide();else try{window.SplashScreenWebInterface.hide()}catch(t){}}preloadError(){document.getElementById("preloader").classList.add("error"),document.getElementById("preloader-msg").innerHTML="Sorry, we couldn't load the game. Press here to reload."}preloadProgress(t,e,i){document.getElementById("preloader-msg").innerHTML="LOADING "+Math.floor(100*i)+"%"}pause(){m.fullscreen.isFullscreen&&m.fullscreen.exitFullscreen(),this.updateState(!0)}App_fullscreenChange(){this.preferFullscreen&&(m.fullscreen.isFullscreen?this.updateState(!1):this.updateState(!0))}App_deactivate(){this.preferFullscreen&&this.updateState(!0)}pauseElement_click(){this.preferFullscreen?m.fullscreen.requestFullscreen():(document.body.scrollTop=0,document.documentElement.scrollTop=0,this.updateState(!1))}}:null;class at{get quality(){return this._quality}set quality(t){this._quality!==t&&(this._quality=t,this.invalidate(!1))}get maxWidth(){return this._maxWidth}set maxWidth(t){t<1&&(t=0),t!==this._maxWidth&&(this._maxWidth=t,this.invalidate(!1))}get maxHeight(){return this._maxHeight}set maxHeight(t){t<1&&(t=0),t!==this._maxHeight&&(this._maxHeight=t,this.invalidate(!1))}constructor(){this.onViewChange=new h,this.pixelRatio=1,this._quality=1,this._maxWidth=0,this._maxHeight=0,this.maxRatio=1,this.rect={x:1,y:1,w:1,h:1},this.orientation=0,this.domRect={x:1,y:1,w:1,h:1},this._invalid=!1,this._minValidationInterval=100,this._lastValidationTime=0,this.window_resizescroll=this.window_resizescroll.bind(this)}initialize(){this.resize(),d.add(window,"resize",this.window_resizescroll,!0,!0),d.add(window,"scroll",this.window_resizescroll,!0,!0)}poll(){this._invalid&&Date.now()-this._lastValidationTime>=this._minValidationInterval&&(this._invalid=!1,this._lastValidationTime=Date.now(),this.resize())&&(k.GameWindow_view_change(),0<this.onViewChange.count)&&this.onViewChange.invoke()}invalidate(t){t&&(this._lastValidationTime=0),this._invalid||(this._invalid=!0,k.GameWindow_view_invalidated())}resize(){let t=window.devicePixelRatio||(screen.deviceXDPI&&screen.logicalXDPI?screen.deviceXDPI/screen.logicalXDPI:1);var e=c.element.getBoundingClientRect();t*=this._quality;let i=1,s=(1<=this._maxHeight&&(n=e.height*t,i=n/this._maxHeight),1);1<=this._maxWidth&&(n=e.width*t,s=n/this._maxWidth);var n=1/Math.max(Math.max(i,s),1),n=(this.maxRatio=n,t*=n,St.resize(),{x:e.left*t,y:e.top*t,w:Math.max(1,e.width*t),h:Math.max(1,e.height*t)});let a=!1;return(t<=0||!isFinite(t))&&(t=1),t===this.pixelRatio&&n.x===this.rect.x&&n.y===this.rect.y&&n.w===this.rect.w&&n.h===this.rect.h||(this.pixelRatio=t,this.rect.x=n.x,this.rect.y=n.y,this.rect.w=n.w,this.rect.h=n.h,this.orientation=this.rect.w>=this.rect.h?0:1,this.domRect.x=n.x/t,this.domRect.y=n.y/t,this.domRect.w=n.w/t,this.domRect.h=n.h/t,a=!0),a}window_resizescroll(t){this.invalidate(!1)}}class ot{constructor(){this.onFocusChange=new h,this.window_focusblur=this.window_focusblur.bind(this)}initialize(){let t=document.hasFocus();t||"GameBundle"===c.embed.type&&window.parent&&window.parent!==window&&(t=window.parent.document.hasFocus()),this.isFocused=t,d.add(window,"focus",this.window_focusblur,!0,!0),d.add(window,"blur",this.window_focusblur,!0,!0)}updateState(){let t=document.hasFocus();t||"GameBundle"===c.embed.type&&window.parent&&window.parent!==window&&(t=window.parent.document.hasFocus()),this.isFocused!==t&&(this.isFocused=t,k.GameWindow_focus_change(),0<this.onFocusChange.count)&&this.onFocusChange.invoke()}window_focusblur(){this.updateState()}}class rt{constructor(){this.onVisibilityChange=new h,this.document_visibilitychange=this.document_visibilitychange.bind(this)}initialize(){W.pageVisibility.isSupported?(this.isVisible="visible"===document[W.pageVisibility.visibilityState],d.add(document,W.pageVisibility.visibilitychange,this.document_visibilitychange,!0,!0)):this.isVisible=!0}updateState(){var t="visible"===document[W.pageVisibility.visibilityState];this.isVisible!==t&&(this.isVisible=t,k.GameWindow_visibility_change(),0<this.onVisibilityChange.count)&&this.onVisibilityChange.invoke()}document_visibilitychange(){this.updateState()}}class ht{constructor(){this.onFullscreenChange=new h,this.isFullscreen=!1,this.isSupported=!1}initialize(){}poll(){}}class lt extends ht{constructor(){super(),this.isSupported=!0}updateState(t){this.isFullscreen!==t&&(this.isFullscreen=t,k.GameWindow_fullscreen_change(),0<this.onFullscreenChange.count)&&this.onFullscreenChange.invoke()}requestFullscreen(){this.isFullscreen||(document.documentElement.classList.add("cssfs"),this.updateState(!0))}exitFullscreen(){this.isFullscreen&&(document.documentElement.classList.remove("cssfs"),this.updateState(!1))}toggleFullscreen(){this.isFullscreen?this.exitFullscreen():this.requestFullscreen()}}class dt extends ht{constructor(){super(),this.document_fullscreenchangeerror=this.document_fullscreenchangeerror.bind(this),this.isSupported=!0}initialize(){this.isFullscreen=document[W.fullscreen.fullscreenElement]===c.element,d.add(document,W.fullscreen.fullscreenchange,this.document_fullscreenchangeerror,!0,!0),d.add(document,W.fullscreen.fullscreenerror,this.document_fullscreenchangeerror,!0,!0)}dispose(){d.remove(document,W.fullscreen.fullscreenchange,this.document_fullscreenchangeerror),d.remove(document,W.fullscreen.fullscreenerror,this.document_fullscreenchangeerror)}requestFullscreen(){var t;this.isFullscreen||(t=c.element[W.fullscreen.requestFullscreen]({navigationUI:"hide"}),t&&d.promise(t,V,V))}exitFullscreen(){var t;document[W.fullscreen.fullscreenElement]&&(t=document[W.fullscreen.exitFullscreen](),t)&&d.promise(t,V,V)}toggleFullscreen(){this.isFullscreen?this.requestFullscreen():this.exitFullscreen()}updateState(){var t=document[W.fullscreen.fullscreenElement]===c.element;this.isFullscreen!==t&&(this.isFullscreen=t,k.GameWindow_fullscreen_change(),0<this.onFullscreenChange.count)&&this.onFullscreenChange.invoke()}document_fullscreenchangeerror(){this.updateState()}}const m=u.isMainThread?new class{constructor(){this.view=new at,this.focus=new ot,this.visibility=new rt,this.window_keydown=this.window_keydown.bind(this),"GameBundle"===c.embed.type?(l.info("Fullscreen disabled in game bundles."),this.fullscreen=new lt):"AndroidAuto"===c.embed.type?(l.info("Fullscreen disabled in android auto builds."),this.fullscreen=new lt):"ExternalSite"===c.embed.type?document[W.fullscreen.fullscreenEnabled]?this.fullscreen=new dt:(l.warn("Fullscreen is disabled because document."+W.fullscreen.fullscreenEnabled+" is "+document[W.fullscreen.fullscreenEnabled]),this.fullscreen=new lt):"Apple iOS"===tt.os?this.fullscreen=new lt:W.fullscreen.isSupported?document[W.fullscreen.fullscreenEnabled]?this.fullscreen=new dt:(l.warn("Fullscreen is disabled because document."+W.fullscreen.fullscreenEnabled+" is "+document[W.fullscreen.fullscreenEnabled]),this.fullscreen=new lt):(l.info("No fullcreen modes are supported. Using CSS fallback."),this.fullscreen=new lt)}initialize(){this.view.initialize(),this.focus.initialize(),this.visibility.initialize(),this.fullscreen.initialize(),d.add(window,"keydown",this.window_keydown,!0,!0)}poll(){this.view.poll(),this.fullscreen.poll()}window_keydown(t){this.fullscreen.exitFullscreen()}App_pauseChange(){c.isPaused&&this.fullscreen.exitFullscreen(),this.view.invalidate(!0)}App_fullscreenChange(){this.view.invalidate(!0)}App_visibilityChange(){this.view.invalidate(!0),this.fullscreen.exitFullscreen()}App_embedPauseChange(){c.embed.paused&&this.view.invalidate(!0)}}:null;class y{constructor(...e){this.onPress=new h,this.onRepeat=new h,this.onRelease=new h,this.onCancel=new h,this.name="",this.mappings=[],this.isPressed=!1;for(let t=0;t<e.length;t+=2)this.mappings.push({id:e[t],location:e[t+1]})}press(t){this.isPressed||(this.isPressed=!0,_.onPress.invoke(this,t),this.isPressed&&this.onPress.invoke(this,t))}repeat(t){this.isPressed&&(_.onRepeat.invoke(this,t),this.isPressed)&&this.onRepeat.invoke(this,t)}release(t){this.isPressed&&(this.isPressed=!1,_.onRelease.invoke(this,t),this.onRelease.invoke(this,t))}cancel(){this.isPressed&&(this.isPressed=!1,_.onCancel.invoke(this),this.onCancel.invoke(this))}}class ct{constructor(){this.Escape=new y("Escape",0,"Esc",0),this.Backspace=new y("Backspace",0),this.Delete=new y("Delete",0,"Del",0),this.Space=new y(" ",0,"Spacebar",0),this.Tab=new y("Tab",0),this.Enter=new y("Enter",0),this.Home=new y("Home",0),this.End=new y("End",0),this.PageUp=new y("PageUp",0),this.PageDown=new y("PageDown",0),this.LeftShift=new y("Shift",1),this.RightShift=new y("Shift",2),this.LeftCtrl=new y("Control",1),this.RightCtrl=new y("Control",2),this.LeftOS=new y("Meta",1,"OS",1,"Win",1),this.RightOS=new y("Meta",2,"OS",2,"Win",2),this.LeftAlt=new y("Alt",1),this.RightAlt=new y("Alt",2),this.ContextMenu=new y("ContextMenu",0,"Apps",0),this.CapsLock=new y("CapsLock",0),this.Insert=new y("Insert",0),this.ScrollLock=new y("ScrollLock",0,"Scroll",0),this.Top1=new y("1",0,"!",0),this.Top2=new y("2",0,"@",0),this.Top3=new y("3",0,"#",0),this.Top4=new y("4",0,"$",0),this.Top5=new y("5",0,"%",0),this.Top6=new y("6",0,"^",0),this.Top7=new y("7",0,"&",0),this.Top8=new y("8",0,"*",0),this.Top9=new y("9",0,"(",0),this.Top0=new y("0",0,")",0),this.TopDash=new y("-",0,"_",0),this.TopEquals=new y("=",0,"+",0),this.NumLock=new y("NumLock",0),this.NumpadForwardSlash=new y("/",3,"Divide",3),this.NumpadStar=new y("*",3,"Multiply",3),this.NumpadMinus=new y("-",3,"Subtract",3),this.NumpadPlus=new y("+",3,"Add",3),this.NumpadEnter=new y("Enter",3),this.NumpadDecimal=new y(".",3,"Decimal",3,"Del",3,"Delete",3),this.Numpad0=new y("0",3,"Insert",3),this.Numpad1=new y("1",3,"End",3),this.Numpad2=new y("2",3,"ArrowDown",3,"Down",3),this.Numpad3=new y("3",3,"PageDown",3),this.Numpad4=new y("4",3,"ArrowLeft",3,"Left",3),this.Numpad5=new y("5",3,"Clear",3),this.Numpad6=new y("6",3,"ArrowRight",3,"Right",3),this.Numpad7=new y("7",3,"Home",3),this.Numpad8=new y("8",3,"ArrowUp",3,"Up",3),this.Numpad9=new y("9",3,"PageUp",3),this.LeftArrow=new y("ArrowLeft",0,"Left",0),this.RightArrow=new y("ArrowRight",0,"Right",0),this.UpArrow=new y("ArrowUp",0,"Up",0),this.DownArrow=new y("ArrowDown",0,"Down",0),this.F1=new y("F1",0),this.F2=new y("F2",0),this.F3=new y("F3",0),this.F4=new y("F4",0),this.F5=new y("F5",0),this.F6=new y("F6",0),this.F7=new y("F7",0),this.F8=new y("F8",0),this.F9=new y("F9",0),this.F10=new y("F10",0),this.F11=new y("F11",0),this.F12=new y("F12",0),this.Tilde=new y("`",0,"~",0),this.LeftBracket=new y("[",0,"{",0),this.RightBracket=new y("]",0,"}",0),this.Backslash=new y("\\",0,"|",0),this.Semicolon=new y(";",0,":",0),this.Quote=new y("'",0,'"',0),this.Comma=new y(",",0,"<",0),this.Period=new y(".",0,">",0),this.ForwardSlash=new y("/",0,"?",0);var t,e="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");for(t of e)this[t]=new y(t.toLowerCase(),0,t,0);var i,s=[],n={};for(i in this){var a,o=this[i];o.name=i,s.push(o);for(a of o.mappings){let t=n[a.id];if(t||(n[a.id]=t={}),t[a.location])throw new Error("Conflict!");t[a.location]=o}}this.list=s,this.mappings=n}}const _=u.isMainThread?new class{constructor(){this.onPress=new h,this.onRepeat=new h,this.onRelease=new h,this.onCancel=new h,this.keys=new ct,this.reset=this.reset.bind(this),this.target_keydown=this.target_keydown.bind(this),this.target_keyup=this.target_keyup.bind(this)}App_activate(){d.add(window,"keydown",this.target_keydown,!0,!1),d.add(window,"keyup",this.target_keyup,!0,!1)}App_deactivate(){this.reset(),d.remove(window,"keydown",this.target_keydown),d.remove(window,"keyup",this.target_keyup)}reset(){for(var t of this.keys.list)t.cancel()}getKey(t,e){let i=null;t=this.keys.mappings[t];return t&&(i=t[e]||null),i}target_keydown(t){"F12"===t.key.toUpperCase()||"V"===t.key.toUpperCase()&&(t.ctrlKey||t.metaKey)||"C"===t.key.toUpperCase()&&(t.ctrlKey||t.metaKey)||"X"===t.key.toUpperCase()&&(t.ctrlKey||t.metaKey)||t.cancelable&&!t.defaultPrevented&&t.preventDefault();t=this.getKey(t.key,t.location);t&&(t.isPressed?t.repeat():t.press())}target_keyup(t){"F12"!==t.key&&t.cancelable&&!t.defaultPrevented&&t.preventDefault();t=this.getKey(t.key,t.location);t&&t.release()}}:null;class ut{constructor(t){this.onPress=new h,this.name=t}static construct(t){return new ut(t)}press(){this.isPressed=!0,this.onPress.invoke(this),this.isPressed=!1}}const pt=u.isMainThread?(()=>{let t=ut.construct("Back");var e={get back(){return t}};return e})():null;class gt{constructor(){this.onPress=new h,this.onRelease=new h,this.onCancel=new h,this.isPressed=!1}press(){this.isPressed||(this.isPressed=!0,f.onPress.invoke(this),this.isPressed&&this.onPress.invoke(this))}release(){this.isPressed&&(this.isPressed=!1,f.onRelease.invoke(this),this.onRelease.invoke(this))}cancel(){this.isPressed&&(this.isPressed=!1,f.onCancel.invoke(this),this.onCancel.invoke(this))}}class mt{constructor(){this.onScroll=new h,this.onScrollReset=new h,this.lock=!1,this.scroll=0,this._reset=!0}down(t,e){this._reset=!1,this.scroll+=t,f.onScroll.invoke(this,t,e),this._reset||this.onScroll.invoke(this,t,e)}up(t,e){this._reset=!1,this.scroll-=t,f.onScroll.invoke(this,t,e),this._reset||this.onScroll.invoke(this,-t,e)}reset(){this._reset=!0,this.scroll=0,f.onScrollReset.invoke(this),this.onScrollReset.invoke(this)}}const f=u.isMainThread?new class{get softMouseControl(){return!(!ft.allowed||this.isDetected&&!this._lastWasSoftMouse)}constructor(){this.onDetected=new h,this.onOver=new h,this.onMove=new h,this.onOut=new h,this.onPress=new h,this.onRelease=new h,this.onCancel=new h,this.onScroll=new h,this.onScrollReset=new h,this.onLockStateChange=new h,this.onLockGained=new h,this.onLockLost=new h,this.isDetected=!1,this.x=-1,this.y=-1,this._clientX=-1,this._clientY=-1,this._xFloat=-1,this._yFloat=-1,this._coordsInit=!1,this.isOver=!1,this.left=new gt,this.right=new gt,this.middle=new gt,this.wheel=new mt,this.buttons=[this.left,this.middle,this.right],this._lastWasSoftMouse=!1,this.target_move=this.target_move.bind(this),this.target_button=this.target_button.bind(this),this.target_wheel=this.target_wheel.bind(this),this.window_mouseUp=this.window_mouseUp.bind(this)}initialize(){this._target=document.getElementById("app-player");for(var t of["mouseover","mousemove","mouseout"])d.add(this._target,t,this.target_move,!0,!0);for(var e of["mousedown","mouseup"])d.add(this._target,e,this.target_button,!0,!0);d.add(this._target,"wheel",this.target_wheel,!0,!1),d.add(window,"mouseup",this.window_mouseUp,!1,!0)}App_deactivate(){this.reset()}reset(){for(let t=0;t<this.buttons.length;++t)this.buttons[t].cancel()}softInitCoords(){var t=this._target.getBoundingClientRect(),e=t.width/2,t=t.height/2;this._clientX=e,this._clientY=t,this._xFloat=(e-m.view.domRect.x)*m.view.pixelRatio,this._yFloat=(t-m.view.domRect.y)*m.view.pixelRatio,this.x=Math.floor(this._xFloat),this.y=Math.floor(this._yFloat),this._coordsInit=!0}move(n,a,o,r){if(k.isActive){if(!this.isDetected&&!r){if(ft.allowed&&("mouseout"===o||"mouseover"===o))return;this.isDetected=!0,0<this.onDetected.count&&this.onDetected.invoke()}this._lastWasSoftMouse=!!r;let t=this.x,e=this.y,i=this.isOver,s=!1;this._clientX=n,this._clientY=a,this._xFloat=(n-m.view.domRect.x)*m.view.pixelRatio,this._yFloat=(a-m.view.domRect.y)*m.view.pixelRatio,this.x=Math.floor(this._xFloat),this.y=Math.floor(this._yFloat),this._coordsInit=!0,this.isOver="mouseout"!==o&&0<=this.x&&this.x<m.view.rect.w&&0<=this.y&&this.y<m.view.rect.h,!i&&this.isOver&&(t=this.x,e=this.y,s=!0,this.onOver.count)&&this.onOver.invoke(),(s||t!==this.x||e!==this.y)&&this.onMove.count&&this.onMove.invoke(this.x-t,this.y-e),i&&!this.isOver&&this.onOut.count&&this.onOut.invoke()}}target_move(t){this.move(t.clientX,t.clientY,t.type,!1)}target_button(t){var e;k.isActive&&(this.move(t.clientX,t.clientY,t.type,!1),t.button<this.buttons.length)&&(e=this.buttons[t.button],"simulated-down"===t.type?(this._lastWasSoftMouse=!0,this.isOver&&e.press()):"simulated-up"===t.type?(this._lastWasSoftMouse=!0,this.isOver&&e.release()):"simulated-cancel"===t.type?(this._lastWasSoftMouse=!0,e.cancel()):"mousedown"===t.type?(this._lastWasSoftMouse=!1,this.isOver&&e.press()):(this._lastWasSoftMouse=!1,this.isOver?e.release():e.cancel()))}target_wheel(t){k.isActive&&(this._lastWasSoftMouse=!1,this.isOver)&&(this.move(t.clientX,t.clientY,t.type,!1),this.isOver)&&(0<t.deltaY?this.wheel.down(1,t):this.wheel.up(1,t),this.wheel.lock)&&t.preventDefault()}window_mouseUp(t){this._lastWasSoftMouse=!1,t.button<this.buttons.length&&this.buttons[t.button].cancel()}}:null;class yt{constructor(t){this.onPress=new h,this.onMove=new h,this.onRelease=new h,this.onCancel=new h,this.x=0,this.y=0,this.isPressed=!1,this.identifier=void 0,this.index=t}press(){this.isPressed||(this.isPressed=!0,_t.numPressed++,this.onPress.count&&this.onPress.invoke(this))}move(t,e){var i,s;this.x===t&&this.y===e||(i=t-this.x,s=e-this.y,this.x=t,this.y=e,this.isPressed&&this.onMove.count&&this.onMove.invoke(this,i,s))}release(){this.identifier=void 0,this.isPressed&&(this.isPressed=!1,_t.numPressed--,this.onRelease.count)&&this.onRelease.invoke(this)}cancel(){this.identifier=void 0,this.isPressed&&(this.isPressed=!1,_t.numPressed--,this.onCancel.count)&&this.onCancel.invoke(this)}}const _t=u.isMainThread?new class{constructor(){this.numPressed=0,this.isDetected=!1,this.reset=this.reset.bind(this),this.target_touchEvt=this.target_touchEvt.bind(this),this.target_touchCancel=this.target_touchCancel.bind(this);var e=[];for(let t=0;t<10;++t)e.push(new yt(t));this.points=e}initialize(){this._target=document.getElementById("app-player"),d.add(this._target,"touchstart",this.target_touchEvt,!0,!1),d.add(this._target,"touchmove",this.target_touchEvt,!0,!0),d.add(this._target,"touchend",this.target_touchEvt,!0,!1),d.add(this._target,"touchcancel",this.target_touchCancel,!0,!1),d.add(this._target,"blur",this.reset)}App_deactivate(){this.reset()}reset(){for(let t=0;t<this.points.length;++t)this.points[t].cancel()}fetch(e){let i=null,s=null;for(let t=0;t<this.points.length;++t){if(this.points[t].identifier===e){i=this.points[t];break}null===s&&void 0===this.points[t].identifier&&(s=this.points[t])}return null===i&&null!==s&&(i=s,i.identifier=e),i}target_touchEvt(e){if(k.isActive){this.isDetected=!0;var i=e.changedTouches;for(let t=0;t<i.length;++t){var s=i[t],n=this.fetch(s.identifier);n&&(s.rotationAngle||s.webkitRotationAngle,n.move(Math.round((s.clientX-m.view.domRect.x)*m.view.pixelRatio),Math.round((s.clientY-m.view.domRect.y)*m.view.pixelRatio)),"touchstart"===e.type?n.press():"touchend"===e.type&&n.release())}"touchstart"===e.type?"INPUT"!==e.target.tagName.toUpperCase()&&e.cancelable&&e.preventDefault():"touchend"===e.type&&e.cancelable&&e.preventDefault()}}target_touchCancel(t){k.isActive&&t.cancelable&&t.preventDefault();var e=t.changedTouches;for(let t=0;t<e.length;++t){var i=e[t],i=this.fetch(i.identifier);i&&i.cancel()}}}:null,ft=u.isMainThread?(()=>{let l=Date.now(),d=!1,c=0,u=!1,e=!1,i=!1,p=!1,g=l;function s(t){k.isActive&&i&&e&&(t?d&&(d=!1,f.target_button({type:"simulated-cancel",clientX:f._clientX,clientY:f._clientY,button:0})):_.keys.Enter.isPressed||_.keys.NumpadEnter.isPressed?d||(d=!0,f.target_button({type:"simulated-down",clientX:f._clientX,clientY:f._clientY,button:0})):d&&(d=!1,f.target_button({type:"simulated-up",clientX:f._clientX,clientY:f._clientY,button:0})))}function t(){s(!1)}function n(){s(!1)}function a(){s(!0)}_.keys.Enter.onPress.add(t,null),_.keys.NumpadEnter.onPress.add(t,null),_.keys.Enter.onRelease.add(n,null),_.keys.NumpadEnter.onRelease.add(n,null),_.keys.Enter.onCancel.add(a,null),_.keys.NumpadEnter.onCancel.add(a,null);var o={get allowed(){return e},set allowed(t){if(e!==t){if(e)throw new Error("already allowed, cannot change");e=t}},get enabled(){return i},set enabled(t){t=t,i!==t&&(t||(u=!1,d&&s(!0)),i=t)},get anyPressed(){return p},get lastPressed(){return g},poll:function(){if(k.isActive&&i&&e){var n=Date.now(),a=n-l,o=(l=n,d&&(p=!0,g=n),f._coordsInit||f.softInitCoords(),new v(f._xFloat,f._yFloat));f._coordsInit?P.root.globalToLocal(o):o.set(P.width/2,P.height/2);let e=o.x,i=o.y;var o=e,r=i;let t=!1,s=new v(0,0);if(_.keys.RightArrow.isPressed&&(t=!0,s.x+=1,p=!0,g=n),_.keys.LeftArrow.isPressed&&(t=!0,--s.x,p=!0,g=n),_.keys.UpArrow.isPressed&&(t=!0,--s.y,p=!0,g=n),_.keys.DownArrow.isPressed&&(t=!0,s.y+=1,p=!0,g=n),t){0!==s.x&&0!==s.y&&(s=s.normalize());var h;let t=100;0!==s.x||0!==s.y?u?(h=n-c,t=100+h/1e3*500):(u=!0,c=n):u=!1,t<100&&(t=100),600<t&&(t=600),e+=s.x*t*a/1e3/P.scaleFactor*m.view.pixelRatio,i+=s.y*t*a/1e3/P.scaleFactor*m.view.pixelRatio,e<P.screen.left&&(e=P.screen.left),e>P.screen.right&&(e=P.screen.right),i<P.screen.top&&(i=P.screen.top),i>P.screen.bottom&&(i=P.screen.bottom),f._coordsInit&&o===e&&r===i||(h=new v(e,i),P.root.localToGlobal(h),h.x/=m.view.pixelRatio,h.y/=m.view.pixelRatio,f.move(h.x,h.y,"simulated",!0))}else u=!1}else u=!1,p=!1}};return o})():null;class wt{constructor(t){this.onPress=new h,this.onMove=new h,this.onRelease=new h,this.onCancel=new h,this.onPresent=new h,this.onAbsent=new h,this.onSecondaryPress=new h,this.onSecondaryRelease=new h,this.onSecondaryCancel=new h,this.x=0,this.y=0,this.isPressed=!1,this.isPresent=!1,this.type=0,this.isSecondaryPressed=!1,this.index=t}present(){this.isPresent||(this.isPresent=!0,this.onPresent.invoke(this))}absent(){this.isPresent&&(this.isPresent=!1,this.onAbsent.invoke(this))}press(){this.isPressed||(this.isPressed=!0,this.onPress.invoke(this))}secondaryPress(){this.isSecondaryPressed||(this.isSecondaryPressed=!0,this.onSecondaryPress.invoke(this))}move(t,e){var i,s;this.x===t&&this.y===e||(i=t-this.x,s=e-this.y,this.x=t,this.y=e,this.onMove.invoke(this,i,s))}release(){this.isPressed&&(this.isPressed=!1,this.onRelease.invoke(this))}secondaryRelease(){this.isSecondaryPressed&&(this.isSecondaryPressed=!1,this.onSecondaryRelease.invoke(this))}cancel(){this.isPressed&&(this.isPressed=!1,this.onCancel.invoke(this))}secondaryCancel(){this.isSecondaryPressed&&(this.isSecondaryPressed=!1,this.onSecondaryCancel.invoke(this))}}const w=u.isMainThread?new class{constructor(){this._mouseControl=!1,this._touchPointControl=!1,this.lastInputFrameTime=0;var e=[];e.push(new wt(0));for(let t=1;t<_t.points.length;++t)e.push(new wt(t));this.pointers=e,this.primary=this.pointers[0]}initialize(){f.onMove.add(this.Mouse_onMove,this),f.left.onPress.add(this.Mouse_left_onPress,this),f.left.onRelease.add(this.Mouse_left_onRelease,this),f.left.onCancel.add(this.Mouse_left_onCancel,this),f.right.onPress.add(this.Mouse_right_onPress,this),f.right.onRelease.add(this.Mouse_right_onRelease,this),f.right.onCancel.add(this.Mouse_right_onCancel,this),f.onOver.add(this.Mouse_onOver,this),f.onOut.add(this.Mouse_onOut,this);for(let t=0;t<_t.points.length;++t)_t.points[t].onPress.add(this.touchPoint_onPress,this),_t.points[t].onMove.add(this.touchPoint_onMove,this),_t.points[t].onRelease.add(this.touchPoint_onRelease,this),_t.points[t].onCancel.add(this.touchPoint_onCancel,this);f.isOver?(this.primary.type=1,this.primary.move(f.x,f.y),this.primary.present()):(this.primary.type=1,this.primary.absent())}Mouse_onMove(t,e){this._touchPointControl||(this.primary.type=1,this.primary.move(f.x,f.y))}Mouse_onOver(){this._touchPointControl||(this.primary.type=1,this.primary.present())}Mouse_onOut(){this._touchPointControl||(this.primary.type=1,this.primary.absent())}Mouse_left_onPress(t){this._touchPointControl||(this._mouseControl=!0,this.primary.type=1,this.primary.move(f.x,f.y),this.primary.press())}Mouse_left_onRelease(t){this._mouseControl&&(this._mouseControl=!1,this.primary.type=1,this.primary.move(f.x,f.y),this.primary.release())}Mouse_left_onCancel(t){this._mouseControl&&(this._mouseControl=!1,this.primary.type=1,this.primary.move(f.x,f.y),this.primary.cancel())}Mouse_right_onPress(t){this._touchPointControl||(this._mouseControl=!0,this.primary.type=1,this.primary.move(f.x,f.y),this.primary.secondaryPress())}Mouse_right_onRelease(t){this._mouseControl&&(this._mouseControl=!1,this.primary.type=1,this.primary.move(f.x,f.y),this.primary.secondaryRelease())}Mouse_right_onCancel(t){this._mouseControl&&(this._mouseControl=!1,this.primary.type=1,this.primary.move(f.x,f.y),this.primary.secondaryCancel())}touchPoint_onPress(t){0<t.index?(this.pointers[t.index].type=2,this.pointers[t.index].move(t.x,t.y),this.pointers[t.index].present(),this.pointers[t.index].press()):this._mouseControl||(this._touchPointControl=!0,this.primary.type=2,this.primary.move(t.x,t.y),this.primary.present(),this.primary.press())}touchPoint_onMove(t,e,i){0<t.index?(this.pointers[t.index].type=2,this.pointers[t.index].move(t.x,t.y)):this._touchPointControl&&(this.primary.type=2,this.primary.move(t.x,t.y))}touchPoint_onRelease(t){0<t.index?(this.pointers[t.index].type=2,this.pointers[t.index].move(t.x,t.y),this.pointers[t.index].release(),this.pointers[t.index].absent()):this._touchPointControl&&(this._touchPointControl=!1,this.primary.type=2,this.primary.move(t.x,t.y),this.primary.release(),f.isOver?this.primary.move(f.x,f.y):this.primary.absent())}touchPoint_onCancel(t){0<t.index?(this.pointers[t.index].type=2,this.pointers[t.index].move(t.x,t.y),this.pointers[t.index].cancel(),this.pointers[t.index].absent()):this._touchPointControl&&(this._touchPointControl=!1,this.primary.type=2,this.primary.move(t.x,t.y),this.primary.cancel(),f.isOver?this.primary.move(f.x,f.y):this.primary.absent())}}:null,vt=function(){let i={};return{warn:function(t,e){i[t]||(i[t]=!0,"AndroidAuto"!==c.embed.type&&(e?l.info("DEPRECATED: "+t+" is deprecated. Use "+e+" instead."):l.info("DEPRECATED: "+t+" is deprecated.")))}}}();class bt{constructor(t){this.state=0,this.started=-1,this.ended=-1,this._durations=new Array(60),this._durationIndex=0,this._lastDuration=0,this.name=t,this._durations.fill(0)}start(){if(0!==this.state)throw new Error("Not Reset!");this.started=Date.now(),this.state=1}end(){if(1!==this.state)throw new Error("Not Started!");this.ended=Date.now(),this.state=2}reset(){if(1===this.state)throw new Error("Not Ended or Reset!");2===this.state?(this._lastDuration=this.ended-this.started,this.state=0,this.started=-1,this.ended=-1):this._lastDuration=0,this._durations[this._durationIndex]=this._lastDuration,this._durationIndex++,this._durationIndex>=this._durations.length&&(this._durationIndex=0)}getLastDuration(){return this._lastDuration}getAverageDuration(){let e=0;for(let t=0;t<this._durations.length;++t)e+=this._durations[t];return e/=this._durations.length,e}}class xt{constructor(){this._list=[],this._map=new Map}get(t){let e;return this._map.has(t)?e=this._map.get(t):(e=new bt(t),this._map.set(t,e),this._list.push(e)),e}start(t){t=this.get(t);t.start()}end(t){t=this.get(t);t.end()}reset(){for(let t=0;t<this._list.length;++t)this._list[t].reset();kt.tick()}}const St=new class{constructor(){this.onFramerateUpdate=new h,this.fps=-1,this._frames=0,this.rps=-1,this._resizes=0,this._lastTime=0,this.profiler=new xt,this.reset()}reset(){this._lastTime=Date.now(),this._frames=0,this.fps=-1,this._resizes=0,this.rps=-1,0<this.onFramerateUpdate.count&&this.onFramerateUpdate.invoke()}frame(){var t=Date.now(),e=t-this._lastTime;1e3<=e&&(this._lastTime=t,this.fps=Math.round(this._frames/e*1e3),this.rps=Math.round(this._resizes/e*1e3),this._resizes=this._frames=0,0<this.onFramerateUpdate.count)&&this.onFramerateUpdate.invoke(),this._frames++}resize(){this._resizes++}};new class{constructor(){this.isEnabled=!1}enable(){this.isEnabled||(this.isEnabled=!0,this._element=document.createElement("div"),this._element.style.cssText="position: absolute; top: auto; left: auto; right: 0; bottom: 0; width: auto; height: auto; padding: 3px 5px; pointer-events: none; background: rgba(0,0,0,0.65); display: inline-block; border: solid 1px #333333; font-family: Consolas, 'Lucida Console', Menlo, monospace; font-size: 10px; border-bottom-width: 0;",this._fpsElement=document.createElement("div"),this._element.appendChild(this._fpsElement),document.getElementById("app-player-debug").appendChild(this._element),St.onFramerateUpdate.add(this.Telementry_onFramerateUpdate,this),this.updateContents())}disable(){this.isEnabled&&(this.isEnabled=!1,St.onFramerateUpdate.remove(this.Telementry_onFramerateUpdate,this),this._element.parentElement.removeChild(this._element),this._element=null,this._fpsElement=null)}updateContents(){if(k.isActive)if(St.fps<0)this._fpsElement.style.color="#CCCCCC",this._fpsElement.innerHTML="FPS: -- / 60";else{St.fps<30?this._fpsElement.style.color="#FF0000":St.fps<50?this._fpsElement.style.color="#FFFF00":this._fpsElement.style.color="#00FF00";let t=""+St.fps;for(;t.length<2;)t=" "+t;this._fpsElement.innerHTML="FPS: "+t+" / 60"}else this._fpsElement.style.color="#AAAAAA",this._fpsElement.innerHTML="FPS:  0 / 60"}Telementry_onFramerateUpdate(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){this._contentsElement.innerHTML="rect XY: "+b.roundTo(m.view.rect.x,2)+", "+b.roundTo(m.view.rect.y,2)+"<br>max ratio: "+b.roundTo(m.view.maxRatio,2)+"<br>pixel ratio: "+b.roundTo(m.view.pixelRatio,2)+"<br>app WH: "+b.roundTo(m.view.rect.w,2)+" x "+b.roundTo(m.view.rect.h,2)+"<br>Paused: "+c.isPaused+"<br>Fullscreen: "+m.fullscreen.isFullscreen+"<br>Visible: "+m.visibility.isVisible+"<br>Focused: "+m.focus.isFocused+"<br>Active: "+k.isActive+"<br>Ticking: "+k.isTicking+"<br>Stage SF: "+P.scaleFactor+"<br>Stage W: "+P.width+"<br>Stage H: "+P.height+"<br>Stage OSF: "+b.roundTo(P.outerScaleFactor,2)+"<br>Stage OW: "+b.roundTo(P.outerWidth,2)+"<br>Stage OH: "+b.roundTo(P.outerHeight,2)}app_statechanged(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){let t="";for(var e of _.keys.list)e.isPressed&&(t&&(t+="<br>"),t+=e.name);this._btnsElement.innerHTML=t}keyboard_change(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){this._stateElement.innerHTML="Soft Allowed: "+ft.allowed+"<br>Soft Enabled: "+ft.enabled+"<br>Detected: "+f.isDetected+"<br>Control: "+(f.softMouseControl?"Soft":"Hard")+"<br>x: "+f.x+"<br>y: "+f.y+"<br>isOver: "+f.isOver+"<br>scroll: "+f.wheel.scroll;let t="";f.left.isPressed&&(t+="Left"),f.middle.isPressed&&(t&&(t+="<br>"),t+="Middle"),f.right.isPressed&&(t&&(t+="<br>"),t+="Right"),this._btnsElement.innerHTML=t}mouse_change(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){this._numPressedElement.innerHTML="down: "+_t.numPressed;let t="";for(var e of _t.points)e.isPressed&&(""!==t&&(t+="<br>"),t+=e.index+": "+e.x+","+e.y+" ("+e.identifier+")");this._touchesElement.innerHTML=t}mouse_change(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){let e="";for(var i of w.pointers){let t="";""!==e&&(t+="<br>"),i.isPresent&&(t+=i.index+": "+i.x+","+i.y+", isPressed: "+i.isPressed,e+=t)}this._touchesElement.innerHTML=e}mouse_change(){this.updateContents()}};new class{constructor(){this.isEnabled=!1,this._screenManager=null}enable(t){}disable(){}updateContents(){let e="";if(this._screenManager)for(let t=0;t<this._screenManager._list.length;++t){var i=this._screenManager._list[t];0<t&&(e="<br>"+e),e=i.name+e}this._contentsElement.innerHTML=e}tick(){this.isEnabled&&this.updateContents()}};const kt=(()=>{let t=!1,s=null;function e(){if(t){let e="";for(let t=0;t<St.profiler._list.length;++t){var i=St.profiler._list[t];0<t&&(e+="<br>"),e+=i.name+" "+i.getLastDuration()+" "+Math.round(i.getAverageDuration())}s.innerHTML=e}}var i={get isEnabled(){return t},enable:function(){},disable:function(){},tick:function(){t&&e()}};return i})();class Ct{get volume(){return this._volume}set volume(t){this._volume=Math.max(Math.min(t,1),0)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=Math.max(Math.min(t,1),0)}constructor(t,e){if(this._volume=1,this._playbackRate=1,this.isLooped=!1,this.category=Mt.getCategory("SFX"),this.type=t,0===t||1===t?(this.buffer=e,this.duration=1e3*this.buffer.duration):(this.buffer=null,this.duration=e),this.duration<=0)throw new Error("Duration must be greater than 0!")}}class Tt{constructor(){this.onSuspensionUpdate=new h,this.isSuspended=!0}}const Ft=u.isMainThread?new class extends Tt{constructor(){super(),this.context_statechange=this.context_statechange.bind(this),W.webAudio.isSupported?this.isSupported=!0:(l.info("Web Audio is not supported"),this.isSupported=!1)}initialize(){this.isSupported&&(this.context=new(window.AudioContext||window.webkitAudioContext),this.context.onstatechange=this.context_statechange)}updateSuspensionState(){k.isActive&&"running"===this.context.state?this.isSuspended=!1:this.isSuspended=!0,0<this.onSuspensionUpdate.count&&this.onSuspensionUpdate.invoke()}updateContextState(t,e){var i=k.isTicking,s=this.context.state;i&&"running"!==s?t&&(t=this.context.resume(),t)&&d.promise(t,V,V):i||"running"!==s||(t=this.context.suspend(),t&&d.promise(t,V,V))}App_tickingChange(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState(!0,"App_tickingChange "+k.isTicking))}App_activate(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState("GameBundle"===c.embed.type,"App_activate"))}App_deactivate(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState(!1,"App_deactivate"))}window_unlockEvent(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState(!0,"window_unlockEvent"))}context_statechange(){this.isSupported&&(this.updateSuspensionState(),"GameBundle"===c.embed.type&&"Apple iOS"===tt.os?this.updateContextState("interrupted"!==this.context.state,"context_statechange SPECIAL"):this.updateContextState(!1,"context_statechange"))}}:null;const Bt=u.isMainThread?new class extends Tt{constructor(){super(),this._tag=null,this.isSupported=!0}initialize(){function t(t,e){let i=e;for(;1<t;t--)i+=e;return i}var e;"Apple iOS"===tt.os&&"GameBundle"!==c.embed.type&&(e=document.createElement("div"),e.innerHTML="<audio x-webkit-airplay='deny'></audio>",this._tag=e.children.item(0),this._tag.controls=!1,this._tag.disableRemotePlayback=!0,this._tag.preload="auto",this._tag.src="data:audio/mpeg;base64,//uQx"+t(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+t(16,"gICA")+t(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+t(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+t(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+t(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+t(97,"V")+"Q==",this._tag.loop=!0,this._tag.load())}updateSuspensionState(t,e){this.isSuspended!==t&&(this.isSuspended=t),this.isSuspended?0<this.onSuspensionUpdate.count&&this.onSuspensionUpdate.invoke():e&&0<this.onSuspensionUpdate.count&&this.onSuspensionUpdate.invoke()}updateTagState(t){var e=k.isTicking;if(e&&this._tag.paused){if(t)try{var i=this._tag.play();i&&d.promise(i,V,V)}catch(t){}}else if(!e&&!this._tag.paused)try{this._tag.pause()}catch(t){}}App_tickingChange(){this._tag&&this.updateTagState("GameBundle"===c.embed.type)}App_activate(){this.updateSuspensionState(!k.isActive,!tt.isMobileDevice)}App_deactivate(){this.updateSuspensionState(!k.isActive,!1)}window_unlockEvent(){this._tag&&this.updateTagState(!0),this.updateSuspensionState(!k.isActive,!0)}}:null;const Pt=u.isMainThread?new class extends Tt{constructor(){super(),this.isSupported=!0}initialize(){}updateSuspensionState(){this.isSuspended=!k.isActive,0<this.onSuspensionUpdate.count&&this.onSuspensionUpdate.invoke()}App_tickingChange(){this.isSupported&&this.updateSuspensionState()}App_activate(){this.isSupported&&this.updateSuspensionState()}App_deactivate(){this.isSupported&&this.updateSuspensionState()}window_unlockEvent(){this.isSupported&&this.updateSuspensionState()}}:null;class Dt{get volume(){return this._volume}set volume(t){t=Math.max(Math.min(t,1),0),this._volume!==t&&(this._volume=t,this.onVolumeUpdate.invoke())}get isMuted(){return this._isMuted}set isMuted(t){this._isMuted!==t&&(this._isMuted=t,this.onVolumeUpdate.invoke())}constructor(t){this.onVolumeUpdate=new h,this._volume=1,this._isMuted=!1,this.name=t}}class x{get volume(){return this._volume}set volume(t){t=Math.max(Math.min(t,1),0),this._volume!==t&&(this._volume=t,this.renderer.updateVolume())}get isMuted(){return this._isMuted}set isMuted(t){this._isMuted!==t&&(this._isMuted=t,this.renderer.updateVolume())}get isLooped(){return this._isLooped}set isLooped(t){this._isLooped!==t&&(this._isLooped=t,this.renderer.updateLoop())}get playbackRate(){return this._playbackRate}set playbackRate(t){t=Math.max(t,0),this._playbackRate!==t&&(this._playbackRate=t,this.renderer.updatePlaybackRate())}get position(){return this.renderer.getPosition()}constructor(t,e=t.category){this.onComplete=new h,this.onLoop=new h,this.state=0,this._isMuted=!1,this.isStopped=!0,this.isPlaying=!1,this.isPaused=!1,this.data=t,this.category=e,this.duration=this.data.duration,this._volume=this.data.volume,this._isLooped=this.data.isLooped,this._playbackRate=this.data.playbackRate,0===t.type?(this.engine=Ft,this.renderer=new Rt(this)):1===t.type?(this.engine=Bt,this.renderer=new At(this)):(this.engine=Pt,this.renderer=new It(this))}play(){1!==this.state&&(this.state=1,this.isPlaying=!0,this.isStopped=!1,this.isPaused=!1,this.engine.onSuspensionUpdate.add(this.engine_onSuspensionUpdate,this),Mt.onVolumeUpdate.add(this.SoundManager_onVolumeUpdate,this),this.category.onVolumeUpdate.add(this.category_onVolumeUpdate,this),this.renderer.updatePlayback())}pause(){1===this.state&&this.haltPlayback(2)}resume(){this.play()}stop(){0!==this.state&&this.haltPlayback(0)}haltPlayback(t){1===this.state&&(this.engine.onSuspensionUpdate.remove(this.engine_onSuspensionUpdate,this),Mt.onVolumeUpdate.remove(this.SoundManager_onVolumeUpdate,this),this.category.onVolumeUpdate.remove(this.category_onVolumeUpdate,this)),this.state=t,this.isPlaying=!1,0===t?(this.isStopped=!0,this.isPaused=!1):(this.isStopped=!1,this.isPaused=!0),this.renderer.updatePlayback()}engine_onSuspensionUpdate(){this.renderer.updatePlayback()}SoundManager_onVolumeUpdate(){this.renderer.updateVolume()}category_onVolumeUpdate(){this.renderer.updateVolume()}}class Et{constructor(t){this.sound=t}}class Rt extends Et{constructor(t){super(t),this._srcNode=null,this._lastTick=0,this._position=0,this.source_ended=this.source_ended.bind(this)}getPosition(){return this._position}updateVolume(){this._gainNode&&(this._gainNode.gain.value=Mt._isMuted||this.sound.category._isMuted||this.sound._isMuted?0:c.embed.volume*Mt._volume*this.sound.category._volume*this.sound._volume)}updateLoop(){this._srcNode&&(this._srcNode.loop=this.sound._isLooped)}updatePlayback(){let t=!1;this.sound.engine.isSuspended||1!==this.sound.state||(t=!0),t?this._srcNode||this.createSource():(0===this.sound.state&&(this._position=0),this._srcNode&&this.destroySource())}updatePlaybackRate(){this._srcNode&&(this._srcNode.playbackRate.value=this.sound._playbackRate)}createSource(){this._srcNode=Ft.context.createBufferSource(),this._srcNode.buffer=this.sound.data.buffer,this._srcNode.playbackRate.value=this.sound._playbackRate,this._gainNode=Ft.context.createGain(),this._srcNode.connect(this._gainNode),this._gainNode.connect(Ft.context.destination),d.add(this._srcNode,"ended",this.source_ended),this._srcNode.onended=this.source_ended,this.updateLoop(),this.updateVolume(),this._lastTick=Date.now(),Mt.onPoll.add(this.SoundManager_onPoll,this),0<this._position?this._srcNode.start(0,this._position/1e3):this._srcNode.start()}destroySource(){d.remove(this._srcNode,"ended",this.source_ended),this._srcNode.onended=null,Mt.onPoll.remove(this.SoundManager_onPoll,this),this._srcNode.loop=!1,this._gainNode.gain.value=0,this._srcNode.stop(),this._srcNode.disconnect(),this._gainNode.disconnect(),this._gainNode=null,this._srcNode=null}source_ended(t){this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)}SoundManager_onPoll(){var t=Date.now()-this._lastTick;this._lastTick+=t,this._position+=t,this._position>=this.sound.duration&&(this._srcNode.loop?(this._position=this._position%this.sound.duration,this.sound.onLoop.count&&this.sound.onLoop.invoke(this.sound)):(this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)))}}class At extends Et{constructor(t){super(t),this._tag=null,this._playPromise=null,this._started=!1,this._lastTick=0,this._position=0,this.tag_loadeddata=this.tag_loadeddata.bind(this),this.tag_ended=this.tag_ended.bind(this),this.tag_play_fulfilled=this.tag_play_fulfilled.bind(this),this.tag_play_rejected=this.tag_play_rejected.bind(this)}getPosition(){return this._position}updateVolume(){this._tag&&(this._tag.volume=Mt._isMuted||this.sound.category._isMuted||this.sound._isMuted?0:c.embed.volume*Mt._volume*this.sound.category._volume*this.sound._volume)}updateLoop(){this._tag&&(this._tag.loop=this.sound._isLooped)}updatePlayback(){let t=!1;this.sound.engine.isSuspended||1!==this.sound.state||(t=!0),t?this._tag||this.createSource():(0===this.sound.state&&(this._position=0),this._tag&&this.destroySource())}updatePlaybackRate(){}createSource(){var t;"Apple iOS"===tt.os?(t=document.createElement("div"),t.innerHTML="<audio x-webkit-airplay='deny'></audio>",this._tag=t.children.item(0)):this._tag=document.createElement("audio"),this._tag.controls=!1,this._tag.disableRemotePlayback=!0,this._tag.crossOrigin=this.sound.data.buffer.crossOrigin,this._tag.playbackRate=this.sound.data.buffer.playbackRate,this._tag.preload="auto",this.updateLoop(),this.updateVolume(),d.add(this._tag,"loadeddata",this.tag_loadeddata),d.add(this._tag,"ended",this.tag_ended),Mt.onPoll.add(this.SoundManager_onPoll,this),this._tag.src=this.sound.data.buffer.src;try{var e=this._tag.play();e?this._playPromise=d.promise(e,this.tag_play_fulfilled,this.tag_play_rejected):this._tag.paused?this.destroySource():(this._lastTick=Date.now(),this._started=!0)}catch(t){this.destroySource()}}destroySource(){this._playPromise&&this._playPromise.cancel(),d.remove(this._tag,"loadeddata",this.tag_loadeddata),d.remove(this._tag,"ended",this.tag_ended),Mt.onPoll.remove(this.SoundManager_onPoll,this);try{this._tag.loop=!1}catch(t){}try{this._tag.muted=!0}catch(t){}try{this._tag.volume=0}catch(t){}try{this._tag.pause()}catch(t){}this._started=!1,this._tag=null}tag_loadeddata(){0!==this._position&&(this._tag.currentTime=this._position/1e3)}tag_ended(){this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)}tag_play_fulfilled(){this._playPromise=null,this._started=!0,this._lastTick=Date.now()}tag_play_rejected(t){this._playPromise=null,this.destroySource()}SoundManager_onPoll(){var t;this._started&&(t=Date.now()-this._lastTick,this._lastTick+=t,this._position+=t,this._position>=this.sound.duration)&&(this._tag.loop?(this._position=this._position%this.sound.duration,this.sound.onLoop.count&&this.sound.onLoop.invoke(this.sound)):(this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)))}}class It extends Et{constructor(t){super(t),this._src=!1,this._lastTick=0,this._position=0,this._loop=!1}getPosition(){return this._position}updateVolume(){}updateLoop(){this._loop=this.sound._isLooped}updatePlayback(){let t=!1;this.sound.engine.isSuspended||1!==this.sound.state||(t=!0),t?this._src||this.createSource():(0===this.sound.state&&(this._position=0),this._src&&this.destroySource())}updatePlaybackRate(){}createSource(){this._src=!0,this.updateLoop(),this.updateVolume(),this._lastTick=Date.now(),Mt.onPoll.add(this.SoundManager_onPoll,this)}destroySource(){Mt.onPoll.remove(this.SoundManager_onPoll,this),this._loop=!1,this._src=!1}SoundManager_onPoll(){var t=Date.now()-this._lastTick;this._lastTick+=t,this._position+=t,this._position>=this.sound.duration&&(this._loop?(this._position=this._position%this.sound.duration,this.sound.onLoop.count&&this.sound.onLoop.invoke(this.sound)):(this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)))}}const Mt=u.isMainThread?new class{get volume(){return this._volume}set volume(t){t=Math.max(Math.min(t,1),0),this._volume!==t&&(this._volume=t,this.onVolumeUpdate.invoke())}get isMuted(){return this._isMuted}set isMuted(t){this._isMuted!==t&&(this._isMuted=t,this.onVolumeUpdate.invoke())}constructor(){this.onVolumeUpdate=new h,this.onPoll=new h,this._volume=1,this._isMuted=!1,this._categories={},this._unlockingEvents=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],this.window_unlockEvent=this.window_unlockEvent.bind(this),this._categories.SFX=new Dt("SFX"),this._categories.Music=new Dt("Music")}initialize(){Bt.initialize(),Ft.initialize(),Pt.initialize();for(var t of this._unlockingEvents)d.add(window,t,this.window_unlockEvent,!1,!0)}createCategory(t){if(this._categories[t])throw"Sound Category ("+t+") already exists!";var e=new Dt(t);return this._categories[t]=e,e}getCategory(t){var e=this._categories[t];if(t)return e;throw new Error("Sound Category ("+t+") does not exist!")}poll(){0<this.onPoll.count&&this.onPoll.invoke()}App_tickingChange(){(k.isTicking?(Bt.App_tickingChange(),Ft.App_tickingChange(),Pt):(Pt.App_tickingChange(),Ft.App_tickingChange(),Bt)).App_tickingChange()}App_activate(){Bt.App_activate(),Ft.App_activate(),Pt.App_activate()}App_deactivate(){Pt.App_deactivate(),Ft.App_deactivate(),Bt.App_deactivate()}window_unlockEvent(){Bt.window_unlockEvent(),Ft.window_unlockEvent(),Pt.window_unlockEvent()}App_embedVolumeChange(){this.onVolumeUpdate.invoke()}}:null;class Ot{get srcUrl(){return this.src+"?v=1760562285692"}constructor(t,e){this.onLoaded=new h,this.onProgress=new h,this.onError=new h,this.onUnloaded=new h,this.preload=!0,this.state=0,this.bytesLoaded=0,this.progress=0,this.data=null,this.assetType=t,this.path=e}setSrc(t,e){this.ext=t,this.src=this.path+"."+t,this.size=e}load(){if(0!==this.state)throw new Error("Asset is not currently unloaded!");this.state=1}progressed(t,e){if(1!==this.state)throw new Error("Asset is not currently loading!");let i=0;e?(this.bytesLoaded=this.size,i=1):(t=t||0,t<0&&(t=0),t>this.size&&(t=this.size),this.bytesLoaded=t,0<this.size&&(i=t/this.size)),this.progress!==i&&(this.progress=i,this.onProgress.invoke(this))}loaded(t){if(this.progressed(this.size,!0),this.data=t,1!==this.state)throw new Error("Asset is not currently loading!");this.state=2,this.onLoaded.invoke(this)}error(t){if(1!==this.state)throw new Error("Asset is not currently loading!");this.state=3,l.warn("Failed to load",this.src,t),this.onError.invoke(this)}unloaded(){0!==this.state&&(this.state=0,this.data=null,this.progress=0,this.bytesLoaded=0,this.onUnloaded.invoke(this))}}class Lt extends Ot{constructor(t,e){super(2,e),this.imageAssetType=t}}class t extends Lt{constructor(t,e,i,s){super(0,e),this._isFallbackPNG=!1,this.tag_error=this.tag_error.bind(this),this.tag_load=this.tag_load.bind(this),this.rasterAssetType=t,this._pngJpgSize=i,this._webpSize=s,S.support&&this.init()}init(){let t=this._pngJpgSize,e=2===this.rasterAssetType?"jpg":"png";"GameBundle"===c.embed.type?1===this.rasterAssetType&&(e="webp",t=this._webpSize):1===this.rasterAssetType&&S.support.webp&&(e="webp",t=this._webpSize),this.setSrc(e,t)}load(){super.load(),this._tag=document.createElement("img"),this.listen(),this._tag.src=this.srcUrl}listen(){d.add(this._tag,"abort",this.tag_error),d.add(this._tag,"error",this.tag_error),d.add(this._tag,"load",this.tag_load)}unlisten(){d.remove(this._tag,"abort",this.tag_error),d.remove(this._tag,"error",this.tag_error),d.remove(this._tag,"load",this.tag_load)}tag_load(t){var e=this._tag;this.unlisten(),this._tag=null,this.loaded(e)}tag_error(t){"error"===t.type&&1===this.rasterAssetType&&S.support.webp&&!this._isFallbackPNG?(this._isFallbackPNG=!0,this.ext="png",this.src=this.path+".png",this.size=this._pngJpgSize,this._tag.src=this.srcUrl):(this.unlisten(),this._tag=null,this.error("Failed to load raster image asset due to "+t.type))}unload(){this._tag&&(this.unlisten(),this._tag=null),this.unloaded()}}class e extends Lt{constructor(t,e,i,s){super(1,t),this._isSVGAsset=!0,this.tag_error=this.tag_error.bind(this),this.tag_load=this.tag_load.bind(this),this._svgSize=s,this.naturalWidth=e,this.naturalHeight=i,S.support&&this.init()}init(){this.setSrc("svg",this._svgSize)}load(){super.load(),this._tag=document.createElement("img"),this.listen(),this._tag.src=this.srcUrl}listen(){d.add(this._tag,"abort",this.tag_error),d.add(this._tag,"error",this.tag_error),d.add(this._tag,"load",this.tag_load)}unlisten(){d.remove(this._tag,"abort",this.tag_error),d.remove(this._tag,"error",this.tag_error),d.remove(this._tag,"load",this.tag_load)}tag_load(t){var e=this._tag;this.unlisten(),this._tag=null,this.loaded(e)}tag_error(t){this.unlisten(),this._tag=null,this.error("Failed to load svg image asset due to "+t.type)}unload(){this._tag&&(this.unlisten(),this._tag=null),this.unloaded()}}class Ht extends Ot{constructor(t,e,i,s,n,a){super(0,t),this._fontFace=null,this._fontFaceLoadPromise=null,this._fontFaceAdded=!1,this._style=null,this._embed=null,this._lastWidth=-1,this._lastHeight=-1,this._startTime=null,this._isIntervalSet=!1,this._timeoutDelay=3e3,this._usingFontFaceAPI=!1,this.fontFace_onfulfilled=this.fontFace_onfulfilled.bind(this),this.fontFace_onrejected=this.fontFace_onrejected.bind(this),this.setInterval_handler=this.setInterval_handler.bind(this),this._ttfSize=n,this._woff2Size=a;n=t.split("/"),a=n[n.length-1];this._font=new it(a,"normal","normal",e,i,s),S.support&&this.init()}init(){let t=this._ttfSize,e="ttf";"GameBundle"!==c.embed.type&&!S.support.woff2||(e="woff2",t=this._woff2Size),this.setSrc(e,t)}load(){super.load(),W.fontFace.isSupported?this.loadUsingFontFace():this.loadUsingEmbedTest()}loadUsingFontFace(){this._usingFontFaceAPI=!0;var t={family:this._font.family,weight:this._font.weight,style:this._font.style,variant:"normal"};this._fontFace=new FontFace(this._font.family,"url("+this.srcUrl+")",t),this._fontFaceLoadPromise=d.promise(this._fontFace.load(),this.fontFace_onfulfilled,this.fontFace_onrejected)}fontFace_onfulfilled(t){this._fontFaceLoadPromise=null,this._fontFaceAdded=!0,document.fonts.add(t),this.loaded(this._font)}fontFace_onrejected(t){this._fontFaceLoadPromise=null,this.error("Font Face promise failed: "+t)}loadUsingEmbedTest(){var t="@font-face {\n\tfont-family: '"+this._font.family+"';\n\tsrc: url('"+this.srcUrl+"') format('truetype');\n\tfont-weight: "+this._font.weight+";\n\tfont-style: "+this._font.style+";\n\tfont-display: block;\n}";this._style=document.createElement("style"),this._style.innerHTML=t,document.head.appendChild(this._style),null===Ht._embedHolder&&(Ht._embedHolder=document.createElement("div"),Ht._embedHolder.style.cssText="display: inline-block; clear: both; white-space: nowrap; position: absolute; top: -10000px; left: -10000px;",0<document.body.children.length?document.body.insertBefore(Ht._embedHolder,document.body.children[0]):document.body.appendChild(Ht._embedHolder)),this._embed=document.createElement("div"),this._embed.style.cssText="font-family: Arial; font-weight: "+this._font.weight+"; font-style: "+this._font.style+";",this._embed.innerHTML="ABCDEFGHIJKLMNOPQRSTUVWXYZabcderfhijklmnopqrstuvwxyz0123456789`~!@#$%^&amp;*()_-+=|]}[{'&quot;;:/?.&gt;,&lt;",Ht._embedHolder.appendChild(this._embed),this.measure(),this._embed.style.cssText="font-family: '"+this._font.family+"', Arial; font-weight: "+this._font.weight+"; font-style: "+this._font.style+";",this.check()||this.startInterval()}measure(){var t=this._embed.clientWidth,e=this._embed.clientHeight,i=t!==this._lastWidth||e!==this._lastHeight;return this._lastWidth=t,this._lastHeight=e,i}check(){return!!this.measure()&&(this.embedComplete(),!0)}startInterval(){this._startTime=Date.now(),d.setTimeout(this.setInterval_handler,250,!0),this._isIntervalSet=!0}stopInterval(){this._isIntervalSet&&d.clearTimeout(this.setInterval_handler),this._isIntervalSet=!1}setInterval_handler(){!this._isIntervalSet||this.check()||Date.now()-this._startTime>=this._timeoutDelay&&this.embedTimeout()}embedTimeout(){this.stopInterval(),l.warn("Font "+this._font.family+" (weight: "+this._font.weight+", style: "+this._font.style+") timed out.");var t=this._font;this.loaded(t)}embedComplete(){this.stopInterval();var t=this._font;this.loaded(t)}unload(){this._usingFontFaceAPI?(this._usingFontFaceAPI=!1,this._fontFaceLoadPromise&&(this._fontFaceLoadPromise.cancel(),this._fontFaceLoadPromise=null),this._fontFaceAdded&&(document.fonts.delete(this._fontFace),this._fontFaceAdded=!1),this._fontFace=null):(this._embed&&(this._embed.parentElement.removeChild(this._embed),this._embed=null),this._style&&(this._style.parentElement.removeChild(this._style),this._style=null),this._isIntervalSet&&this.stopInterval(),this._lastWidth=this._lastHeight=-1,this._startTime=null,Ht._embedHolder&&0===Ht._embedHolder.children.length&&(Ht._embedHolder.parentElement.removeChild(Ht._embedHolder),Ht._embedHolder=null)),this.unloaded()}}Ht._embedHolder=null;class zt extends Ot{constructor(t,e,i,s){super(1,t),this._request=null,this._decodePromise=null,this._tag=null,this._usingWebAudio=!1,this.request_error=this.request_error.bind(this),this.request_progress=this.request_progress.bind(this),this.request_load=this.request_load.bind(this),this.decodeAudioData_error=this.decodeAudioData_error.bind(this),this.decodeAudioData_success=this.decodeAudioData_success.bind(this),this.tag_canplaythrough=this.tag_canplaythrough.bind(this),this.tag_error=this.tag_error.bind(this),this._mp3FileSize=i,this._m4aFileSize=s,this._duration=0<e?e:1e3,S.support&&this.init()}init(){let t=this._mp3FileSize,e="mp3";"GameBundle"!==c.embed.type&&!S.support.m4a||(e="m4a",t=this._m4aFileSize),this.setSrc(e,t)}load(){super.load(),Ft.isSupported?this.loadWebAudio():this.loadHTMLAudio()}loadWebAudio(){this._usingWebAudio=!0,this._request=new XMLHttpRequest,this._request.open("GET",this.srcUrl,!0),this._request.responseType="arraybuffer",this.listenRequest(),this._request.send()}listenRequest(){d.add(this._request,"progress",this.request_progress),d.add(this._request,"load",this.request_load),d.add(this._request,"abort",this.request_error),d.add(this._request,"error",this.request_error),d.add(this._request,"timeout",this.request_error)}unlistenRequest(){d.remove(this._request,"progress",this.request_progress),d.remove(this._request,"load",this.request_load),d.remove(this._request,"abort",this.request_error),d.remove(this._request,"error",this.request_error),d.remove(this._request,"timeout",this.request_error)}request_progress(t){this.stagedProgress(t.loaded,!1,!1)}stagedProgress(t,e,i){if(1!==this.state)throw new Error("Asset is not currently loading!");let s=0,n=0;e?(this.bytesLoaded=this.size,s=1):(t=t||0,t<0&&(t=0),t>this.size&&(t=this.size),this.bytesLoaded=t,0<this.size&&(s=t/this.size)),i&&(n=1);e=.5*s+.5*n;this.progress!==e&&(this.progress=e,this.onProgress.invoke(this))}request_load(t){400<=this._request.status?this.request_error(t):(this.stagedProgress(this.size,!0,!1),t=this._request.response,this.unlistenRequest(),this._request=null,this.decodeData(t))}request_error(t){this.unlistenRequest();var e=this._request.status;this._request=null,this.error("Failed to load web audio sound asset due to "+("load"===t.type?e+" status code":t.type))}decodeData(t){this._decodePromise=d.promise(void 0,this.decodeAudioData_success,this.decodeAudioData_error);t=Ft.context.decodeAudioData(t,this._decodePromise.onfulfilled,this._decodePromise.onrejected);t&&this._decodePromise.setPromise(t)}decodeAudioData_error(t){this._decodePromise.cancel(),this._decodePromise=null,"Apple iOS"===tt.os?(l.warn("Failed to decode audio data due to error below, will use "+this._duration+"ms empty fallback since this is an iOS device, for:",this.src),l.warn(t),this.stagedProgress(this.size,!0,!0),this.loaded(new Ct(2,this._duration))):(l.warn("Failed to decode audio data due to error below, trying HTML audio fallback, for:",this.src),l.warn(t),this.loadHTMLAudio())}decodeAudioData_success(t){this._decodePromise.cancel(),this._decodePromise=null,this.stagedProgress(this.size,!0,!0),this.loaded(new Ct(0,t))}loadHTMLAudio(){this._tag=document.createElement("audio"),this.listenTag(),this._tag.src=this.srcUrl,this._tag.load()}listenTag(){"Android"===tt.os?d.add(this._tag,"loadstart",this.tag_canplaythrough):d.add(this._tag,"canplaythrough",this.tag_canplaythrough),d.add(this._tag,"error",this.tag_error),d.add(this._tag,"abort",this.tag_error)}unlistenTag(){"Android"===tt.os?d.remove(this._tag,"loadstart",this.tag_canplaythrough):d.remove(this._tag,"canplaythrough",this.tag_canplaythrough),d.remove(this._tag,"error",this.tag_error),d.remove(this._tag,"abort",this.tag_error)}tag_canplaythrough(t){this.unlistenTag();var e=new Ct(1,this._tag);this._tag=null,this.loaded(e)}tag_error(t){this.unlistenTag(),this._tag=null,l.warn("Failed to load html audio file due to "+t.type+" and will use "+this._duration+"ms empty fallback for:",this.src),this.loaded(new Ct(2,this._duration))}unload(){this._usingWebAudio?(this._usingWebAudio=!1,this._request&&(this.unlistenRequest(),this._request=null),this._decodePromise&&(this._decodePromise.cancel(),this._decodePromise=null)):this._tag&&(this.unlistenTag(),this._tag=null),super.unloaded()}}class Gt{get error(){return this._error}get bytesTotal(){let t=0;for(var e of this._assets)t+=e.size;return t}get bytesLoaded(){let t=0;for(var e of this._assets)t+=e.bytesLoaded;return t}constructor(){this.onLoaded=new h,this.onProgress=new h,this.onError=new h,this._state=0,this._assets=[],this._activeThreadCount=0,this._currentIndex=0,this._isInLoadLoop=!1,this.progress=0,this._error=!1,this.done_timeout=this.done_timeout.bind(this)}add(t){if(0!==this._state)throw new Error("Loader already started!");if(null==t)throw new Error("Asset param is "+t);if(Array.isArray(t))for(var e of t)this._assets.push(e);else this._assets.push(t)}load(t=16){if(0!==this._state)throw new Error("Not currently unloaded!");this._state=1,this._maxThreads=t,this.loadNext()}loadNext(){if(!this._isInLoadLoop){for(this._isInLoadLoop=!0;!this._error&&this._currentIndex<this._assets.length&&this._activeThreadCount<this._maxThreads;){var t=this._assets[this._currentIndex];this._currentIndex++,t.onProgress.add(this.asset_onProgress,this),t.onLoaded.add(this.asset_onLoaded,this),t.onError.add(this.asset_onError,this),this._activeThreadCount++,0===t.state?t.load():1===t.state?this.asset_onProgress(t):2===t.state?(this.asset_onProgress(t),this.asset_onLoaded(t)):this.asset_onError(t)}this._isInLoadLoop=!1,!this._error&&0===this._activeThreadCount&&this._currentIndex>=this._assets.length&&(this.progress=1,this.onProgress.invoke(this),d.setTimeout(this.done_timeout,0,!1))}}cancel(){d.containsTimeout(this.done_timeout)&&d.clearTimeout(this.done_timeout);for(var t of this._assets)t.onProgress.contains(this.asset_onProgress,this)&&t.onProgress.remove(this.asset_onProgress,this),t.onLoaded.contains(this.asset_onLoaded,this)&&t.onLoaded.remove(this.asset_onLoaded,this),t.onError.contains(this.asset_onError,this)&&t.onError.remove(this.asset_onError,this);this._state=0,this._assets.length=0,this._activeThreadCount=0,this._currentIndex=0,this._isInLoadLoop=!1,this.progress=0,this._error=!1}done_timeout(){this._state=2,this.onLoaded.invoke(this)}asset_onProgress(t){if(!this._error){var e,i=1/this._assets.length;this.progress=0;for(e of this._assets)this.progress+=e.progress*i;this.progress<0&&(this.progress=0),1<this.progress&&(this.progress=1),this.onProgress.invoke(this)}}asset_onLoaded(t){this._activeThreadCount--,t.onProgress.remove(this.asset_onProgress,this),t.onLoaded.remove(this.asset_onLoaded,this),t.onError.remove(this.asset_onError,this),this._error||this.loadNext()}asset_onError(t){t.onProgress.remove(this.asset_onProgress,this),t.onLoaded.remove(this.asset_onLoaded,this),t.onError.remove(this.asset_onError,this),this._error=!0,this.onError.invoke(this)}}const S={fonts:{},sounds:{},images:{},dynamic:{vector:{},pattern:{},gradient:{},raster:{}},support:null,preload:function(){let r=this;{var t;r.support={},W.fontFace.isSupported?(t=new FontFace("t","url('data:font/woff2;base64,d09GMgABAAAAAADwAAoAAAAAAiQAAACoAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAALAogOAE2AiQDBgsGAAQgBSAHIBuDAciO1EZ3I/mL5/+5/rfPnTt9/9Qa8H4cUUZxaRbh36LiKJoVh61XGzw6ufkpoeZBW4KphwFYIJGHB4LAY4hby++gW+6N1EN94I49v86yCpUdYgqeZrOWN34CMQg2tAmthdli0eePIwAKNIIRS4AGZFzdX9lbBUAQlm//f262/61o8PlYO/D1/X4FrWFFgdCQD9DpGJSxmFyjOAGUU4P0qigcNb82GAAA') format('woff2')",{}),d.promise(t.load(),V,V),r.support.woff2="loading"===t.status||"loaded"===t.status):r.support.woff2=!1,r.support.woff2||l.info("woff2 fonts are not supported, falling back to ttf"),r.support.m4a=window.MediaSource&&MediaSource.isTypeSupported("audio/aac");let o;function h(t){o.removeEventListener("load",h),o.removeEventListener("error",h),r.support.webp="load"===t.type&&!!o.width,r.support.webp||l.info("webp images are not supported, falling back to png"),i(r.images),i(r.fonts),i(r.sounds);{let i=new Gt;function e(t){for(var e in t)t[e].preload&&i.add(t[e])}function s(){i.onError.remove(s,null),i.onProgress.remove(n,null),i.onLoaded.remove(a,null),k.Assets_preloadError()}function n(){k.Assets_preloadProgress(i.bytesLoaded,i.bytesTotal,i.progress)}function a(){i.onError.remove(s,null),i.onProgress.remove(n,null),i.onLoaded.remove(a,null),k.Assets_preloadComplete()}e(r.sounds),e(r.fonts),e(r.images),i.onError.add(s,null),i.onProgress.add(n,null),i.onLoaded.add(a,null),i.load()}function i(t){for(var e in t)t[e].init()}}o=document.createElement("img"),o.addEventListener("load",h),o.addEventListener("error",h),o.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA=="}}};class Nt extends class{constructor(){this.onActivated=new h,this.onDeactivated=new h,this.onTickingChange=new h,this.onIntent=new h,this.intent=null,this.isActive=!1,this.isTicking=!1,this._started=!1,this._rafId=null,this.info={name:"Pool",id:"games247.pool",namespace:"pool",gameType:"pool",version:(new et).fromVersionString("1.2.0.0"),buildDate:new Date(1760562285692),theme:document.getElementById("game-script").getAttribute("data-theme")},this.script_loadGame=this.script_loadGame.bind(this),this.script_startGame=this.script_startGame.bind(this),this.script_intentTriggered=this.script_intentTriggered.bind(this),this.script_embedPauseChange=this.script_embedPauseChange.bind(this),this.script_embedVolumeChange=this.script_embedVolumeChange.bind(this),this.script_backButtonPress=this.script_backButtonPress.bind(this),this.script_keyboardEvent=this.script_keyboardEvent.bind(this),this.raf=this.raf.bind(this),c.script.loadGame=this.script_loadGame,c.script.startGame=this.script_startGame,c.script.intentTriggered=this.script_intentTriggered,c.script.backButtonPress=this.script_backButtonPress,c.script.keyboardEvent=this.script_keyboardEvent,c.script.embedPauseChange=this.script_embedPauseChange,c.script.embedVolumeChange=this.script_embedVolumeChange}initialize(){ce.initialize(),m.initialize(),c.initialize(),f.initialize(),w.initialize(),_t.initialize(),Mt.initialize(),P.initialize(),S.preload()}start(){S.sounds.click.data.volume=.5,"AmazonFireTV"===c.embed.variant&&(ft.allowed=!0,ft.enabled=!0,m.view.maxWidth=1920,m.view.maxHeight=1080),this._started=!0,this.tick(),M.main(),this.updateTickingActiveState()}tick(){var t;m.poll(),Mt.poll(),P.poll(),ft.poll(),"GameBundle"===c.embed.type&&"AmazonFireTV"===c.embed.variant&&(t=f._coordsInit&&f.x<10,t?c.appMenuTriggered||(c.appMenuTriggered=!0,c.script.onToggleAppMenu(!0)):c.appMenuTriggered&&(c.appMenuTriggered=!1,c.script.onToggleAppMenu(!1))),o._instance&&o._instance.tick(),St.frame(),St.profiler.reset()}raf(){this._rafId=null,this.tick(),this.isTicking&&(this._rafId=requestAnimationFrame(this.raf))}updateTickingActiveState(){var t=this.testActive(),t=(this.isActive!==t&&(this.isActive=t,this.isActive?this.activate():this.deactivate()),this.testTickable());this.isTicking!==t&&(this.isTicking=t,this.isTicking?null===this._rafId&&(this._rafId=requestAnimationFrame(this.raf)):(null!==this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=null),Mt.App_tickingChange(),this.onTickingChange.count)&&this.onTickingChange.invoke()}activate(){_.App_activate(),Mt.App_activate(),o._instance&&o._instance.activate(),this.tick(),St.reset(),this.onActivated.invoke()}deactivate(){this.onDeactivated.invoke(),o._instance&&o._instance.deactivate(),Mt.App_deactivate(),_t.App_deactivate(),f.App_deactivate(),_.App_deactivate(),c.App_deactivate(),this.tick(),St.reset()}Assets_preloadProgress(t,e,i){i<0&&(i=0),1<i&&(i=1),c.preloadProgress(t,e,i)}Assets_preloadError(){c.preloadError()}Assets_preloadComplete(){c.script.onGameLoaded()}gameReloadWithIntent(t){c.script.onGameReload&&(o._instance&&o._instance.reloading(),c.script.onGameReload(t))}gameReload(){c.script.onGameReload&&(o._instance&&o._instance.reloading(),c.script.onGameReload())}script_loadGame(t){t=t||{},t.defaultMute=t.defaultMute||!1,t.rateUsURL=t.rateUsURL||"https://www.247games.com/",t.moreGamesURL=t.moreGamesURL||"https://www.247games.com/",!0!==t.showRateUsButton&&!1!==t.showRateUsButton&&(t.showRateUsButton=!0),t.interstitials=t.interstitials||{},t.interstitials.desktop=t.interstitials.desktop||{},t.interstitials.desktop.enabled=t.interstitials.desktop.enabled||!1,t.interstitials.mobile=t.interstitials.mobile||{},t.interstitials.mobile.enabled=t.interstitials.mobile.enabled||!1,this.config=t,this.initialize()}script_startGame(t){l.log("App.script_startGame",JSON.stringify(t)),"object"==typeof t&&null!==t?this.intent=t:"string"==typeof t&&""!==t&&(this.intent={type:"Url",href:t}),this.start()}script_intentTriggered(t){this._started?(l.log("App.script_intentTriggered",JSON.stringify(t)),"object"==typeof t&&null!==t?(this.intent=t,this.onIntent.invoke()):"string"==typeof t&&""!==t&&(this.intent={type:"Url",href:t},this.onIntent.invoke())):l.log("WARNING!!!! App.script_intentTriggered BUT NOT STARTED YET",JSON.stringify(t))}script_backButtonPress(){this._started&&k.isActive&&(l.log("App.script_backButtonPress"),pt.back.press())}script_keyboardEvent(t){this._started&&k.isActive&&("keydown"===t.type?_.target_keydown(t):"keyup"===t.type&&_.target_keyup(t))}script_embedPauseChange(t){this._started&&"boolean"==typeof t&&c.embed.paused!==t&&(c.embed.paused=t,m.App_embedPauseChange(),this.updateTickingActiveState())}script_embedVolumeChange(t){this._started&&"number"==typeof t&&!isNaN(t)&&isFinite(t)&&(t<0&&(t=0),1<t&&(t=1),c.embed.volume!==t)&&(c.embed.volume=t,Mt.App_embedVolumeChange())}AppPlayer_pauseChange(){m.App_pauseChange(),this.updateTickingActiveState()}GameWindow_view_invalidated(){}GameWindow_view_change(){P.App_viewChange()}GameWindow_focus_change(){this.updateTickingActiveState()}GameWindow_visibility_change(){m.App_visibilityChange(),this.updateTickingActiveState()}GameWindow_fullscreen_change(){_.reset(),f.reset(),_t.reset(),P.App_fullscreenChange(),m.App_fullscreenChange(),c.App_fullscreenChange(),this.updateTickingActiveState()}}{constructor(){super()}testActive(){return"GameBundle"===c.embed.type?!c.embed.paused&&this._started&&!c.isPaused&&m.visibility.isVisible:!c.embed.paused&&this._started&&!c.isPaused&&m.visibility.isVisible&&("Apple iOS"!==tt.os||m.focus.isFocused)}testTickable(){return"GameBundle"===c.embed.type?!c.embed.paused&&this._started&&m.visibility.isVisible:!c.embed.paused&&this._started&&m.visibility.isVisible&&("Apple iOS"!==tt.os||m.focus.isFocused)}}const k=function(){if(u.isMainThread){if("Web App"===tt.runtime)return new Nt;throw new Error("Not implemented")}}();class Vt{constructor(t){this._ctx=t,this.resetState()}setTransform(t,e,i,s,n,a){this._a===t&&this._b===e&&this._c===i&&this._d===s&&this._e===n&&this._f===a||(this._a=t,this._b=e,this._c=i,this._d=s,this._e=n,this._f=a,this._ctx.setTransform(t,e,i,s,n,a))}clearRect(t,e,i,s){this._ctx.clearRect(t,e,i,s)}save(){this._ctx.save()}beginPath(){this._ctx.beginPath()}clip(){this._ctx.clip()}restore(){this._ctx.restore(),this.resetState()}rect(t,e,i,s){this._ctx.rect(t,e,i,s)}arc(t,e,i,s,n,a){this._ctx.arc(t,e,i,s,n,!!a)}strokeRect(t,e,i,s){this._ctx.strokeRect(t,e,i,s)}drawImage(t,e,i,s,n,a,o,r,h){void 0!==a?this._ctx.drawImage(t,e,i,s,n,a,o,r,h):void 0!==s?this._ctx.drawImage(t,e,i,s,n):this._ctx.drawImage(t,e,i)}set globalAlpha(t){this._globalAlpha!==t&&(this._ctx.globalAlpha=this._globalAlpha=t)}set strokeStyle(t){this._strokeStyle!==t&&(this._ctx.strokeStyle=this._strokeStyle=t)}set lineWidth(t){this._lineWidth!==t&&(this._ctx.lineWidth=this._lineWidth=t)}set globalCompositeOperation(t){this._globalCompositeOperation!==t&&(this._ctx.globalCompositeOperation=this._globalCompositeOperation=t)}set font(t){this._font!==t&&(this._ctx.font=this._font=t)}set textBaseline(t){this._textBaseline!==t&&(this._ctx.textBaseline=this._textBaseline=t)}set textAlign(t){this._textAlign!==t&&(this._ctx.textAlign=this._textAlign=t)}measureText(t){return this._ctx.measureText(t)}strokeText(t,e,i,s){void 0!==s?this._ctx.strokeText(t,e,i,s):this._ctx.strokeText(t,e,i)}set fillStyle(t){this._fillStyle!==t&&(this._ctx.fillStyle=this._fillStyle=t)}fillText(t,e,i,s){void 0!==s?this._ctx.fillText(t,e,i,s):this._ctx.fillText(t,e,i)}set lineJoin(t){this._lineJoin!==t&&(this._ctx.lineJoin=this._lineJoin=t)}moveTo(t,e){this._ctx.moveTo(t,e)}lineTo(t,e){this._ctx.lineTo(t,e)}closePath(){this._ctx.closePath()}stroke(t){void 0!==t?this._ctx.stroke(t):this._ctx.stroke()}set lineCap(t){this._lineCap!==t&&(this._ctx.lineCap=this._lineCap=t)}fill(t,e){void 0===t?this._ctx.fill():"string"!=typeof t&&"string"==typeof e?this._ctx.fill(t,e):this._ctx.fill(t)}set lineDashOffset(t){this._lineDashOffset!==t&&(this._ctx.lineDashOffset=this._lineDashOffset=t)}setLineDash(t){this._ctx.setLineDash(t)}quadraticCurveTo(t,e,i,s){this._ctx.quadraticCurveTo(t,e,i,s)}scale(t,e){this._ctx.scale(t,e);t=this._ctx.getTransform();this._a=t.a,this._b=t.b,this._c=t.c,this._d=t.d,this._e=t.e,this._f=t.f}translate(t,e){this._ctx.scale(t,e);t=this._ctx.getTransform();this._a=t.a,this._b=t.b,this._c=t.c,this._d=t.d,this._e=t.e,this._f=t.f}set miterLimit(t){this._miterLimit!==t&&(this._ctx.miterLimit=this._miterLimit=t)}createPattern(t,e){return this._ctx.createPattern(t,e)}createRadialGradient(t,e,i,s,n,a){return this._ctx.createRadialGradient(t,e,i,s,n,a)}createLinearGradient(t,e,i,s){return this._ctx.createLinearGradient(t,e,i,s)}resetState(){var t=this._ctx.getTransform();this._a=t.a,this._b=t.b,this._c=t.c,this._d=t.d,this._e=t.e,this._f=t.f,this._globalAlpha=this._ctx.globalAlpha,this._strokeStyle=this._ctx.strokeStyle,this._lineWidth=this._ctx.lineWidth,this._globalCompositeOperation=this._ctx.globalCompositeOperation,this._font=this._ctx.font,this._textBaseline=this._ctx.textBaseline,this._textAlign=this._ctx.textAlign,this._fillStyle=this._ctx.fillStyle,this._lineJoin=this._ctx.lineJoin,this._lineCap=this._ctx.lineCap,this._lineDashOffset=this._ctx.lineDashOffset,this._miterLimit=this._ctx.miterLimit}}class jt{get r(){return this._r}set r(t){this._r=1<=t?1:t<=0?0:t}get g(){return this._g}set g(t){this._g=1<=t?1:t<=0?0:t}get b(){return this._b}set b(t){this._b=1<=t?1:t<=0?0:t}get a(){return this._a}set a(t){this._a=1<=t?1:t<=0?0:t}constructor(t=1,e=1,i=1,s=1){this._r=1<=t?1:t<=0?0:t,this._g=1<=e?1:e<=0?0:e,this._b=1<=i?1:i<=0?0:i,this._a=1<=s?1:s<=0?0:s}copy(t){return this._r=t._r,this._g=t._g,this._b=t._b,this._a=t._a,this}set(t,e,i,s){return this._r=1<=t?1:t<=0?0:t,this._g=1<=e?1:e<=0?0:e,this._b=1<=i?1:i<=0?0:i,this._a=1<=s?1:s<=0?0:s,this}interpolateFromTo(t,e,i){return this.set(i*(e._r-t._r)+t._r,i*(e._g-t._g)+t._g,i*(e._b-t._b)+t._b,i*(e._a-t._a)+t._a)}equals(t){return this._r===t._r&&this._g===t._g&&this._b===t._b&&this._a===t._a}clone(){return new jt(this._r,this._g,this._b,this._a)}toHSV(){var t=255*this.r,e=255*this.g,i=255*this.b;let s=Math.max(t,e,i),n=Math.min(t,e,i),a=s-n,o,r=0===s?0:a/s,h=s/255;switch(s){case n:o=0;break;case t:o=e-i+a*(e<i?6:0),o/=6*a;break;case e:o=i-t+2*a,o/=6*a;break;case i:o=t-e+4*a,o/=6*a}return{h:o,s:r,v:h}}fromHSV(t,e,i,s=1){t<0&&(t=0),e<0&&(e=0),i<0&&(i=0);let n,a,o,r,h,l,d,c;switch(r=Math.floor(6*t),h=6*t-r,l=i*(1-e),d=i*(1-h*e),c=i*(1-(1-h)*e),r%6){case 0:n=i,a=c,o=l;break;case 1:n=d,a=i,o=l;break;case 2:n=l,a=i,o=c;break;case 3:n=l,a=d,o=i;break;case 4:n=c,a=l,o=i;break;case 5:n=i,a=l,o=d}this.r=n,this.g=a,this.b=o,this.a=s}toStyleHexRGB(){var t=Math.round(255*this._r),e=Math.round(255*this._g),i=Math.round(255*this._b);return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}toStyleHexRGBA(){function t(t){t=t.toString(16);return 1===t.length?"0"+t:t}var e=Math.round(255*this._r),i=Math.round(255*this._g),s=Math.round(255*this._b),n=Math.round(255*this._a);return"#"+t(e)+t(i)+t(s)+t(n)}fromStyleHexRGB(t){vt.warn("Color::fromStyleHexRGB","Color::fromStyleHex"),8===t.length&&"#"!==t.charAt(0)&&(t="#"+t),9===t.length&&(t=t.substring(0,7)),4===t.length&&"#"!==t.charAt(0)&&(t="#"+t),5===t.length&&(t=t.substring(0,4));t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(e)return this.r=parseInt(e[1],16)/255,this.g=parseInt(e[2],16)/255,this.b=parseInt(e[3],16)/255,this;throw new Error("Not a valid 6 or 3 char hex rgb value! "+t)}fromStyleHex(t){if("#"!==t.charAt(0))throw new Error("Hex doesn't start with pound. Hex: "+t);if(4!==t.length&&5!==t.length&&7!==t.length&&9!==t.length)throw new Error("Hex length invalid! Hex: "+t);if(4===t.length?(e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,t=t.replace(e,function(t,e,i,s){return e+e+i+i+s+s})):5===t.length&&(e=/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,t=t.replace(e,function(t,e,i,s,n){return e+e+i+i+s+s+n+n})),7===t.length){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!e)throw new Error("Not a valid 6 or 3 char hex rgb value! "+t);this.r=parseInt(e[1],16)/255,this.g=parseInt(e[2],16)/255,this.b=parseInt(e[3],16)/255}else{if(9!==t.length)throw new Error("Unexpected hex code length ("+t.length+")! Hex (may be expanded): "+t);e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!e)throw new Error("Not a valid 6 or 3 char hex rgb value! "+t);this.r=parseInt(e[1],16)/255,this.g=parseInt(e[2],16)/255,this.b=parseInt(e[3],16)/255,this.a=parseInt(e[4],16)/255}return this}fromStyleFuncRGBA(t){t=t.split("(")[1].split(")")[0].split(",");return this.r=parseInt(t[0],10)/255,this.g=parseInt(t[1],10)/255,this.b=parseInt(t[2],10)/255,this.a=parseFloat(t[3]),this}fromStyle(t){return t=t.trim(),0===t.indexOf("rgba(")?this.fromStyleFuncRGBA(t):this.fromStyleHex(t)}toStyleFuncRGBA(){return"rgba("+Math.round(255*this._r)+", "+Math.round(255*this._g)+", "+Math.round(255*this._b)+", "+this._a+")"}toStyle(){return 1!==this._a?this.toStyleFuncRGBA():this.toStyleHexRGB()}}class Ut{constructor(t,e){this.asset=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.asset.naturalWidth,this.canvas.height=this.asset.naturalHeight,this._ctx=this.canvas.getContext("2d"),this.update(e)}update(t){var e;this.scaleFactor!==t&&(this.scaleFactor=t,this.inverseScaleFactor=1/t,e=t*this.asset.naturalWidth,t=t*this.asset.naturalHeight,this.canvas.width=Math.max(1,Math.ceil(e)),this.canvas.height=Math.max(1,Math.ceil(t)),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.drawImage(this.asset.data,0,0,e,t))}}const Wt=new class{constructor(){this._dict={},this._list=[],this._scaleFactor=1,this.enabled=!0}get(t){let e=this._dict[t.path];return e||(this._dict[t.path]=e=new Ut(t,this._scaleFactor),this._list.push(e)),e}update(t){if((!this.enabled||t<1)&&(t=1),this._scaleFactor!==t){this._scaleFactor=t;for(var e of this._list)e.update(t)}}},$t={};class C{constructor(t,e=!0,i=!0,s=null){this.onPointerOver=new h,this.onPointerOut=new h,this.onPointerRollOver=new h,this.onPointerRollOut=new h,this.onPointerPress=new h,this.onPointerRelease=new h,this.onPointerClick=new h,this.onPointerCancel=new h,this.onPointerSecondaryPress=new h,this.onPointerSecondaryRelease=new h,this.onPointerSecondaryClick=new h,this.onPointerSecondaryCancel=new h,this.displayObject=t,this.pointerEnabled=e,this.pointerChildrenEnabled=i,this.hitArea=s}}class Yt{get cursor(){return this._cursor}get overDisplayObject(){return this._pointChain.last?this._pointChain.last.value:null}constructor(){this._pointChains=[new H,new H],this._pointChainIndex=0,this._pressChain=new H,this._secondaryPressChain=new H,this._pressed=!1,this._secondaryPressed=!1,this._cursor=null,this._pool=new z,this._setCursor=null,this._pointChain=this._pointChains[0],this._nextPointChain=this._pointChains[1],w.primary.onPress.add(this.PointerInput_primary_onPress,this),w.primary.onRelease.add(this.PointerInput_primary_onRelease,this),w.primary.onCancel.add(this.PointerInput_primary_onCancel,this),w.primary.onSecondaryPress.add(this.PointerInput_primary_onSecondaryPress,this),w.primary.onSecondaryRelease.add(this.PointerInput_primary_onSecondaryRelease,this),w.primary.onSecondaryCancel.add(this.PointerInput_primary_onSecondaryCancel,this)}beginFrame(){this.point()}point(){let t,e,i,s;var n,a;let o,r,h=null;for(a=w.primary.isPresent?P.pick(w.primary.x,w.primary.y,0):null,n=this._pointChain.last?this._pointChain.last.value:null,i=a;i;){var l=this._pool.remove()||new L;l.value=i,this._nextPointChain.prepend(l),h=h||i.cursor,i=i.parent}for(o=null,e=this._pointChain.first,t=this._nextPointChain.first,r=null!==e||null!==t;e&&t&&e.value===t.value;)o=e.value,e=e.next,t=t.next,e||t||(r=!1);for(s=!1,e=this._pointChain.last;e;)r&&e.value.input&&e.value.input.onPointerOut.count&&e.value.input.onPointerOut.invoke(e.value,n),s||(e.value!==o?e.value.input&&e.value.input.onPointerRollOut.count&&e.value.input.onPointerRollOut.invoke(e.value,n):s=!0),e.value=null,this._pool.add(e),e=e.previous;for(this._pointChain.clear(),s=!1,t=this._nextPointChain.last;t;)s||(t.value!==o?t.value.input&&t.value.input.onPointerRollOver.count&&t.value.input.onPointerRollOver.invoke(t.value,a):s=!0),r&&t.value.input&&t.value.input.onPointerOver.count&&t.value.input.onPointerOver.invoke(t.value,a),t=t.previous;0===this._pointChainIndex?(this._pointChain=this._pointChains[1],this._nextPointChain=this._pointChains[0],this._pointChainIndex=1):(this._pointChain=this._pointChains[0],this._nextPointChain=this._pointChains[1],this._pointChainIndex=0),h=P.overrideCursorType||h||P.defaultCursor,this._cursor!==h&&(this._cursor=h);let d=this._cursor;f.softMouseControl&&(d="none"),this._setCursor!==d&&(this._setCursor=d,P.canvas.style.cursor=d)}press(){this._pressed&&this.cancel(),this._pressed=!0,this.point();let t=this._pointChain.last,e;for(;t;)e=this._pool.remove()||new L,e.value=t.value,this._pressChain.prepend(e),t=t.previous;e=this._pressChain.last;for(var i=e?e.value:null;e;)e.value.input&&e.value.input.onPointerPress.count&&e.value.input.onPointerPress.invoke(e.value,i),e=e.previous}release(){this._pressed=!1,this.point();let t,e,i,s;var n;let a,o;for(a=null,e=this._pressChain.first,t=this._pointChain.first,o=null!==e||null!==t;e&&t&&e.value===t.value;)a=e.value,e=e.next,t=t.next,e||t||(o=!1);if(o){for(i=!1,e=this._pressChain.last,s=e?e.value:null;e;)i||e.value===a?i=!0:e.value.input&&e.value.input.onPointerCancel.count&&e.value.input.onPointerCancel.invoke(e.value,s),e.value=null,this._pool.add(e),e=e.previous;for(this._pressChain.clear(),t=this._pointChain.last,n=t?t.value:null;t;)t.value.input&&t.value.input.onPointerRelease.count&&t.value.input.onPointerRelease.invoke(t.value,n),t=t.previous}else{for(e=this._pressChain.last,s=e?e.value:null;e;)e.value.input&&e.value.input.onPointerRelease.count&&e.value.input.onPointerRelease.invoke(e.value,s),e.value.input&&e.value.input.onPointerClick.count&&e.value.input.onPointerClick.invoke(e.value,s),e.value=null,this._pool.add(e),e=e.previous;this._pressChain.clear()}}cancel(){this._pressed=!1;let t=this._pressChain.last;for(var e=t?t.value:null;t;)t.value.input&&t.value.input.onPointerCancel.count&&t.value.input.onPointerCancel.invoke(t.value,e),t.value=null,this._pool.add(t),t=t.previous;this._pressChain.clear()}pressSecondary(){this._secondaryPressed&&this.cancelSecondary(),this._secondaryPressed=!0,this.point();let t=this._pointChain.last,e;for(;t;)e=this._pool.remove()||new L,e.value=t.value,this._secondaryPressChain.prepend(e),t=t.previous;e=this._secondaryPressChain.last;for(var i=e?e.value:null;e;)e.value.input&&e.value.input.onPointerSecondaryPress.count&&e.value.input.onPointerSecondaryPress.invoke(e.value,i),e=e.previous}releaseSecondary(){this._secondaryPressed=!1,this.point();let t,e,i,s;var n;let a,o;for(a=null,e=this._secondaryPressChain.first,t=this._pointChain.first,o=null!==e||null!==t;e&&t&&e.value===t.value;)a=e.value,e=e.next,t=t.next,e||t||(o=!1);if(o){for(i=!1,e=this._secondaryPressChain.last,s=e?e.value:null;e;)i||e.value===a?i=!0:e.value.input&&e.value.input.onPointerSecondaryCancel.count&&e.value.input.onPointerSecondaryCancel.invoke(e.value,s),e.value=null,this._pool.add(e),e=e.previous;for(this._secondaryPressChain.clear(),t=this._pointChain.last,n=t?t.value:null;t;)t.value.input&&t.value.input.onPointerSecondaryRelease.count&&t.value.input.onPointerSecondaryRelease.invoke(t.value,n),t=t.previous}else{for(e=this._secondaryPressChain.last,s=e?e.value:null;e;)e.value.input&&e.value.input.onPointerSecondaryRelease.count&&e.value.input.onPointerSecondaryRelease.invoke(e.value,s),e.value.input&&e.value.input.onPointerSecondaryClick.count&&e.value.input.onPointerSecondaryClick.invoke(e.value,s),e.value=null,this._pool.add(e),e=e.previous;this._secondaryPressChain.clear()}}cancelSecondary(){this._secondaryPressed=!1;let t=this._secondaryPressChain.last;for(var e=t?t.value:null;t;)t.value.input&&t.value.input.onPointerSecondaryCancel.count&&t.value.input.onPointerSecondaryCancel.invoke(t.value,e),t.value=null,this._pool.add(t),t=t.previous;this._secondaryPressChain.clear()}PointerInput_primary_onPress(){this.press()}PointerInput_primary_onRelease(){this.release()}PointerInput_primary_onCancel(){this.cancel()}PointerInput_primary_onSecondaryPress(){this.pressSecondary()}PointerInput_primary_onSecondaryRelease(){this.releaseSecondary()}PointerInput_primary_onSecondaryCancel(){this.cancelSecondary()}}class qt{constructor(){this.parent=null,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.skewX=0,this.skewY=0,this.regX=0,this.regY=0,this.maskShape=null,this.visible=!0,this.alpha=1,this.cursor=null,this.input=null,this._wvp=new Q,this._pt=new v,this._xformMatrix=new Q}getConcatenatedMatrix(t){t=t||new Q,t.setTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY);let e=this.parent;for(;e;)t.prependTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY),e=e.parent;return t.prependTransform(0,0,P.scaleFactor,P.scaleFactor,0,0,0,0,0),t}globalToLocal(t){return this.getConcatenatedMatrix(this._xformMatrix).invert().transformVector(t)}localToGlobal(t){return this.getConcatenatedMatrix(this._xformMatrix).transformVector(t)}setPosition(t,e){return this.x=t,this.y=e,this}setRotation(t){return this.rotation=t,this}setReg(t,e){return this.regX=t,this.regY=e,this}}class Xt extends qt{constructor(){super(...arguments),this._children=[]}get children(){return this._children}addChild(t){if(t===this)throw new Error("Cannot add an item to itself!");let e=this.parent;for(;e;){if(e===t)throw new Error("An item cannot be added as its own descendant!");e=e.parent}return t.parent&&t.parent.removeChild(t),this._children.push(t),t.parent=this,t}addChildAt(t,e){if(t===this)throw new Error("Cannot add an item to itself!");let i=this.parent;for(;i;){if(i===t)throw new Error("An item cannot be added as its own descendant!");i=i.parent}if(e<0||e>this._children.length)throw new Error("Index ("+e+") out of range [0, "+this._children.length+"]!");return t.parent&&t.parent.removeChild(t),e<=0?this._children.unshift(t):e>=this._children.length?this._children.push(t):this._children.splice(e,0,t),t.parent=this,t}getChildIndex(t){t=this._children.indexOf(t);if(t<0)throw new Error("DisplayObject is not a child of this Container!");return t}setChildIndex(t,e){if(e<0||e>=this._children.length)throw new Error("Index ("+e+") out of range [0, "+this._children.length+"]!");var i=this._children.indexOf(t);if(i<0)throw new Error("DisplayObject is not a child of this Container!");i!==e&&(this._children.splice(i,1),e<=0?this._children.unshift(t):e>=this._children.length?this._children.push(t):this._children.splice(e,0,t))}swapChildren(t,e){var i=this._children.indexOf(t),s=this._children.indexOf(e);if(i<0||s<0)throw new Error("DisplayObject is not a child of this Container!");i!==s&&(this._children[i]=e,this._children[s]=t)}getChildAt(t){if(t<0||t>=this._children.length)throw new Error("Index ("+t+") out of range [0, "+this._children.length+"]!");return this._children[t]}removeChild(t){var e=this._children.indexOf(t);if(e<0)throw new Error("DisplayObject is not a child of this Container!");return this._children.splice(e,1),t.parent=null,t}removeChildAt(t){if(t<0||t>=this._children.length)throw new Error("Index ("+t+") out of range [0, "+this._children.length+"]!");t=this._children.splice(t,1)[0];return t.parent=null,t}pick(i,s,n,a){if(0!==a||!this.input||this.input&&this.input.pointerChildrenEnabled){let e;for(let t=this._children.length-1;0<=t;--t)if(e=this._children[t],e.visible&&!(e.alpha<=0)&&0!==e.scaleX&&0!==e.scaleY&&(0!==a||!e.input||e.input.pointerEnabled||e.input.pointerChildrenEnabled)&&(e=e.pick(this._wvp.copy(i).appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY),s,n,a),e))return e}return 0===a&&this.input&&this.input.pointerEnabled&&this.input.hitArea&&(this._wvp.copy(i).invert().transformVector(this._pt.set(s,n)),this.input.hitArea.containsVector(this._pt))?this:null}render(e,i,s){var n;for(let t=0;t<this._children.length;++t)n=this._children[t],!n.visible||n.alpha<=0||0===n.scaleX||0===n.scaleY||(null!==n.maskShape&&(e.save(),e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),(n.maskShape,!1)?n.maskShape.execute(e,!1):n.maskShape instanceof r?(e.beginPath(),e.rect(n.maskShape.x,n.maskShape.y,n.maskShape.width,n.maskShape.height)):n.maskShape&&(e.beginPath(),e.arc(n.maskShape.origin.x,n.maskShape.origin.y,n.maskShape.radius,0,b.TWO_PI)),e.clip()),n.render(e,this._wvp.copy(i).appendTransform(n.x,n.y,n.scaleX,n.scaleY,n.rotation,n.skewX,n.skewY,n.regX,n.regY),s*n.alpha),null!==n.maskShape&&e.restore())}}class Jt extends Xt{get parent(){return null}set parent(t){if(null!==t)throw new Error("The stage root cannot be set as a child of anything!")}constructor(){super(),this._rootTransform=new Q}rootPick(t,e,i){return this._rootTransform.setTransform(0,0,P.scaleFactor,P.scaleFactor,0,0,0,-P.x/P.scaleFactor,-P.y/P.scaleFactor),this._rootTransform.appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY),this.pick(this._rootTransform,t,e,i)||this}rootDraw(){this._rootTransform.setTransform(0,0,P.scaleFactor,P.scaleFactor,0,0,0,-P.x/P.scaleFactor,-P.y/P.scaleFactor),this._rootTransform.appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY),this.render(P.ctx,this._rootTransform,this.alpha)}}class T extends qt{constructor(t="",e=null,i=16){super(),this.fontSize=12,this.align="left",this.baseline="top",this.fill="#000000",this.underStroke=null,this.underStrokeWidth=1,this.overStroke=null,this.overStrokeWidth=1,this.shadowFill=null,this.shadowUnderStroke=null,this.shadowUnderStrokeWidth=1,this.shadowOverStroke=null,this.shadowOverStrokeWidth=1,this.shadowX=0,this.shadowY=0,this.shadowAlpha=.3,this.underStrokeJoin="round",this.text=t,this.font=e,this.fontSize=i}pick(t,e,i){return this.input&&this.input.pointerEnabled,null}measure(){return P.ctx.font=this.font.cssFont(this.fontSize),P.ctx.textAlign=this.align,P.ctx.measureText(this.text)}getVerticalCenterOffset(){var t,e;if("top"===this.baseline)return t=this.font.ascent/this.font.unitsPerEm*this.fontSize,e=this.font.descent/this.font.unitsPerEm*this.fontSize,(t+e)/2-e;throw new Error("Not implemented!")}render(t,e,i){t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.font=this.font.cssFont(this.fontSize),t.textBaseline="alphabetic",t.textAlign=this.align;let s=0;if("top"===this.baseline)s+=this.font.ascent/this.font.unitsPerEm*this.fontSize;else if("alphabetic"===this.baseline)s+=0;else if("bottom"===this.baseline)s+=this.font.descent/this.font.unitsPerEm*this.fontSize;else{if("middle"!==this.baseline)throw new Error("Text Baseline "+this.baseline+" is not yet supported!");var e=this.font.ascent/this.font.unitsPerEm*this.fontSize,n=this.font.descent/this.font.unitsPerEm*this.fontSize;s+=(e+n)/2}t.globalAlpha=i*this.shadowAlpha,this.shadowUnderStroke&&0<this.shadowUnderStrokeWidth&&(t.strokeStyle=this.shadowUnderStroke,t.lineWidth=this.shadowUnderStrokeWidth,t.strokeText(this.text,0+this.shadowX,s+this.shadowY)),this.shadowFill&&(t.fillStyle=this.shadowFill,t.fillText(this.text,0+this.shadowX,s+this.shadowY)),this.shadowOverStroke&&0<this.shadowOverStrokeWidth&&(t.strokeStyle=this.shadowOverStroke,t.lineWidth=this.shadowOverStrokeWidth,t.strokeText(this.text,0+this.shadowX,s+this.shadowY)),t.globalAlpha=i,this.underStroke&&0<this.underStrokeWidth&&(t.lineJoin=this.underStrokeJoin,t.strokeStyle=this.underStroke,t.lineWidth=this.underStrokeWidth,t.strokeText(this.text,0,s)),this.fill&&(t.fillStyle=this.fill,t.fillText(this.text,0,s)),this.overStroke&&0<this.overStrokeWidth&&(t.strokeStyle=this.overStroke,t.lineWidth=this.overStrokeWidth,t.strokeText(this.text,0,s))}}class F extends qt{constructor(t=null){super(),this.img=null,this.isSVG=!1,this.width=0,this.height=0,this.blendMode=null,this.setImage(t)}setRegCenterCenter(){return this.regX=this.width/2,this.regY=this.height/2,this}setScale(t,e){return this.scaleX=t,this.scaleY=e,this}setVisible(t){return this.visible=t,this}setImage(t){t?1===t.imageAssetType?(this.width=t.naturalWidth,this.height=t.naturalHeight,this.isSVG=!0,this.img=Wt.get(t).canvas):0===t.imageAssetType?(this.width=t.data.width,this.height=t.data.height,this.isSVG=!1,this.img=t.data):(this.width=t.width,this.height=t.height,this.isSVG=!1,this.img=t):(this.width=0,this.height=0,this.isSVG=!1,this.img=null)}render(t,e,i){this.img&&(this.isSVG&&Wt.enabled&&1<P.scaleFactor&&e.appendTransform(0,0,1/P.scaleFactor,1/P.scaleFactor,0,0,0,0,0),_i.showBitmapOutlines&&(t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i,t.strokeStyle="#FF0000",t.lineWidth=2*P.pixelSize,t.strokeRect(0,0,this.img.width,this.img.height)),t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i,this.blendMode&&(t.globalCompositeOperation=this.blendMode),t.drawImage(this.img,0,0),this.blendMode)&&(t.globalCompositeOperation="source-over")}pick(t,e,i,s){return(!this.input||this.input.pointerEnabled)&&0===s&&this.input&&this.input.pointerEnabled&&this.input.hitArea&&(this._wvp.copy(t).invert().transformVector(this._pt.set(e,i)),this.input.hitArea.containsVector(this._pt))?this:null}}class B extends Xt{}class Qt extends qt{constructor(t,e,i,s,n=null){super(),this.strokeWidth=0,this.strokeLineCap="round",this.strokeLineJoin="round",this.rectangle=new r(t,e,i,s),this.fillStyle=n,this.input=new C(this,!0,!1,this.rectangle)}pick(t,e,i,s){return 0===s&&this.input&&this.input.pointerEnabled&&this.input.hitArea&&(this._wvp.copy(t).invert().transformVector(this._pt.set(e,i)),this.input.hitArea.containsVector(this._pt))?this:null}render(t,e,i){t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i,t.beginPath(),t.rect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle&&0<this.strokeWidth&&(t.lineJoin=this.strokeLineJoin,t.lineCap=this.strokeLineCap,t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,t.stroke())}}class Kt extends qt{constructor(t,e,i,s,n,a=null){super(),this.strokeWidth=0,this.strokeUnderFill=!1,this.topLeftRadius=0,this.topRightRadius=0,this.bottomLeftRadius=0,this.bottomRightRadius=0,this.rectangle=new r(t,e,i,s),this.fillStyle=a,this.topLeftRadius=this.topRightRadius=this.bottomLeftRadius=this.bottomRightRadius=n,this.input=new C(this,!0,!1,this.rectangle)}pick(t,e,i,s){return 0===s&&this.input&&this.input.pointerEnabled&&this.input.hitArea&&(this._wvp.copy(t).invert().transformVector(this._pt.set(e,i)),this.input.hitArea.containsVector(this._pt))?this:null}render(t,e,i){t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i;let s=this.rectangle.x,n=s+this.rectangle.width;n<s&&(i=n,n=s,s=i);let a=this.rectangle.y,o=a+this.rectangle.height,r=(o<a&&(i=o,o=a,a=i),0);r=this.topLeftRadius,i=r<0,i&&(r=-r);var h=s,l=a+r,d=s+r,c=a,u=i?s+r:s,p=i?a+r:a,g=(r=this.topRightRadius,i=r<0,i&&(r=-r),n-r),m=a,y=n,_=a+r,f=i?n-r:n,w=i?a+r:a,v=(r=this.bottomRightRadius,i=r<0,i&&(r=-r),n),b=o-r,x=n-r,S=o,k=i?n-r:n,C=i?o-r:o,T=(r=this.bottomLeftRadius,i=r<0,i&&(r=-r),s+r),F=o,B=s,P=o-r,D=i?s+r:s,i=i?o-r:o;t.beginPath(),t.moveTo(h,l),t.quadraticCurveTo(u,p,d,c),t.lineTo(g,m),t.quadraticCurveTo(f,w,y,_),t.lineTo(v,b),t.quadraticCurveTo(k,C,x,S),t.lineTo(T,F),t.quadraticCurveTo(D,i,B,P),t.closePath(),this.strokeUnderFill&&this.strokeStyle&&0<this.strokeWidth&&(t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,t.stroke()),this.fillStyle&&("string"==typeof this.fillStyle?(t.fillStyle=this.fillStyle,t.fill()):(t.scale(this.rectangle.width,this.rectangle.height),t.fillStyle=this.fillStyle,t.fill(),t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty))),!this.strokeUnderFill&&this.strokeStyle&&0<this.strokeWidth&&(t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,t.stroke())}}class Zt extends qt{constructor(t,e,i,s,n,a,o=null){super(),this.strokeStyle=null,this.strokeWidth=0,this.blendMode=null,this.triangle=new Z(t,e,i,s,n,a),this.fillStyle=o}pick(t,e,i){return this.input&&!this.input.pointerEnabled?null:(t.invert().transformVector(this._pt.set(e,i)),this.input&&this.input.hitArea?this.input.hitArea.containsVector(this._pt)?this:null:this.triangle.containsVector(this._pt)?this:null)}render(t,e,i){t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i,this.blendMode&&(t.globalCompositeOperation=this.blendMode),t.beginPath(),t.moveTo(this.triangle.p1.x,this.triangle.p1.y),t.lineTo(this.triangle.p2.x,this.triangle.p2.y),t.lineTo(this.triangle.p3.x,this.triangle.p3.y),t.closePath(),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle&&0<this.strokeWidth&&(t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,t.stroke()),this.blendMode&&(t.globalCompositeOperation="source-over")}}class te extends qt{constructor(t,e=null){if(super(),this.strokeStyle=null,this.strokeWidth=0,this.closePath=!0,this.strokeLineCap="round",this.strokeLineJoin="round",this.strokeDash=null,this.strokeDashOffset=0,t.length%2!=0)throw new Error("Invalid path! Odd number of values");this.points=t.slice(0),this.fillStyle=e}pick(t,e,i){return null}render(e,t,i){if(e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.globalAlpha=i,2<this.points.length){e.beginPath(),e.moveTo(this.points[0],this.points[1]);for(let t=2;t<this.points.length;t+=2)e.lineTo(this.points[t],this.points[t+1]);this.closePath&&e.closePath(),this.fillStyle&&(e.fillStyle=this.fillStyle,e.fill()),this.strokeStyle&&0<this.strokeWidth&&(this.strokeDash&&this.strokeDash.length&&(e.setLineDash(this.strokeDash),e.lineDashOffset=this.strokeDashOffset),e.lineJoin=this.strokeLineJoin,e.lineCap=this.strokeLineCap,e.strokeStyle=this.strokeStyle,e.lineWidth=this.strokeWidth,e.stroke(),e.lineJoin="round",this.strokeDash)&&this.strokeDash.length&&(e.setLineDash([]),e.lineDashOffset=0)}}setPoints(t){if(t.length%2!=0)throw new Error("Invalid path! Odd number of values");this.points=t.slice()}}class ee extends qt{constructor(t=0,e=0,i=50,s=null,n=null){super(),this.strokeWidth=1,this.strokeMatrix=null,this.startAngle=0,this.endAngle=360,this.innerRadius=0,this.strokeDash=null,this.strokeDashOffset=0,this.asPie=!1,this.strokeBeforeClosePie=!1,this.blendMode=null,this.underStroke=null,this.underStrokeWidth=1,this.underStrokeJoin="round",this.circle=new J(t,e,i),this.fillStyle=s,this.strokeStyle=n}pick(t,e,i){return this.input&&!this.input.pointerEnabled?null:(t.invert().transformVector(this._pt.set(e,i)),this.input&&this.input.hitArea?this.input.hitArea.containsVector(this._pt)?this:null:this.circle.containsVector(this._pt)?this:null)}render(t,e,i){var s;this.startAngle!==this.endAngle&&0!==this.circle.radius&&(this.fillStyle||this.strokeStyle)&&(t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i,this.blendMode&&(t.globalCompositeOperation=this.blendMode),i=b.DEG_TO_RAD*this.startAngle,s=b.DEG_TO_RAD*this.endAngle,t.moveTo(this.circle.origin.x,this.circle.origin.y),t.beginPath(),t.arc(0,0,this.circle.radius,i,s,!1),this.strokeDash&&this.strokeDash.length&&(t.setLineDash(this.strokeDash),t.lineDashOffset=this.strokeDashOffset),this.asPie&&(this.strokeBeforeClosePie&&this.strokeStyle&&0<this.strokeWidth&&(t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,this.strokeMatrix&&(this._wvp.copy(e).appendMatrix(this.strokeMatrix),t.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty)),t.stroke(),this.strokeMatrix)&&t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.lineTo(this.circle.origin.x,this.circle.origin.y),t.closePath()),0!==this.innerRadius&&t.arc(this.circle.origin.x,this.circle.origin.y,this.innerRadius,s,i,!0),this.underStroke&&0<this.underStrokeWidth&&(t.lineJoin=this.underStrokeJoin,t.strokeStyle=this.underStroke,t.lineWidth=this.underStrokeWidth,t.stroke()),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle&&0<this.strokeWidth&&(this.asPie&&this.strokeBeforeClosePie||(t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,this.strokeMatrix&&(this._wvp.copy(e).appendMatrix(this.strokeMatrix),t.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty)),t.stroke())),this.strokeDash&&this.strokeDash.length&&(t.setLineDash([]),t.lineDashOffset=0),this.blendMode)&&(t.globalCompositeOperation="source-over")}}class ie extends Xt{constructor(){super(),this._last=-1,this._scaleTween=new n(0,1,250,0,p.Quadratic.easeOut,new X(-1,!0)),this._scaleMin=1,this._scaleDelta=.25,this._vis=!1,this._defaultVis=!1,this._pointerVis=!1,this._scaleStyleTransform=1,this._xStyleTransform=0,this._yStyleTransform=0,this.input=new C(this,!1,!1),this._div=document.createElement("div"),this._div.style.cssText="position: absolute; top: 0; left: 0; pointer-events: none;",this._div.style.display="none",this._defaultImg=document.createElement("img"),this._defaultImg.style.cssText="position: absolute; top: 0; left: 0; pointer-events: none; transform: translate(-50%, -50%)",this._defaultImg.src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2060%2060%22%20width%3D%2260%22%20height%3D%2260%22%3E%3C!--%20%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22lime%22%20%2F%3E%20--%3E%3C!--%20%3Cdefs%3E%3ClinearGradient%20id%3D%22cursor_default_grad1%22%20x1%3D%220%25%22%20x2%3D%22100%25%22%20y1%3D%220%25%22%20y2%3D%220%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23FFFFCC%22%20%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23FF8844%22%20%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%20--%3E%3C!--%20%3Cdefs%3E%3ClinearGradient%20id%3D%22cursor_default_grad1%22%20x1%3D%220%25%22%20x2%3D%22100%25%22%20y1%3D%220%25%22%20y2%3D%220%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23FFFFFF%22%20%2F%3E%3Cstop%20offset%3D%2210%25%22%20stop-color%3D%22%23F7DB2F%22%20%2F%3E%3Cstop%20offset%3D%2250%25%22%20stop-color%3D%22%23FF9900%22%20%2F%3E%3Cstop%20offset%3D%2290%25%22%20stop-color%3D%22%23F7DB2F%22%20%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23FFFFFF%22%20%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2210%22%20stroke-width%3D%225%22%20stroke%3D%22%23000000%22%20fill%3D%22none%22%20%2F%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2210%22%20stroke-width%3D%223%22%20stroke%3D%22url(%23cursor_default_grad1)%22%20fill%3D%22none%22%20%2F%3E%20--%3E%3Cdefs%3E%3ClinearGradient%20id%3D%22cursor_default_grad1%22%20x1%3D%2250%25%22%20x2%3D%2250%25%22%20y1%3D%220%25%22%20y2%3D%22100%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23FFFFCC%22%20%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23FF8844%22%20%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2210%22%20stroke-width%3D%227%22%20stroke%3D%22%23000000%22%20fill%3D%22none%22%20opacity%3D%220.25%22%20%2F%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2210%22%20stroke-width%3D%225%22%20stroke%3D%22%23000000%22%20fill%3D%22none%22%20%2F%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2210%22%20stroke-width%3D%223%22%20stroke%3D%22url(%23cursor_default_grad1)%22%20fill%3D%22none%22%20%2F%3E%3C%2Fsvg%3E",this._defaultImg.style.visibility="hidden",this._div.appendChild(this._defaultImg),this._pointerImg=document.createElement("img"),this._pointerImg.style.cssText="position: absolute; top: 0; left: 0; pointer-events: none; transform: translate(-50%, -50%)",this._pointerImg.src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2060%2060%22%20width%3D%2260%22%20height%3D%2260%22%3E%3C!--%20%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22lime%22%20%2F%3E%20--%3E%3C!--%20%3Cdefs%3E%3ClinearGradient%20id%3D%22cursor_default_grad1%22%20x1%3D%220%25%22%20x2%3D%22100%25%22%20y1%3D%220%25%22%20y2%3D%220%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23FFFFCC%22%20%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23FF8844%22%20%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%20--%3E%3C!--%20%3Cdefs%3E%3ClinearGradient%20id%3D%22cursor_default_grad1%22%20x1%3D%220%25%22%20x2%3D%22100%25%22%20y1%3D%220%25%22%20y2%3D%220%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23CCFFFF%22%20%2F%3E%3Cstop%20offset%3D%2210%25%22%20stop-color%3D%22%23CCFFFF%22%20%2F%3E%3Cstop%20offset%3D%2250%25%22%20stop-color%3D%22%2344FF88%22%20%2F%3E%3Cstop%20offset%3D%2290%25%22%20stop-color%3D%22%23CCFFFF%22%20%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23CCFFFF%22%20%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%229%22%20stroke-width%3D%225%22%20stroke%3D%22%23000000%22%20fill%3D%22none%22%20%2F%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%229%22%20stroke-width%3D%223%22%20stroke%3D%22url(%23cursor_default_grad1)%22%20fill%3D%22none%22%20%2F%3E%20--%3E%3Cdefs%3E%3ClinearGradient%20id%3D%22cursor_default_grad1%22%20x1%3D%2250%25%22%20x2%3D%2250%25%22%20y1%3D%220%25%22%20y2%3D%22100%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23CCFFFF%22%20%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%2344FF88%22%20%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%229%22%20stroke-width%3D%225%22%20stroke%3D%22%23000000%22%20fill%3D%22none%22%20%2F%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%229%22%20stroke-width%3D%223%22%20stroke%3D%22url(%23cursor_default_grad1)%22%20fill%3D%22none%22%20%2F%3E%3C%2Fsvg%3E%3C!--%20%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2060%2060%22%20width%3D%2260%22%20height%3D%2260%22%3E%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22lime%22%20%2F%3E%3Cdefs%3E%3ClinearGradient%20id%3D%22cursor_pointer_grad1%22%20x1%3D%220%25%22%20x2%3D%22100%25%22%20y1%3D%220%25%22%20y2%3D%220%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23CCFFFF%22%20%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%2344FF88%22%20%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2210%22%20stroke-width%3D%227%22%20stroke%3D%22%23000000%22%20fill%3D%22none%22%20opacity%3D%220.5%22%20%2F%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2210%22%20stroke-width%3D%225%22%20stroke%3D%22%23000000%22%20fill%3D%22none%22%20%2F%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2210%22%20stroke-width%3D%223%22%20stroke%3D%22url(%23cursor_pointer_grad1)%22%20fill%3D%22none%22%20%2F%3E%3C%2Fsvg%3E%20--%3E",this._pointerImg.style.visibility="hidden",this._div.appendChild(this._pointerImg),document.querySelector("#app-player-game").appendChild(this._div)}render(t,e,i){let s=!1,n=!1,a=!1;if(ft.allowed&&ft.enabled&&f.softMouseControl){var o=P.inputManager.cursor;if("none"===o)this._scaleTween.time=0,this._scaleTween.end<this._scaleTween.start&&(r=this._scaleTween.start,this._scaleTween.start=this._scaleTween.end,this._scaleTween.end=r);else{s=!0,"pointer"===o?a=!0:n=!0;var r=Date.now();let t=0;0<this._last&&(t=r-this._last),this._last=r,3e3<r-ft.lastPressed?this._scaleTween.update(t):(this._scaleTween.time=0,this._scaleTween.end<this._scaleTween.start&&(o=this._scaleTween.start,this._scaleTween.start=this._scaleTween.end,this._scaleTween.end=o))}}var h;this._vis!==s&&(this._vis=s,this._div.style.display=s?"block":"none"),this._vis&&(r=f.x*(1/m.view.pixelRatio),o=f.y*(1/m.view.pixelRatio),h=this._scaleTween.value*this._scaleDelta+this._scaleMin,this._xStyleTransform===r&&this._yStyleTransform===o&&this._scaleStyleTransform===h||(this._xStyleTransform=r,this._yStyleTransform=o,this._scaleStyleTransform=h,this._div.style.transform=`translate(${r}px, ${o}px) scale(${h})`),this._defaultVis!==n&&(this._defaultVis=n,this._defaultImg.style.visibility=n?"visible":"hidden"),this._pointerVis!==a)&&(this._pointerVis=a,this._pointerImg.style.visibility=a?"visible":"hidden"),super.render(t,e,i)}}const P=u.isMainThread?new class{get designWidth(){return this._designWidth}set designWidth(t){this._designWidth!==t&&(this._designWidth=t,this._dirty=!0)}get designHeight(){return this._designHeight}set designHeight(t){this._designHeight!==t&&(this._designHeight=t,this._dirty=!0)}get autoRotateDesignSize(){return this._autoRotateDesignSize}set autoRotateDesignSize(t){this._autoRotateDesignSize!==t&&(this._autoRotateDesignSize=t,this._dirty=!0)}get respectTitleSafeArea(){return this._respectTitleSafeArea}set respectTitleSafeArea(t){this._respectTitleSafeArea=t,this._dirty=!0}constructor(){this.onResize=new h,this.scaleFactor=1,this.pixelSize=1,this.titleSafeArea=new r(0,0,100,100),this.root=new Jt,this._designWidth=1600,this._designHeight=1200,this._autoRotateDesignSize=!0,this.x=0,this.y=0,this.width=100,this.height=100,this.outerWidth=100,this.outerHeight=100,this.outerScaleFactor=1,this.titleSafePadding={top:0,left:0,right:0,bottom:0},this.screen={top:0,left:0,right:0,bottom:0,width:100,height:100},this._dirty=!0,this.canvas=document.getElementById("app-player-game-canvas"),this.canvasWidth=100,this.canvasHeight=100,this._respectTitleSafeArea=!0,this.defaultCursor="default",this.overrideCursorType=null}initialize(){this.ctx=new Vt(this.canvas.getContext("2d")),this.inputManager=new Yt,$t.panelBg=this.ctx.createLinearGradient(0,0,0,1),$t.panelBg.addColorStop(0,"#000000"),$t.panelBg.addColorStop(1,"#333333")}App_viewChange(){this._dirty=!0}App_fullscreenChange(){this._dirty=!0}pick(t,e,i){return this.root.rootPick(t,e,i)}poll(){if(this._dirty){this.canvasWidth=m.view.rect.w,this.canvasHeight=m.view.rect.h,this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.ctx.resetState(),this.canvas.style.width=this.canvasWidth/m.view.pixelRatio+"px",this.canvas.style.height=this.canvasHeight/m.view.pixelRatio+"px",this.titleSafePadding.bottom=0,this.titleSafePadding.top=0,this.titleSafePadding.left=0,this.titleSafePadding.right=0;"Apple iOS"===tt.os&&"GameBundle"===c.embed.type?(this.titleSafePadding.bottom=20*m.view.pixelRatio,0===m.view.orientation&&(this.titleSafePadding.right=20*m.view.pixelRatio)):"Apple iOS"===tt.os&&"Safari"===tt.browser&&("Handheld"===tt.device?0===m.view.orientation?this.titleSafePadding.top=20*m.view.pixelRatio:this.titleSafePadding.bottom=40*m.view.pixelRatio:this.titleSafePadding.bottom=20*m.view.pixelRatio),"GameBundle"===c.embed.type||this._respectTitleSafeArea||(this.titleSafePadding.bottom=0,this.titleSafePadding.top=0,this.titleSafePadding.left=0,this.titleSafePadding.right=0),this.titleSafeArea.set(this.titleSafePadding.left,this.titleSafePadding.top,this.canvas.width-this.titleSafePadding.left-this.titleSafePadding.right,this.canvas.height-this.titleSafePadding.top-this.titleSafePadding.bottom);let t=this._designWidth,e=this._designHeight;this._autoRotateDesignSize&&1===m.view.orientation&&(t=this._designHeight,e=this._designWidth),this.outerScaleFactor=Math.min(m.view.rect.w/t,m.view.rect.h/e),this.outerWidth=m.view.rect.w/this.outerScaleFactor,this.outerHeight=m.view.rect.h/this.outerScaleFactor,this.scaleFactor=Math.min(this.titleSafeArea.width/t,this.titleSafeArea.height/e),this.x=this.titleSafeArea.x,this.y=this.titleSafeArea.y,this.width=this.titleSafeArea.width/this.scaleFactor,this.height=this.titleSafeArea.height/this.scaleFactor,this.screen.left=this.titleSafePadding.left*(-1/P.scaleFactor),this.screen.right=this.width+this.titleSafePadding.right*(1/P.scaleFactor),this.screen.width=this.screen.right-this.screen.left,this.screen.top=this.titleSafePadding.top*(-1/P.scaleFactor),this.screen.bottom=this.height+this.titleSafePadding.bottom*(1/P.scaleFactor),this.screen.height=this.screen.bottom-this.screen.top,this._dirty=!1,this.onResize.count&&this.onResize.invoke(),Wt.update(this.scaleFactor)}this.inputManager.beginFrame()}clear(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.setTransform(1,0,0,1,0,0)}draw(){this.root.rootDraw()}}:null;class se extends B{get state(){return this._state}constructor(){super(),this.onClicked=new h,this._state=0,this.isPressed=!1,this.isOver=!1,this.isDisabled=!1,this.clickSound=null,this.value=null,this.canceled=!1,this.cursor="pointer",this.input=new C(this),this.input.onPointerRollOver.add(this.this_onPointerRollOver,this),this.input.onPointerRollOut.add(this.this_onPointerRollOut,this),this.input.onPointerPress.add(this.this_onPointerPress,this),this.input.onPointerCancel.add(this.this_onPointerCancel,this),this.input.onPointerRelease.add(this.this_onPointerRelease,this),this.input.onPointerClick.add(this.this_onPointerClick,this)}updateButtonState(t=!1){this.isDisabled?3===this._state&&!t||this.disabled():this.isOver?this.isPressed?(3!==this._state&&!t||this.enabled(),2===this._state&&!t||this.down()):(3!==this._state&&!t||this.enabled(),1===this._state&&!t||this.over()):(3!==this._state&&!t||this.enabled(),0===this._state&&!t||this.up())}up(){this._state=0}down(){this._state=2}over(){this._state=1}click(){this.onClicked.invoke(this)}disabled(){this._state=3}enabled(){}enableButton(){this.isDisabled&&(this.isDisabled=!1,this.input.pointerEnabled=!0,this.updateButtonState(!0))}disableButton(){this.isDisabled||(this.isDisabled=!0,this.input.pointerEnabled=!1,this.updateButtonState(!0))}this_onPointerRollOver(t,e){this.isOver=!0,this.updateButtonState()}this_onPointerRollOut(t,e){this.isOver=!1,this.updateButtonState()}this_onPointerPress(t,e){this.canceled=!1,this.isPressed=!0,this.updateButtonState()}this_onPointerCancel(t,e){this.isPressed=!1,this.updateButtonState()}this_onPointerRelease(t,e){this.isPressed=!1,this.updateButtonState()}this_onPointerClick(t,e){this.canceled||(this.clickSound&&(this.clickSound.stop(),this.clickSound.play()),this.click())}simClick(){this.input.pointerEnabled&&this.input.onPointerClick.invoke(this,this)}cancel(){this.canceled=!0,this.isPressed=!1,this.updateButtonState()}}class ne extends Qt{constructor(t){super(0,0,P.width,P.height,t.toStyleFuncRGBA()),this.cursor="pointer",this.anchor()}anchor(){this.rectangle.set(P.screen.left,P.screen.top,P.screen.width,P.screen.height)}render(t,e,i){this.anchor(),super.render(t,e,i)}}class ae extends Qt{constructor(t=0){super(0,-.5,300,1,"#999999"),this.y=t}}class oe extends se{constructor(t,e){super();var i=e;this.width=e,this.input.pointerEnabled=!0,this.input.pointerChildrenEnabled=!1,this.input.hitArea=new r(0,0,e,i),this.bg=new Qt(0,0,e,i,"#CC0000"),this.addChild(this.bg),this._sideDiv=new Qt(-.5,0,1,i,"#999999"),this.addChild(this._sideDiv),this._sideDiv.visible=!t,this._sideDiv2=new Qt(-.5+e,0,1,i,"#999999"),this.addChild(this._sideDiv2),this._sideDiv2.visible=t,this._topDiv=new Qt(0,-.5,e,1,"#999999"),this.addChild(this._topDiv),this.iconHolder=new B,this.addChild(this.iconHolder),this.iconHolder.x=e/2,this.iconHolder.y=i/2,e*=.6,i*=.6;let s;this.iconHolder.addChild(s=new Qt(0,0,5/6*e,6,"#FFFFFF")),s.rotation=45,s.regX=s.rectangle.width/2,s.regY=s.rectangle.height/2,this.iconHolder.addChild(s=new Qt(0,0,5/6*i,6,"#FFFFFF")),s.rotation=-45,s.regX=s.rectangle.width/2,s.regY=s.rectangle.height/2,this.clickSound=new x(S.sounds.click.data)}up(){this.bg.fillStyle="#CC0000",this.iconHolder.scaleX=this.iconHolder.scaleY=1,super.up()}over(){this.bg.fillStyle="#DD0000",this.iconHolder.scaleX=this.iconHolder.scaleY=1.02,super.over()}down(){this.bg.fillStyle="#C00000",this.iconHolder.scaleX=this.iconHolder.scaleY=.98,super.down()}render(t,e,i){this._topDiv.visible=0!==P.y,super.render(t,e,i)}}class re extends se{get isOn(){return this._isOn}set isOn(t){t!==this._isOn&&(this._isOn=t,t?(this.knob.x=this.onKnobX,this.toggleBG.fillStyle=this.onColor):(this.knob.x=this.offKnobX,this.toggleBG.fillStyle=this.offColor))}constructor(t,e){super(),this._isOn=!0,this.onColor="#33CC66",this.offColor="#666666";this.height=50,this._bg=new Qt(0,0,300,50,"rgba(255,255,255,0.1)"),this._bg.visible=!1,this.addChild(this._bg),this._textField=new T(t,S.fonts["OpenSans-ExtraBold"].data,20),this._textField.fill="#FFFFFF",this._textField.align="left",this._textField.baseline="middle",this._textField.x=12,this._textField.y=25,this._textField.shadowFill="#000000",this._textField.shadowAlpha=.2,this._textField.shadowX=-2,this._textField.shadowY=2,this.addChild(this._textField);var t=new ae,t=(t.y=50,this.addChild(t),this._textField.fontSize,this.onKnobX=56,this.offKnobX=3,new B),i=new Kt(0,-11,75,22,3,this.onColor),s=(t.addChild(i),this.toggleBG=i,new Kt(0,-8,16,16,2,"#FFFFFF"));s.x=56,t.addChild(s),this.knob=s,e||(s.x=this.offKnobX,i.fillStyle=this.offColor),this._isOn=e,this.addChild(t),t.x=211,t.y=25,this.input.hitArea=new r(0,0,300,50),this.input.pointerChildrenEnabled=!1,this.clickSound=new x(S.sounds.click.data)}over(){this._bg.visible=!0,this._bg.alpha=1,super.over()}up(){this._bg.visible=!1,super.up()}update(t){}}class he extends se{constructor(t){super();this.height=50,this._bg=new Qt(0,0,300,50,"rgba(255,255,255,0.1)"),this._bg.visible=!1,this.addChild(this._bg),this._textField=new T(t,S.fonts["OpenSans-ExtraBold"].data,20),this._textField.fill="#FFFFFF",this._textField.align="left",this._textField.baseline="middle",this._textField.x=12,this._textField.y=25,this._textField.shadowFill="#000000",this._textField.shadowAlpha=.2,this._textField.shadowX=-2,this._textField.shadowY=2,this.addChild(this._textField);t=new ae;t.y=50,this.addChild(t),this._textField.fontSize;this.input.hitArea=new r(0,0,300,50),this.input.pointerChildrenEnabled=!1,this.clickSound=new x(S.sounds.click.data)}over(){this._bg.visible=!0,this._bg.alpha=1,super.over()}up(){this._bg.visible=!1,super.up()}update(t){}disabled(){this._textField.fill="#7A7A7A"}enabled(){this._textField.fill="#FFFFFF"}setText(t){this._textField.text=t}}class le{constructor(){this._list=[],this._iterator=-1,this._reverseIterator=-1,this._count=0,this.display=new B}add(t){if(t.isActive)throw new Error("GameScreen is already added to the screen manager!");t._isExiting=!1,t._isActive=!0,t._isFocused=!1,t._isOccluded=!0,t.screenManager=this,this._list.push(t),this._count++,this.display.addChild(t._display),t._isInitialized||t.initialize(),t.added(),this.updateScreenState()}addBehind(t,e){if(!e.isActive)throw new Error("overScreen is not in the screen manager!");if(t.isActive)throw new Error("GameScreen is already added to the screen manager!");t._isExiting=!1,t._isActive=!0,t._isFocused=!1,t._isOccluded=!0,t.screenManager=this;e=this._list.indexOf(e);0===e?this._list.unshift(t):this._list.splice(e,0,t),this._count++,e<=this._iterator&&this._iterator++,e<=this._reverseIterator&&this._reverseIterator++,this.display.addChildAt(t._display,e),t._isInitialized||t.initialize(),t.added(),this.updateScreenState()}remove(t){if(!t.isActive)throw new Error("GameScreen is not in the screen manager!");t.isFocused&&t.loseFocus(),t.isOccluded||t.hide(),t.removed();var e=this._list.indexOf(t);0<=e&&(this._list.splice(e,1),this._count--,e<=this._iterator&&this._iterator--,e<=this._reverseIterator)&&this._reverseIterator--,this.display.removeChild(t.display),t._isActive=!1,t.screenManager=null,t.onRemoved.invoke(t),this.updateScreenState()}removeAll(){for(;0<this._list.length;)this.remove(this._list[this._list.length-1])}updateScreenState(){if(-1!==this._reverseIterator)throw new Error("Already iterating!");let t=!0,e=!1,i=!0;for(this._reverseIterator=this._count-1;0<=this._reverseIterator;this._reverseIterator--){var s=this._list[this._reverseIterator];i?(s._isInputAllowed||(s._isInputAllowed=!0,s.refreshInputState()),s._isModal&&(i=!1)):s._isInputAllowed&&(s._isInputAllowed=!1,s.refreshInputState()),t?(s._isFocused||s.gainFocus(),s._isModal&&(t=!1)):s._isFocused&&s.loseFocus(),e?s._isOccluded||s.hide():(s._isOccluded&&s.show(),s._isPopup||(e=!0))}this._reverseIterator=-1}update(t){if(-1!==this._iterator)throw new Error("already iterating!");for(this._iterator=0;this._iterator<this._count;++this._iterator)this._list[this._iterator].update(t);this._iterator=-1}draw(){if(this.updateScreenState(),-1!==this._iterator)throw new Error("already iterating!");for(this._iterator=0;this._iterator<this._count;++this._iterator)this._list[this._iterator].anchor(),this._list[this._iterator].draw();this._iterator=-1}toString(){let e="ScreenManager:";for(let t=this._list.length-1;0<=t;--t)e+="\n    "+this._list[t];return e}}class de{get isModal(){return this._isModal}set isModal(t){this._isModal=t}get isPopup(){return this._isPopup}set isPopup(t){this._isPopup=t}get inputEnabled(){return this._inputEnabled}set inputEnabled(t){this._inputEnabled!==t&&(this._inputEnabled=t,this.refreshInputState())}get isActive(){return this._isActive}get isFocused(){return this._isFocused}get isOccluded(){return this._isOccluded}get isExiting(){return this._isExiting}get display(){return this._display}constructor(t){this.onRemoved=new h,this._isModal=!0,this._isPopup=!1,this._inputEnabled=!0,this._inputState=!1,this._isActive=!1,this._isFocused=!1,this._isOccluded=!0,this._isInitialized=!1,this._isInputAllowed=!1,this._isExiting=!1,this._display=new B,this.screenManager=null,this.name=t,this._display.input=new C(this._display),this._display.visible=!1,this._display.input.pointerEnabled=this._display.input.pointerChildrenEnabled=!1}initialize(){this._isInitialized=!0,this.anchor()}added(){}removed(){}exit(){!this._isActive||this._isExiting||(this._isExiting=!0,this.screenManager.remove(this))}gainFocus(){this._isFocused=!0,o._instance.navBar.homeButton.input.onPointerClick.add(this.navHomeButton_onClick,this),o._instance.navBar.settingsButton.input.onPointerClick.add(this.navSettingsButton_onClick,this),o._instance.navBar.closeButton.input.onPointerClick.add(this.navCloseButton_onClick,this),o.getInstance().navBar.notificationsButton.input.onPointerClick.add(this.navNotificationsButton_onClick,this),pt.back.onPress.add(this.SoftKeys_back_onPress,this)}loseFocus(){this._isFocused=!1,o._instance.navBar.homeButton.input.onPointerClick.remove(this.navHomeButton_onClick,this),o._instance.navBar.settingsButton.input.onPointerClick.remove(this.navSettingsButton_onClick,this),o._instance.navBar.closeButton.input.onPointerClick.remove(this.navCloseButton_onClick,this),o.getInstance().navBar.notificationsButton.input.onPointerClick.remove(this.navNotificationsButton_onClick,this),pt.back.onPress.remove(this.SoftKeys_back_onPress,this)}show(){this._isOccluded=!1,this._display.visible=!0}hide(){this._isOccluded=!0,this._display.visible=!1}refreshInputState(){this._isInputAllowed&&this._inputEnabled?!1===this._inputState&&(this._inputState=!0,this._display.input.pointerEnabled=this._display.input.pointerChildrenEnabled=!0,this.inputStateChanged(!0)):!0===this._inputState&&(this._inputState=!1,this._display.input.pointerEnabled=this._display.input.pointerChildrenEnabled=!1,this.inputStateChanged(!1))}inputStateChanged(t){}homeClicked(){}navHomeButton_onClick(){this.inputEnabled&&this.homeClicked()}settingsClicked(){}navSettingsButton_onClick(){this.inputEnabled&&this.settingsClicked()}closeClicked(){}navCloseButton_onClick(){this.inputEnabled&&this.closeClicked()}notificationsClicked(){}navNotificationsButton_onClick(){this.inputEnabled&&this.notificationsClicked()}backSoftKeyPressed(){}SoftKeys_back_onPress(){this.inputEnabled&&this.backSoftKeyPressed()}update(t){}anchor(){}draw(){}toString(){try{return"["+this.constructor.name+"]"}catch(t){return"[GameScreen]"}}}de._debug=!1;class o{static getInstance(){return this._instance}get usesDailyChallenge(){return this._usesDailyChallenge}get usesMultiplayerGameModes(){return this._usesMultiplayerGameModes}constructor(t,e){if(this._usesDailyChallenge=!1,this._usesMultiplayerGameModes=!1,this._lastTickTime=0,this.timeScale=1,this.urlVars=[],o._instance)throw new Error("Singleton!");o._instance=t.instance=this,this.expfsCancelBtn_onClick=this.expfsCancelBtn_onClick.bind(this),this._type=t,this._settingsScreenClass=e,this.urlVars=function(){let t=[],e=location.search.trim();return"?"===e.charAt(0)&&(e=e.substring(1)),""!==e&&(t=e.split("&"),window.history.replaceState({},document.title,location.pathname)),t}(),this.screenManager=new le,P.root.addChild(this.screenManager.display),this.navBar=new Oe,P.root.addChild(this.navBar),this.softMouseCursor=P.root.addChild(new ie),d.add(document.getElementById("expfs_cancel-btn"),"click",this.expfsCancelBtn_onClick,!0,!0),k.onIntent.add(this.App_onIntent,this)}expfsCancelBtn_onClick(){this.cancelExpanderFullscreen(),c.preferFullscreen=!1,m.fullscreen.exitFullscreen()}cancelExpanderFullscreen(){}activate(){this._lastTickTime=Date.now()}deactivate(){}reloading(){}App_onIntent(){var t=this.getGameIntent(k.intent);t&&this.handleGameIntent(t)}tick(){var t=Date.now();let e=t-this._lastTickTime;50<e&&(e=50),this._lastTickTime=t,k.isActive&&this.update(e*this.timeScale),this.draw()}update(t){this.screenManager.update(t),this.navBar.update(t)}draw(){P.clear(),this.screenManager.draw(),P.draw()}}const ce=new class{constructor(){this.default={shadow:"rgba(0,0,0,0.25)",buttonBorder:"#000000"},this.game={},this.theme={},this._themes={}}initialize(){let s=new jt;function t(t){for(var e in t){var i=t[e];if("string"!=typeof i)throw new Error("Invalid color! must be a hex string");t[e]=s.fromStyle(i).toStyleHexRGBA()}}for(var e in t(this.game),this._themes)t(this._themes[e]);this.theme=this._themes[k.info.theme]}};class ue extends nt{constructor(){super("com.games247."+k.info.gameType+"."+k.info.theme+".DailyChallenge"),this.year=null,this.month=null,this.day=null,this.state=null,this.score=null}save(){var t={};t.year=this.year,t.month=this.month,t.day=this.day,t.state=this.state,t.score=this.score,super.write(t)}load(){var t=super.read();this.year=a.validateIntMinInclusive(t.year,2020,null),this.month=a.validateIntMinInclusive(t.month,1,null),this.day=a.validateIntMinInclusive(t.day,1,null),this.state=a.validateOneOf(t.state,[0,1,2],null),this.score=a.validateIntMinInclusive(t.score,0,null),null!==this.year&&null!==this.month&&null!==this.day&&null!==this.state||this.reset()}reset(){this.year=this.month=this.day=this.state=this.score=null}}const D=u.isMainThread?new class{constructor(){this.onUpdated=new h,this.state=0,this.table={numPostedScores:0,averageScore:0,entries:[]},this.score=null,this._storable=new ue,this._lastSyncTime=0,this._syncInterval=3e4,this.loaded=!1,this.isUpdating=!1,this._xhr=null,this._disabled=!1,this.xhr_evt=this.xhr_evt.bind(this),"GameBundle"===c.embed.type?window.location.pathname.includes("game-bundle.html")?(this._api="https://247games.local:3000/api/1/",this._endpoint=this._api+"daily-challenge/",l.info("Using local daily challenge api because /game-bundle.html was detected.",this._api)):window.location.pathname.includes("aftv.html")?(this._api="https://247games.local:3000/api/1/",this._endpoint=this._api+"daily-challenge/",l.info("Using local daily challenge api because /aftv.html was detected.",this._api)):(this._api="https://247gamesdev.com:3000/api/1/",this._endpoint=this._api+"daily-challenge/",l.info("Using production daily challenge api in GameBundle builds (capacitor).",this._api)):"AndroidAuto"===c.embed.type?(this._api="https://247games.local:3000/api/1/",this._endpoint=this._api+"daily-challenge/",l.info("Daily Challenge disabled in android auto builds."),this._disabled=!0):0===location.hostname.indexOf("247games.local")||0===location.hostname.indexOf("localhost")?(this._api="https://247games.local:3000/api/1/",this._endpoint=this._api+"daily-challenge/",l.info("Using local daily challenge api.",this._api)):(this._api="https://247gamesdev.com:3000/api/1/",this._endpoint=this._api+"daily-challenge/");var t=new Date;this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate(),this.updateSeed()}load(){if(this.loaded)throw new Error("Load should only be called once during startup!");this.loaded=!0,this._storable.load(),this.day!==this._storable.day||this.month!==this._storable.month||this._storable.year!==this.year?this.store():(this.score=this._storable.score,this.state=this._storable.state),this.sync()}sync(t=!1){if(!this.loaded)throw new Error("DailyChallenge not loaded!");var e,i,s,n,a;this.isUpdating||(s=new Date,a=s.getTime(),e=s.getFullYear(),i=s.getMonth()+1,s=s.getDate(),n=s!==this.day||i!==this.month||e!==this.year,a=a-this._lastSyncTime>=this._syncInterval,n||a||t?((n||t)&&(this.year=e,this.month=i,this.day=s,this.state=0,this.score=null,this.table={numPostedScores:0,averageScore:0,entries:[]},this.updateSeed()),this.fetchAll()):this.onUpdated.invoke())}syncComplete(t){t&&(this.state=t.state,this.table=t.table,this.store()),this.onUpdated.invoke()}start(){if(!this.loaded)throw new Error("DailyChallenge not loaded!");var t;0!==this.state?l.warn("Invalid daily challenge state, ignoring attempt to start!"):(this.state=1,this.store(),t=new XMLHttpRequest,t.open("POST",this._endpoint,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify({gameType:k.info.gameType,theme:k.info.theme,year:this.year,month:this.month,day:this.day,action:"start"})))}submit(t){if(!this.loaded)throw new Error("DailyChallenge not loaded!");1!==this.state&&l.warn("Invalid daily challenge state, not in started state"),this.score=t,this.state=2,this.store(),this._xhr&&this.destroyXHR(),this.createXHR(),this._disabled?this.xhr_evt({type:"error"}):this._xhr.send(JSON.stringify({gameType:k.info.gameType,theme:k.info.theme,year:this.year,month:this.month,day:this.day,score:t,action:"submit"}))}fetchAll(){this.createXHR(),this._disabled?this.xhr_evt({type:"error"}):this._xhr.send(JSON.stringify({gameType:k.info.gameType,theme:k.info.theme,year:this.year,month:this.month,day:this.day,action:"fetch-all"}))}createXHR(){this._xhr=new XMLHttpRequest,d.add(this._xhr,"load",this.xhr_evt),d.add(this._xhr,"abort",this.xhr_evt),d.add(this._xhr,"error",this.xhr_evt),d.add(this._xhr,"timeout",this.xhr_evt),this._xhr.open("POST",this._endpoint,!0),this._xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this.isUpdating=!0,this._lastSyncTime=Date.now()}destroyXHR(){d.remove(this._xhr,"load",this.xhr_evt),d.remove(this._xhr,"abort",this.xhr_evt),d.remove(this._xhr,"error",this.xhr_evt),d.remove(this._xhr,"timeout",this.xhr_evt),this._xhr=null,this.isUpdating=!1}xhr_evt(t){var e=this._xhr;this.destroyXHR(),"load"===t.type&&200<=e.status&&e.status<400?this.syncComplete(this.parseResponse(e.responseText)):this.syncComplete(null)}parseResponse(t){let e=null;try{e=JSON.parse(t),e&&!0===e.success&&0<=[0,1,2].indexOf(e.state)&&e.table&&void 0!==e.table.averageScore&&void 0!==e.table.numPostedScores&&"object"==typeof e.table.entries&&void 0!==e.table.entries.length||(!1===e.success?l.warn("DC request was unsuccessful"):l.warn("Malformed DC response"),e=null)}catch(t){l.warn("Error handling DC response"),e=null}return e}store(){this._storable.year=this.year,this._storable.month=this.month,this._storable.day=this.day,this._storable.score=this.score,this._storable.state=this.state,this._storable.save()}updateSeed(){var e=new N(1e4*this.year+100*this.month+this.day),i=["247","4th-of-july","christmas","cinco-de-mayo","easter","fall","halloween","new-years","spring","st-patricks","summer","thanksgiving","valentines","winter"].indexOf(k.info.theme);for(let t=0;t<i;++t)e.next();this.seed=e.seed}calculateCurrentTimeSeed(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,t=t.getDate(),s=new N(1e4*e+100*i+t),n=["247","4th-of-july","christmas","cinco-de-mayo","easter","fall","halloween","new-years","spring","st-patricks","summer","thanksgiving","valentines","winter"].indexOf(k.info.theme);for(let t=0;t<n;++t)s.next();return s.seed}}:null;class pe extends se{constructor(t=100,e=100){super(),this.w=t,this.h=e;this._shadow=new Qt(0,0,t,e,"rgba(0,0,0,0.25)"),this._shadow.x=-4,this._shadow.y=4,this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this._btn=new B,this.addChild(this._btn),this._base=new Qt(0,0,t,e,"#000000"),this._btn.addChild(this._base);var i=t-4,s=e-4,s=(this._topBevel=new te([4,4,i,4,i-7,11,11,11,11,s-7,4,s],"#5C5C5C"),this._btn.addChild(this._topBevel),this._bottomBevel=new te([i,4,i,s,4,s,11,s-7,i-7,s-7,i-7,11],"#333333"),this._btn.addChild(this._bottomBevel),t-10),i=s-10,s=e-10,s=(s-10)/2,n=10+s;this._topFace=new Qt(10,10,i,s,"#232323"),this._btn.addChild(this._topFace),this._bottomFace=new Qt(10,n,i,s,"#000000"),this._btn.addChild(this._bottomFace),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new r(0,0,t,e),this.clickSound=new x(S.sounds.click.data)}down(){super.down(),this._btn.y=1,this._btn.x=-1}up(){super.up(),this._btn.y=0,this._btn.x=0}over(){super.over(),this._btn.y=-1,this._btn.x=0}}class ge extends se{constructor(t=100,e=100){super(),this.w=t,this.h=e;var i=t-8,s=e-8;this.btn=new B,this._faceDarkColorBtnsOnly=new Kt(0,0,.5+i,s-2,14*.8,"#00FF00"),this._faceDarkColorBtnsOnly.x=4,this._faceDarkColorBtnsOnly.y=6,this._faceDarkColorBtnsOnly.visible=!1,this._face=new Kt(0,0,i,s/2-2,14*.8,"#333333"),this._face.bottomLeftRadius=this._face.bottomRightRadius=0,this._face.x=4,this._face.y=6,this._side=new Kt(0,0,i,s/2,14*.8,"#666666"),this._side.bottomLeftRadius=this._side.bottomRightRadius=0,this._side.x=4,this._side.y=4,this._base=new Kt(0,0,t,e,14,"#000000"),this._shadow=new Kt(0,0,t,e,14,"rgba(0,0,0,0.25)"),this._shadow.x=-4,this._shadow.y=4,this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this.btn.addChild(this._base),this.btn.addChild(this._side),this.btn.addChild(this._faceDarkColorBtnsOnly),this.btn.addChild(this._face),this.addChild(this.btn),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new r(0,0,t,e),this.clickSound=new x(S.sounds.click.data)}enabled(){super.enabled(),this._face.fillStyle="#333333",this._side.fillStyle="#666666",this._base.fillStyle="#000000"}disabled(){super.disabled(),this._face.fillStyle="#555555",this._side.fillStyle="#666666",this._base.fillStyle="#444444",this.btn.y=0,this.btn.x=0}down(){super.down(),this.btn.y=1,this.btn.x=-1}up(){super.up(),this.btn.y=0,this.btn.x=0}over(){super.over(),this.btn.y=-1,this.btn.x=0}resizeWidth(t){var e;this.w!==t&&(e=t-this.w,this.w=t,this._shadow.rectangle.width+=e,this._base.rectangle.width+=e,this._side.rectangle.width+=e,this._face.rectangle.width+=e,this._faceDarkColorBtnsOnly.rectangle.width+=e,this.input.hitArea.width+=e)}}class E extends ge{constructor(t,e=340,i=100){super(e,i),this.asSelectableOption=!1,this.asSelectebleOptionSelected=!1,this.label=this._label=new T(t,S.fonts["OpenSans-ExtraBold"].data,46),this.label.fill="#FFFFFF",this.label.baseline="middle",this.label.align="center",this.label.x=e/2,this.label.y=i/2,this.label.shadowFill="#000000",this.label.shadowAlpha=1,this.label.shadowX=0,this.label.shadowY=-2,this.label.shadowOverStroke="#000000",this.label.shadowOverStrokeWidth=5,this.btn.addChild(this.label)}enabled(){super.enabled(),this.updateColors()}disabled(){super.disabled(),this.updateColors()}updateColors(){this.isDisabled?(this.label.fill="#AAAAAA",this.label.shadowFill="#444444",this.label.shadowOverStroke="#444444"):this.asSelectableOption?(this.asSelectebleOptionSelected?(this.label.fill="#FFFFFF",this.label.shadowFill="#000000",this.label.shadowOverStroke="#000000",this._face.fillStyle="#333333",this._side.fillStyle="#666666"):(this.label.fill="#444444",this.label.shadowFill="#000000",this.label.shadowOverStroke="#000000",this._face.fillStyle="#222222",this._side.fillStyle="#444444"),this._base.fillStyle="#000000"):(this.label.fill="#FFFFFF",this.label.shadowFill="#000000",this.label.shadowOverStroke="#000000")}setAsSelectableOption(t){this.asSelectableOption!==t&&(this.asSelectableOption=t,this.updateColors())}setAsSelectableOptionSelected(t){this.asSelectebleOptionSelected!==t&&(this.asSelectebleOptionSelected=t,this.updateColors())}}class me extends E{constructor(t,e,i=340,s=100,n=1,a=0){super(e,i,s),this._spacing=16,this._spacing*=n,this._btnWidth=i,this._icon=new F(t),this._icon.y=s/2,this._icon.regY=this._icon.height/2,this._icon.scaleX=this._icon.scaleY=n,this._label.align="left",this._lblWidth=this._label.measure().width,this.btn.addChild(this._icon);e=this._lblWidth+this._spacing+this._icon.width*n;this._icon.x=this._btnWidth/2-e/2,this._label.x=this._icon.x+this._icon.width*n+this._spacing,1===a&&(this._label.x=(this._btnWidth-this._lblWidth-this._icon.width-this._spacing)/2,this._icon.x=this._label.x+this._lblWidth+this._spacing)}}class ye extends ge{constructor(t,e=100,i=100){super(e,i),this.icon=new F(t),this.icon.y=i/2,this.icon.x=e/2,this.icon.regY=this.icon.height/2,this.icon.regX=this.icon.width/2,this.btn.addChild(this.icon)}resizeWidth(t){this.w!==t&&(super.resizeWidth(t),this.icon.x=t/2)}}class _e extends se{constructor(t){super(),this.isLeft=t;this._shadow=new F(S.images.arrow_right_shadow),this._shadow.x=-4,this._shadow.y=4,this.addChild(this._shadow),this._btn=new F(S.images.arrow_right),this.addChild(this._btn),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new r(0,0,this._btn.width,this._btn.height),this.regY=this._btn.height/2,this.isLeft?(this.input.hitArea.x=-this._btn.width,this._btn.scaleX=-1,this._shadow.scaleX=-1,this.clickSound=new x(S.sounds.swoop_backward.data)):this.clickSound=new x(S.sounds.swoop_forward.data)}down(){super.down(),this._btn.y=1,this._btn.x=-1}up(){super.up(),this._btn.y=0,this._btn.x=0}over(){super.over(),this._btn.y=-1,this._btn.x=0}}class fe extends me{constructor(){super(S.images.icon_play,"Play",340,90)}}E;class we extends E{constructor(){super("Pass & Play",340,90)}}class ve extends me{constructor(){super(S.images.icon_more,"Games",340,90)}}me;E;E;E;class be extends E{constructor(){super("Play Online",340,90)}}E;class xe extends E{constructor(){super("New Game",340,90)}}class Se extends E{constructor(){super("Resume",340,90)}}class ke extends E{constructor(t="Replay"){super(t,340,90)}}E;class Ce extends E{constructor(){super("View Board",340,90)}}class Te extends ye{constructor(){super(S.images.icon_home,90,90)}}class Fe extends ye{get hideWithoutIndicator(){return this._hideWithoutIndicator}set hideWithoutIndicator(t){this._hideWithoutIndicator!==t&&(this._hideWithoutIndicator=t,this.updateVisibilities())}get allowIndicatorDot(){return this._allowIndicatorDot}set allowIndicatorDot(t){this._allowIndicatorDot!==t&&(this._allowIndicatorDot=t,this.updateVisibilities())}get allowRingSound(){return this._allowRingSound}set allowRingSound(t){this._allowRingSound=t}get allowRingAnim(){return this._allowRingAnim}set allowRingAnim(t){this._allowRingAnim=t}constructor(){super(S.images.icon_notifications,90,90),this.arr="0123456789+#".split(""),this.ind=0,this.tween=null,this._shouldIndicatorBeVisible=!1,this._hideWithoutIndicator=!0,this._allowIndicatorDot=!1,this.ringSound=new x(S.sounds.notification.data),this._allowRingSound=!1,this._allowRingAnim=!1,this.indicator=this.btn.addChild(new B),this.indicator.input=new C(this.indicator,!1,!1),this.indicator.x=this.w/2,this.indicator.y=this.h/2,this.indicatorTextField=this.indicator.addChild(new T(this.arr[this.ind],S.fonts["Asap-Regular"].data,30)),this.indicatorTextField.fill="#FFFFFF",this.indicatorTextField.baseline="middle",this.indicatorTextField.align="center",this.indicatorTextField.visible=!1,this.indicatorTextField.underStroke="#000000",this.indicatorTextField.underStrokeWidth=8,this.indicatorDot=this.indicator.addChild(new B),this.indicatorDot.x=19,this.indicatorDot.y=-16,this.indicatorDotOuterCircle=this.indicatorDot.addChild(new ee(0,0,11,"#000000")),this.indicatorDotOuterCircle.x-=.5,this.indicatorDotOuterCircle.y-=.5,this.indicatorDotInnerCircle=this.indicatorDot.addChild(new ee(0,0,8,"#FF0000")),this.icon.regY=6,this.icon.y-=this.icon.height/2-this.icon.regY,this.indicator.visible=!1,this.visible=!1}ring(){this.tween&&(this.tween.onLooped.remove(this.tween_onLooped,this),this.tween=null,this.icon.rotation=0),this._allowRingAnim&&(this.tween=new n(0,-10,20,0,p.Quadratic.easeOut,new X(49,!1)),this.tween.onLooped.add(this.tween_onLooped,this)),this._shouldIndicatorBeVisible=!0,this.updateVisibilities(),this.allowRingSound&&(this.ringSound.isPlaying&&this.ringSound.stop(),this.ringSound.play())}seen(){this._shouldIndicatorBeVisible=!1,this.updateVisibilities()}unseen(){this._shouldIndicatorBeVisible=!0,this.updateVisibilities()}updateVisibilities(){this.indicator.visible=this._shouldIndicatorBeVisible,this._hideWithoutIndicator?this.visible=this.indicator.visible:this.visible=!0,this._allowIndicatorDot||(this.indicator.visible=!1)}tween_onLooped(){0!==this.tween.end?(this.tween.start=this.tween.end,this.tween.end=0,this.tween.ease=p.Quadratic.easeIn):(this.tween.end=-.92*this.tween.start,this.tween.start=0,this.tween.ease=p.Quadratic.easeOut)}update(t){this.tween&&(this.icon.rotation=this.tween.update(t),this.tween.isFinished)&&(this.tween.onLooped.remove(this.tween_onLooped,this),this.tween=null)}}me;class Be extends se{constructor(){super();this.w=90,this.h=90;this._btn=new B,this._faceDark=new Kt(0,0,82.5,80,14*.8,"#CC0000"),this._faceDark.x=4,this._faceDark.y=6,this._face=new Kt(0,0,82,39,14*.8,"#FF0000"),this._face.bottomLeftRadius=this._face.bottomRightRadius=0,this._face.x=4,this._face.y=6,this._side=new Kt(0,0,82,41,14*.8,"#FF6666"),this._side.bottomLeftRadius=this._side.bottomRightRadius=0,this._side.x=4,this._side.y=4,this._base=new Kt(0,0,90,90,14,"#000000"),this._shadow=new Kt(0,0,90,90,14,"rgba(0,0,0,0.25)"),this._shadow.x=-4,this._shadow.y=4,this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this._btn.addChild(this._base),this._btn.addChild(this._side),this._btn.addChild(this._faceDark),this._btn.addChild(this._face),this.addChild(this._btn),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new r(0,0,90,90),this.clickSound=new x(S.sounds.click.data),this._icon=new F(S.images.icon_x_red),this._icon.y=45,this._icon.x=45,this._icon.regY=this._icon.height/2,this._icon.regX=this._icon.width/2,this._btn.addChild(this._icon)}down(){super.down(),this._btn.y=1,this._btn.x=-1}up(){super.up(),this._btn.y=0,this._btn.x=0}over(){super.over(),this._btn.y=-1,this._btn.x=0}}class Pe extends ye{constructor(){super(S.images.icon_wrench,90,90)}}class De extends ye{constructor(){super(S.images.icon_pause,70,70)}}class Ee extends me{constructor(t="Daily Challenge",e=540){var i=0!==D.state;super(S.images[i?"icon_daily_challenge_complete":"icon_daily_challenge"],t,e,90),this._isDCCompleted=i}render(t,e,i){var s=0!==D.state;s!==this._isDCCompleted&&(this._isDCCompleted=s,this._icon.setImage(S.images[s?"icon_daily_challenge_complete":"icon_daily_challenge"]),this._icon.regX=this._icon.width/2,this._icon.regY=this._icon.height/2),super.render(t,e,i)}}me;class Re extends E{constructor(){super("Play Now",340,90)}}class Ae extends E{constructor(){super("Not Today",340,90)}}class Ie extends E{constructor(){super("Done",340,90)}}E;E;class Me{constructor(t){this._showing=!1,this._onY=Oe.topMargin,this._offY=0,this._yTween=null,this._alphaTween=null,this._button=t,this._button.input.pointerEnabled=!1,this._button.y=this._offY,this._button.alpha=0}show(t=!0){this._showing?t||(this._yTween=null,this._alphaTween=null,this._button.y=this._onY,this._button.alpha=1):(this._showing=!0,this._button.input.pointerEnabled=!0,t?(this._yTween=new n(this._button.y,this._onY,150,0,p.Quadratic.easeOut),this._alphaTween=new n(this._button.alpha,1,150,0,p.Quadratic.easeOut)):(this._yTween=null,this._alphaTween=null,this._button.y=this._onY,this._button.alpha=1))}hide(t=!0){this._showing?(this._showing=!1,this._button.input.pointerEnabled=!1,t?(this._yTween=new n(this._button.y,this._offY,150,0,p.Quadratic.easeOut),this._alphaTween=new n(this._button.alpha,0,150,0,p.Quadratic.easeOut)):(this._yTween=null,this._alphaTween=null,this._button.y=this._offY,this._button.alpha=0)):t||(this._yTween=null,this._alphaTween=null,this._button.y=this._offY,this._button.alpha=0)}update(t){this._yTween&&(this._button.y=this._yTween.update(t),this._yTween.isFinished)&&(this._yTween=null),this._alphaTween&&(this._button.alpha=this._alphaTween.update(t),this._alphaTween.isFinished)&&(this._alphaTween=null)}}class Oe extends B{constructor(){super(),this.usesNotifications=!1,tt.isMobileDevice&&"Apple iOS"!==tt.os&&"AndroidAuto"!==c.embed.type&&(Oe.sideMargin=40),this.homeButton=new Te,this.addChild(this.homeButton),this.home=new Me(this.homeButton),this.closeButton=new Be,this.addChild(this.closeButton),this.close=new Me(this.closeButton),this.settingsButton=new Pe,this.addChild(this.settingsButton),this.settings=new Me(this.settingsButton),this.notificationsButton=new Fe,this.addChild(this.notificationsButton),this.notifications=new Me(this.notificationsButton),this.input=new C(this,!0,!0)}update(t){this.home.update(t),this.close.update(t),this.settings.update(t),this.notifications.update(t),this.notificationsButton.update(t)}render(t,e,i){var s=Oe.sideMargin;this.homeButton.x=s,this.closeButton.x=s,this.settingsButton.x=P.width-s-this.settingsButton.w,this.notificationsButton.x=P.width-s-this.settingsButton.w-(this.notificationsButton.w+16),super.render(t,e,i)}hideAll(t=!0){this.home.hide(t),this.close.hide(t),this.settings.hide(t),this.notifications.hide(t)}}Oe.topMargin=16,Oe.sideMargin=16,Oe.height=Oe.topMargin+90;class Le extends B{constructor(t=100,e=100,i){super(),this.value=i,this.w=t,this.h=e,this.regX=t/2,this.regY=e/2;var i=t+4,s=e+4,n=i,a=s,o=t-8;this._shadow=new Kt(-8,4,n,a,14*1.15,"rgba(0,0,0,0.25)"),this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this._panel=new B,this.addChild(this._panel),this._outerStroke=new Kt(-2,-2,i,s,14*1.15,"#FFFFFF"),this._panel.addChild(this._outerStroke),this._base=new Kt(0,0,t,e,14,"#000000"),this._panel.addChild(this._base),this._side=new Kt(0,0,o,46,14*.8,"#666666"),this._side.bottomLeftRadius=this._side.bottomRightRadius=0,this._side.x=4,this._side.y=4,this._panel.addChild(this._side),this._face=new Kt(0,0,o,44,14*.8,"#333333"),this._face.bottomLeftRadius=this._face.bottomRightRadius=0,this._face.x=4,this._face.y=6,this._panel.addChild(this._face),this._grad=new Kt(0,0,t,e-(this._face.y+this._face.rectangle.height),14,$t.panelBg),this._grad.topLeftRadius=0,this._grad.topRightRadius=0,this._grad.y=this._face.y+this._face.rectangle.height,this._panel.addChild(this._grad),this._panel.input=new C(this._panel,!0,!1,new r(0,0,t,e)),this.content=new B,this.addChild(this.content)}}class He extends se{constructor(t=100,e=100,i){super(),this.value=i,this.w=t,this.h=e,this.regX=t/2,this.regY=e/2;var i=t+4,s=e+4,n=i,a=s,o=t-8;this._shadow=new Kt(-8,4,n,a,14*1.15,"rgba(0,0,0,0.25)"),this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this._panel=new B,this.addChild(this._panel),this._outerStroke=new Kt(-2,-2,i,s,14*1.15,"#FFFFFF"),this._panel.addChild(this._outerStroke),this._base=new Kt(0,0,t,e,14,"#000000"),this._panel.addChild(this._base),this._side=new Kt(0,0,o,46,14*.8,"#666666"),this._side.bottomLeftRadius=this._side.bottomRightRadius=0,this._side.x=4,this._side.y=4,this._panel.addChild(this._side),this._face=new Kt(0,0,o,44,14*.8,"#333333"),this._face.bottomLeftRadius=this._face.bottomRightRadius=0,this._face.x=4,this._face.y=6,this._panel.addChild(this._face),this._grad=new Kt(0,0,t,e-(this._face.y+this._face.rectangle.height),14,$t.panelBg),this._grad.topLeftRadius=0,this._grad.topRightRadius=0,this._grad.y=this._face.y+this._face.rectangle.height,this._panel.addChild(this._grad),this.input.pointerChildrenEnabled=!1,this.input.pointerEnabled=!0,this.input.hitArea=new r(0,0,t,e),this.clickSound=new x(S.sounds.click.data)}down(){super.down(),this._panel.y=1,this._panel.x=-1}up(){super.up(),this._panel.y=0,this._panel.x=0}over(){super.over(),this._panel.y=-1,this._panel.x=0}}class ze extends He{constructor(t,e,i,s,n,a=814,o=478){super(a,o,n),this.stars=[],this.titleTextField=new T(t,S.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.captionTextField=new T(e,S.fonts["OpenSans-ExtraBold"].data,48),this.captionTextField.fill="#FFFFFF",this.captionTextField.align="center",this.captionTextField.x=this.w/2,this.captionTextField.y=140,this._panel.addChild(this.captionTextField),this.recordLabelTextField=new T("Record: ",S.fonts["OpenSans-ExtraBold"].data,64),this.recordLabelTextField.fill="#CCCCCC",this.recordLabelTextField.align="left",this.recordLabelTextField.y=this.h-this.recordLabelTextField.fontSize-36,this._panel.addChild(this.recordLabelTextField),this.recordTextField=new T(i,S.fonts["OpenSans-ExtraBold"].data,this.recordLabelTextField.fontSize),this.recordTextField.fill="#FFFFFF",this.recordTextField.align="left",this.recordTextField.y=this.recordLabelTextField.y,this._panel.addChild(this.recordTextField);a=this.recordLabelTextField.measure().width,o=this.recordTextField.measure().width,n=this.recordLabelTextField.fontSize/5,t=a+n+o;this.recordLabelTextField.x=this.w/2-t/2,this.recordTextField.x=this.recordLabelTextField.x+a+n;let r=(this.captionTextField.y+1.5*this.captionTextField.fontSize+this.recordLabelTextField.y)/2;e||(r-=1.5*this.captionTextField.fontSize/2);for(let t=1;t<=3;++t){var h=new F(S.images["star_"+(s>=t?"fill":"empty")]);h.regX=h.width/2,h.regY=h.height/2,h.x=this.w/2+(h.width+20)*(t-2),h.y=r,this._panel.addChild(h),this.stars.push(h)}}}class Ge extends Le{constructor(t,e,i=980,s=620){super(i,s),this.titleTextField=new T("Paused",S.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.difficultyLabelTextField=new T("Level:",S.fonts["OpenSans-ExtraBold"].data,48),this.difficultyLabelTextField.fill="#CCCCCC",this.difficultyLabelTextField.align="center",this.difficultyLabelTextField.x=this.w/2,this.difficultyLabelTextField.y=140,this._panel.addChild(this.difficultyLabelTextField),this.difficultyTextField=new T(t,S.fonts["OpenSans-ExtraBold"].data,82),this.difficultyTextField.fill="#FFFFFF",this.difficultyTextField.align="center",this.difficultyTextField.x=this.w/2,this.difficultyTextField.y=this.difficultyLabelTextField.y+this.difficultyLabelTextField.fontSize,this._panel.addChild(this.difficultyTextField),this.timeLabelTextField=new T("Time:",S.fonts["OpenSans-ExtraBold"].data,48),this.timeLabelTextField.fill="#CCCCCC",this.timeLabelTextField.align="center",this.timeLabelTextField.x=this.w/2,this.timeLabelTextField.y=this.difficultyTextField.y+this.difficultyTextField.fontSize+36,this._panel.addChild(this.timeLabelTextField),this.timeTextField=new T(e,S.fonts["OpenSans-ExtraBold"].data,82),this.timeTextField.fill="#FFFFFF",this.timeTextField.align="center",this.timeTextField.x=this.w/2,this.timeTextField.y=this.timeLabelTextField.y+this.timeLabelTextField.fontSize,this._panel.addChild(this.timeTextField),this.resumeButton=new Se,this.resumeButton.x=this.w/2-this.resumeButton.w/2,this.resumeButton.y=this.h-this.resumeButton.h-32,this.content.addChild(this.resumeButton)}}class Ne extends Le{constructor(t,e,i=980,s=620){super(i,s),this.titleTextField=new T("Resume?",S.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.difficultyLabelTextField=new T("Level:",S.fonts["OpenSans-ExtraBold"].data,48),this.difficultyLabelTextField.fill="#CCCCCC",this.difficultyLabelTextField.align="center",this.difficultyLabelTextField.x=this.w/2,this.difficultyLabelTextField.y=140,this._panel.addChild(this.difficultyLabelTextField),this.difficultyTextField=new T(t,S.fonts["OpenSans-ExtraBold"].data,82),this.difficultyTextField.fill="#FFFFFF",this.difficultyTextField.align="center",this.difficultyTextField.x=this.w/2,this.difficultyTextField.y=this.difficultyLabelTextField.y+this.difficultyLabelTextField.fontSize,this._panel.addChild(this.difficultyTextField),this.timeLabelTextField=new T("Time:",S.fonts["OpenSans-ExtraBold"].data,48),this.timeLabelTextField.fill="#CCCCCC",this.timeLabelTextField.align="center",this.timeLabelTextField.x=this.w/2,this.timeLabelTextField.y=this.difficultyTextField.y+this.difficultyTextField.fontSize+36,this._panel.addChild(this.timeLabelTextField),this.timeTextField=new T(e,S.fonts["OpenSans-ExtraBold"].data,82),this.timeTextField.fill="#FFFFFF",this.timeTextField.align="center",this.timeTextField.x=this.w/2,this.timeTextField.y=this.timeLabelTextField.y+this.timeLabelTextField.fontSize,this._panel.addChild(this.timeTextField);this.newGameButton=new xe,this.newGameButton.x=this.w/2-16-this.newGameButton.w,this.newGameButton.y=this.h-this.newGameButton.h-32,this.content.addChild(this.newGameButton),this.resumeButton=new Se,this.resumeButton.x=this.w/2+16,this.resumeButton.y=this.newGameButton.y,this.content.addChild(this.resumeButton)}}class Ve extends Le{constructor(t=980,e=700){super(t,e),this.titleTextField=new T("Play Online",S.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.anyoneLabelTextField=new T("Play a random online opponent",S.fonts["OpenSans-Bold"].data,48),this.anyoneLabelTextField.fill="#CCCCCC",this.anyoneLabelTextField.align="center",this.anyoneLabelTextField.x=this.w/2,this.anyoneLabelTextField.y=180,this._panel.addChild(this.anyoneLabelTextField),this.anyoneButton=new E("Play Anyone",440),this.anyoneButton.x=this.w/2-this.anyoneButton.w/2,this.anyoneButton.y=this.anyoneLabelTextField.y+this.anyoneLabelTextField.fontSize+50,this.content.addChild(this.anyoneButton),this.inviteLabelTextField=new T("or invite a friend to play online",S.fonts["OpenSans-Bold"].data,48),this.inviteLabelTextField.fill="#CCCCCC",this.inviteLabelTextField.align="center",this.inviteLabelTextField.x=this.w/2,this.inviteLabelTextField.y=this.anyoneButton.y+this.anyoneButton.h+64,this._panel.addChild(this.inviteLabelTextField),this.inviteButton=new E("Invite a Friend",440),this.inviteButton.x=this.w/2-this.inviteButton.w/2,this.inviteButton.y=this.inviteLabelTextField.y+this.inviteLabelTextField.fontSize+50,this.content.addChild(this.inviteButton)}}class je extends Le{constructor(t,e,i,s,n,a="Replay",o=!0,r=1160,h=620,l=450){super(r,o?h:l),this.stars=[],this.titleTextField=new T(n,S.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.difficultyLabelTextField=new T("Level:",S.fonts["OpenSans-ExtraBold"].data,48),this.difficultyLabelTextField.fill="#CCCCCC",this.difficultyLabelTextField.align="left",this.difficultyLabelTextField.y=o?312:142,this._panel.addChild(this.difficultyLabelTextField),this.difficultyTextField=new T(t,S.fonts["OpenSans-ExtraBold"].data,48),this.difficultyTextField.fill="#FFFFFF",this.difficultyTextField.align="left",this.difficultyTextField.y=this.difficultyLabelTextField.y,this._panel.addChild(this.difficultyTextField);r=this.difficultyLabelTextField.measure().width,h=r+this.difficultyTextField.measure().width+8,this.difficultyLabelTextField.x=this.w/2-h/2,this.difficultyTextField.x=this.difficultyLabelTextField.x+r+8,this.timeTextField=new T(e,S.fonts["OpenSans-ExtraBold"].data,82),this.timeTextField.fill="#FFFFFF",this.timeTextField.align="center",this.timeTextField.x=this.w/2,this.timeTextField.y=this.difficultyLabelTextField.y+this.difficultyLabelTextField.fontSize,this._panel.addChild(this.timeTextField),this.newGameButton=new xe,this.newGameButton.y=this.h-this.newGameButton.h-32,this.content.addChild(this.newGameButton),this.replayButton=new ke(a),this.replayButton.y=this.newGameButton.y,this.content.addChild(this.replayButton),this.viewBoardButton=new Ce,this.viewBoardButton.y=this.newGameButton.y,this.content.addChild(this.viewBoardButton),l=this.newGameButton.w+32+this.replayButton.w+32+this.viewBoardButton.w;this.viewBoardButton.x=this.w/2-l/2,this.newGameButton.x=this.viewBoardButton.x+this.viewBoardButton.w+32,this.replayButton.x=this.newGameButton.x+this.newGameButton.w+32;for(let t=1;t<=3;++t){var d=new F(S.images["star_"+(s>=t?"fill":"empty")]);d.scaleX=d.scaleY=1,d.regX=d.width/2,d.regY=d.height/2,d.x=this.w/2+(+d.width+20)*(t-2),d.y=220,this._panel.addChild(d),this.stars.push(d),o||(d.visible=!1)}this.leftRecordMedal=new F(S.images.icon_medal),this.addChild(this.leftRecordMedal),this.rightRecordMedal=new F(S.images.icon_medal),this.addChild(this.rightRecordMedal),this.leftRecordMedal.regX=this.leftRecordMedal.width,this.leftRecordMedal.regY=this.rightRecordMedal.regY=this.leftRecordMedal.height/2,this.repositionMedals(),i&&o||(this.leftRecordMedal.visible=this.rightRecordMedal.visible=!1)}repositionMedals(){var t=this.timeTextField.measure().width;this.leftRecordMedal.x=this.w/2-t/2-20,this.rightRecordMedal.x=this.w/2+t/2+20,this.leftRecordMedal.y=this.rightRecordMedal.y=this.timeTextField.y+60}}class Ue extends Le{constructor(t,e,i,s="Replay",n=1160,a=450,o){var r=void 0!==o,a=(r&&450===a&&(a+=68),super(n,a),this.titleTextField=new T(i,S.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.captionTextField=new T(o||"",S.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=n/2,this.captionTextField.y=142,this._panel.addChild(this.captionTextField),r||(this.captionTextField.visible=!1),this.difficultyLabelTextField=new T("Level:",S.fonts["OpenSans-ExtraBold"].data,48),this.difficultyLabelTextField.fill="#CCCCCC",this.difficultyLabelTextField.align="left",this.difficultyLabelTextField.y=142+(r?68:0),this._panel.addChild(this.difficultyLabelTextField),this.difficultyTextField=new T(t,S.fonts["OpenSans-ExtraBold"].data,48),this.difficultyTextField.fill="#FFFFFF",this.difficultyTextField.align="left",this.difficultyTextField.y=this.difficultyLabelTextField.y,this._panel.addChild(this.difficultyTextField),this.difficultyLabelTextField.measure().width),i=a+this.difficultyTextField.measure().width+8,o=(this.difficultyLabelTextField.x=this.w/2-i/2,this.difficultyTextField.x=this.difficultyLabelTextField.x+a+8,this.timeTextField=new T(e,S.fonts["OpenSans-ExtraBold"].data,82),this.timeTextField.fill="#FFFFFF",this.timeTextField.align="center",this.timeTextField.x=this.w/2,this.timeTextField.y=this.difficultyLabelTextField.y+this.difficultyLabelTextField.fontSize,this._panel.addChild(this.timeTextField),this.newGameButton=new xe,this.newGameButton.y=this.h-this.newGameButton.h-32,this.content.addChild(this.newGameButton),this.replayButton=new ke(s),this.replayButton.y=this.newGameButton.y,this.content.addChild(this.replayButton),this.viewBoardButton=new Ce,this.viewBoardButton.y=this.newGameButton.y,this.content.addChild(this.viewBoardButton),this.newGameButton.w+32+this.replayButton.w+32+this.viewBoardButton.w);this.viewBoardButton.x=this.w/2-o/2,this.newGameButton.x=this.viewBoardButton.x+this.viewBoardButton.w+32,this.replayButton.x=this.newGameButton.x+this.newGameButton.w+32}}Le;class We extends B{constructor(t){super(),this.isOn=!1,this.xTween=null,this.alphaTween=null,this.input=new C(this,!1,!1),this.holder=new B,this.addChild(this.holder),this.item=t,this.holder.addChild(t),this.visible=!1,this.alpha=0,this.holder.x=-We.tweenDist}on(t){this.isOn||(this.isOn=!0,this.holder.x=t?-We.tweenDist:We.tweenDist,this.alpha=0,this.visible=!0,this.xTween=new n(this.holder.x,0,We.tweenDur,We.tweenDelay,p.Quadratic.easeOut),this.alphaTween=new n(this.alpha,1,We.tweenDur,We.tweenDelay))}off(t,e=0){this.isOn&&(this.isOn=!1,this.holder.x=0,this.alpha=1,this.input.pointerEnabled=this.input.pointerChildrenEnabled=!1,this.xTween=t?new n(this.holder.x+e,We.tweenDist+e,We.tweenDur,0,p.Quadratic.easeOut):new n(this.holder.x+e,-We.tweenDist+e,We.tweenDur,0,p.Quadratic.easeOut),this.alphaTween=new n(this.alpha,0,We.tweenDur,0))}backHome(t){this.isOn&&0!==t&&(this.input.pointerEnabled=this.input.pointerChildrenEnabled=!1,this.holder.x=t,this.xTween=new n(this.holder.x,0,We.tweenDur,0,p.Quadratic.easeOut))}warpOff(){this.isOn=!1,this.input.pointerEnabled=this.input.pointerChildrenEnabled=!1,this.holder.x=-We.tweenDist,this.alpha=0,this.visible=!1,this.xTween=null,this.alphaTween=null}warpOn(){this.isOn=!0,this.input.pointerEnabled=this.input.pointerChildrenEnabled=!0,this.holder.x=0,this.alpha=1,this.visible=!0,this.xTween=null,this.alphaTween=null}warp(){this.isOn?(this.input.pointerEnabled=this.input.pointerChildrenEnabled=!0,this.holder.x=0,this.alpha=1,this.visible=!0):(this.input.pointerEnabled=this.input.pointerChildrenEnabled=!1,this.holder.x=-We.tweenDist,this.alpha=0,this.visible=!1),this.xTween=null,this.alphaTween=null}update(t){var e=!(!this.alphaTween&&!this.xTween),t=(this.alphaTween?(this.alpha=this.alphaTween.update(t),this.alphaTween.isFinished&&(this.alphaTween=null)):this.isOn||(this.visible=!1),this.xTween&&(this.holder.x=this.xTween.update(t),this.xTween.isFinished)&&(this.xTween=null),!(!this.alphaTween&&!this.xTween));e&&!t&&this.isOn&&(this.input.pointerEnabled=this.input.pointerChildrenEnabled=!0)}}We.tweenDist=150,We.tweenDur=100,We.tweenDelay=100;class $e extends B{constructor(t){super(),this.onIndexChange=new h,this.onItemClick=new h,this.entries=[],this.trayPos=0,this.currentIndex=0,this.yShift=0,this.xShift=0,this._pressed=!1,this._pressPos=new v,this._currPos=new v,this._dragging=!1,this._startingIndex=t,this.input=new C(this,!0,!0,new r(0,0,1,1)),this.input.onPointerPress.add(this.input_onPointerPress,this),this.input.onPointerCancel.add(this.input_onPointerCancel,this),this.input.onPointerRelease.add(this.input_onPointerRelease,this)}startPressed(){this._pressed||(this._pressed=!0,this._pressPos.set(w.primary.x,w.primary.y),this._currPos.copy(this._pressPos),w.primary.onMove.add(this.PointerInput_primary_onMove,this))}stopPressed(t){var e,i;this._pressed&&(e=this.xShift,i=this._dragging,w.primary.onMove.remove(this.PointerInput_primary_onMove,this),this.stopDragging(),this._pressed=!1,i)&&t&&this.entries[this.currentIndex].backHome(e)}input_onPointerPress(){this.startPressed()}input_onPointerRelease(){this.stopPressed(!0)}input_onPointerCancel(){this.stopPressed(!0)}PointerInput_primary_onMove(t,e,i){var s;this._currPos.set(w.primary.x,w.primary.y),this._dragging||(this.entries[0].item.w,30<Math.abs(this._currPos.x-this._pressPos.x)&&this.startDragging()),this._dragging&&(this.xShift,this.xShift=this._currPos.x-this._pressPos.x,this.entries[0].item.w,100<=this.xShift?0<this.currentIndex?(s=this.xShift,this.stopPressed(!1),this.swipeRight(s)):this.stopPressed(!0):this.xShift<=-100&&(this.currentIndex<this.entries.length-1?(s=this.xShift,this.stopPressed(!1),this.swipeLeft(s)):this.stopPressed(!0)))}swipeRight(t){this.currentIndex--,this.onIndexChange.invoke(this,!1),this.updateArrowButtons(),this.startTween(!1,t),new x(S.sounds.swoop_backward.data).play()}swipeLeft(t){this.currentIndex++,this.onIndexChange.invoke(this,!0),this.updateArrowButtons(),this.startTween(!0,t),new x(S.sounds.swoop_forward.data).play()}startDragging(){if(!this._dragging){this.input.pointerChildrenEnabled=!1;for(var t of this.entries)t.item.cancel(),t.warp();this._dragging=!0}}stopDragging(){this._dragging&&(this.input.pointerChildrenEnabled=!0,this._dragging=!1,this.xShift=0)}addEntry(t){this.entries.push(t),this.addChild(t),t.item.onClicked.add(this.item_onClicked,this)}initialize(){this.leftButton=new _e(!0),this.addChild(this.leftButton),this.rightButton=new _e(!1),this.addChild(this.rightButton),this.rightButton.input.onPointerClick.add(this.rightButton_onClick,this),this.leftButton.input.onPointerClick.add(this.leftButton_onClick,this),this.currentIndex=this._startingIndex,this.entries[this.currentIndex].warpOn(),this.updateArrowButtons()}updateArrowButtons(){0===this.currentIndex?this.leftButton.visible=!1:this.leftButton.visible=!0,this.currentIndex===this.entries.length-1?this.rightButton.visible=!1:this.rightButton.visible=!0}startTween(e,i=0){for(let t=0;t<this.entries.length;++t)e?t===this.currentIndex-1?this.entries[t].off(!1,i):t===this.currentIndex?this.entries[t].on(!1):this.entries[t].warpOff():t===this.currentIndex+1?this.entries[t].off(!0,i):t===this.currentIndex?this.entries[t].on(!0):this.entries[t].warpOff()}rightButton_onClick(){this.currentIndex++,this.onIndexChange.invoke(this,!0),this.updateArrowButtons(),this.startTween(!0)}leftButton_onClick(){this.currentIndex--,this.onIndexChange.invoke(this,!1),this.updateArrowButtons(),this.startTween(!1)}item_onClicked(t){this.onItemClick.invoke(this,t)}anchor(){this.input.hitArea.width=P.width,this.input.hitArea.height=P.height;for(var t of this.entries)t.x=P.width/2+this.xShift,t.y=P.height/2+this.yShift;this.leftButton.x=P.width/2-this.entries[0].item.w/2-26,this.leftButton.y=P.height/2+this.yShift,this.rightButton.x=P.width/2+this.entries[0].item.w/2+26,this.rightButton.y=P.height/2+this.yShift}update(t){for(var e of this.entries)e.update(t)}}class Ye extends B{constructor(t=100,e=360){super(),this.radius=t,this.degsPerSecond=e,this.base=new ee(0,0,this.radius,"#CCCCCC"),this.base.alpha=.3,this.base.innerRadius=.8*this.radius,this.addChild(this.base),this.bar=new ee(0,0,this.radius,"#CCCCCC"),this.bar.startAngle=0,this.bar.endAngle=90,this.bar.innerRadius=this.base.innerRadius,this.addChild(this.bar)}update(t){this.bar.rotation+=t/1e3*this.degsPerSecond}}class qe extends te{constructor(){super([-6,-10,6,0,-6,10]),this.closePath=!1,this.strokeStyle="#CCCCCC",this.strokeWidth=6,this.strokeLineCap="square"}}class Xe extends se{constructor(t){super(),this.w=80,this.h=60,this.icon=new qe,this.addChild(this.icon),t&&(this.icon.scaleX=-1),this.input.hitArea=new r(-this.w/2,-this.h/2,this.w,this.h),this.clickSound=new x(S.sounds.click.data)}over(){this.icon.y=-1,this.icon.strokeStyle="#FFFFFF",super.over()}up(){this.icon.y=0,this.icon.strokeStyle="#CCCCCC",super.up()}down(){this.icon.y=1,this.icon.strokeStyle="#FFFFFF",super.down()}}class Je extends Xe{constructor(t){super(t),this.icon2=new qe,this.addChild(this.icon2),this.icon.x=-8,this.icon2.x=-this.icon.x,t&&(this.icon2.scaleX=-1)}over(){super.over(),this.icon2.y=this.icon.y,this.icon2.strokeStyle=this.icon.strokeStyle}up(){super.up(),this.icon2.y=this.icon.y,this.icon2.strokeStyle=this.icon.strokeStyle}down(){super.down(),this.icon2.y=this.icon.y,this.icon2.strokeStyle=this.icon.strokeStyle}}class Qe extends B{constructor(){super(),this.rankTextField=new T("0",S.fonts["RobotoMono-SemiBold"].data,48),this.rankTextField.align="left",this.rankTextField.baseline="top",this.rankTextField.fill="#FFFFFF",this.rankSuffixTextField=new T("th",S.fonts["RobotoMono-SemiBold"].data,24),this.rankSuffixTextField.align="left",this.rankSuffixTextField.baseline="top",this.rankSuffixTextField.y=6,this.rankSuffixTextField.fill="#FFFFFF",this.timeTextField=new T("00:00",S.fonts["RobotoMono-SemiBold"].data,48),this.timeTextField.align="right",this.timeTextField.baseline="top",this.timeTextField.fill="#FFFFFF",this.addChild(this.rankTextField),this.addChild(this.rankSuffixTextField),this.addChild(this.timeTextField),this.w=this.timeTextField.x=600,this.h=this.timeTextField.fontSize}setRankText(t){this.rankTextField.text=t+"",this.rankSuffixTextField.text=a.getPlaceSuffix(t),this.rankSuffixTextField.x=this.rankTextField.measure().width+2,this.rankSuffixTextField.visible=t<=100}clear(t){this.setRankText(t),this.timeTextField.text="--:--",this.rankSuffixTextField.fill=this.timeTextField.fill=this.rankTextField.fill="#CCCCCC"}set(t,e){this.setRankText(t),this.timeTextField.text=a.toTimerString(e),e===D.score?this.rankSuffixTextField.fill=this.timeTextField.fill=this.rankTextField.fill="#FECC07":this.rankSuffixTextField.fill=this.timeTextField.fill=this.rankTextField.fill="#FFFFFF"}}class Ke extends B{constructor(t){super(),this.rows=[],this.numPages=1,this.page=0,this.initEntries(),this.screen=t,this.rankHeaderTextField=new T("RANK",S.fonts["RobotoMono-SemiBold"].data,48),this.rankHeaderTextField.align="left",this.rankHeaderTextField.baseline="top",this.rankHeaderTextField.fill="#CCCCCC",this.addChild(this.rankHeaderTextField),this.timeHeaderTextField=new T("TIME",S.fonts["RobotoMono-SemiBold"].data,48),this.timeHeaderTextField.align="right",this.timeHeaderTextField.baseline="top",this.timeHeaderTextField.fill="#CCCCCC",this.addChild(this.timeHeaderTextField),this.pageTextField=new T("1000 / 1000",S.fonts["RobotoMono-SemiBold"].data,36),this.pageTextField.align="center",this.pageTextField.baseline="middle",this.pageTextField.fill="#CCCCCC",this.addChild(this.pageTextField);for(let t=0;t<10;++t){var e=this.createRow();e.y=66+t*(e.h+16),this.addChild(e),this.rows.push(e)}this.w=this.rows[0].w,this.dividerBottom=new te([0,0,this.w,0]),this.dividerBottom.strokeStyle="#666666",this.dividerBottom.strokeWidth=2,this.addChild(this.dividerBottom),this.dividerBottom.y=66+this.rows.length*this.rows[0].h+16*(this.rows.length-1)+24,this.pageTextField.x=this.w/2,this.pageTextField.y=this.dividerBottom.y+20+this.pageTextField.fontSize/2,this.h=this.pageTextField.y+this.pageTextField.fontSize,this.dividerTop=new te([0,this.rankHeaderTextField.fontSize+12,this.w,this.rankHeaderTextField.fontSize+12]),this.dividerTop.strokeStyle="#666666",this.dividerTop.strokeWidth=2,this.addChild(this.dividerTop),this.timeHeaderTextField.x=this.rows[0].w,this.nextPageButton=new Xe(!1),this.nextPageButton.y=this.pageTextField.y,this.nextPageButton.x=this.w/2+150,this.addChild(this.nextPageButton),this.prevPageButton=new Xe(!0),this.prevPageButton.y=this.pageTextField.y,this.prevPageButton.x=this.w/2-150,this.addChild(this.prevPageButton),this.firstPageButton=new Je(!0),this.firstPageButton.y=this.pageTextField.y,this.firstPageButton.x=this.prevPageButton.x-this.prevPageButton.w,this.addChild(this.firstPageButton),this.lastPageButton=new Je(!1),this.lastPageButton.y=this.pageTextField.y,this.lastPageButton.x=this.nextPageButton.x+this.nextPageButton.w,this.addChild(this.lastPageButton),this.nextPageButton.input.onPointerClick.add(this.pageButton_onClick,this),this.prevPageButton.input.onPointerClick.add(this.pageButton_onClick,this),this.firstPageButton.input.onPointerClick.add(this.pageButton_onClick,this),this.lastPageButton.input.onPointerClick.add(this.pageButton_onClick,this)}initEntries(){this.entries=D.table.entries}createRow(){return new Qe}populate(t){this.initEntries();t=Math.floor((t-1)/this.rows.length);this.numPages=Math.max(1,Math.ceil(this.entries.length/this.rows.length)),this.setPage(t)}setPage(e){for(let t=0;t<this.rows.length;++t){var i=e*this.rows.length+t,s=e*this.rows.length+t+1;i>=this.entries.length?this.rows[t].clear(s):(i=this.entries[i],this.rows[t].set(s,i))}this.pageTextField.text=e+1+" / "+this.numPages,this.page=e}pageButton_onClick(t){t===this.nextPageButton?(this.screen.track("Next Page Button Pressed"),this.page<this.numPages-1&&this.setPage(this.page+1)):t===this.lastPageButton?(this.screen.track("Last Page Button Pressed"),this.setPage(this.numPages-1)):t===this.prevPageButton?(this.screen.track("Previous Page Button Pressed"),0<this.page&&this.setPage(this.page-1)):t===this.firstPageButton&&(this.screen.track("First Page Button Pressed"),this.setPage(0))}}class Ze extends Le{constructor(t,e="Daily Challenge"){super(1164,1164),this.screen=t,this.titleTextField=new T(e,S.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.spinner=new Ye,this.spinner.x=this.w/2,this.spinner.y=this.h/2,this._panel.addChild(this.spinner),this.captionTextField=new T("Loading...",S.fonts["OpenSans-ExtraBold"].data,56),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=this.w/2,this.captionTextField.y=150,this._panel.addChild(this.captionTextField),this.scoreboard=this.createScoreboard(),this.content.addChild(this.scoreboard),this.scoreboard.visible=!1;this.notTodayButton=new Ae,this.notTodayButton.x=this.w/2-16-this.notTodayButton.w,this.notTodayButton.y=this.h-this.notTodayButton.h-32,this.content.addChild(this.notTodayButton),this.playNowButton=new Re,this.playNowButton.x=this.w/2+16,this.playNowButton.y=this.notTodayButton.y,this.content.addChild(this.playNowButton),this.doneButton=new Ie,this.doneButton.x=this.w/2-this.doneButton.w/2,this.doneButton.y=this.notTodayButton.y,this.content.addChild(this.doneButton),this.doneButton.visible=!1,this.notTodayButton.visible=this.playNowButton.visible=!1,this.scoreboard.x=this.w/2-this.scoreboard.w/2,this.scoreboard.y=236}createScoreboard(){return new Ke(this.screen)}populate(){var t=0!==D.state,e=null!==D.score;let i="What's Your Score?",s="#FECC07";this.scoreboard.visible=!0;let n=1;s=t?(this.doneButton.visible=!0,this.notTodayButton.visible=this.playNowButton.visible=!1,e&&0<=D.table.entries.indexOf(D.score)?(n=D.table.entries.indexOf(D.score)+1,i="You ranked "+a.toPlaceString(n)+"!","#FECC07"):(i="You did not rank today.","#CCCCCC")):(this.doneButton.visible=!1,this.notTodayButton.visible=this.playNowButton.visible=!0,i="What's Your Score?","#FECC07"),this.spinner.visible=!1,this.captionTextField.fill=s,this.captionTextField.text=i,this.captionTextField.fontSize=48,this.scoreboard.populate(n)}update(t){this.spinner.update(t)}}class ti extends Le{constructor(t,e,i){super(1164,1164),this.onRankDetermined=new h,this.screen=i,this.isWin=t,this.time=e,this.titleTextField=new T("Daily Challenge",S.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.spinner=new Ye,this.spinner.x=this.w/2,this.spinner.y=this.h/2,this._panel.addChild(this.spinner),this.captionTextField=new T("Loading...",S.fonts["OpenSans-ExtraBold"].data,56),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=this.w/2,this.captionTextField.y=150,this._panel.addChild(this.captionTextField),this.scoreboard=new Ke(this.screen),this.content.addChild(this.scoreboard),this.scoreboard.visible=!1;this.newGameButton=new Ie,this.newGameButton.y=this.h-this.newGameButton.h-32,this.content.addChild(this.newGameButton),this.viewBoardButton=new Ce,this.viewBoardButton.y=this.newGameButton.y,this.content.addChild(this.viewBoardButton);i=this.newGameButton.w+32+this.viewBoardButton.w;this.viewBoardButton.x=this.w/2-i/2,this.newGameButton.x=this.viewBoardButton.x+this.viewBoardButton.w+32,this.newGameButton.visible=this.viewBoardButton.visible=!0,this.scoreboard.x=this.w/2-this.scoreboard.w/2,this.scoreboard.y=236}populate(){var t=0!==D.state,e=null!==D.score;let i="What's Your Score?",s="#FECC07";this.scoreboard.visible=!0;let n=1;t&&e&&0<=D.table.entries.indexOf(D.score)?(n=D.table.entries.indexOf(D.score)+1,i="You ranked "+a.toPlaceString(n)+"!",s="#FECC07",this.onRankDetermined.invoke(n)):(i="You did not rank today.",s="#CCCCCC",this.onRankDetermined.invoke(0)),this.spinner.visible=!1,this.captionTextField.fill=s,this.captionTextField.text=i,this.captionTextField.fontSize=48,this.scoreboard.populate(n)}update(t){this.spinner.update(t)}}class ei extends B{constructor(t){super(),this.isDead=!1,this.xTween=new n(0,200,500,0,p.Quadratic.easeOut),this.alphaTween=new n(0,1,250,0,p.none),this.timeRem=1200,this.textField=new T(t,S.fonts["OpenSans-ExtraBold"].data,50),this.textField.fill="#FFFFFF",this.textField.underStroke="#FF0000",this.textField.underStrokeWidth=10,this.textField.align="left",this.textField.baseline="alphabetic",this.textField.x=this.xTween.start,this.textField.y=0,this.textField.alpha=this.alphaTween.start,this.addChild(this.textField),this.input=new C(this,!1,!1)}update(t){this.textField.x=this.xTween.update(t),this.textField.alpha=this.alphaTween.update(t),this.timeRem-=t,this.timeRem<=0&&(this.isDead=!0)}}class ii extends B{constructor(t,e,i=null){super(),this.penalties=[],this.isNotPausable=e,this.pauseButton=new De,this.pauseButton.x=Oe.sideMargin,this.pauseButton.y=-(Oe.topMargin+this.pauseButton.h),this.clockIcon=new F(S.images.icon_clock),this.addChild(this.clockIcon),this.clockIcon.x=Oe.sideMargin,this.clockIcon.y=-(Oe.topMargin+this.clockIcon.height),this.timeTextField=new T("00:00",S.fonts["OpenSans-ExtraBold"].data,50),this.timeTextField.align="left",this.timeTextField.baseline="alphabetic",this.timeTextField.x=this.pauseButton.x+this.pauseButton.w+16,this.timeTextField.y=70-(Oe.topMargin+70)-8,this.timeTextField.shadowX=-4,this.timeTextField.shadowY=4,this.timeTextField.shadowFill="#000000",this.timeTextField.shadowAlpha=.25,this.timeTextField.fill="#FFFFFF",this.timeTextField.input=new C(this.timeTextField,!1,!1),this.addChild(this.timeTextField),this.addChild(this.pauseButton),this.height=Oe.topMargin+70,this.isNotPausable?(this.pauseButton.visible=!1,this.timeTextField.x=this.clockIcon.x+this.clockIcon.width+16):this.clockIcon.visible=!1,this.setTime(t),this.input=new C(this,!1,!0),this.stopwatch=i,this.stopwatch&&(this.stopwatch.onTimeChange.add(this.stopwatch_onTimeChange,this),this.stopwatch.onRunningStateChange.add(this.stopwatch_onRunningStateChange,this),this.stopwatch_onRunningStateChange())}dispose(){this.stopwatch&&(this.stopwatch.onTimeChange.contains(this.stopwatch_onTimeChange,this)&&this.stopwatch.onTimeChange.remove(this.stopwatch_onTimeChange,this),this.stopwatch.onRunningStateChange.contains(this.stopwatch_onRunningStateChange,this))&&this.stopwatch.onRunningStateChange.remove(this.stopwatch_onRunningStateChange,this)}stopwatch_onRunningStateChange(){}stopwatch_onTimeChange(){this.setTime(this.stopwatch.time)}setTime(t){this.timeTextField.text=a.toTimerString(t,0)}penalty(t){t=new ei(t);t.y=this.timeTextField.y,t.x=this.timeTextField.x,this.penalties.push(t),this.addChild(t)}update(e){for(let t=0;t<this.penalties.length;++t)this.penalties[t].update(e),this.penalties[t].isDead&&(this.removeChild(this.penalties[t]),this.penalties.splice(t,1),t--)}}class si extends B{constructor(t,e,i,s,n="Daily Challenge"){super(),this.isPractice=!1,this.isDailyChallenge=e,this.isOnline=i||!1,this.isTwoPlayer=s||!1,this._dailyChallengeText=n,this.starIcon=new F(S.images.icon_star),this.addChild(this.starIcon),this.starIcon.x=-(Oe.sideMargin+this.starIcon.width),this.starIcon.y=-(Oe.topMargin+this.starIcon.height),this.timeTextField=new T("00:00",S.fonts["OpenSans-ExtraBold"].data,50),this.timeTextField.align="right",this.timeTextField.baseline="alphabetic",this.timeTextField.x=this.starIcon.x-16,this.timeTextField.y=70-(Oe.topMargin+70)-8,this.timeTextField.shadowX=-4,this.timeTextField.shadowY=4,this.timeTextField.shadowFill="#000000",this.timeTextField.shadowAlpha=.25,this.timeTextField.fill="#FFFFFF",this.timeTextField.input=new C(this.timeTextField,!1,!1),this.addChild(this.timeTextField),this.height=Oe.topMargin+70,this.setTime(t),this.input=new C(this,!1,!0)}setTime(t){this.isDailyChallenge?this.timeTextField.text=this._dailyChallengeText:this.isOnline?this.timeTextField.text="Online Game":this.isTwoPlayer?this.timeTextField.text="2 Player":this.isPractice?this.timeTextField.text="Practice":this.timeTextField.text=null===t?"--:--":a.toTimerString(t,0)}}class ni extends de{track(t,e,i){bi.track(this.name,t,e,i)}constructor(t,e){super(t),this.buttons=[],this._dimmerTweenIn=null,this._drawerTweenIn=null,this._dimmerTweenOut=null,this._drawerTweenOut=null,this.title=e,this.isPopup=!0}initialize(){this.dimmer=new ne(new jt(1,1,1,.7)),this.display.addChild(this.dimmer),this.drawerHolder=new B,this.display.addChild(this.drawerHolder),this.drawer=new B,this.drawerHolder.addChild(this.drawer),this.drawerShadow=new Qt(0,0,300,P.height,"#000000"),this.drawerShadow.alpha=.2,this.drawerShadow.x=-3,this.drawer.addChild(this.drawerShadow),this.drawerBackground=new Qt(0,0,300,P.height,"#333333"),this.drawer.addChild(this.drawerBackground),this.track("Opened");var t;this.titleText=new T(this.title,S.fonts["OpenSans-ExtraBold"].data,24),this.titleText.fill="#FFFFFF",this.titleText.align="left",this.titleText.baseline="middle",this.drawer.addChild(this.titleText),this.titleText.x=12,this.titleText.y=30,this.titleText.shadowFill="#000000",this.titleText.shadowAlpha=.2,this.titleText.shadowX=-2,this.titleText.shadowY=2,this.closeButton=new oe(!1,60),this.closeButton.x=300-this.closeButton.width,this.drawer.addChild(this.closeButton);let e=60;this.drawer.addChild(new ae(e));for(t of this.buttons)t.y=e,this.drawer.addChild(t),e+=t.height;this._dimmerTweenIn=new n(0,this.dimmer.alpha,250,0),this.dimmer.alpha=this._dimmerTweenIn.start,this._drawerTweenIn=new n(0,-300,300,0,p.Quadratic.easeOut),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this),this.closeButton.input.onPointerClick.add(this.closeButton_onClick,this),super.initialize()}close(){this._dimmerTweenIn=null,this._dimmerTweenOut=new n(this.dimmer.alpha,0,300),this._drawerTweenIn=null,this._drawerTweenOut=new n(this.drawer.x,0,250,0,p.Quadratic.easeIn),this.inputEnabled=!1}isOpeningOrClosing(){return!(!this._dimmerTweenIn&&!this._dimmerTweenOut)}removed(){this.track("Closed"),super.removed()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}closeButton_onClick(){this.track("Close Button Pressed"),this.close()}backSoftKeyPressed(){this.close()}anchor(){this.drawerHolder.x=P.screen.right;var t=P.screen.width,e=P.height,t=t/320,e=e/426,t=Math.min(t,e);this.drawerHolder.scaleX=this.drawerHolder.scaleY=t,this.drawerShadow.rectangle.y=this.drawerBackground.rectangle.y=P.screen.top/t,this.drawerShadow.rectangle.height=this.drawerBackground.rectangle.height=P.screen.height/t+1,super.anchor()}gainFocus(){o._instance.navBar.hideAll(),super.gainFocus()}update(t){if(this.anchor(),this.isFocused){for(var e of this.buttons)e.update(t);this._dimmerTweenIn&&(this.dimmer.alpha=this._dimmerTweenIn.update(t),this._dimmerTweenIn.isFinished)&&(this._dimmerTweenIn=null),this._dimmerTweenOut&&(this.dimmer.alpha=this._dimmerTweenOut.update(t),this._dimmerTweenOut.isFinished)&&(this._dimmerTweenOut=null,this.exit()),this._drawerTweenIn&&(this.drawer.x=this._drawerTweenIn.update(t),this._drawerTweenIn.isFinished)&&(this._drawerTweenIn=null),this._drawerTweenOut&&(this.drawer.x=this._drawerTweenOut.update(t),this._drawerTweenOut.isFinished)&&(this._drawerTweenOut=null)}}}class ai extends de{constructor(t,e=!0){super(t),this.onClosing=new h,this.openCloseAlphaTween=null,this.closeTweening=!1,this.nextScreen=null,this.childScreens=[],this._animateOn=e}initialize(){this._animateOn&&(this.display.alpha=0,this.openCloseAlphaTween=new n(0,1,150,0)),this.track("Opened"),super.initialize()}exit(){for(;0<this.childScreens.length;)this.childScreens.pop().exit();super.exit()}removed(){this.track("Closed"),super.removed()}close(t,e){null!=t&&(this.nextScreen=t),void 0!==e&&(this.childScreens=e),this.openCloseAlphaTween=new n(this.display.alpha,0,Math.max(1,150*+this.display.alpha),0),this.closeTweening=!0,this.inputEnabled=!1,this.closing(),this.onClosing.invoke(this)}closing(){}track(t,e,i){bi.track(this.name,t,e,i)}settingsClicked(){this.track("Settings Button Pressed"),this.screenManager.add(new o._instance._settingsScreenClass)}homeClicked(){this.track("Home Button Pressed"),this.close()}closeClicked(){this.track("Close Button Pressed"),this.close()}notificationsClicked(){this.track("Notifications Button Pressed")}update(t){this.openCloseAlphaTween&&(this.display.alpha=this.openCloseAlphaTween.update(t),this.openCloseAlphaTween.isFinished)&&(this.openCloseAlphaTween=null,this.closeTweening)&&(this.nextScreen&&this.screenManager.add(this.nextScreen),this.nextScreen=null,this.exit()),super.update(t)}}class oi extends ai{constructor(t=!0,e="Daily Challenge Screen"){super(e),this.toDailyChallenge=!1,this.isPopup=!0,this.autoHideHome=t}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this),this.panel=this.createPanel(),this.display.addChild(this.panel),this.panel.notTodayButton.input.onPointerClick.add(this.notTodayButton_onClick,this),this.panel.playNowButton.input.onPointerClick.add(this.playNowButton_onClick,this),this.panel.doneButton.input.onPointerClick.add(this.doneButton_onClick,this),D.onUpdated.add(this.DailyChallenge_onUpdated,this),D.sync(),super.initialize()}createPanel(){return new Ze(this)}gainFocus(t=!0){t&&o._instance.navBar.home.show(),o._instance.navBar.settings.show(),super.gainFocus()}removed(){D.onUpdated.contains(this.DailyChallenge_onUpdated,this)&&D.onUpdated.remove(this.DailyChallenge_onUpdated,this),super.removed()}close(){!this.toDailyChallenge&&this.autoHideHome&&o._instance.navBar.home.hide(),super.close()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}notTodayButton_onClick(){this.track("Not Today Button Pressed"),this.close()}playNowButton_onClick(){this.track("Play Now Button Pressed"),this.toDailyChallenge=!0,D.start(),this.close()}doneButton_onClick(){this.track("Done Button Pressed"),this.close()}DailyChallenge_onUpdated(){D.onUpdated.remove(this.DailyChallenge_onUpdated,this),this.panel.populate()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}update(t){this.panel.update(t),super.update(t)}}class ri extends ni{constructor(t="Settings Screen",e="Settings"){super(t,e)}}class hi extends ai{constructor(t,e){void 0===e?(vt.warn("StandardTitleScreen(animateOn:boolean, name?:string)","StandardTitleScreen(animateOn:boolean, opts:StandardTitleScreenInitOpts)"),super("Title Screen",t),this._initOpts={name:"Title Screen",layout:1}):"string"==typeof e?(vt.warn("StandardTitleScreen(animateOn:boolean, name?:string)","StandardTitleScreen(animateOn:boolean, opts:StandardTitleScreenInitOpts)"),super(e,t),this._initOpts={name:e,layout:1}):(e=e,"string"!=typeof e.name&&(e.name="Title Screen"),super(e.name,t),this._initOpts=e,1===this._initOpts.layout&&vt.warn("StandardTitleScreenLayoutVersion.V1","StandardTitleScreenLayoutVersion.V2 or greater")),this.content=this.titleBitmap=this.playButton=this.moreGamesButton=this.dailyChallengeButton=this._resumeGameScreen=this._resumeOpenForNumPlayers=this._playOnlineGameScreen=this._dailyChallengeScreen=null}initialize(){if(this.content=new B,this.display.addChild(this.content),1===this._initOpts.layout)this.titleBitmap=new F(S.images["@theme/intro"]),this.titleBitmap.regX=this.titleBitmap.width/2,this.content.addChild(this.titleBitmap),this.playButton=this.createPlayButton(),this.content.addChild(this.playButton),this.playButton.input.onPointerClick.add(this.playButton_onClick,this),this.moreGamesButton=new ve,this.moreGamesButton.clickSound=null,this.content.addChild(this.moreGamesButton),this.moreGamesButton.input.onPointerClick.add(this.moreGamesButton_onClick,this),o._instance.usesDailyChallenge&&(this.dailyChallengeButton=this.createDailyChallengeButton(),this.content.addChild(this.dailyChallengeButton),this.dailyChallengeButton.input.onPointerClick.add(this.dailyChallengeButton_onClick,this),D.sync()),"GameBundle"===c.embed.type&&(this.moreGamesButton.visible=!1);else{if(2!==this._initOpts.layout)throw new Error("Unknown layout version");this.titleBitmap=new F(S.images["@theme/intro"]),this.titleBitmap.regX=this.titleBitmap.width/2,this.content.addChild(this.titleBitmap),this.playButton=this.createPlayButton(),this.content.addChild(this.playButton),this.playButton.input.onPointerClick.add(this.playButton_onClick,this),this.playButton.regX=this.playButton.w/2,this.onlinePlayButton=this.createPlayOnlineButton(),this.content.addChild(this.onlinePlayButton),this.onlinePlayButton.input.onPointerClick.add(this.onlinePlayButton_onClick,this),this.onlinePlayButton.regX=this.onlinePlayButton.w/2,this.passAndPlayButton=this.createPassAndPlayButton(),this.content.addChild(this.passAndPlayButton),this.passAndPlayButton.input.onPointerClick.add(this.passAndPlayButton_onClick,this),this.passAndPlayButton.regX=this.passAndPlayButton.w/2,"GameBundle"===c.embed.type&&(this.onlinePlayButton.visible=!1),o._instance.usesDailyChallenge&&D.sync()}this._animateOn||(o._instance.navBar.home.hide(!1),o._instance.navBar.settings.show(!1)),super.initialize()}createPlayButton(){return this._initOpts.layout,new fe}createPassAndPlayButton(){return new we}createPlayOnlineButton(){return new be}createDailyChallengeButton(){return new Ee}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.show(),super.gainFocus()}exit(){this._resumeGameScreen&&(this._resumeGameScreen.onClosing.contains(this.resumeGameScreen_onClosing,this)&&this._resumeGameScreen.onClosing.remove(this.resumeGameScreen_onClosing,this),this._resumeGameScreen.exit(),this._resumeGameScreen=null),this._playOnlineGameScreen&&(this._playOnlineGameScreen.onClosing.contains(this.playOnlineGameScreen_onClosing,this)&&this._playOnlineGameScreen.onClosing.remove(this.playOnlineGameScreen_onClosing,this),this._playOnlineGameScreen.exit(),this._playOnlineGameScreen=null),this._dailyChallengeScreen&&(this._dailyChallengeScreen.onClosing.contains(this.dailyChallengeScreen_onClosing,this)&&this._dailyChallengeScreen.onClosing.remove(this.dailyChallengeScreen_onClosing,this),this._dailyChallengeScreen.exit(),this._dailyChallengeScreen=null),super.exit()}createDailyChallenge(){return new oi}homeClicked(){}playButton_onClick(){this.track("Play Button Pressed"),1===this._initOpts.layout&&o._instance.usesMultiplayerGameModes?(this.nextScreen=this.createMultiplayerGameMode(),this.close()):this.hasInProgressGame(1)?(this._resumeOpenForNumPlayers=1,this._resumeGameScreen=this.createResumeGame(1),this._resumeGameScreen.onClosing.add(this.resumeGameScreen_onClosing,this),this.screenManager.add(this._resumeGameScreen)):(this.nextScreen=this.createLevelSelect(),this.close())}onlinePlayButton_onClick(){this.track("Play Online Button Pressed"),this._playOnlineGameScreen=this.createPlayOnline(),this._playOnlineGameScreen.onClosing.add(this.playOnlineGameScreen_onClosing,this),this.screenManager.add(this._playOnlineGameScreen)}passAndPlayButton_onClick(){this.track("Pass & Play Button Pressed"),this.hasInProgressGame(2)?(this._resumeOpenForNumPlayers=2,this._resumeGameScreen=this.createResumeGame(2),this._resumeGameScreen.onClosing.add(this.resumeGameScreen_onClosing,this),this.screenManager.add(this._resumeGameScreen)):(this.nextScreen=this.createPassAndPlayGame(),this.nextScreen&&this.close())}moreGamesButton_onClick(){this.track("More Games Button Pressed"),a.openLink(!1,k.config.moreGamesURL)}dailyChallengeButton_onClick(){this.track("Daily Challenge Button Pressed"),this._dailyChallengeScreen=this.createDailyChallenge(),this._dailyChallengeScreen.onClosing.add(this.dailyChallengeScreen_onClosing,this),this.screenManager.add(this._dailyChallengeScreen)}resumeGameScreen_onClosing(){this._resumeGameScreen.onClosing.remove(this.resumeGameScreen_onClosing,this),this._resumeGameScreen.toNewGame?(1===this._resumeOpenForNumPlayers?this.nextScreen=this.createLevelSelect():this.nextScreen=this.createPassAndPlayGame(),this.nextScreen&&this.close()):this._resumeGameScreen.toResumeGame?(this.nextScreen=this.createResumedGameplay(this._resumeOpenForNumPlayers),this.nextScreen&&this.close()):this._resumeGameScreen=null}playOnlineGameScreen_onClosing(){this._playOnlineGameScreen.onClosing.remove(this.playOnlineGameScreen_onClosing,this),this._playOnlineGameScreen.toPlayAnyone?(this.nextScreen=this.createPlayOnlineAnyone(),this.nextScreen&&this.close()):this._playOnlineGameScreen.toInviteFriend?(this.nextScreen=this.createPlayOnlineInviteFriend(),this.nextScreen&&this.close()):this._playOnlineGameScreen=null}dailyChallengeScreen_onClosing(){this._dailyChallengeScreen.onClosing.remove(this.dailyChallengeScreen_onClosing,this),this._dailyChallengeScreen.toDailyChallenge?(this.nextScreen=this.createDailyChallengeGameplay(),this.nextScreen&&this.close()):this._dailyChallengeScreen=null}anchor(){if(1===this._initOpts.layout){var e=P.width,i=P.height,e=(this.playButton.x=e/2-this.playButton.w-16,this.moreGamesButton.x=e/2+16,this.titleBitmap.x=e/2,this.dailyChallengeButton&&(this.dailyChallengeButton.x=P.width/2-this.dailyChallengeButton.w/2),e-40),e=Math.min(1,e/this.titleBitmap.width),e=(this.titleBitmap.scaleX=this.titleBitmap.scaleY=e,this.titleBitmap.height*e),e=50+e+this.playButton.h;this.titleBitmap.y=i/2-e/2,this.playButton.y=this.moreGamesButton.y=i/2+e/2-this.playButton.h,this.dailyChallengeButton&&(this.dailyChallengeButton.y=this.playButton.y+this.playButton.h+32),"GameBundle"===c.embed.type&&(this.playButton.x=P.width/2-this.playButton.w/2)}else{i=this.passAndPlayButton.h+32+this.onlinePlayButton.h+32+this.passAndPlayButton.h,e=new r(20,0,P.width-20-20,Math.min(+P.height-50-i-50,.58*P.height)),e=(this.titleBitmap.scaleX=this.titleBitmap.scaleY=Math.min(1,Math.min(e.width/this.titleBitmap.width,e.height/this.titleBitmap.height)),this.playButton.x=this.onlinePlayButton.x=this.passAndPlayButton.x=this.titleBitmap.x=e.x+e.width/2,this.titleBitmap.scaleY*this.titleBitmap.height+50+i);let t=(P.height-e)/2;25<t&&(t-=25),this.titleBitmap.y=t,this.playButton.y=this.titleBitmap.y+this.titleBitmap.scaleY*this.titleBitmap.height+50,this.onlinePlayButton.y=this.playButton.y+this.playButton.h+32,this.passAndPlayButton.y=this.onlinePlayButton.y+this.onlinePlayButton.h+32,"GameBundle"===c.embed.type&&(this.passAndPlayButton.y=this.onlinePlayButton.y,this.onlinePlayButton.visible=!1)}super.anchor()}}class li extends ai{constructor(t,e,i,s="Resume Game Screen"){super(s),this.toNewGame=!1,this.toResumeGame=!1,this._panelWidth=void 0,this._panelHeight=void 0,this.isPopup=!0,this.difficultyName=t,this.time=e,this._autoHideHome=i}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this),this.panel=new Ne(this.difficultyName,a.toTimerString(this.time,0),this._panelWidth,this._panelHeight),this.display.addChild(this.panel),this.panel.newGameButton.input.onPointerClick.add(this.newGameButton_onClick,this),this.panel.resumeButton.input.onPointerClick.add(this.resumeButton_onClick,this),super.initialize()}gainFocus(){o._instance.navBar.home.show(),o._instance.navBar.settings.show(),super.gainFocus()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}newGameButton_onClick(){this.track("New Game Button Pressed"),this.toNewGame=!0,this.close()}resumeButton_onClick(){this.track("Resume Button Pressed"),this.toResumeGame=!0,this.close()}backSoftKeyPressed(){this.close()}close(){this.toNewGame||this.toResumeGame||this._autoHideHome&&o._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}}class di extends ai{constructor(t,e,i="Level Select Screen"){super(i),this._dailyChallengeScreen=null,this.values=t,this._startingIndex=e}initialize(){this.carousel=new $e(this._startingIndex),this.display.addChild(this.carousel);for(var t of this.values){t=this.createItem(t),t=new We(t);this.carousel.addEntry(t)}this.carousel.initialize(),this.carousel.onIndexChange.add(this.carousel_onIndexChange,this),this.carousel.onItemClick.add(this.carousel_onItemClick,this),o._instance.usesDailyChallenge?(this.dailyChallengeButton=new Ee,this.display.addChild(this.dailyChallengeButton),this.dailyChallengeButton.input.onPointerClick.add(this.dailyChallengeButton_onClick,this),D.sync()):this.dailyChallengeButton=null,super.initialize()}gainFocus(){o._instance.navBar.home.show(),o._instance.navBar.settings.show(),super.gainFocus()}exit(){this._dailyChallengeScreen&&(this._dailyChallengeScreen.onClosing.contains(this.dailyChallengeScreen_onClosing,this)&&this._dailyChallengeScreen.onClosing.remove(this.dailyChallengeScreen_onClosing,this),this._dailyChallengeScreen.exit(),this._dailyChallengeScreen=null),super.exit()}createDailyChallenge(){return new oi(!1)}homeClicked(){this.track("Home Button Pressed"),o._instance.usesMultiplayerGameModes?this.nextScreen=this.createGameMode():(o._instance.navBar.home.hide(),this.nextScreen=this.createTitle()),this.close()}backSoftKeyPressed(){o._instance.usesMultiplayerGameModes?this.nextScreen=this.createGameMode():(o._instance.navBar.home.hide(),this.nextScreen=this.createTitle()),this.close()}dailyChallengeButton_onClick(){this.track("Daily Challenge Button Pressed"),this._dailyChallengeScreen=this.createDailyChallenge(),this._dailyChallengeScreen.onClosing.add(this.dailyChallengeScreen_onClosing,this),this.screenManager.add(this._dailyChallengeScreen)}carousel_onItemClick(t,e){this.nextScreen=this.createNewGame(e),this.close()}dailyChallengeScreen_onClosing(){this._dailyChallengeScreen.onClosing.remove(this.dailyChallengeScreen_onClosing,this),this._dailyChallengeScreen.toDailyChallenge?(this.nextScreen=this.createDailyChallengeGameplay(),this.close()):this._dailyChallengeScreen=null}anchor(){this.carousel.anchor(),this.dailyChallengeButton&&(this.dailyChallengeButton.x=P.width/2-this.dailyChallengeButton.w/2,this.dailyChallengeButton.y=this.carousel.entries[0].y+this.carousel.entries[0].item.h/2+32),super.anchor()}update(t){this.carousel.update(t),super.update(t)}}class ci extends ai{constructor(t,e,i="Pause Game Screen"){super(i),this._panelWidth=void 0,this._panelHeight=void 0,this.difficultyName=t,this.time=e}initialize(){this.panel=new Ge(this.difficultyName,a.toTimerString(this.time,0),this._panelWidth,this._panelHeight),this.display.addChild(this.panel),this.panel.resumeButton.input.onPointerClick.add(this.resumeButton_onClick,this),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),super.gainFocus()}resumeButton_onClick(){this.track("Resume Button Pressed"),this.close()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}}class ui extends ai{constructor(t="View Board Screen"){super(t),this.isPopup=!0,this.hitCatcher=new B,this.display.addChild(this.hitCatcher),this.hitCatcher.input=new C(this.hitCatcher,!0,!1,new r),this.hitCatcher.cursor="pointer",this.hitCatcher.input.onPointerClick.add(this.hitCatcher_onClick,this)}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.show(),o._instance.navBar.close.show(),super.gainFocus()}close(){o._instance.navBar.close.hide(),super.close(),this.exit()}loseFocus(){o._instance.navBar.close.hide(),super.loseFocus()}hitCatcher_onClick(){this.closeClicked()}anchor(){this.hitCatcher.input.hitArea.set(0,0,P.width,P.height),super.anchor()}}class pi extends ai{constructor(t,e,i="Daily Challenge Complete Screen"){super(i),this.onRankDetermined=new h,this.isPopup=!0,this.isWin=t,this.time=e}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.cursor="auto",this.panel=new ti(this.isWin,this.time,this),this.panel.onRankDetermined.add(t=>{this.onRankDetermined.invoke(this,t)},null),this.display.addChild(this.panel),this.panel.viewBoardButton.input.onPointerClick.add(this.viewBoardButton_onClick,this),this.panel.newGameButton.input.onPointerClick.add(this.newGameButton_onClick,this),D.onUpdated.add(this.DailyChallenge_onUpdated,this),D.isUpdating||this.DailyChallenge_onUpdated(),super.initialize()}DailyChallenge_onUpdated(){D.onUpdated.remove(this.DailyChallenge_onUpdated,this),this.panel.populate()}removed(){D.onUpdated.contains(this.DailyChallenge_onUpdated,this)&&D.onUpdated.remove(this.DailyChallenge_onUpdated,this),super.removed()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.show(),super.gainFocus()}viewBoardButton_onClick(){this.track("View Board Button Pressed");var t=new ui;t.onRemoved.add(this.viewBoardScreen_onRemoved,this),this.display.visible=!1,this.screenManager.add(t)}viewBoardScreen_onRemoved(t){t.onRemoved.remove(this.viewBoardScreen_onRemoved,this),this.display.visible=!0}newGameButton_onClick(){this.track("New Game Button Pressed"),this.close()}close(){o._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}update(t){this.panel.update(t),super.update(t)}}class gi extends ai{constructor(t,e,i,s,n,a="Replay",o=null,r="Win Screen"){super(r),this.toNewGame=!1,this.toReplay=!1,this.wPanel=void 0,this.hPanelUsesStars=void 0,this.hPanelNoStars=void 0,this.isPopup=!0,null===o&&(o=i?"New Record!":"Winner!"),this.title=o,this.difficultyName=t,this.time=e,this.isNewRecord=i,this.numStars=s,this.stingerSoundAsset=n,this._replayButtonText=a}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.cursor="auto",this.panel=new je(this.difficultyName,a.toTimerString(this.time,0),this.isNewRecord,this.numStars,this.title,this._replayButtonText,0<=this.numStars,this.wPanel,this.hPanelUsesStars,this.hPanelNoStars),this.display.addChild(this.panel),this.rateUsButton=new me(S.images.icon_rate_us,"Rate Us",480,90,1,1),this.rateUsButton.y=this.panel.newGameButton.y,this.rateUsButton.visible=!1,this.rateUsButton.clickSound=null,this.rateUsButton.x=this.panel.w/2-this.rateUsButton.w/2,this.rateUsButton.y=this.panel.newGameButton.y+this.panel.newGameButton.h+64,this.panel.content.addChild(this.rateUsButton),this.panel.viewBoardButton.input.onPointerClick.add(this.viewBoardButton_onClick,this),this.panel.newGameButton.input.onPointerClick.add(this.newGameButton_onClick,this),this.panel.replayButton.input.onPointerClick.add(this.replayButton_onClick,this),this.rateUsButton.input.onPointerClick.add(this.rateUsButton_onClick,this),this.stingerSoundAsset&&new x(this.stingerSoundAsset.data).play(),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.show(),super.gainFocus()}createViewBoard(){return new ui}viewBoardButton_onClick(){this.track("View Board Button Pressed");var t=this.createViewBoard();t.onRemoved.add(this.viewBoardScreen_onRemoved,this),this.display.visible=!1,this.screenManager.add(t)}viewBoardScreen_onRemoved(t){t.onRemoved.remove(this.viewBoardScreen_onRemoved,this),this.display.visible=!0}newGameButton_onClick(){this.track("New Game Button Pressed"),this.toNewGame=!0,this.close()}replayButton_onClick(){this.track("Replay Button Pressed"),this.toReplay=!0,this.close()}rateUsButton_onClick(){this.track("Rate Us Button Pressed"),a.openRating()}close(){o._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}}class mi extends ai{constructor(t,e,i,s="Replay",n=null,a="Lose Screen",o){super(a),this.toNewGame=!1,this.toReplay=!1,this.wPanel=1160,this.hPanel=450,this.isPopup=!0,null===n&&(n="Game Over"),this.title=n,this.caption=o,this.difficultyName=t,this.time=e,this.stingerSoundAsset=i,this._replayButtonText=s}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.cursor="auto",this.panel=new Ue(this.difficultyName,a.toTimerString(this.time,0),this.title,this._replayButtonText,this.wPanel,this.hPanel,this.caption),this.display.addChild(this.panel),this.panel.viewBoardButton.input.onPointerClick.add(this.viewBoardButton_onClick,this),this.panel.newGameButton.input.onPointerClick.add(this.newGameButton_onClick,this),this.panel.replayButton.input.onPointerClick.add(this.replayButton_onClick,this),this.stingerSoundAsset&&new x(this.stingerSoundAsset.data).play(),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.show(),super.gainFocus()}createViewBoard(){return new ui}viewBoardButton_onClick(){this.track("View Board Button Pressed");var t=this.createViewBoard();t.onRemoved.add(this.viewBoardScreen_onRemoved,this),this.display.visible=!1,this.screenManager.add(t)}viewBoardScreen_onRemoved(t){t.onRemoved.remove(this.viewBoardScreen_onRemoved,this),this.display.visible=!0}newGameButton_onClick(){this.track("New Game Button Pressed"),this.toNewGame=!0,this.close()}replayButton_onClick(){this.track("Replay Button Pressed"),this.toReplay=!0,this.close()}close(){o._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}}class yi extends ai{constructor(t,e="Play Online Screen"){super(e),this.toPlayAnyone=!1,this.toInviteFriend=!1,this._panelWidth=void 0,this._panelHeight=void 0,this.isPopup=!0,this._autoHideHome=t}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this),this.panel=new Ve,this._panelWidth=this.panel.w,this._panelHeight=this.panel.h,this.display.addChild(this.panel),this.panel.anyoneButton.input.onPointerClick.add(this.anyoneButton_onClick,this),this.panel.inviteButton.input.onPointerClick.add(this.inviteButton_onClick,this),super.initialize()}gainFocus(){o._instance.navBar.home.show(),o._instance.navBar.settings.show(),super.gainFocus()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}anyoneButton_onClick(){this.track("Play Anyone Button Pressed"),this.toPlayAnyone=!0,this.close()}inviteButton_onClick(){this.track("Invite Friend Button Pressed"),this.toInviteFriend=!0,this.close()}close(){this.toPlayAnyone||this.toInviteFriend||this._autoHideHome&&o._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}}const _i=u.isMainThread?window["247gamesdebug"]={enableSVGCaching(){Wt.enabled=!0,P._dirty=!0},disableSVGCaching(){Wt.enabled=!1,P._dirty=!0},isSVGCachingEnabled(){return Wt.enabled},dumpScreens(){console.log(o._instance.screenManager.toString())},showBitmapOutlines:!1,renderEnabled:!0}:null;const fi=u.isMainThread?new class{constructor(){this.onAdClosed=new h,this.isShowingAd=!1,this.adHolder=null,this.skipBtn=null,this._adBreak=null,this.skipBtn_click=this.skipBtn_click.bind(this),window.games247&&window.games247.ads?window.games247.ads.createAdBreak?this.enabled=!0:(this.mobileEnabled="true"===document.getElementById("site-script").getAttribute("data-interstitial-enabled-mobile"),this.mobileUnit=document.getElementById("site-script").getAttribute("data-interstitial-unit-mobile"),this.mobileBaseId=this.mobileUnit+"_",this.desktopEnabled="true"===document.getElementById("site-script").getAttribute("data-interstitial-enabled-desktop"),this.desktopUnit=document.getElementById("site-script").getAttribute("data-interstitial-unit-desktop"),this.desktopBaseId=this.desktopUnit+"_","AndroidAuto"===c.embed.type&&(this.mobileEnabled=this.desktopEnabled=!1),tt.isMobileDevice?(this.enabled=this.mobileEnabled,this.baseId=this.mobileBaseId,this.unit=this.mobileUnit):(this.enabled=this.desktopEnabled,this.baseId=this.desktopBaseId,this.unit=this.desktopUnit)):this.enabled=!1}adsBlocked(){return 1!==window.games247pbjs}showAd(){window.games247.ads.createAdBreak?this.showAdBreak():this.showAdOld()}showAdStack(){window.games247.ads.createAdBreak?this.showAdBreak():this.showAdStackOld()}showAdBreak(){console.log("InterstitialAds.showAdBreak"),this._adBreak=window.games247.ads.createAdBreak(),this._adBreak.onStart.add(this.adBreak_onStart,this),this._adBreak.onEnd.add(this.adBreak_onEnd,this),this._adBreak.start()}showAdOld(){if(!this.isShowingAd)if(this.isShowingAd=!0,this.adsBlocked())this.isShowingAd=!1,this.onAdClosed.invoke(!0);else{var t=document.createElement("div"),n=(t.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000000;",this.adHolder=t,document.createElement("div")),a=(n.style.cssText="display: inline-block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);",this.baseId+Math.floor(1e5*Math.random()));n.id=a,t.appendChild(n);let e=document.createElement("div"),i=(e.style.cssText=`
	color: #FFFFFF;
	background: rgba(0,0,0,0.15);
	display: inline-block;
	font-family: sans-serif;
	font-weight: normal;
	font-size: 18px;
	padding: 12px 36px;
	border: solid 1px rgba(255,255,255,0.3);
	border-right-width: 0;
	position: absolute;
	bottom: 20px;
	right: 0;
	font-weight: 500;
	cursor: pointer;
	-webkit-user-select: none;
	-ms-user-select: none;
	user-select: none;
	`,e.innerHTML=`
	Close Ad
	`,d.add(e,"click",this.skipBtn_click,!0,!0),d.add(e,"touchend",this.skipBtn_click,!0,!0),d.add(e,"touchstart",this.skipBtn_click,!0,!0),t.appendChild(e),this.skipBtn=e,e.style.pointerEvents="none",5),s=(e.innerHTML=i+"",e.style.opacity="0.65",null);s=setTimeout(function t(){s=null,i--,0===i?(e.style.opacity="1",e.innerHTML="Close Ad",e.style.pointerEvents="auto"):(e.innerHTML=i+"",s=setTimeout(t,1e3))},1e3),document.getElementById("app-player").appendChild(t);try{window.games247.ads.loadBanner300x250(a,2e3,function(){})}catch(t){null!==s&&(clearTimeout(s),s=null,this.skipBtn_click())}}}showAdStackOld(){if(!this.isShowingAd)if(this.isShowingAd=!0,this.adsBlocked())this.isShowingAd=!1,this.onAdClosed.invoke(!0);else{var t=document.createElement("div"),n=(t.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000000;",t.classList.add("asc-interstitial-stack"),this.adHolder=t,document.createElement("div")),a=(n.classList.add("asc-interstitial-stack-list"),t.appendChild(n),document.createElement("div")),o=(a.classList.add("asc-interstitial-stack-item"),n.appendChild(a),document.createElement("div")),n=(o.classList.add("asc-interstitial-stack-item"),n.appendChild(o),document.createElement("div")),r=this.baseId+Math.floor(1e5*Math.random()),a=(n.id=r,a.appendChild(n),document.createElement("div")),n=this.baseId+Math.floor(1e5*Math.random());a.id=n,o.appendChild(a);let e=document.createElement("div"),i=(e.style.cssText=`
	color: #FFFFFF;
	background: rgba(0,0,0,0.15);
	display: inline-block;
	font-family: sans-serif;
	font-weight: normal;
	font-size: 18px;
	padding: 12px 36px;
	border: solid 1px rgba(255,255,255,0.3);
	border-right-width: 0;
	position: absolute;
	bottom: 20px;
	right: 0;
	font-weight: 500;
	cursor: pointer;
	-webkit-user-select: none;
	-ms-user-select: none;
	user-select: none;
	`,e.innerHTML=`
	Close Ad
	`,d.add(e,"click",this.skipBtn_click,!0,!0),d.add(e,"touchend",this.skipBtn_click,!0,!0),d.add(e,"touchstart",this.skipBtn_click,!0,!0),t.appendChild(e),this.skipBtn=e,e.style.pointerEvents="none",5),s=(e.innerHTML=i+"",e.style.opacity="0.65",null);s=setTimeout(function t(){s=null,i--,0===i?(e.style.opacity="1",e.innerHTML="Close Ad",e.style.pointerEvents="auto"):(e.innerHTML=i+"",s=setTimeout(t,1e3))},1e3),document.getElementById("app-player").appendChild(t);try{window.games247.ads.loadBanner300x250Stack(r,n,2e3,function(){})}catch(t){null!==s&&(clearTimeout(s),s=null,this.skipBtn_click())}}}skipBtn_click(){d.remove(this.skipBtn,"click",this.skipBtn_click),d.remove(this.skipBtn,"touchend",this.skipBtn_click),d.remove(this.skipBtn,"touchstart",this.skipBtn_click),this.isShowingAd=!1,this.adHolder&&(this.adHolder.parentElement.removeChild(this.adHolder),this.adHolder=null,this.onAdClosed.invoke(!1)),_t.reset()}adBreak_onStart(t){console.log("InterstitialAds.adBreak_onStart")}adBreak_onEnd(t){console.log("InterstitialAds.adBreak_onEnd"),this._adBreak.onStart.remove(this.adBreak_onStart,this),this._adBreak.onEnd.remove(this.adBreak_onEnd,this),this._adBreak=null,_t.reset(),this.onAdClosed.invoke(!1)}}:null;class wi extends de{constructor(t){super("Interstitial"),this.useAdStack=!1,this.isPopup=!0,this._nextScreen=t}initialize(){super.initialize(),this.markPlacementOpportunity(),fi.enabled&&this.shouldShowAd()?this.showAd():this.close()}showAd(){fi.onAdClosed.add(this.InterstitialAds_onAdClosed,this),this.useAdStack?fi.showAdStack():fi.showAd()}close(){this._nextScreen&&this.screenManager.add(this._nextScreen),this._nextScreen=null,this.exit()}InterstitialAds_onAdClosed(t){fi.onAdClosed.remove(this.InterstitialAds_onAdClosed,this),this.close()}}class vi{constructor(){this.gtag=window.gtag,this.debug=!0;var t=location.href;"GameBundle"===c.embed.type?(this.enabled=!1,this.debug=!1,l.info("Google Analytics disabled in GameBundle (capacitor) builds.")):"AndroidAuto"===c.embed.type?(this.enabled=!1,this.debug=!1,l.info("Google Analytics disabled in android auto builds.")):0<=t.indexOf("file://")&&"StandaloneExe"!==c.embed.type||0<=t.indexOf("127.0.0.1")||0<=t.indexOf("192.168.1.")||0<=t.indexOf("localhost")||0<=t.indexOf("nautgames.com")||0<=t.indexOf("spencer-evans.com")||0<=t.indexOf("247gamesdev.com")||0<=t.indexOf("247game.dev")?(this.enabled=!1,l.info("Google Analytics is disabled because the game is running on a test server.")):this.gtag?this.enabled=!0:(this.enabled=!1,l.info("Google Analytics is disabled because gtag could not be found."))}track(t,e,i,s){let n;this.debug&&(n=void 0!==s?t+" --\x3e "+e+(i?" :: "+i+" = "+s:""):t+" --\x3e "+e+(i?" :: "+i:""));try{var a;this.debug&&this.enabled,this.enabled&&(a={},a.event_category=t,void 0!==i&&(a.event_label=i),void 0!==s&&(a.value=s),this.gtag("event",e,a))}catch(t){this.debug&&l.info("GA Failed Event: "+n)}}}const bi=u.isMainThread?new class{constructor(){this.googleAnalytics=new vi}track(t,e,i,s){this.googleAnalytics.track(t,e,i,s)}}:null;class xi{constructor(){this.state=0}}class Si{constructor(t){this.type=t}static define(t,e){if(this.roomControllerMap[t])throw new Error("Type already defined!");this.roomControllerMap[t]=e}}Si.roomIdLength=5,Si.roomIdLetters="ABCDEFGHKLMNPRSTUVWXYZ",Si.roomControllerMap={};class ki extends Si{constructor(t){if(super(0),this.rooms={},this._roomIdGenerator=0,this._sessionIdGenerator=0,this.endpoint=t,ki.endpoints[t])throw new Error("Already exists!");ki.endpoints[t]=this}static reconnect(t,e,i){var s=ki.endpoints[t.clientDriver.client.endpoint];s?t.serverResponse_connectFailure("Reconnect not implemented"):t.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+t.clientDriver.client.endpoint)}static joinById(t,e,i){var s,n,a,o=ki.endpoints[t.clientDriver.client.endpoint];o?(s=o.rooms[e],s?(n=new Ci(t,s,"session_"+ ++o._sessionIdGenerator),a=s.onAuth(n,i,null),a?(t.id=e,t.sessionId=n.sessionId,t.name=s.type,s.clients.push(n),t.serverResponse_connectSuccess(),s.onJoin(n,i,null)):(t.serverResponse_connectFailure("Failed room authorization"),o.cleanUpRoom(s))):t.serverResponse_connectFailure("Could not locate LocalGameServer room with id: "+e)):t.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+t.clientDriver.client.endpoint)}static create(t,e,i){var s=ki.endpoints[t.clientDriver.client.endpoint];s?(e=new Ti(s,"room_"+ ++s._roomIdGenerator,e),s.rooms[e.id]=e,e.onCreate(i),this.joinById(t,e.id,i)):t.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+t.clientDriver.client.endpoint)}static join(t,e,i){var s=ki.endpoints[t.clientDriver.client.endpoint];if(s){var n,a=s.rooms;for(n in a){var o=a[n];if(o.type===e&&o.clients.length<o.maxClients&&!o.locked)return void this.joinById(t,o.id,i)}t.serverResponse_connectFailure("No available rooms")}else t.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+t.clientDriver.client.endpoint)}static joinOrCreate(t,e,i){var s=ki.endpoints[t.clientDriver.client.endpoint];if(s){var n,a=s.rooms;for(n in a){var o=a[n];if(o.type===e&&o.clients.length<o.maxClients&&!o.locked)return void this.joinById(t,o.id,i)}this.create(t,e,i)}else t.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+t.clientDriver.client.endpoint)}cleanUpRoom(t){0===t.clients.length&&delete this.rooms[t.id]}}ki.endpoints={};class Ci{constructor(t,e,i){this._roomDriver=t,this.sessionId=i,this._serverRoom=e,this._roomDriver.serverClient=this}leave(t,e){this._serverRoom.onLeave(this,!1);let i=this;function s(){i._roomDriver.receive_leave(t)}0<=i._roomDriver.clientDriver.client.latency?setTimeout(s,i._roomDriver.clientDriver.client.latency/2):s()}send(t,e){let i=this;function s(){i._roomDriver.receive_message(t,JSON.parse(JSON.stringify(e)))}0<=i._roomDriver.clientDriver.client.latency?setTimeout(s,i._roomDriver.clientDriver.client.latency/2):s()}error(t,e){let i=this;function s(){i._roomDriver.receive_error(t,e)}0<=i._roomDriver.clientDriver.client.latency?setTimeout(s,i._roomDriver.clientDriver.client.latency/2):s()}receive_leave(){this._serverRoom.onLeave(this,!0);let t=this;function e(){t._roomDriver.receive_leave(1e3)}0<=t._roomDriver.clientDriver.client.latency?setTimeout(e,t._roomDriver.clientDriver.client.latency/2):e()}receive_message(t,e){this._serverRoom.onMessage(this,t,e)}}class Ti{get locked(){return this.clients.length>=this.maxClients||this._manuallyLocked}constructor(t,e,i){this.clients=[],this.maxClients=Infinity,this._manuallyLocked=!1,this.__FLAG_IS_LOCAL_GAME_SERVER_ROOM=!0,this.server=t,this.id=e,this.type=i,this.controller=new Si.roomControllerMap[i](this)}onCreate(t){this.controller.onCreate(t)}onAuth(t,e,i){return this.controller.onAuth(t,e,i)}onJoin(t,e,i){this.controller.onJoin(t,e,i)}onLeave(t,e){this.clients.splice(this.clients.indexOf(t),1),this.controller.onLeave(t,e),this.server.cleanUpRoom(this)}onMessage(t,e,i){this.controller.onMessage(t,e,i)}broadcast(t,e,i){var s,n=this.clients.slice(0);for(s of n)i&&i.except===s||s.send(t,e)}disconnect(){for(;0<this.clients.length;)this.clients[0].leave(1001,"Game room disconnected");this.server.cleanUpRoom(this)}lock(){this._manuallyLocked=!0}unlock(){this._manuallyLocked=!1}}class Fi{constructor(t,e){this.serverType=t,this.endpoint=e}newRoom(){return new(0===this.serverType?Ai:Ii)(this)}reconnect(t,e,i){var s=this.newRoom();return s.type=t,s.id=e,s.sessionId=i,s.connectAction=4,s}joinById(t,e,i){var s=this.newRoom();return s.type=t,s.id=e,s.createJoinOptions=i,s.connectAction=3,s}join(t,e){var i=this.newRoom();return i.type=t,i.createJoinOptions=e,i.connectAction=0,i}create(t,e){var i=this.newRoom();return i.type=t,i.createJoinOptions=e,i.connectAction=1,i}joinOrCreate(t,e){var i=this.newRoom();return i.type=t,i.createJoinOptions=e,i.connectAction=2,i}}class Bi{constructor(t){this.client=t}reconnect(t,e,i,s){var n=new Ri(this);n.reconnect(t,e,i,s)}joinById(t,e,i,s){var n=new Ri(this);n.joinById(t,e,i,s)}create(t,e,i,s){var n=new Ri(this);n.create(t,e,i,s)}join(t,e,i,s){var n=new Ri(this);n.join(t,e,i,s)}joinOrCreate(t,e,i,s){var n=new Ri(this);n.joinOrCreate(t,e,i,s)}}class Pi extends Fi{constructor(t,e=-1){super(0,t),this.clientDriver=new Bi(this),this.latency=e}}class Di extends Fi{constructor(t){super(1,"wss://"+t),this.colyseusClient=new O.Client(this.endpoint)}}class Ei{constructor(t){this.onConnecting=new h,this.onConnected=new h,this.onConnectFailed=new h,this.onDisconnected=new h,this.onError=new h,this.onMessage=new h,this.type=null,this.id=null,this.sessionId=null,this.connectAction=null,this.createJoinOptions=void 0,this.connection=new xi,this.client=t}assertCanConnect(){if(1===this.connection.state)throw new Error("Already connecting!");if(2===this.connection.state)throw new Error("Already connected!")}assertCanDisconnect(){if(0===this.connection.state)throw new Error("Already disconnected!")}assertConnected(){if(2!==this.connection.state)throw new Error("Not connected!")}setState(t){var e;this.connection.state!==t&&(e=this.connection.state,this.connection.state=t,1===t?this.onConnecting.invoke(this):2===t?this.onConnected.invoke(this):0===t&&(1===e?this.onConnectFailed:this.onDisconnected).invoke(this))}}class Ri{constructor(t){this.onError=new h,this.onLeave=new h,this.onMessage=new h,this._connectSuccessCallback=null,this._connectFailureCallback=null,this.id=null,this.name=null,this.sessionId=null,this.serverClient=null,this.clientDriver=t}reconnect(t,e,i,s){let n=this;function a(){ki.reconnect(n,t,e)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(a,this.clientDriver.client.latency/2):a()}joinById(t,e,i,s){let n=this;function a(){ki.joinById(n,t,e)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(a,this.clientDriver.client.latency/2):a()}create(t,e,i,s){let n=this;function a(){ki.create(n,t,e)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(a,this.clientDriver.client.latency/2):a()}join(t,e,i,s){let n=this;function a(){ki.join(n,t,e)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(a,this.clientDriver.client.latency/2):a()}joinOrCreate(t,e,i,s){let n=this;function a(){ki.joinOrCreate(n,t,e)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(a,this.clientDriver.client.latency/2):a()}serverResponse_connectFailure(t){let e=this;function i(){e._connectFailureCallback(t)}0<=this.clientDriver.client.latency?setTimeout(i,this.clientDriver.client.latency/2):i()}serverResponse_connectSuccess(){let t=this;function e(){t._connectSuccessCallback(t)}0<=this.clientDriver.client.latency?setTimeout(e,this.clientDriver.client.latency/2):e()}leave(){let t=this;ki.endpoints[this.clientDriver.client.endpoint];function e(){t.serverClient.receive_leave()}0<=this.clientDriver.client.latency?setTimeout(e,this.clientDriver.client.latency/2):e()}send(t,e){let i=this;var s=ki.endpoints[this.clientDriver.client.endpoint];s.rooms[this.id];function n(){i.serverClient.receive_message(t,JSON.parse(JSON.stringify(e)))}0<=this.clientDriver.client.latency?setTimeout(n,this.clientDriver.client.latency/2):n()}receive_leave(t){this.onLeave.invoke(t)}receive_error(t,e){this.onError.invoke(t,e)}receive_message(t,e){this.onMessage.invoke(t,e)}}class Ai extends Ei{constructor(t){super(t),this._connectPromise=!1,this.roomDriver=null,this.connect_success=this.connect_success.bind(this),this.connect_failure=this.connect_failure.bind(this)}connect(){var t;this.assertCanConnect(),this._connectPromise||(t=this.client.clientDriver,this.setState(1),this._connectPromise=!0,4===this.connectAction?t.reconnect(this.id,this.sessionId,this.connect_success,this.connect_failure):3===this.connectAction?t.joinById(this.id,this.createJoinOptions,this.connect_success,this.connect_failure):1===this.connectAction?t.create(this.type,this.createJoinOptions,this.connect_success,this.connect_failure):0===this.connectAction?t.join(this.type,this.createJoinOptions,this.connect_success,this.connect_failure):2===this.connectAction&&t.joinOrCreate(this.type,this.createJoinOptions,this.connect_success,this.connect_failure))}connect_success(t){this._connectPromise=!1,1===this.connection.state?t.name!==this.type?(t.leave(),this.connect_failure("Incorrect room type")):(this.roomDriver=t,4===this.connectAction?this.type=this.roomDriver.name:(3===this.connectAction?this.type=this.roomDriver.name:this.id=this.roomDriver.id,this.sessionId=this.roomDriver.sessionId),this.connectAction=4,this.roomDriver.onError.add(this.roomDriver_onError,this),this.roomDriver.onLeave.add(this.roomDriver_onLeave,this),this.roomDriver.onMessage.add(this.roomDriver_onMessage,this),this.setState(2)):t.leave()}connect_failure(t){this._connectPromise=!1,l.info("Failed to connect to local game room:",t),this.setState(0)}disconnect(){this.assertCanDisconnect(),this._connectPromise||(this.roomDriver.onError.remove(this.roomDriver_onError,this),this.roomDriver.onLeave.remove(this.roomDriver_onLeave,this),this.roomDriver.onMessage.remove(this.roomDriver_onMessage,this),this.roomDriver.leave(),this.roomDriver=null),this.setState(0)}send(t,e){this.assertConnected(),this.roomDriver.send(t,e)}roomDriver_onError(t,e){this.onError.invoke(this,t,e)}roomDriver_onLeave(t){1e3!==t?l.info("Left local game room with abnormal close code: "+t):l.info("Unexpectedly left local game room with normal close code: "+t),this._connectPromise=!1,this.roomDriver&&(this.roomDriver.onError.remove(this.roomDriver_onError,this),this.roomDriver.onLeave.remove(this.roomDriver_onLeave,this),this.roomDriver.onMessage.remove(this.roomDriver_onMessage,this),this.roomDriver=null),this.setState(0)}roomDriver_onMessage(t,e){this.onMessage.invoke(this,t,e)}}class Ii extends Ei{constructor(t){super(t),this._connectPromise=null,this.colyseusRoom=null,this.connect_success=this.connect_success.bind(this),this.connect_failure=this.connect_failure.bind(this),this.colyseusRoom_onError=this.colyseusRoom_onError.bind(this),this.colyseusRoom_onLeave=this.colyseusRoom_onLeave.bind(this),this.colyseusRoom_onMessage=this.colyseusRoom_onMessage.bind(this)}connect(){var t;this.assertCanConnect(),this._connectPromise||(t=this.client.colyseusClient,4===this.connectAction?this._connectPromise=t.reconnect(this.id,this.sessionId):3===this.connectAction?this._connectPromise=t.joinById(this.id,this.createJoinOptions):1===this.connectAction?this._connectPromise=t.create(this.type,this.createJoinOptions):0===this.connectAction?this._connectPromise=t.join(this.type,this.createJoinOptions):2===this.connectAction&&(this._connectPromise=t.joinOrCreate(this.type,this.createJoinOptions)),this._connectPromise.then(this.connect_success,this.connect_failure).catch(this.connect_failure)),this.setState(1)}connect_success(t){this._connectPromise=null,1===this.connection.state?t.name!==this.type?(t.leave(!0),this.connect_failure("Incorrect room type")):(this.colyseusRoom=t,4===this.connectAction?this.type=this.colyseusRoom.name:(3===this.connectAction?this.type=this.colyseusRoom.name:this.id=t.id,this.sessionId=t.sessionId),this.connectAction=4,this.colyseusRoom.onError(this.colyseusRoom_onError),this.colyseusRoom.onLeave(this.colyseusRoom_onLeave),this.colyseusRoom.onMessage("*",this.colyseusRoom_onMessage),this.setState(2)):t.leave(!0)}connect_failure(t){this._connectPromise=null,l.info("Failed to connect to remote game room:",t),this.setState(0)}disconnect(){this.assertCanDisconnect(),this._connectPromise||(this.colyseusRoom.onError.remove(this.colyseusRoom_onError),this.colyseusRoom.onLeave.remove(this.colyseusRoom_onLeave),this.colyseusRoom.removeAllListeners(),this.colyseusRoom.leave(!0),this.colyseusRoom=null),this.setState(0)}send(t,e){this.assertConnected(),this.colyseusRoom.send(t,e)}colyseusRoom_onError(t,e){this.onError.invoke(this,t,e)}colyseusRoom_onLeave(t){1e3!==t?l.info("Left remove game room with abnormal close code: "+t):l.info("Unexpectedly left remote game room with normal close code: "+t),this._connectPromise=null,this.colyseusRoom&&(this.colyseusRoom.onError.remove(this.colyseusRoom_onError),this.colyseusRoom.onLeave.remove(this.colyseusRoom_onLeave),this.colyseusRoom.removeAllListeners(),this.colyseusRoom=null),this.setState(0)}colyseusRoom_onMessage(t,e){this.onMessage.invoke(this,t,e)}}var Mi,i,s,R,Oi,Li;(()=>{const i=new h;let s=!1,n={isSupported:!1,token:null},a=!1;function t(){if(s)throw new Error("Already initialized");a||(a=!0,console.log("NotificationManager initializing..."),c.script.onGameRequestPushToken?(console.log("   NotificationManager calling onGameRequestPushToken"),c.script.onGameRequestPushToken((t,e)=>{console.log("   NotificationManager onGameRequestPushToken callback",t,e),t&&(n.isSupported=!0,n.token="string"==typeof e?e:null),a=!1,s=!0,i.invoke()})):(console.log("   NotificationManager could not initialize, no onGameRequestPushToken method found"),a=!1,s=!0,i.invoke()))}function e(t){if(console.log(">>>>>>>>>>>> TRACK","remove"),!s)throw new Error("Not initialized");console.log("NotificationManager.remove",JSON.stringify(t)),n.isSupported?(console.log("   NotificationManager calling onGameRequestRemoveNotifications"),c.script.onGameRequestRemoveNotifications(t)):console.log("    not supported, ignoring")}function o(e){if(console.log(">>>>>>>>>>>> TRACK","getDelivered"),!s)throw new Error("Not initialized");console.log("NotificationManager.getDeliveredNotifications"),n.isSupported?(console.log("   NotificationManager calling onGameRequestDeliveredNotifications"),c.script.onGameRequestDeliveredNotifications(t=>{console.log("   NotificationManager onGameRequestDeliveredNotifications callback",JSON.stringify(t)),e(t)})):(console.log("    not supported, returning empty"),e({notifications:[]}))}var r={get onInitialized(){return i},get isInitialized(){return s},get push(){return n},get initialize(){return t},get remove(){return e},get getDelivered(){return o}}})();ce.game={cueBall:"#E2E2E2",ball1:"#FFCC00",ball2:"#0033CC",ball3:"#CC0000",ball4:"#660099",ball5:"#FF6600",ball6:"#006633",ball7:"#730000",ball8:"#333333",ball9:"#FFCC00",ball10:"#0033CC",ball11:"#CC0000",ball12:"#660099",ball13:"#FF6600",ball14:"#006633",ball15:"#730000",stripesBaseColor:"#FFFFFF",numberCircleColor:"#FFFFFF",numberColor:"#000000",pullMeter0Pct:"#00FF00",pullMeter50Pct:"#FFFD00",pullMeter100Pct:"#FF0000",cueBallHitPoint:"#CD0303"},ce._themes[247]={},ce._themes["4th-of-july"]={},ce._themes.christmas={},ce._themes["cinco-de-mayo"]={},ce._themes.easter={},ce._themes.fall={},ce._themes.halloween={},ce._themes["new-years"]={},ce._themes.spring={},ce._themes["st-patricks"]={},ce._themes.summer={},ce._themes.thanksgiving={},ce._themes.valentines={},ce._themes.winter={};const Hi={production:{envName:"Production",host:"room.247pool.com:50002",allowedDomains:["247pool.com"]},staging:{envName:"Staging",host:"room.247pool.com:50003",allowedDomains:["staging.247pool.com"]},development:{envName:"Development",host:"247games.local:50002",allowedDomains:["247games.local:8080","127.0.0.1:8080","localhost:8080","247games.local:8081","127.0.0.1:8081","localhost:8081","247games.local:8082","127.0.0.1:8082","localhost:8082","247games.local:8083","127.0.0.1:8083","localhost:8083","247games.local:8084","127.0.0.1:8084","localhost:8084","247games.local:8085","127.0.0.1:8085","localhost:8085","247games.local:8086","127.0.0.1:8086","localhost:8086","247games.local:8087","127.0.0.1:8087","localhost:8087","247games.local:8088","127.0.0.1:8088","localhost:8088","247games.local:8089","127.0.0.1:8089","localhost:8089"]}},zi=(u.isMainThread&&(s=document.getElementById("game-script"),Mi=s.getAttribute("data-theme"),i=S.images,I=S.sounds,Oi=S.fonts,s=s.getAttribute("data-basepath")+"game/",Oi["RobotoMono-SemiBold"]=new Ht(s+"fonts/RobotoMono-SemiBold",2146,-555,2048,14400,8124),Oi["OpenSans-ExtraBold"]=new Ht(s+"fonts/OpenSans-ExtraBold",2189,-600,2048,11048,6036),Oi["OpenSans-Bold"]=new Ht(s+"fonts/OpenSans-Bold",2189,-600,2048,12120,6688),Oi["AsapCondensed-SemiBold"]=new Ht(s+"fonts/AsapCondensed-SemiBold",934,-212,1e3,13848,7e3),Oi["Asap-Regular"]=new Ht(s+"fonts/Asap-Regular",934,-212,1e3,14604,7216),I.swoop_forward=new zt(s+"sounds/swoop_forward",444,2680,2600),I.swoop_backward=new zt(s+"sounds/swoop_backward",418,2629,2347),I.notification=new zt(s+"sounds/notification",1541,9945,9689),I.keypress=new zt(s+"sounds/keypress",104,1460,1655),I.countdown=new zt(s+"sounds/countdown",392,3255,5941),I.click=new zt(s+"sounds/click",444,3489,6071),I.win=new zt(s+"sounds/win",5146,74724,32403),I.welcome=new zt(s+"sounds/welcome",3239,39720,20384),I["turn-notification"]=new zt(s+"sounds/turn-notification",360,3024,2904),I["stick-ball-03"]=new zt(s+"sounds/stick-ball-03",576,3648,4080),I.record=new zt(s+"sounds/record",1228,6635,7645),I["rack-02"]=new zt(s+"sounds/rack-02",601,7901,4560),I["rack-01"]=new zt(s+"sounds/rack-01",392,6729,2900),I.lose=new zt(s+"sounds/lose",3971,48216,24950),I.foul=new zt(s+"sounds/foul",1724,11218,6636),I["ball-tray-roll-01"]=new zt(s+"sounds/ball-tray-roll-01",3161,19843,20299),I["ball-tray-bounce-02"]=new zt(s+"sounds/ball-tray-bounce-02",312,2376,2177),I["ball-tray-bounce-01"]=new zt(s+"sounds/ball-tray-bounce-01",576,3504,4177),I["ball-pocket-04"]=new zt(s+"sounds/ball-pocket-04",209,1850,1727),I["ball-pocket-03"]=new zt(s+"sounds/ball-pocket-03",209,1876,1682),I["ball-pocket-02"]=new zt(s+"sounds/ball-pocket-02",209,1876,1632),I["ball-pocket-01"]=new zt(s+"sounds/ball-pocket-01",209,1850,1659),I["ball-cushion-05"]=new zt(s+"sounds/ball-cushion-05",366,2395,2954),I["ball-cushion-04"]=new zt(s+"sounds/ball-cushion-04",392,2785,3078),I["ball-cushion-03"]=new zt(s+"sounds/ball-cushion-03",392,2603,2968),I["ball-cushion-02"]=new zt(s+"sounds/ball-cushion-02",392,2577,2914),I["ball-cushion-01"]=new zt(s+"sounds/ball-cushion-01",392,2447,3093),I["ball-ball-03"]=new zt(s+"sounds/ball-ball-03",313,2526,2561),I["ball-ball-02"]=new zt(s+"sounds/ball-ball-02",313,2370,2553),I["ball-ball-01"]=new zt(s+"sounds/ball-ball-01",183,1694,1723),i.star_fill=new e(s+"images/star_fill",168.11,159.89,5197),i.star_empty=new e(s+"images/star_empty",168.11,159.89,3621),i.kb_delete=new e(s+"images/kb_delete",80,80,244),i.icon_x_red=new e(s+"images/icon_x_red",56.32,56.32,676),i.icon_wrench=new e(s+"images/icon_wrench",64.32,64.32,752),i.icon_undo_disabled=new e(s+"images/icon_undo_disabled",64.16,50.7,1075),i.icon_undo=new e(s+"images/icon_undo",64.16,50.7,1063),i.icon_swap_hor=new e(s+"images/icon_swap_hor",88,88,287),i.icon_stats=new e(s+"images/icon_stats",64.3,64.3,585),i.icon_star=new e(s+"images/icon_star",68.07,64.91,853),i.icon_shuffle=new e(s+"images/icon_shuffle",68,62,1928),i.icon_replay=new e(s+"images/icon_replay",64,62,1414),i.icon_rate_us=new e(s+"images/icon_rate_us",200,75,5373),i.icon_play=new e(s+"images/icon_play",43.69,49.83,410),i.icon_pause=new e(s+"images/icon_pause",38.11,41.64,512),i.icon_notifications=new e(s+"images/icon_notifications",54.39,64.32,725),i.icon_next=new e(s+"images/icon_next",43.69,49.83,706),i.icon_more=new e(s+"images/icon_more",44,44,369),i.icon_medal=new e(s+"images/icon_medal",55.66,68.53,7562),i.icon_home=new e(s+"images/icon_home",67.84,63.95,1367),i.icon_hint=new e(s+"images/icon_hint",42.95,64.32,1357),i.icon_help=new e(s+"images/icon_help",64.3,64.3,1342),i.icon_daily_challenge_complete=new e(s+"images/icon_daily_challenge_complete",54.18,52,624),i.icon_daily_challenge=new e(s+"images/icon_daily_challenge",54.18,52,734),i.icon_clock=new e(s+"images/icon_clock",57.14,57.14,578),i.cursor_pointer=new e(s+"images/cursor_pointer",60,60,409),i.cursor_default=new e(s+"images/cursor_default",60,60,502),i.arrow_right_shadow=new e(s+"images/arrow_right_shadow",145.38,162.52,499),i.arrow_right_disabled=new e(s+"images/arrow_right_disabled",145.38,162.52,762),i.arrow_right=new e(s+"images/arrow_right",145.38,162.52,738),i.tray_bezel=new t(1,s+"images/tray_bezel",534,196),i.table_shadow=new t(1,s+"images/table_shadow",12774,7784),i.spin_bezel=new t(1,s+"images/spin_bezel",1766,1332),i.spin_ball=new t(1,s+"images/spin_ball",3345,810),i.rotation_dial_strip=new t(1,s+"images/rotation_dial_strip",386,186),i.rotation_bezel=new t(1,s+"images/rotation_bezel",3470,2464),i.rotation_arrow_shadow=new t(1,s+"images/rotation_arrow_shadow",233,126),i.rotation_arrow=new t(1,s+"images/rotation_arrow",529,314),i.pull_gradient=new t(1,s+"images/pull_gradient",688,252),i.pull_bezel=new t(1,s+"images/pull_bezel",1476,1020),i.cue_shadow=new t(1,s+"images/cue_shadow",3249,1990),i.ball_sheen=new t(1,s+"images/ball_sheen",598,306),i.ball_shadow=new t(1,s+"images/ball_shadow",2089,1208),i.ball_fade=new t(1,s+"images/ball_fade",1307,908),i.ball_bezel=new t(1,s+"images/ball_bezel",1614,996),i.pull_stick=new e(s+"images/pull_stick",46,496,3360),"247"===Mi?(i["@theme/table_top"]=new t(1,s+"images/247/table_top",92151,13314),i["@theme/table_frame"]=new t(1,s+"images/247/table_frame",192869,23230),i["@theme/game_bg"]=new t(1,s+"images/247/game_bg",86638,18630),i["@theme/intro"]=new e(s+"images/247/intro",1400,716,48886),i["@theme/cue"]=new e(s+"images/247/cue",23,730,4731)):"spring"===Mi?(i["@theme/table_top"]=new t(1,s+"images/spring/table_top",226717,25200),i["@theme/table_frame"]=new t(1,s+"images/spring/table_frame",333004,48864),i["@theme/game_bg"]=new t(1,s+"images/spring/game_bg",78988,19356),i["@theme/intro"]=new e(s+"images/spring/intro",1400,716,57788),i["@theme/cue"]=new e(s+"images/spring/cue",23,730,4725)):"summer"===Mi?(i["@theme/table_top"]=new t(1,s+"images/summer/table_top",202342,29812),i["@theme/table_frame"]=new t(1,s+"images/summer/table_frame",372364,33852),i["@theme/game_bg"]=new t(1,s+"images/summer/game_bg",78988,19382),i["@theme/intro"]=new e(s+"images/summer/intro",1400,716,70297),i["@theme/cue"]=new e(s+"images/summer/cue",23,730,4725)):"fall"===Mi?(i["@theme/table_top"]=new t(1,s+"images/fall/table_top",158652,26080),i["@theme/table_frame"]=new t(1,s+"images/fall/table_frame",333423,51968),i["@theme/game_bg"]=new t(1,s+"images/fall/game_bg",78988,15474),i["@theme/intro"]=new e(s+"images/fall/intro",1400,716,67560),i["@theme/cue"]=new e(s+"images/fall/cue",23,730,4722)):"winter"===Mi?(i["@theme/table_top"]=new t(1,s+"images/winter/table_top",232743,39154),i["@theme/table_frame"]=new t(1,s+"images/winter/table_frame",269467,51600),i["@theme/game_bg"]=new t(1,s+"images/winter/game_bg",75936,16270),i["@theme/intro"]=new e(s+"images/winter/intro",1400,716,56101),i["@theme/cue"]=new e(s+"images/winter/cue",23,730,4731)):"christmas"===Mi?(i["@theme/table_top"]=new t(1,s+"images/christmas/table_top",232133,35612),i["@theme/table_frame"]=new t(1,s+"images/christmas/table_frame",270467,42146),i["@theme/game_bg"]=new t(1,s+"images/christmas/game_bg",78779,13338),i["@theme/intro"]=new e(s+"images/christmas/intro",1400,716,99242),i["@theme/cue"]=new e(s+"images/christmas/cue",23,730,4725)):"easter"===Mi?(i["@theme/table_top"]=new t(1,s+"images/easter/table_top",199902,26144),i["@theme/table_frame"]=new t(1,s+"images/easter/table_frame",265743,39782),i["@theme/game_bg"]=new t(1,s+"images/easter/game_bg",78988,18888),i["@theme/intro"]=new e(s+"images/easter/intro",1400,716,65439),i["@theme/cue"]=new e(s+"images/easter/cue",23,730,4765)):"4th-of-july"===Mi?(i["@theme/table_top"]=new t(1,s+"images/4th-of-july/table_top",96058,18886),i["@theme/table_frame"]=new t(1,s+"images/4th-of-july/table_frame",232091,32824),i["@theme/game_bg"]=new t(1,s+"images/4th-of-july/game_bg",78988,16018),i["@theme/intro"]=new e(s+"images/4th-of-july/intro",1400,716,72517),i["@theme/cue"]=new e(s+"images/4th-of-july/cue",23,730,4729)):"halloween"===Mi?(i["@theme/table_top"]=new t(1,s+"images/halloween/table_top",258153,35104),i["@theme/table_frame"]=new t(1,s+"images/halloween/table_frame",380218,69988),i["@theme/game_bg"]=new t(1,s+"images/halloween/game_bg",78057,14800),i["@theme/intro"]=new e(s+"images/halloween/intro",1400,716,67165),i["@theme/cue"]=new e(s+"images/halloween/cue",23,730,4716)):"thanksgiving"===Mi?(i["@theme/table_top"]=new t(1,s+"images/thanksgiving/table_top",214529,39174),i["@theme/table_frame"]=new t(1,s+"images/thanksgiving/table_frame",259389,65424),i["@theme/game_bg"]=new t(1,s+"images/thanksgiving/game_bg",78988,16688),i["@theme/intro"]=new e(s+"images/thanksgiving/intro",1400,716,85683),i["@theme/cue"]=new e(s+"images/thanksgiving/cue",23,730,4812)):"new-years"===Mi?(i["@theme/table_top"]=new t(1,s+"images/new-years/table_top",216674,35586),i["@theme/table_frame"]=new t(1,s+"images/new-years/table_frame",223685,35254),i["@theme/game_bg"]=new t(1,s+"images/new-years/game_bg",78210,15408),i["@theme/intro"]=new e(s+"images/new-years/intro",1400,716,66467),i["@theme/cue"]=new e(s+"images/new-years/cue",23,730,4722)):"valentines"===Mi?(i["@theme/table_top"]=new t(1,s+"images/valentines/table_top",146120,18842),i["@theme/table_frame"]=new t(1,s+"images/valentines/table_frame",283536,47664),i["@theme/game_bg"]=new t(1,s+"images/valentines/game_bg",78988,16810),i["@theme/intro"]=new e(s+"images/valentines/intro",1400,716,79017),i["@theme/cue"]=new e(s+"images/valentines/cue",23,730,4731)):"st-patricks"===Mi?(i["@theme/table_top"]=new t(1,s+"images/st-patricks/table_top",138794,25202),i["@theme/table_frame"]=new t(1,s+"images/st-patricks/table_frame",224223,46140),i["@theme/game_bg"]=new t(1,s+"images/st-patricks/game_bg",72952,14048),i["@theme/intro"]=new e(s+"images/st-patricks/intro",1400,716,96220),i["@theme/cue"]=new e(s+"images/st-patricks/cue",23,730,4764)):"cinco-de-mayo"===Mi&&(i["@theme/table_top"]=new t(1,s+"images/cinco-de-mayo/table_top",178223,25556),i["@theme/table_frame"]=new t(1,s+"images/cinco-de-mayo/table_frame",297742,61396),i["@theme/game_bg"]=new t(1,s+"images/cinco-de-mayo/game_bg",78988,18612),i["@theme/intro"]=new e(s+"images/cinco-de-mayo/intro",1400,716,82681),i["@theme/cue"]=new e(s+"images/cinco-de-mayo/cue",23,730,4725))),{"-1":"Not Applicable",0:"Easy",1:"Medium",2:"Hard",3:"Expert"});class Gi{constructor(t){this.group=null,this.shots=0,this.sunk=[],this.time=0,this.team=t}pack(){var t=new Array(4);return t[0]=this.group,t[1]=this.shots,t[2]=this.sunk.slice(),t[3]=this.time,t}validate(t,e){if("object"!=typeof t||null===t)return this.validateError("data is not a valid object",e);if(4!==t.length)return this.validateError("data is incorrect length",e);if([null,0,1].indexOf(t[0])<0)return this.validateError("Invalid group",e);if("number"!=typeof t[1])return this.validateError("shots not a number",e);if(!Number.isInteger(t[1]))return this.validateError("shots not an integer",e);if(!Number.isFinite(t[1]))return this.validateError("shots not finite",e);if(t[1]<0)return this.validateError("shots less than 0",e);if("object"!=typeof t[2]||null===t[2])return this.validateError("sunk is not a valid object",e);if(!Array.isArray(t[2]))return this.validateError("sunk is not a valid array",e);for(var i of t[2])if([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15].indexOf(i)<0)return this.validateError("sunk contains an invalid entry",e);return"number"!=typeof t[3]?this.validateError("time not a number",e):Number.isInteger(t[3])?Number.isFinite(t[3])?!(t[3]<0)||this.validateError("time less than 0",e):this.validateError("time not finite",e):this.validateError("time not an integer",e)}validateError(t,e){return e&&console.log("TeamState.validate error: "+t),!1}unpack(t){this.group=t[0],this.shots=t[1],this.sunk.length=0;for(var e of t[2])this.sunk.push(e);this.time=t[3]}matches(e,i){if(this.group!==e[0])return this.matchesError("group",i);if(this.shots!==e[1])return this.matchesError("shots",i);if(this.sunk.length!==e[2].length)return this.matchesError("sunk length mismatch",i);for(let t=0;t<this.sunk.length;++t)if(this.sunk[t]!==e[2][t])return this.matchesError("sunk entry mismatch",i);return!0}matchesError(t,e){return e&&console.log("TeamState.matches error: "+t),!1}}class Ni{constructor(t,e){this.gameMode=null,this.difficulty=null,this.random=null,this.table=null,this.teams=[new Gi(0),new Gi(1)],this.turnState=null,this.team=2,this.lastShotCall=0,this.lastShotScratched=!1,this.lastShooter=2,this._simulationActive=!1;let i=null,s=null;var n=new N;if(0===arguments.length)i=4;else if(0===t)i=t,s=e;else if(1===t)i=t;else if(4===t)i=t;else if(2===t)i=t;else{if(3!==t)throw new Error("Could not match constructor overload");i=t,n.seed=e}this.gameMode=i,this.difficulty=s,this.random=n,this.table=new Ui}isPausable(){return 0===this.gameMode||1===this.gameMode||2===this.gameMode}pack(){if(this._simulationActive)throw new Error("Cannot pack while simulating");var t=new Array(11);return t[0]=this.gameMode,t[1]=this.difficulty,t[2]=this.random.seed,t[3]=this.table.pack(),t[4]=this.teams[0].pack(),t[5]=this.teams[1].pack(),t[6]=this.turnState,t[7]=this.team,t[8]=this.lastShotCall,t[9]=this.lastShotScratched,t[10]=this.lastShooter,t}validate(t,e){if("object"!=typeof t||null===t)return this.validateError("data is not a valid object",e);if(11!==t.length)return this.validateError("data is incorrect length",e);if([0,3,4,2,1].indexOf(t[0])<0)return this.validateError("Invalid gameMode",e);if(0===t[0]){if([0,1,2,3].indexOf(t[1])<0)return this.validateError("Invalid difficulty",e)}else if(null!==t[1])return this.validateError("Difficulty should be null",e);if("number"!=typeof t[2])return this.validateError("seed not a number",e);if(!Number.isInteger(t[2]))return this.validateError("seed not an integer",e);if(!Number.isFinite(t[2]))return this.validateError("seed not finite",e);if([0,1,2,3,4,5,6,7,8,9].indexOf(t[6])<0)return this.validateError("Invalid turnState",e);if([0,1,2].indexOf(t[7])<0)return this.validateError("Invalid team",e);if("number"!=typeof t[8])return this.validateError("lastShotCall not a number",e);if(!Number.isInteger(t[8]))return this.validateError("lastShotCall not an integer",e);if(!Number.isFinite(t[8]))return this.validateError("lastShotCall not finite",e);if(t[8]<0||19<=t[8])return this.validateError("lastShotCall invalid",e);if("boolean"!=typeof t[9])return this.validateError("lastShotScratched invalid",e);if([0,1,2].indexOf(t[10])<0)return this.validateError("Invalid lastShooter",e);if(!this.table.validate(t[3],e))return!1;if(!this.teams[0].validate(t[4],e))return!1;if(!this.teams[1].validate(t[5],e))return!1;if(null!==t[4][0]&&null===t[5][0])return this.validateError("one ball group assigned but not the other",e);if(null===t[4][0]&&null!==t[5][0])return this.validateError("one ball group assigned but not the other",e);if(null!==t[4][0]&&t[4][0]===t[5][0])return this.validateError("both teams have the same ball group",e);var i,s=t[4][2].slice(),n=t[5][2].slice();for(i of s)if(0<=n.indexOf(i))return this.validateError("both teams have same sunk ball",e);var a,o=t[3][18].slice(0),s=s.concat(n);if(null!==t[4][0]&&o.length!==s.length)return this.validateError("teams assigned and team sunk balls don't match tray sunk balls length",e);for(a of s)if(o.indexOf(a)<0)return this.validateError("team sunk balls contains ball not in tray",e);return!0}validateError(t,e){return e&&console.log("GameState.validate error: "+t),!1}unpack(t){this.gameMode=t[0],this.difficulty=t[1],this.random.seed=t[2],this.turnState=t[6],this.team=t[7],this.lastShotCall=t[8],this.lastShotScratched=t[9],this.lastShooter=t[10],this.table.unpack(t[3]),this.teams[0].unpack(t[4]),this.teams[1].unpack(t[5]),this._simulationActive=!1}matches(t,e){return this.gameMode!==t[0]?this.matchesError("gameMode",e):this.difficulty!==t[1]?this.matchesError("difficulty",e):this.random.seed!==t[2]?this.matchesError("random_seed",e):this.turnState!==t[6]?this.matchesError("turnState",e):this.team!==t[7]?this.matchesError("team",e):this.lastShotCall!==t[8]?this.matchesError("lastShotCall",e):this.lastShotScratched!==t[9]?this.matchesError("lastShotScratched",e):this.lastShooter!==t[10]?this.matchesError("lastShooter",e):!!this.table.matches(t[3],e)&&!!this.teams[0].matches(t[4],e)&&!!this.teams[1].matches(t[5],e)}matchesError(t,e){return e&&console.log("GameState.matches error: "+t),!1}}const A=new class{newGame(t,e){return t._simulationActive?this.error("Can't start a new game while simulating",e):(t.lastShooter=2,t.lastShotScratched=!1,t.lastShotCall=0,t.teams[0].group=null,t.teams[0].shots=0,t.teams[0].sunk.length=0,t.teams[0].time=0,t.teams[1].group=null,t.teams[1].shots=0,t.teams[1].sunk.length=0,t.teams[1].time=0,3===t.gameMode?(this.rackChallenge(t),t.turnState=6,t.team=0):(this.rack8Ball(t),4===t.gameMode?(t.turnState=1,t.team=Math.random()<.5?0:1):2===t.gameMode?(t.turnState=2,t.team=0):(t.turnState=0,t.team=2)),this.resetSticks(t),t.table.sticks[0].rotation=0,t.table.sticks[1].rotation=0,!0)}setManualBreaker(t,e,i){return t._simulationActive?this.error("Sim active",i):0!==t.turnState?this.error("Incorrect turn state to set manual breaker",i):0!==e&&1!==e?this.error("Invalid manual breaker team",i):(t.team=e,t.turnState=2,!0)}setRandomBreaker(t,e){return t._simulationActive?this.error("Sim active",e):0!==t.turnState?this.error("Incorrect turn state to set random breaker",e):(t.team=t.random.next()<.5?0:1,t.turnState=1,!0)}resolveInvalidBreak(t,e,i,s){let n=0;if(0===t.lastShooter&&(n=1),i!==n)return this.error("Invalid requester",s);if(5===t.turnState){if(2===e)return t.turnState=8,this.setBallOnTable(t,t.table.balls[0]),t.table.balls[0].position.set(-.417195,0),this.advanceShooter(t),this.resetSticks(t),!0;if(0===e||1===e)return this.rack8Ball(t),t.turnState=3,t.team=e,this.resetSticks(t),!0}else if(4===t.turnState){if(2===e)return t.turnState=6,this.advanceShooter(t),this.resetSticks(t),!0;if(0===e||1===e)return this.rack8Ball(t),t.turnState=3,t.team=e,this.resetSticks(t),!0}return this.error("Some other failure resolving invalid break",s)}rotateStick(t,e,i,s){return t._simulationActive?this.error("Sim active",s):"number"==typeof e&&!(e<0||360<=e||i!==t.team||2!==t.turnState&&1!==t.turnState&&3!==t.turnState&&6!==t.turnState&&7!==t.turnState&&8!==t.turnState||(s=0===t.team?0:1,t.table.sticks[s].rotation=e,0))}adjustSpin(t,e,i,s,n){return t._simulationActive?this.error("Sim active",n):"number"!=typeof e?this.error("english degrees not a number",n):e<0?this.error("english degrees < 0",n):360<=e?this.error("english degrees >= 360",n):"number"!=typeof i?this.error("english length not a number",n):i<0?this.error("english length < 0",n):1<i?this.error("english length > 1",n):s!==t.team?this.error("incorrect team",n):2!==t.turnState&&1!==t.turnState&&3!==t.turnState&&6!==t.turnState&&7!==t.turnState&&8!==t.turnState?this.error("incorrect turn state",n):(s=0===t.team?0:1,t.table.sticks[s].englishDegrees=e,t.table.sticks[s].englishLength=i,!0)}adjustElevation(t,e,i,s){return t._simulationActive?this.error("Sim active",s):"number"!=typeof e?this.error("elevation not a number",s):e<0?this.error("elevation < 0",s):85<e?this.error("elevation > 85",s):i!==t.team?this.error("incorrect team",s):2!==t.turnState&&1!==t.turnState&&3!==t.turnState&&6!==t.turnState&&7!==t.turnState&&8!==t.turnState?this.error("incorrect turn state",s):(i=0===t.team?0:1,t.table.sticks[i].elevation=e,!0)}moveCueBall(t,e,i,s,n){if(t._simulationActive)return this.error("Sim active",n);if("number"!=typeof e)return this.error("x not a number",n);if("number"!=typeof i)return this.error("y not a number",n);if(s!==t.team)return this.error("incorrect team",n);if(2!==t.turnState&&1!==t.turnState&&3!==t.turnState&&7!==t.turnState&&8!==t.turnState)return this.error("incorrect turn state",n);let a=t.table.tableBallInHandRect;return 2!==t.turnState&&1!==t.turnState&&3!==t.turnState&&8!==t.turnState||(a=t.table.kitchenBallInHandRect),e<a.x||e>a.right||i<a.y||i>a.bottom?this.error("pos not in correct table rect",n):(t.table.balls[0].position.set(e,i),t.table.sticks[0].position.set(e,i),t.table.sticks[1].position.set(e,i),!0)}adjustPull(t,e,i,s){return t._simulationActive?this.error("Sim active",s):"number"!=typeof e?this.error("pull not a number",s):e<0?this.error("pull < 0",s):1<e?this.error("pull > 1",s):i!==t.team?this.error("incorrect team",s):2!==t.turnState&&1!==t.turnState&&3!==t.turnState&&6!==t.turnState&&7!==t.turnState&&8!==t.turnState?this.error("incorrect turn state",s):(t.table.sticks[i].pull=e,!0)}isAllowedToMakeShot(t,e,i,s){return t._simulationActive?this.error("Sim active",s):"number"!=typeof e?this.error("pull not a number",s):e<0?this.error("pull < 0",s):1<e?this.error("pull > 1",s):i!==t.team?this.error("incorrect team",s):2===t.turnState||1===t.turnState||3===t.turnState||6===t.turnState||7===t.turnState||8===t.turnState||this.error("incorrect turn state",s)}isGameStarted(t){return 0!==t.turnState&&2!==t.turnState&&1!==t.turnState}isGameOver(t){return 9===t.turnState}getElligibleFirstHitBalls(t){if(0===t.turnState||5===t.turnState||4===t.turnState||9===t.turnState)throw new Error("Invalid turn state!");var e=[],i=t.teams[t.team].group;if(null===i)for(var s of t.table.balls)0!==s.num&&8!==s.num&&s.isInPlay2()&&!s.isPocketed2()&&e.push(s);else{for(var n of t.table.balls)0!==n.num&&n.group===i&&n.isInPlay2()&&!n.isPocketed2()&&e.push(n);0===e.length&&(t=t.table.balls[8],t.isInPlay2())&&!t.isPocketed2()&&e.push(t)}if(0===e.length)throw new Error("Could not find any balls!");return e}fullySimulateShot(t,e,i=!1){var s=t.gameState;if(2!==s.turnState&&1!==s.turnState&&3!==s.turnState&&6!==s.turnState&&7!==s.turnState&&8!==s.turnState)return this.error("Not a turn shot",e);if(1!==s.table.balls[0].motionState)return this.error("Cue ball not stationary",e);if(0===s.table.sticks[s.team].pull)return this.error("Pull is 0",e);if(s._simulationActive)return this.error("Simulation already active",e);if(t.running)return this.error("Shot already running",e);for(this.startSimulation(t),s.teams[s.team].shots++;t.running;)if(this.simulate(t,1e3/60,i),i){if(t.anyBallBallCol)break;if(t.anyBallSunk)break;if(2<=t.numRailCols)break}return!0}shot(t,e){var i=t.gameState;return 2!==i.turnState&&1!==i.turnState&&3!==i.turnState&&6!==i.turnState&&7!==i.turnState&&8!==i.turnState?this.error("Not a turn shot",e):1!==i.table.balls[0].motionState?this.error("Cue ball not stationary",e):0===i.table.sticks[i.team].pull?this.error("Pull is 0",e):i._simulationActive?this.error("Simulation already active",e):t.running?this.error("Shot already running",e):(i.teams[i.team].shots++,this.startSimulation(t),!0)}startSimulation(t){var e=t.gameState,t=(t.running=e._simulationActive=!0,t.timeAccumulated=0,e.table.balls[0]),e=e.table.sticks[e.team],i=e.elevation,s=4.4*e.pull+.1,n=(new v).unit(e.englishDegrees,e.englishLength).scale(.028575),a=n.x,n=n.y,e=e.rotation,o=Math.cos(i*Math.PI/180),i=Math.sin(i*Math.PI/180),r=.000816530625-a*a-n*n;let h=Math.abs(Math.sqrt(Math.abs(r)));if(isNaN(h)||!isFinite(h))throw new Error("c fail!");R.fequal(h,0)&&(h=0);r=326.02*s/(1+163.01/600+3059.97402118261*(a*a+n*n*o*o+h*h*i*i-2*n*h*o*i));t.velocity.copy(R.rotateDeg(new g(0,-r*o/163.01,0),e+90)),t.angularVelocity.copy(R.rotateDeg(new g(-h*r*i+n*r*o,a*r*i,-a*r*o).scale(19.22286263998851),e+90)),t.updateMotionState2()}stopSimulation(t){var e=t.gameState;t.running=e._simulationActive=!1,t.timeAccumulated=0,t.gameState.lastShooter=t.gameState.team,t.gameState.lastShotScratched=t.scratched,this.evaluateShot(t),t.gameState.lastShotCall=t.call}simulate(t,e,i=!1){var s=t.gameState;if(!t.running)throw new Error("Simulation not active");t.timeAccumulated+=e/1e3;let n=!0;for(;.016666666666666666<=t.timeAccumulated;)if(t.timeAccumulated-=this.step(t,.016666666666666666),n=this.checkBallsInMotion(s),n||(t.timeAccumulated=0),i){if(t.anyBallBallCol)break;if(t.anyBallSunk)break;if(2<=t.numRailCols)break}n=this.checkBallsInMotion(s),n||this.stopSimulation(t)}step(i,e){var t,s=i.gameState;for(t of s.table.balls)t.updateDelta(e);var n,a,o=this.getEarliestIntersections(s,e),r=0<o.length?o[0].t*e:e;for(n of s.table.balls)this.moveBall(n,r);for(a of s.table.balls)this.friction(a,r);0<o.length&&(0===o[0].type?(i.anyBallBallCol=!0,0===o[0].ball.num?(null===i.lastAnyBallHitNum&&(i.lastAnyBallHitNum=o[0].otherBall.num),i.firstColPos.copy(o[0].ball.position)):(null===i.lastAnyBallHitNum&&(i.lastAnyBallHitNum=o[0].ball.num),i.firstColPos.copy(o[0].otherBall.position)),o[0].ball.isPocketed2()||o[0].otherBall.isPocketed2()||o[0].ball.isPocketed2()||i.numBallColsUnpocketed++):(0===i.numRailCols&&i.firstColPos.copy(o[0].ball.position),i.numRailCols++,o[0].ball.isPocketed2()||i.numRailColsUnpocketed++),o[0].response(i));for(let e=0;e<s.table.balls.length;++e)if(s.table.balls[e].isInPlay2()&&!s.table.balls[e].isPocketed2())for(let t=0;t<s.table.pockets.length;++t){var h=s.table.balls[e].position.distanceSquared(s.table.pockets[t].position);h<s.table.pockets[t].radiusSquared&&(i.anyBallSunk=!0,i.pocketOrder.push(s.table.balls[e].num),this.pocketBall(s.table.balls[e],s.table.pockets[t]))}for(let t=0;t<s.table.balls.length;++t)s.table.balls[t].isInPlay2()&&s.table.balls[t].isPocketed2()&&this.sinkBall(i,s.table.balls[t],e);return r}checkBallsInMotion(t){let e=!1;for(var i of t.table.balls)if(i.isInPlay2()&&(i.isInMotion2()||2===i.playState)){e=!0;break}return e}getEarliestIntersections(t,e){var i,s=[];let n=1;for(i of t.table.intersections)i.test(),i.isCollision&&(i.t<n?(n=i.t,s.length=0,s.push(i)):i.t===n&&s.push(i));return s}moveBall(t,e){t.isInMotion2()&&(t.position.x+=t.velocity.x*e,t.position.y+=t.velocity.y*e,t.angularVelocity.x||t.angularVelocity.y||t.angularVelocity.z)&&(t.quaternion.integrate(t.angularVelocity.clone().scale(2*Math.PI),e,new g(1,1,1)),t.quaternion.normalize()),2===t.playState&&t.sinkingPocket.position.distanceSquared(t.position)>=t.sinkingPocket.radiusSquared&&t.position.copy(t.sinkingPocket.position)}friction(a,o){if(!a.isPocketed2()){var r=a.velocity.clone(),h=a.angularVelocity.clone();let s,n;if(2===a.motionState){let t=1,e=0;0<r.lengthSquared()&&(l=r.clone().normalize(1),t=l.x,e=l.y,R.rotateCosSinPhi(r,t,-e),R.rotateCosSinPhi(h,t,-e));let i=new g(0,0,1).cross(h).scale(.028575).add(r).normalize(1);0<=i.x&&(i=new g(0,0,-1).cross(h).scale(.028575).add(r).normalize(1));var l=i.clone().scale(.2*9.81*o),l=(s=r.clone(),l.lengthSquared()>=r.lengthSquared()?s.set(0,0,0):s.subtract(l),new g(s.y/.17954202015265666,s.x/.17954202015265666,0)),d=new g(h.x,h.y,0),c=i.clone().cross(new g(0,0,1)).scale(.2*9.81*o).scale(5/.05715);if(0!==c.z)throw new Error("failed");n=c.lengthSquared()>=l.clone().subtract(d).lengthSquared()?l.clone():(h.x<l.x?0<c.x&&(c.x*=-1):h.x>l.x&&c.x<0&&(c.x*=-1),h.y<l.y?0<c.y&&(c.y*=-1):h.y>l.y&&c.y<0&&(c.y*=-1),h.clone().subtract(c)),n.z=this.updateSpinning(a,h.z,o,!0),R.rotateCosSinPhi(s,t,e),R.rotateCosSinPhi(n,t,e)}else if(4===a.motionState){let t=1,e=0;0<r.lengthSquared()&&(d=r.clone().normalize(1),t=d.x,e=d.y,R.rotateCosSinPhi(r,t,-e),R.rotateCosSinPhi(h,t,-e));let i=new g(0,0,1).cross(h).scale(.028575).add(r).normalize(1);0<=i.x&&(i=new g(0,0,-1).cross(h).scale(.028575).add(r).normalize(1));l=i.clone().scale(.14715*o),c=(s=r.clone(),l.lengthSquared()>=r.lengthSquared()?s.set(0,0,0):s.subtract(l),new g(s.y/.17954202015265666,s.x/.17954202015265666,h.z));n=c.clone(),n.z=this.updateSpinning(a,h.z,o,!1),R.rotateCosSinPhi(s,t,e),R.rotateCosSinPhi(n,t,e)}else{if(3!==a.motionState)return;s=a.velocity.clone(),n=new g(0,0,this.updateSpinning(a,h.z,o,!1))}a.velocity.copy(s),a.angularVelocity.copy(n)}a.updateMotionState2()}updateSpinning(t,e,i,s){if(R.fequal(e,0))return 0;let n=e-2.1582*i/.05715*(0<e?1:-1)*(s?.25:1);return n*e<=0&&(n=0),n}pocketBall(t,e){t.isPocketed2()||(t.playState=2,t.sinkingPocket=e,e=e.position.clone().subtract(t.position).normalize(),e=e.clone().scale(1.143),t.velocity.add(new g(e.x,e.y,0)),t.updateMotionState2(),t.onPocketed.invoke(t))}sinkBall(t,e,i){e.isPocketed2()&&0!==e.motionState&&(e.depth=Math.max(0,Math.min(1,e.depth+ +i)),1<=e.depth)&&(this.resetBall(e,3),3!==e.group?(this.addBallToTray(t.gameState.table.tray,e),t.sunk.push(e.num)):t.scratched=!0,e.onSunk.invoke(e))}evaluateShot(t){t.gameState;this.isPracticeShot(t)||this.isDailyChallengeShot(t)||this.is8BallOnBreak(t)||this.is8BallWrongTime(t)||this.is8BallRightTime(t)||this.isBreakOtherShot(t)||this.isNoBallsHitFoul(t)||this.isWrongTypeHitFirstFoul(t)||this.isScratch(t)||this.isNoRailNoPocketFoul(t)||this.normalShot(t)}isPracticeShot(t){var e=t.gameState;return 2===e.gameMode&&(this.assignBalls(t,!1),t.call=0,e.turnState=7,t.scratched&&this.setBallOnTable(e,e.table.balls[0]),this.resetSticks(e),e.table.balls[0].quaternion.identity(),!0)}isDailyChallengeShot(t){var e,i=t.gameState;return 3===i.gameMode&&(this.assignBalls(t,!1),t.call=0,e=this.hasBallOfTypeOnTable(i,i.teams[0].group),t=t.scratched,i.turnState=(!e||!t)&&e?6:9,this.resetSticks(i),i.table.balls[0].quaternion.identity(),!0)}is8BallOnBreak(t){var e=t.gameState;return(2===e.turnState||1===e.turnState||3===e.turnState)&&!(t.sunk.indexOf(8)<0||(this.assignBalls(t,!1),t.scratched?(t.call=2,this.declareWinner(e,0===e.team?1:0)):(t.call=1,this.declareWinner(e,e.team)),this.resetSticks(e),e.table.balls[0].quaternion.identity(),0))}is8BallWrongTime(t){var e=t.gameState;if(t.sunk.indexOf(8)<0)return!1;var i=e.teams[e.team].group;let s=!1;return(null===i||this.hasBallOfTypeOnTable(e,i)||this.containsBallType(t.sunk,i))&&(s=!0),!!s&&(this.assignBalls(t,!1),t.call=8,this.declareWinner(e,0===e.team?1:0),this.resetSticks(e),e.table.balls[0].quaternion.identity(),!0)}is8BallRightTime(t){var e=t.gameState;return!(t.sunk.indexOf(8)<0||(this.assignBalls(t,!1),t.scratched?(t.call=10,this.declareWinner(e,0===e.team?1:0)):(t.call=9,this.declareWinner(e,e.team)),this.resetSticks(e),e.table.balls[0].quaternion.identity(),0))}isBreakOtherShot(t){var e=t.gameState;if(2!==e.turnState&&1!==e.turnState&&3!==e.turnState)return!1;this.assignBalls(t,!1);var i=t.scratched,s=0<t.sunk.length,n=4<=this.getNumNumberBallsHitRail(t.ballRailCollisions),n=s||n;return n&&!i?s?(t.call=3,e.turnState=6):(t.call=4,e.turnState=6,this.advanceShooter(e)):n&&i?(t.call=5,e.turnState=8,this.advanceShooter(e),this.setBallOnTable(e,e.table.balls[0]),e.table.balls[0].position.set(-.417195,0),this.resetSticks(e),e.table.balls[0].quaternion.identity()):n||i?(t.call=7,e.turnState=5):(t.call=6,e.turnState=4),this.resetSticks(e),e.table.balls[0].quaternion.identity(),!0}isNoBallsHitFoul(t){var e=t.gameState;if(0<t.ballBallCollisions.length)return!1;this.assignBalls(t,!1);var i=t.scratched;return t.call=i?12:11,e.turnState=7,i&&this.setBallOnTable(e,e.table.balls[0]),this.advanceShooter(e),this.resetSticks(e),e.table.balls[0].quaternion.identity(),!0}isWrongTypeHitFirstFoul(t){var e,i=t.gameState,s=t.scratched;let n=null;for(e of t.ballBallCollisions)if(3===e.a.group){n=e;break}return s&&this.setBallOnTable(i,i.table.balls[0]),2===n.b.group?!(null!==i.teams[i.team].group&&!this.hasBallOfTypeOnTable(i,i.teams[i.team].group)||(this.assignBalls(t,!1),t.call=13,i.turnState=7,this.advanceShooter(i),this.resetSticks(i),i.table.balls[0].quaternion.identity(),0)):null!==i.teams[i.team].group&&n.b.group!==i.teams[i.team].group&&(this.assignBalls(t,!1),t.call=13,i.turnState=7,this.advanceShooter(i),this.resetSticks(i),i.table.balls[0].quaternion.identity(),!0)}isScratch(t){var e=t.gameState;return!!t.scratched&&(this.assignBalls(t,!1),t.call=14,e.turnState=7,this.advanceShooter(e),this.setBallOnTable(e,e.table.balls[0]),this.resetSticks(e),e.table.balls[0].quaternion.identity(),!0)}isNoRailNoPocketFoul(t){var e=t.gameState;return 0===t.ballRailCollisions.length&&0===t.sunk.length&&(this.assignBalls(t,!1),t.call=15,e.turnState=7,this.advanceShooter(e),this.resetSticks(e),e.table.balls[0].quaternion.identity(),!0)}normalShot(t){var e=t.gameState;let i=!1,s=!1;var n;null===e.teams[e.team].group&&(s=!0,0<t.sunk.length)&&this.isUniformStripeOrSolidGroup(t.sunk)&&(i=!0,0===e.team?(e.teams[0].group=Qi[t.sunk[0]],e.teams[1].group=this.getOpposingGroup(e.teams[0].group)):(e.teams[1].group=Qi[t.sunk[0]],e.teams[0].group=this.getOpposingGroup(e.teams[1].group))),this.assignBalls(t,i);let a=!1;if(s?0<t.sunk.length&&(a=!0):0<t.sunk.length&&(n=e.teams[e.team].group,this.containsBallType(t.sunk,n))&&(a=!0),i&&!a)throw new Error("Shouldnt happen?");a?(i?t.call=16:t.call=17,e.turnState=6):(t.call=18,e.turnState=6,this.advanceShooter(e)),this.resetSticks(e),e.table.balls[0].quaternion.identity()}assignBalls(e,t){var i=e.gameState;let s=!1,n=!1;if(n=t?(s=!0,!1):null!==i.teams[0].group?(s=!1,!1):(s=!0,!0),!n){let t=[];t=s?i.table.tray.ballNumbers:e.sunk;for(var a of t){var o=Qi[a];o===i.teams[0].group?i.teams[0].sunk.push(a):o===i.teams[1].group?i.teams[1].sunk.push(a):2===o&&i.teams[i.team].sunk.push(a)}if(i.teams[0].sunk.length+i.teams[1].sunk.length!==i.table.tray.ballNumbers.length)throw new Error("HERE")}}error(t,e){return e&&console.log("Rules error: "+t),!1}removeBallFromTray(t,e){e=t.ballNumbers.indexOf(e.num);0<=e&&t.ballNumbers.splice(e,1)}addBallToTray(t,e){var i=t.ballNumbers.indexOf(e.num);i<0&&t.ballNumbers.push(e.num)}resetBall(t,e){t.position.set(0,0),t.quaternion.identity(),t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0),t.depth=0,t.playState=e,0===t.playState||3===t.playState?t.motionState=0:t.motionState=1,t.sinkingPocket=null}resetSticks(t){t.table.sticks[0].position.copy(t.table.balls[0].position),t.table.sticks[0].elevation=0,t.table.sticks[0].englishDegrees=0,t.table.sticks[0].englishLength=0,t.table.sticks[0].pull=0,t.table.sticks[1].position.copy(t.table.balls[0].position),t.table.sticks[1].elevation=0,t.table.sticks[1].englishDegrees=0,t.table.sticks[1].englishLength=0,t.table.sticks[1].pull=0}hasBallOfTypeOnTable(t,e){for(var i of t.table.balls)if(0!==i.motionState&&i.group===e)return!0;return!1}declareWinner(t,e){t.turnState=9,t.team=e}containsBallType(e,i){for(let t=0;t<e.length;++t)if(Qi[e[t]]===i)return!0;return!1}getNumNumberBallsHitRail(t){let e=0;var i,s={};for(i of t)0!==i.ball.num&&!0!==s[i.ball.num]&&(s[i.ball.num]=!0,e++);return e}advanceShooter(t){0===t.team?t.team=1:t.team=0}isUniformStripeOrSolidGroup(e){if(0===e.length)throw new Error("FAIL");for(var t of e){t=Qi[t];if(0!==t&&1!==t)throw new Error("FAIL")}var i=Qi[e[0]];for(let t=1;t<e.length;++t)if(Qi[e[t]]!==i)return!1;return!0}getOpposingGroup(t){if(1===t)return 0;if(0===t)return 1;throw new Error("Fail")}setBallOnTable(t,e){this.removeBallFromTray(t.table.tray,e),this.resetBall(e,1)}setBallNotUsed(t,e){this.removeBallFromTray(t.table.tray,e),this.resetBall(e,0)}rack8Ball(e){for(var t of e.table.balls)this.setBallOnTable(e,t);var i,s=[],n=[];for(i of e.table.balls)0===i.group?s.push(i):1===i.group&&n.push(i);var a=new Array(e.table.balls.length-1),o=(a[4]=e.table.balls[8],e.random.next()<.5?(a[10]=e.random.removeNextItem(s),a[14]=e.random.removeNextItem(n)):(a[10]=e.random.removeNextItem(n),a[14]=e.random.removeNextItem(s)),n.concat(s));for(let t=0;t<a.length;++t)a[t]||(a[t]=e.random.removeNextItem(o));var r,h=(new v).unit(30,.05715),l=[new v(0,0),new v(h.x,-h.y),new v(h.x,h.y),new v(2*h.x,2*-h.y),new v(2*h.x,0),new v(2*h.x,2*h.y),new v(3*h.x,3*-h.y),new v(3*h.x,-h.y),new v(3*h.x,+h.y),new v(3*h.x,3*h.y),new v(4*h.x,4*-h.y),new v(4*h.x,2*-h.y),new v(4*h.x,0*h.y),new v(4*h.x,2*h.y),new v(4*h.x,4*h.y)];for(r of l)r.x-=-.417195;for(let t=0;t<a.length;++t){var d=a[t],c=l[t];d.position.copy(c)}e.table.balls[0].position.set(-.417195,0)}rackChallenge(e){var t,i=e.random,s=i.removeNextItem([0,1]),n=[];e.teams[0].group=s,e.teams[1].group=this.getOpposingGroup(s);for(t of e.table.balls)3===t.group||t.group===s?(this.setBallOnTable(e,t),n.push(t)):this.setBallNotUsed(e,t);for(var a=[];0<n.length;){var o,r=n[0],h=i.next()*e.table.tableBallInHandRect.width+e.table.tableBallInHandRect.x,l=i.next()*e.table.tableBallInHandRect.height+e.table.tableBallInHandRect.y;r.position.set(h,l);let t=!0;for(o of a)if(o.position.distance(r.position)<.05857875){t=!1;break}t&&(n.shift(),a.push(r))}}};class Vi{constructor(t){this.onCollision=new h,this.onPocketed=new h,this.onSunk=new h,this.num=null,this.group=null,this.id=null,this.position=new v(0,0),this.quaternion=new K(0,0,0,1),this.velocity=new g(0,0,0),this.angularVelocity=new g(0,0,0),this.depth=0,this.playState=0,this.motionState=0,this.sinkingPocket=null,this.deltaHull=new $,this.deltaVector=new v,this.deltaDistance=0,this.deltaDirection=new v,this.num=t,this.group=Qi[t],this.id=Ki[t]}pack(){if(!this.velocity.equals(0,0,0))throw new Error("Cannot pack while non zero velocity");if(!this.angularVelocity.equals(0,0,0))throw new Error("Cannot pack while non zero angular velocity");if(0!==this.depth&&1!==this.depth)throw new Error("Cannot pack while depth is not 0 and not 1");if(2===this.playState)throw new Error("Cannot pack while sinking");if(0!==this.motionState&&1!==this.motionState)throw new Error("Cannot pack with curret ball motion state: "+this.motionState);if(null!==this.sinkingPocket)throw new Error("Cannot pack while there is a sinking pocket set");if(1===this.playState){if(1!==this.motionState)throw new Error("ball is on table, but not stationary")}else if(0!==this.motionState)throw new Error("ball is not on table, but has a motion state");var t=new Array(8);return t[0]=this.position.x,t[1]=this.position.y,t[2]=this.quaternion.x,t[3]=this.quaternion.y,t[4]=this.quaternion.z,t[5]=this.quaternion.w,t[6]=this.playState,t[7]=this.motionState,t}validate(e,i){if("object"!=typeof e||null===e)return this.validateError("data is not a valid object",i);if(8!==e.length)return this.validateError("data is incorrect length",i);for(let t=0;t<e.length;++t)if("number"!=typeof e[t])return this.validateError("data contains something other than a number",i);if([0,1,3].indexOf(e[6])<0)return this.validateError("invalid play state",i);if([0,1].indexOf(e[7])<0)return this.validateError("invalid motion state",i);if(1===e[6]){if(1!==e[7])return this.validateError("in play but not stationary",i)}else if(0!==e[7])return this.validateError("not in play but stationary",i);return!0}validateError(t,e){return e&&console.log("PoolBall.validate error: "+t),!1}unpack(t){this.position.x=t[0],this.position.y=t[1],this.quaternion.x=t[2],this.quaternion.y=t[3],this.quaternion.z=t[4],this.quaternion.w=t[5],this.playState=t[6],this.motionState=t[7],this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),3===this.playState?this.depth=1:this.depth=0,this.sinkingPocket=null}matches(t,e){return this.position.x!==t[0]?this.matchesError("position.x",e):this.position.y!==t[1]?this.matchesError("position.y",e):this.quaternion.x!==t[2]?this.matchesError("quaternion.x",e):this.quaternion.y!==t[3]?this.matchesError("quaternion.y",e):this.quaternion.z!==t[4]?this.matchesError("quaternion.z",e):this.quaternion.w!==t[5]?this.matchesError("quaternion.w",e):this.playState!==t[6]?this.matchesError("playState",e):this.motionState===t[7]||this.matchesError("motionState",e)}matchesError(t,e){return e&&console.log("PoolBall.matches error: "+t),!1}updateDelta(t){2===this.motionState||3===this.motionState||4===this.motionState?(this.deltaVector.set(this.velocity.x*t,this.velocity.y*t),this.deltaDistance=this.deltaVector.length(),this.deltaHull.setXYXYRadius(this.position.x,this.position.y,this.position.x+this.velocity.x*t,this.position.y+this.velocity.y*t,.028575),0!==this.deltaDistance?(this.deltaDirection.x=this.deltaVector.x/this.deltaDistance,this.deltaDirection.y=this.deltaVector.y/this.deltaDistance):(this.deltaDirection.x=0,this.deltaDirection.y=0)):(this.deltaVector.set(0,0),this.deltaHull.setXYWH(this.position.x-.028575,this.position.y-.028575,.05715,.05715),this.deltaDirection.set(0,0))}isInPlay2(){return 0!==this.motionState}isPocketed2(){return 2===this.playState||3===this.playState}isInMotion2(){return 0!==this.motionState&&1!==this.motionState}updateMotionState2(){let t=this.motionState;var e,i=this.velocity.clone(),s=this.angularVelocity.clone();0===this.playState||3===this.playState?(t=0,i.set(0,0,0),s.set(0,0,0)):(e=new g(0,0,1).cross(this.angularVelocity).scale(.028575).add(this.velocity.clone().scale(1/(2*Math.PI))),R.vzeroAlt(this.velocity)?R.vzeroAlt(new g(0,0,this.angularVelocity.z))?(t=1,i.set(0,0,0),s.set(0,0,0)):(t=3,s.x=0,s.y=0):t=R.vzeroAlt(e)?4:2),this.velocity.copy(i),this.angularVelocity.copy(s),this.setMotionState2(t)}setMotionState2(t){this.motionState!==t&&(this.motionState=t)}}class ji{constructor(t){this.team=null,this.position=new v(0,0),this.pull=0,this.rotation=0,this.elevation=0,this.englishDegrees=0,this.englishLength=0,this.team=t}pack(){if(0!==this.pull)throw new Error("Cannot pack with stick pulled");var t=new Array(6);return t[0]=this.position.x,t[1]=this.position.y,t[2]=this.rotation,t[3]=this.elevation,t[4]=this.englishDegrees,t[5]=this.englishLength,t}validate(e,i){if("object"!=typeof e||null===e)return this.validateError("data is not a valid object",i);if(6!==e.length)return this.validateError("data is incorrect length",i);for(let t=0;t<e.length;++t)if("number"!=typeof e[t])return this.validateError("data contains something other than a number",i);return!0}validateError(t,e){return e&&console.log("PoolStick.validate error: "+t),!1}unpack(t){this.position.x=t[0],this.position.y=t[1],this.rotation=t[2],this.elevation=t[3],this.englishDegrees=t[4],this.englishLength=t[5],this.pull=0}matches(t,e){return this.position.x!==t[0]?this.matchesError("position.x",e):this.position.y!==t[1]?this.matchesError("position.y",e):this.rotation!==t[2]?this.matchesError("rotation",e):this.elevation!==t[3]?this.matchesError("elevation",e):this.englishDegrees!==t[4]?this.matchesError("englishDegrees",e):this.englishLength===t[5]||this.matchesError("englishLength",e)}matchesError(t,e){return e&&console.log("PoolStick.matches error: "+t),!1}}class Ui{constructor(){this.sticks=null,this.balls=null,this.outerEdges=[],this.innerEdges=[],this.pockets=new Array(6),this.tray=new es,this.tableBallInHandRect=new r,this.kitchenBallInHandRect=new r,this._outerWorkingPoint=new v,this._innerWorkingPoint=new v,this.intersections=[],this.createEdgesAndPockets(),this.sticks=[new ji(0),new ji(1)],this.balls=[new Vi(0),new Vi(1),new Vi(2),new Vi(3),new Vi(4),new Vi(5),new Vi(6),new Vi(7),new Vi(8),new Vi(9),new Vi(10),new Vi(11),new Vi(12),new Vi(13),new Vi(14),new Vi(15)];for(let e=0;e<this.balls.length;++e){for(let t=e+1;t<this.balls.length;++t){var i=new os(this.balls[e],this.balls[t]);this.intersections.push(i)}for(let t=0;t<this.outerEdges.length;++t){var s=new as(this.balls[e],this.outerEdges[t]);this.intersections.push(s)}for(let t=0;t<this.innerEdges.length;++t){var n=new as(this.balls[e],this.innerEdges[t]);this.intersections.push(n)}}}createEdgesAndPockets(){var t,e,i,s,n=this.pockets;this._outerWorkingPoint.set(-.72151875,-.38576249999999995),this.addOuterEdge(1,.6543675,0),this.addOuterEdge(1,.01857375,-.05714999999999999),this._innerWorkingPoint.copy(this._outerWorkingPoint),this.addOuterEdge(0,.03000375,-.03429),this.addOuterEdge(0,.0371475,0),this.addOuterEdge(0,.03000375,.03429),this.addInnerEdge(0,0,.03429),this.addInnerEdge(0,.03000375,.03429),this.addInnerEdge(0,.0371475,0),this.addInnerEdge(0,.03000375,-.03429),this.addInnerEdge(0,0,-.03429),n[0]=new ts(0,0,.00142875*-298,36*.00142875),this.addOuterEdge(2,.01857375,.05714999999999999),this.addOuterEdge(2,.6543675,0),t=this.addOuterEdge(2,.07572374999999999,-.05714999999999999),i=t.a.y,this._innerWorkingPoint.copy(this._outerWorkingPoint),this.addOuterEdge(0,20*.00142875,-.02143125),this.addOuterEdge(0,.03429,0),this.addOuterEdge(0,.03000375,.03000375),this.addOuterEdge(0,0,.03571875),this.addOuterEdge(0,-.02143125,19*.00142875),this.addInnerEdge(0,-.01143,20*.00142875),this.addInnerEdge(0,11*.00142875,.03857625),this.addInnerEdge(0,.03429,10*.00142875),this.addInnerEdge(0,23*.00142875,-.01000125),n[1]=new ts(1,586*.00142875,-.41290875,36*.00142875),this.addOuterEdge(3,.00142875*-40,.074295),this.addOuterEdge(3,0,.59436),t=this.addOuterEdge(3,40*.00142875,.074295),e=t.a.x,this._innerWorkingPoint.copy(this._outerWorkingPoint),this.addOuterEdge(0,.02143125,19*.00142875),this.addOuterEdge(0,0,.03571875),this.addOuterEdge(0,-.03000375,.03000375),this.addOuterEdge(0,-.03429,0),this.addOuterEdge(0,.00142875*-20,-.02143125),this.addInnerEdge(0,.00142875*-23,-.01000125),this.addInnerEdge(0,-.03429,10*.00142875),this.addInnerEdge(0,.00142875*-11,.03857625),this.addInnerEdge(0,.01143,20*.00142875),n[2]=new ts(2,586*.00142875,.41290875,36*.00142875),this.addOuterEdge(4,-.07572374999999999,-.05714999999999999),this.addOuterEdge(4,-.6543675,0),this.addOuterEdge(4,-.01857375,.05714999999999999),this._innerWorkingPoint.copy(this._outerWorkingPoint),this.addOuterEdge(0,-.03000375,.03429),this.addOuterEdge(0,-.0371475,0),this.addOuterEdge(0,-.03000375,-.03429),this.addInnerEdge(0,0,-.03429),this.addInnerEdge(0,-.03000375,-.03429),this.addInnerEdge(0,-.0371475,0),this.addInnerEdge(0,-.03000375,.03429),this.addInnerEdge(0,0,.03429),n[3]=new ts(3,0,298*.00142875,36*.00142875),this.addOuterEdge(5,-.01857375,-.05714999999999999),this.addOuterEdge(5,-.6543675,0),t=this.addOuterEdge(5,-.07572374999999999,.05714999999999999),s=t.a.y,this._innerWorkingPoint.copy(this._outerWorkingPoint),this.addOuterEdge(0,.00142875*-20,.02143125),this.addOuterEdge(0,-.03429,0),this.addOuterEdge(0,-.03000375,-.03000375),this.addOuterEdge(0,0,-.03571875),this.addOuterEdge(0,.02143125,.00142875*-19),this.addInnerEdge(0,.01143,.00142875*-20),this.addInnerEdge(0,.00142875*-11,-.03857625),this.addInnerEdge(0,-.03429,.00142875*-10),this.addInnerEdge(0,.00142875*-23,.01000125),n[4]=new ts(4,.00142875*-586,.41290875,36*.00142875),t=this.addOuterEdge(6,40*.00142875,-.074295),t=t.b.x,this.addOuterEdge(6,0,-.59436),this.addOuterEdge(6,.00142875*-40,-.074295),this._innerWorkingPoint.copy(this._outerWorkingPoint),this.addOuterEdge(0,-.02143125,.00142875*-19),this.addOuterEdge(0,0,-.03571875),this.addOuterEdge(0,.03000375,-.03000375),this.addOuterEdge(0,.03429,0),this.addOuterEdge(0,20*.00142875,.02143125),this.addInnerEdge(0,23*.00142875,.01000125),this.addInnerEdge(0,.03429,.00142875*-10),this.addInnerEdge(0,11*.00142875,-.03857625),this.addInnerEdge(0,-.01143,.00142875*-20),n[5]=new ts(5,.00142875*-586,-.41290875,36*.00142875),this.addOuterEdge(1,.07572374999999999,.05714999999999999),t+=.03000375,e-=.03000375,i+=.03000375,s-=.03000375,this.tableBallInHandRect.set(t,i,e-t,s-i),this.kitchenBallInHandRect.set(t,i,-.417195-t,s-i)}addOuterEdge(t,e,i){e=this._outerWorkingPoint.clone().addValues(e,i),i=new Zi(t,!1,this._outerWorkingPoint,e);return this._outerWorkingPoint.copy(e),this.outerEdges.push(i),i}addInnerEdge(t,e,i){e=this._innerWorkingPoint.clone().addValues(e,i),i=new Zi(t,!0,e,this._innerWorkingPoint);this._innerWorkingPoint.copy(e),this.innerEdges.push(i)}pack(){var t=new Array(19);return t[0]=this.sticks[0].pack(),t[1]=this.sticks[1].pack(),t[2]=this.balls[0].pack(),t[3]=this.balls[1].pack(),t[4]=this.balls[2].pack(),t[5]=this.balls[3].pack(),t[6]=this.balls[4].pack(),t[7]=this.balls[5].pack(),t[8]=this.balls[6].pack(),t[9]=this.balls[7].pack(),t[10]=this.balls[8].pack(),t[11]=this.balls[9].pack(),t[12]=this.balls[10].pack(),t[13]=this.balls[11].pack(),t[14]=this.balls[12].pack(),t[15]=this.balls[13].pack(),t[16]=this.balls[14].pack(),t[17]=this.balls[15].pack(),t[18]=this.tray.pack(),t}validate(e,i){if("object"!=typeof e||null===e)return this.validateError("data is not a valid object",i);if(19!==e.length)return this.validateError("data is incorrect length",i);if(!this.sticks[0].validate(e[0],i))return!1;if(!this.sticks[1].validate(e[1],i))return!1;if(!this.balls[0].validate(e[2],i))return!1;if(!this.balls[1].validate(e[3],i))return!1;if(!this.balls[2].validate(e[4],i))return!1;if(!this.balls[3].validate(e[5],i))return!1;if(!this.balls[4].validate(e[6],i))return!1;if(!this.balls[5].validate(e[7],i))return!1;if(!this.balls[6].validate(e[8],i))return!1;if(!this.balls[7].validate(e[9],i))return!1;if(!this.balls[8].validate(e[10],i))return!1;if(!this.balls[9].validate(e[11],i))return!1;if(!this.balls[10].validate(e[12],i))return!1;if(!this.balls[11].validate(e[13],i))return!1;if(!this.balls[12].validate(e[14],i))return!1;if(!this.balls[13].validate(e[15],i))return!1;if(!this.balls[14].validate(e[16],i))return!1;if(!this.balls[15].validate(e[17],i))return!1;if(!this.tray.validate(e[18],i))return!1;var s=e[18];for(let t=1;t<this.balls.length;++t){var n=this.balls[t],a=e[t+2];if(3===a[6]&&s.indexOf(n.num)<0)return this.validateError("sunk ball not in tray",i)}for(let t=0;t<s.length;++t){var o=s[t],o=e[o+2];if(3!==o[6])return this.validateError("tray contains ball that isn't sunk",i)}return!0}validateError(t,e){return e&&console.log("PoolTable.validate error: "+t),!1}unpack(t){this.sticks[0].unpack(t[0]),this.sticks[1].unpack(t[1]),this.balls[0].unpack(t[2]),this.balls[1].unpack(t[3]),this.balls[2].unpack(t[4]),this.balls[3].unpack(t[5]),this.balls[4].unpack(t[6]),this.balls[5].unpack(t[7]),this.balls[6].unpack(t[8]),this.balls[7].unpack(t[9]),this.balls[8].unpack(t[10]),this.balls[9].unpack(t[11]),this.balls[10].unpack(t[12]),this.balls[11].unpack(t[13]),this.balls[12].unpack(t[14]),this.balls[13].unpack(t[15]),this.balls[14].unpack(t[16]),this.balls[15].unpack(t[17]),this.tray.unpack(t[18])}matches(t,e){if(!this.sticks[0].matches(t[0],e))return!1;if(!this.sticks[1].matches(t[1],e))return!1;if(!this.balls[0].matches(t[2],e))return!1;if(!this.balls[1].matches(t[3],e))return!1;if(!this.balls[2].matches(t[4],e))return!1;if(!this.balls[3].matches(t[5],e))return!1;if(!this.balls[4].matches(t[6],e))return!1;if(!this.balls[5].matches(t[7],e))return!1;if(this.balls[6].matches(t[8],e))return!!(this.balls[7].matches(t[9],e)&&this.balls[8].matches(t[10],e)&&this.balls[9].matches(t[11],e)&&this.balls[10].matches(t[12],e)&&this.balls[11].matches(t[13],e)&&this.balls[12].matches(t[14],e)&&this.balls[13].matches(t[15],e)&&this.balls[14].matches(t[16],e)&&this.balls[15].matches(t[17],e)&&this.tray.matches(t[18],e));return!1}matchesError(t,e){return e&&console.log("PoolTable.matches error: "+t),!1}}function Wi(t){return 180*t/Math.PI}function $i(t,e){var i,s=2*Math.PI;return t<0&&(i=t/s,i=i-Math.trunc(i),t=(1+i)*s),s<=t&&(i=t/s,i=i-Math.trunc(i),t=i*s),1===e&&t>=Math.PI&&(t-=s),t}function Yi(t,e,i){var s=t.x,n=t.y;return t.x=s*e-n*i,t.y=s*i+n*e,qi(t),t}function qi(t){return Math.abs(+t.x)<1e-11&&(t.x=0),Math.abs(+t.y)<1e-11&&(t.y=0),t}Oi=R=R||{},Oi.projectPointToLineSegment=function(t,e,i,s){var i=i.clone().subtract(e),t=t.clone().subtract(e),n=i.x*i.x+i.y*i.y;let a;return a=0==n?0:(t.x*i.x+t.y*i.y)/n,a<0&&(a=0),1<a&&(a=1),s.set(e.x+a*i.x,e.y+a*i.y),a},Oi.angle=function(t,e,i,s){return e=Math.atan2(e.y-t.y,e.x-t.x),t=$i(e,i),1===s?t:Wi(t)},Oi.toDegrees=Wi,Oi.normalizeRadianAngleRange=$i,Oi.rotateCosSinPhi=Yi,Oi.fixVector2=qi,Oi.rotateCosSinPhiFastFiz=function(t,e,i){var s=t.x,n=t.y;return t.x=s*e-n*i,t.y=s*i+n*e,t},Oi.rotateDeg=function(t,e){return Yi(t,Math.cos(e*Math.PI/180),Math.sin(e*Math.PI/180))},Oi.fequal=function(t,e){return Math.abs(t-e)<1e-11},Oi.vzeroOld=function(t){return Math.abs(t)<1e-10},Oi.vzeroAlt=function(t){return Math.abs(t.x)<1e-10&&Math.abs(t.y)<1e-10&&Math.abs(t.z)<1e-10};class Xi{constructor(t,e,i,s,n=null,a=null){this.firstColPos=null,this.numRailsHit=0,this.call=0,this.pocketOrder=[],this.numRailColsUnpocketed=0,this.numBallColsUnpocketed=0,this.type=t,this.target=e,this.rotation=i,this.pull=s,this.x=n,this.y=a}}class Ji{constructor(t){this.running=!1,this.timeAccumulated=0,this.sunk=[],this.pocketOrder=[],this.scratched=!1,this.ballBallCollisions=[],this.ballRailCollisions=[],this.allCollisions=[],this.call=0,this.anyBallSunk=!1,this.anyBallBallCol=!1,this.numRailCols=0,this.lastAnyBallHitNum=null,this.firstColPos=new v,this.numRailColsUnpocketed=0,this.numBallColsUnpocketed=0,this.gameState=t}}const Qi=[3,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1],Ki=["cueBall","ball1","ball2","ball3","ball4","ball5","ball6","ball7","ball8","ball9","ball10","ball11","ball12","ball13","ball14","ball15"];class Zi{constructor(t,e,i,s){this.rail=t,this.a=new v(i.x,i.y),this.b=new v(s.x,s.y),this.isInner=e,this.center=new v(s.x,s.y).subtract(i).scale(.5).add(i),this.length=i.distance(s),this.lengthSquared=this.length*this.length,this.normal=(new v).unit(this.b.clone().subtract(this.a).rotation()+90,1),this.hull=(new $).setXYXY(this.a.x,this.a.y,this.b.x,this.b.y)}}class ts{constructor(t,e,i,s){this.id=t,this.position=new v(e,i),this.radius=s,this.radiusSquared=s*s}}class es{constructor(){this.ballNumbers=[]}pack(){return this.ballNumbers.slice()}validate(e,i){if("object"!=typeof e||null===e)return this.validateError("data is not a valid object",i);if("number"!=typeof e.length)return this.validateError("data is not array like",i);if(e.length<0||15<e.length)return this.validateError("data is incorrect length",i);var s={};for(let t=0;t<e.length;++t){if("number"!=typeof e[t])return this.validateError("data contains something other than a number",i);if(!Number.isInteger(e[t]))return this.validateError("data contains something other than a integer",i);if(e[t]<1||15<e[t])return this.validateError("data contains a non pool ball number",i);if(s[e[t]])return this.validateError("data contains same pool ball more than once",i);s[e[t]]=!0}return!0}validateError(t,e){return e&&console.log("PoolTableBallTray.validate error: "+t),!1}unpack(e){this.ballNumbers.length=e.length;for(let t=0;t<e.length;++t)this.ballNumbers[t]=e[t]}matches(e,i){if(e.length!==this.ballNumbers.length)return this.matchesError("entries.length",i);for(let t=0;t<e.length;++t)if(this.ballNumbers[t]!==e[t])return this.matchesError("entries["+t+"]",i);return!0}matchesError(t,e){return e&&console.log("PoolTableBallTray.matches error: "+t),!1}}{var I=Li=Li||{};class Qn{constructor(){this.time=0,this.normal=new v}}I.PoolGeomCollision=Qn;class Kn{constructor(){this.intersection=!1,this.strictIntersection=!1,this.t=null,this.u=null}}const Zn=.25;function is(t,e,i){var s=t.clone().subtract(e),i=i.clone().subtract(e),s=s.dot(i),s=s/i.lengthSquared();return t.copy(e).add(i.clone().scale(s)),s}function ss(t,e,i,s,n){var a=new Qn,o=i.clone().subtract(t),e=e+s,s=e*e-o.lengthSquared();if(s>Zn)a.time=0;else{a.time=-1;var s=o.length(),r=n.length(),h=s-e;if(r<h)return a;h=n.clone().normalize(),h=h.dot(o);if(h<=0)return a;o=s*s-h*h,s=e*e;if(s<=o)return a;e=s-o;if(e<0)return a;s=h-Math.sqrt(e);if(r<s)return a;a.time=s/r}return a.normal.copy(i).subtract(t.clone().add(n.clone().scale(a.time))).normalize(),a}I.circleLineSegment=function(e,i,s,n,a){var o=new Qn,t=e.clone(),r=is(t,s,n),h=i*i,l=e.clone().subtract(t).lengthSquared(),d=t.clone().subtract(e).normalize();if(l+Zn<h&&0<=r&&r<=1)return o.time=0,o.normal.copy(d),o;o.time=-1;var h=e.clone().add(a),c=(c=s,p=n,u=e,g=h,p=p.clone().subtract(c),g=g.clone().subtract(u),u=u.clone().subtract(c),c=u.cross(g),u=u.cross(p),p=p.cross(g),g=new Kn,0!==p&&(g.intersection=!0,g.t=c/p,g.u=u/p,g.strictIntersection=!(g.t<0||1<g.t||g.u<0||1<g.u)),g);if(!c.intersection){var u=s.clone().subtract(e).dot(a),p=n.clone().subtract(e).dot(a);let t;if(u<0){if(p<0)return o;t=n}else t=p<0||u<p?s:n;return ss(e,i,t,0,a)}var g=a.clone(),d=(c=g,u=d,p=c.dot(u)/u.dot(u),u=u.clone().scale(p),c.copy(u),g.length()),p=Math.sqrt(l)-i;if(d<p)return o;if(o.time=p/d,c=is(h,s,n),u=r,l=c,p=o.time,d=u+(l-u)*p,0<=d&&d<=1&&0<=g.dot(t.clone().subtract(e)))return o.normal.copy(t).subtract(e).normalize(),o;let m=1<r?n:s;return ss(e,i,m,0,a)}}class ns{constructor(t,e){this.isCollision=!1,this.t=0,this.type=t,this.ball=e}}class as extends ns{constructor(t,e){super(1,t),this._normal=new v,this.edge=e}test(){var t;this.isCollision=!1,this.t=0,this._normal.set(0,0),0===this.ball.motionState||this.edge.isInner&&2!==this.ball.playState||1!==this.ball.motionState&&0!==this.ball.deltaDistance&&2===this.ball.deltaHull.test(this.edge.hull)&&(t=Li.circleLineSegment(this.ball.position,.028575,this.edge.a,this.edge.b,this.ball.deltaVector),0<=t.time)&&(this.isCollision=!0,this.t=t.time,this._normal.copy(t.normal))}response(t){var e=this.ball.deltaDirection.clone(),i=this._normal.clone(),i=e.clone().subtract(i.clone().scale(2*i.dot(e))),e=(i.scale(.9*this.ball.velocity.length()),this.ball.velocity.set(i.x,i.y,0),this.ball.angularVelocity.scale(.1),this.ball.updateMotionState2(),{ball:this.ball,rail:this.edge.rail});t.allCollisions.push(e),t.ballRailCollisions.push(e),this.ball.onCollision.invoke(this)}getCueBallResponseDirection(t){var t=t.clone(),e=this._normal.clone(),e=t.clone().subtract(e.clone().scale(2*e.dot(t))),t=new v(e.x,e.y).normalize();return t}}class os extends ns{constructor(t,e){super(0,t),this.lengthRelVelocity=-1,this.otherBall=e}test(){if(this.isCollision=!1,this.t=0,this.ball.isInPlay2()&&this.otherBall.isInPlay2()&&!this.ball.isPocketed2()&&!this.otherBall.isPocketed2()&&(this.ball.isInMotion2()||this.otherBall.isInMotion2())&&(0!==this.ball.deltaDistance||0!==this.otherBall.deltaDistance)&&2===this.ball.deltaHull.test(this.otherBall.deltaHull)&&b.areObjectsConverging(this.ball.position,this.ball.velocity.toVector2(),this.otherBall.position,this.otherBall.velocity.toVector2())){var s=this.ball.deltaVector.clone().subtract(this.otherBall.deltaVector),n=this.ball.position.clone(),a=this.ball.position.clone().add(s),o=this.otherBall.position.clone(),a=a.clone().subtract(n),a=a.lengthSquared();if(0!==a){s=2*(s.x*(n.x-o.x)+s.y*(n.y-o.y)),n=(n.x-o.x)*(n.x-o.x)+(n.y-o.y)*(n.y-o.y)-.0032661225;let i=s*s-4*a*n;if(R.fequal(i,0)&&(i=0),!(i<=0)){let t=(-s+Math.sqrt(i))/(2*a),e=(-s-Math.sqrt(i))/(2*a);R.fequal(t,0)?t=0:R.fequal(t,1)&&(t=1),R.fequal(e,0)?e=0:R.fequal(e,1)&&(e=1);o=0<=t&&t<=1,n=0<=e&&e<=1;if(o&&n)this.t=Math.min(t,e);else if(o)this.t=t;else{if(!n)return;this.t=e}this.isCollision=!0}}}}response(t){var e=this.ball,i=this.otherBall,s=R.angle(e.position,i.position,0,0),n=(e.velocity.copy(R.rotateDeg(e.velocity.clone(),-s)),i.velocity.copy(R.rotateDeg(i.velocity.clone(),-s)),e.velocity.x),a=e.velocity.clone().add(i.velocity.clone().scale(-1)).add(new g(1,0,0).cross(e.angularVelocity.clone().add(i.angularVelocity)).scale(-.028575)),o=a.length(),r=(this.lengthRelVelocity=o,new g),h=(r.y=i.velocity.y+.01*n*a.y/o,r.x=e.velocity.x,r.z=0,new g);h.y=e.velocity.y-.01*n*a.y/o,h.x=i.velocity.x,h.z=0;let l=new g,d=new g;1===i.motionState||3===i.motionState?(a=new g(1,0,0).cross(a).scale(-.025*n/o/.028575/1.000575),l=i.angularVelocity.clone().add(a),d=e.angularVelocity.clone().add(a.clone().scale(-1))):(l.x=-r.y/.028575,l.y=r.x/.028575,l.z=i.angularVelocity.z,d.x=-h.y/.028575,d.y=h.x/.028575,d.z=e.angularVelocity.z),e.velocity.copy(h),i.velocity.copy(r),e.angularVelocity.copy(d),i.angularVelocity.copy(l),e.velocity.copy(R.rotateDeg(e.velocity.clone(),s)),i.velocity.copy(R.rotateDeg(i.velocity.clone(),s)),e.angularVelocity.copy(R.rotateDeg(e.angularVelocity.clone(),s)),i.angularVelocity.copy(R.rotateDeg(i.angularVelocity.clone(),s)),R.vzeroAlt(e.velocity)&&R.vzeroAlt(e.angularVelocity)&&(e.velocity.set(0,0,0),e.angularVelocity.set(0,0,e.angularVelocity.z)),R.vzeroAlt(i.velocity)&&R.vzeroAlt(i.angularVelocity)&&(i.velocity.set(0,0,0),i.angularVelocity.set(0,0,i.angularVelocity.z)),e.updateMotionState2(),i.updateMotionState2();n={a:this.ball,b:this.otherBall};t.allCollisions.push(n),t.ballBallCollisions.push(n),this.ball.onCollision.invoke(this)}getCueBallTangentDirection(t,e){t=this.otherBall.position.clone().subtract(t).normalize(),t=(new v).unit(t.rotation()+90),e=e.dot(t);return e<0&&t.scale(-1),t}getObjBallResponseDirection(t){return this.otherBall.position.clone().subtract(t).normalize()}}class rs{constructor(t=null){this.isPresent=!1,this.sessionId=null,this.wantsReplay=!1,this.team=null,this.team=t}pack(){var t=new Array(3);return t[0]=this.isPresent,t[1]=this.sessionId,t[2]=this.wantsReplay,t}validate(t,e){return"object"!=typeof t||null===t?this.validateError("data is not a valid object",e):3!==t.length?this.validateError("data is incorrect length",e):("boolean"!=typeof t[0]&&this.validateError("isPresent is invalid",e),t[0]?"string"!=typeof t[1]&&this.validateError("session id not specified while player is present",e):"string"!=typeof t[1]&&this.validateError("session id specified while player is not present",e),"boolean"!=typeof t[2]&&this.validateError("wantsReplay is invalid",e),!0)}validateError(t,e){return e&&console.log("GameplayRoomPlayer.validate error: "+t),!1}unpack(t){this.isPresent=t[0],this.sessionId=t[1],this.wantsReplay=t[2]}matches(t,e){return this.isPresent!==t[0]?this.matchesError("isPresent",e):this.sessionId!==t[1]?this.matchesError("sessionId",e):this.wantsReplay===t[2]||this.matchesError("wantsReplay",e)}matchesError(t,e){return e&&console.log("GameplayRoomPlayer.matches error: "+t),!1}}class hs{constructor(t,e){if(this.isLocal=null,this.isPublic=null,this.players=[new rs(0),new rs(1)],this.gameState=null,this.isLocal=t,"PrivateGameplay"===e)this.isPublic=!1;else{if("PublicGameplay"!==e)throw new Error("Unsuported gameRoomType: "+e);this.isPublic=!0}if(this.isLocal&&this.isPublic)throw new Error("Local rooms should never be public!")}initialize(t,e){if("object"!=typeof t||null===t)return this.initializeError("options is not a valid object",e);if(0===t.gameMode||1===t.gameMode||2===t.gameMode||3===t.gameMode){if(!this.isLocal)return this.initializeError("Local game rooms can only exist on local servers",e);if(this.isPublic)return this.initializeError("Local game rooms must be private",e);if(this.gameState=new Ni,!this.gameState.validate(t.packedGameState,e))return this.initializeError("options.packedGameState invalid",e);if(this.gameState.unpack(t.packedGameState),this.gameState.gameMode!==t.gameMode)return this.initializeError("options.gameMode does not match options.packedGameState",e)}else{if(4!==t.gameMode)return this.initializeError("options.gameMode not supported",e);if(this.isLocal)return this.initializeError("Remote game rooms can only exist on remote servers",e);if(this.gameState=new Ni(4),!A.newGame(this.gameState,e))return!1}return!0}initializeError(t,e){return e&&console.log("GameplayRoomState.initialize error: "+t),!1}isGameFull(){return this.players[0].isPresent&&this.players[1].isPresent}isPrivateOnline(){return!this.isLocal&&!this.isPublic}pack(){var t=new Array(3);return t[0]=this.players[0].pack(),t[1]=this.players[1].pack(),t[2]=this.gameState.pack(),t}validate(t,e){return"object"!=typeof t||null===t?this.validateError("data is not a valid object",e):3!==t.length?this.validateError("data is incorrect length",e):!!this.players[0].validate(t[0],e)&&!!this.players[1].validate(t[1],e)&&!!this.gameState.validate(t[2],e)}validateError(t,e){return e&&console.log("GameplayRoomState.validate error: "+t),!1}unpack(t){this.players[0].unpack(t[0]),this.players[1].unpack(t[1]),this.gameState.unpack(t[2])}matches(t,e){return!!this.players[0].matches(t[0],e)&&!!this.players[1].matches(t[1],e)&&!!this.gameState.matches(t[2],e)}matchesError(t,e){return e&&console.log("GameplayRoomState.matches error: "+t),!1}}class ls extends class{constructor(t){this.room=t,this.isLocalGameServerRoom=!!t.__FLAG_IS_LOCAL_GAME_SERVER_ROOM}}{constructor(){super(...arguments),this._numJoined=0,this._roomState=null}onCreate(t){ls.debug&&console.log("GameplayRoomController.onCreate",this.room.id,t),this._roomState=new hs(this.isLocalGameServerRoom,this.room.type),this._roomState.initialize(t,ls.debug)?this.isLocalGameServerRoom?this.room.maxClients=1:this.room.maxClients=2:(ls.debug&&console.log("   Failed to initialize room state, destroying the room"),this.room.disconnect())}onAuth(t,e,i){return ls.debug&&console.log("GameplayRoomController.onAuth",this.room.id,e),!(this._numJoined>=this.room.maxClients&&(ls.debug&&console.log("   Rejecting authenticating client, game room is full"),1))}onJoin(t,e,i){if(ls.debug&&console.log("GameplayRoomController.onJoin",this.room.id,e),this._numJoined>=this.room.maxClients)ls.debug&&console.log("   Rejecting joining client, game room is full"),t.leave(4300,"Too many clients");else{this._numJoined++,this._numJoined>=this.room.maxClients&&this.room.lock();e=this._roomState.pack();if(this.room.maxClients<=1)this._roomState.players[0].isPresent=this._roomState.players[1].isPresent=!0,this._roomState.players[0].sessionId=this._roomState.players[1].sessionId=t.sessionId;else for(var s of this._roomState.players)if(null===s.sessionId){s.isPresent=!0,s.sessionId=t.sessionId;break}this.room.broadcast("Join",{preState:e,sessionId:t.sessionId})}}onLeave(t,e){ls.debug&&console.log("GameplayRoomController.onLeave",this.room.id,t.sessionId,e);var i,e=this._roomState.pack();for(i of this._roomState.players)i.sessionId===t.sessionId&&(i.isPresent=!1,i.sessionId=null);let s=!0;this.isLocalGameServerRoom||this._roomState.isPublic||(s=!1),this.room.broadcast("Leave",{preState:e,sessionId:t.sessionId,terminating:s}),s?this.room.disconnect():(this._numJoined--,this._numJoined<this.room.maxClients&&this.room.unlock())}onMessage(e,t,i){ls.debug&&console.log("GameplayRoomController.onMessage",this.room.id,e.sessionId,t,i.playerIndex);var s=this._roomState.players[i.playerIndex];if(s)if(s.isPresent)if(s.sessionId!==e.sessionId)ls.debug&&console.log("   Booting them, Incorrect player!"),e.leave(1e3,"Incorrect player");else if(0!==s.team&&1!==s.team)ls.debug&&console.log("Booting them, Not a player 2!"),e.leave(1e3,"Not a player 2");else{s=this._roomState.pack();if("SetManualBreaker"===t){var n=i;A.setManualBreaker(this._roomState.gameState,n.breaker,ls.debug)}else if("SetRandomBreaker"===t)A.setRandomBreaker(this._roomState.gameState,ls.debug);else if("RotateStick"===t){var n=i,a=this._roomState.pack();A.rotateStick(this._roomState.gameState,n.degree,n.playerIndex,ls.debug)?this.room.broadcast("RotateStick",{preState:a,degree:n.degree},{except:e}):this.syncClient(e,a,"Stick rotation disallowed")}else if("AdjustSpin"===t){n=i,a=this._roomState.pack();A.adjustSpin(this._roomState.gameState,n.englishDegrees,n.englishLength,n.playerIndex,ls.debug)?this.room.broadcast("AdjustSpin",{preState:a,englishDegrees:n.englishDegrees,englishLength:n.englishLength},{except:e}):this.syncClient(e,a,"Adjust spin disallowed")}else if("AdjustElevation"===t){n=i,a=this._roomState.pack();A.adjustElevation(this._roomState.gameState,n.elevation,n.playerIndex,ls.debug)?this.room.broadcast("AdjustElevation",{preState:a,elevation:n.elevation},{except:e}):this.syncClient(e,a,"Adjust elevation disallowed")}else if("MoveCueBall"===t){n=i,a=this._roomState.pack();A.moveCueBall(this._roomState.gameState,n.x,n.y,n.playerIndex,ls.debug)?this.room.broadcast("MoveCueBall",{preState:a,x:n.x,y:n.y},{except:e}):this.syncClient(e,a,"Cue ball movement disallowed")}else if("Shot"===t){n=i,a=this._roomState.pack();A.isAllowedToMakeShot(this._roomState.gameState,n.pull,n.playerIndex,ls.debug)?this._roomState.gameState.validate(n.postGameState,ls.debug)?(this._roomState.gameState.unpack(n.postGameState),this.room.broadcast("Shot",{preState:a,pull:n.pull,call:n.call,postGameState:n.postGameState},{except:e})):this.syncClient(e,a,"Shot post state invalid"):this.syncClient(e,a,"Shot disallowed")}else if("ResolveInvalidBreak"===t){n=i,a=this._roomState.pack();A.resolveInvalidBreak(this._roomState.gameState,n.rebreaker,n.playerIndex,ls.debug)?this.room.broadcast("ResolveInvalidBreak",{preState:a,rebreaker:n.rebreaker},{except:e}):this.syncClient(e,a,"Resolve invalid break disallowed")}else if("Replay"===t){i=this._roomState.pack();if(A.isGameOver(this._roomState.gameState)){for(var o of this._roomState.players)o.sessionId===e.sessionId&&(o.wantsReplay=!0);let t=!0;for(var r of this._roomState.players)r.wantsReplay||(t=!1);if(t){A.newGame(this._roomState.gameState,ls.debug);for(var h of this._roomState.players)h.wantsReplay=!1;this.room.broadcast("Replay",{preState:i,postState:this._roomState.pack()})}}else this.syncClient(e,s,"Game is not over")}else this.syncClient(e,s,"Unknown message type.")}else ls.debug&&console.log("   Booting them, Player not present!"),e.leave(1e3,"Player not present");else ls.debug&&console.log("   Booting them, Not a player!"),e.leave(1e3,"Not a player")}syncClient(t,e,i){ls.debug&&console.log("   Disallowing and syncing client:",i),t.send("Sync",{preState:e})}}ls.debug=!1,Si.define("PublicGameplay",ls),Si.define("PrivateGameplay",ls);class ds{constructor(t,e,i){this.gameMode=null,this.isPublic=!1,this.roomId=null,this.packedGameState=null,this.gameMode=t,4===t&&!0===e&&(this.isPublic=!0),4===t&&!1===e?"string"==typeof i&&(this.roomId=i):this.packedGameState=e}isOnline(){return 4===this.gameMode}isPublicOnline(){return 4===this.gameMode&&this.isPublic}isJoinPrivateOnline(){return this.isOnline()&&!this.isPublic&&null!==this.roomId}isCreatePrivateOnline(){return this.isOnline()&&!this.isPublic&&null===this.roomId}}class cs{constructor(){this.cueBall=null,this.cueBallVelocity=new v,this.intersection=null}}class us{static main(t){u.onMessage.add(this.Thread_onMessage,this)}static Thread_onMessage(t){Date.now();var e=new Ni;if(!e.validate(t.data.packedGameState,!0))throw new Error("Game state validation failed");e.unpack(t.data.packedGameState),e.table.sticks[e.team].pull=t.data.pull;t=new Ji(e);if(!A.fullySimulateShot(t,!0))throw new Error("Simulation rejected!");u.sendMessage("done",{packedGameState:t.gameState.pack(),call:t.call})}}us.classpath="ShotRunner",u.register(us);const ps=u.isMainThread?new class extends nt{constructor(){super("com.games247."+k.info.gameType+".GameSettings"),this.mute=!1,this.fullscreen=c.defaultPreferFullscreen,this.levelSelectPage=1}save(){var t={};t.mute=this.mute,t.levelSelectPage=this.levelSelectPage,t.fullscreen=this.fullscreen,super.write(t)}load(){var t=super.read();this.mute=a.validateBoolean(t.mute,k.config.defaultMute),this.levelSelectPage=a.validateOneOf(t.levelSelectPage,[0,1,2,3],1),this.fullscreen=a.validateBoolean(t.fullscreen,c.defaultPreferFullscreen)}reset(){this.mute=k.config.defaultMute,this.levelSelectPage=1,this.fullscreen=c.defaultPreferFullscreen}}:null,gs=u.isMainThread?new class extends nt{constructor(){super("com.games247."+k.info.gameType+".GameAds"),this.launches=0,this.adPlacementOpportunities=0}save(){var t;"GameBundle"!==c.embed.type&&(t={},t.launches=this.launches,t.adPlacementOpportunities=this.adPlacementOpportunities,super.write(t))}load(){var t=super.read();this.launches=a.validateNumberMinInclusive(t.launches,0,0),this.adPlacementOpportunities=a.validateNumberMinInclusive(t.adPlacementOpportunities,0,0),this.launches++,this.save()}reset(){this.launches=0,this.adPlacementOpportunities=0}}:null,ms=u.isMainThread?new class extends nt{constructor(){super("com.games247."+k.info.gameType+"."+k.info.theme+".GameSave"),this.onePlayer=null,this.twoPlayer=null}hasInProgressGame(t){return t?!!this.onePlayer&&!!A.isGameStarted(this.onePlayer)&&!A.isGameOver(this.onePlayer):!!this.twoPlayer&&!!A.isGameStarted(this.twoPlayer)&&!A.isGameOver(this.twoPlayer)}save(){var t={};t.onePlayer=this.onePlayer?this.onePlayer.pack():null,t.twoPlayer=this.twoPlayer?this.twoPlayer.pack():null,super.write(t)}load(){var t=super.read();this.onePlayer=null;try{t.onePlayer&&(this.onePlayer=new Ni,this.onePlayer.validate(t.onePlayer,!0)?this.onePlayer.unpack(t.onePlayer):this.onePlayer=null)}catch(t){this.onePlayer=null}this.twoPlayer=null;try{t.twoPlayer&&(this.twoPlayer=new Ni,this.twoPlayer.validate(t.twoPlayer,!0)?this.twoPlayer.unpack(t.twoPlayer):this.twoPlayer=null)}catch(t){this.twoPlayer=null}}reset(){this.onePlayer=null,this.twoPlayer=null}}:null,ys=u.isMainThread?new class extends nt{constructor(){super("com.games247."+k.info.gameType+"."+k.info.theme+".GameRecords"),this.onePlayerShots=[null,null,null,null]}save(){var t={};t.shots=this.onePlayerShots,super.write(t)}load(){var t=super.read();t.shots&&"object"==typeof t.shots?(this.onePlayerShots[0]=a.validateNumberMinInclusive(t.shots[0],0,null),this.onePlayerShots[1]=a.validateNumberMinInclusive(t.shots[1],0,null),this.onePlayerShots[2]=a.validateNumberMinInclusive(t.shots[2],0,null),this.onePlayerShots[3]=a.validateNumberMinInclusive(t.shots[3],0,null)):this.reset()}reset(){this.onePlayerShots[0]=this.onePlayerShots[1]=this.onePlayerShots[2]=this.onePlayerShots[3]=null}}:null;class _s extends class{constructor(t){this.phase=null,this._changingPhase=!1,this.debug=!1,this.screen=t}disposePhase(){this.phase&&this.phase.dispose()}initializePhase(){this.phase&&this.phase.initialize()}next(t){if(this._changingPhase)throw new Error("Already changing phase!");if(this._changingPhase=!0,this.phase&&(this.debug&&l.debug("Stopping phase: "+this.phase),this.disposePhase(),this.phase.controller=null,this.phase.screen=null,this.phase=null),this._changingPhase=!1,t){if(t._consumed)throw new Error("Phases cannot be re-used!");t._consumed=!0,this.phase=t,this.phase.controller=this,this.phase.screen=this.screen,this.debug&&l.debug("Starting phase: "+this.phase),this.initializePhase()}}update(t){this.phase&&this.phase.update(t)}}{constructor(t,e){super(t),this.client=null,this.room=null,this.isJoinById=!1,this.roomState=null,this._queue=[],this.wasRoomFull=!1,this.shotRunner=new u(us),this.ai=new u(Yn),this.debug=!1,this.client=e.isOnline()?new Di(M.remoteHost.host):new Pi(M.localServer.endpoint);let i;e.isPublicOnline()?this.room=this.client.joinOrCreate("PublicGameplay",i={gameMode:e.gameMode}):e.isJoinPrivateOnline()?(this.isJoinById=!0,this.room=this.client.joinById("PrivateGameplay",e.roomId,i={gameMode:e.gameMode})):e.isCreatePrivateOnline()?this.room=this.client.create("PrivateGameplay",i={gameMode:e.gameMode}):e.isOnline()||(this.room=this.client.create("PrivateGameplay",i={gameMode:e.gameMode,packedGameState:e.packedGameState})),this.roomState=new hs(!e.isOnline(),this.room.type),this.roomState.initialize(i,!0),this.gameState=this.roomState.gameState,this.room.onConnecting.add(this.room_onConnecting,this),this.room.onConnected.add(this.room_onConnected,this),this.room.onConnectFailed.add(this.room_onConnectFailed,this),this.room.onDisconnected.add(this.room_onDisconnected,this),this.room.onError.add(this.room_onError,this),this.room.onMessage.add(this.room_onMessage,this),this.shotRunner.start(),this.ai.start()}dispose(){this.next(null),0!==this.room.connection.state&&this.room.disconnect(),this.shotRunner&&(this.shotRunner.stop(),this.shotRunner=null),this.ai&&(this.ai.stop(),this.ai=null)}sync(t){this.roomState.unpack(t),this.syncUI()}syncUI(){this.syncBallTray(),this.syncPlayerInfos(),this.syncMeters(),this.screen.shotsDisplay.setShots(this.getShotsToDisplay()),this.screen.invalidPositionMessage.hide(),this.screen.tableMessageDisplay.hide(),this.screen.tableDisplay.stickDisplays[0].setOrientationFromStick(this.gameState.table.sticks[0]),this.screen.tableDisplay.stickDisplays[1].setOrientationFromStick(this.gameState.table.sticks[1]),this.screen.tableDisplay.stickDisplays[0].setVisible(!1),this.screen.tableDisplay.stickDisplays[1].setVisible(!1),this.screen.tableDisplay.ballDisplays[0].setAiming(!1),this.screen.tableDisplay.ballDisplays[0].setAimVis(!1)}syncMeters(t){0===arguments.length&&(t=2,0===this.gameState.gameMode||2===this.gameState.gameMode||3===this.gameState.gameMode?t=0:4===this.gameState.gameMode?t=this.room.sessionId===this.roomState.players[0].sessionId?0:1:1!==this.gameState.gameMode||1!==this.gameState.turnState&&2!==this.gameState.turnState&&3!==this.gameState.turnState&&4!==this.gameState.turnState&&5!==this.gameState.turnState&&6!==this.gameState.turnState&&7!==this.gameState.turnState&&8!==this.gameState.turnState||(t=this.gameState.team)),2!==t?(this.screen.pullMeterDisplay.setPct(this.gameState.table.sticks[t].pull,!1),this.screen.rotationMeterDisplay.setDegree(this.gameState.table.sticks[t].rotation,!1),this.screen.spinMeterDisplay.setPolar(this.gameState.table.sticks[t].englishDegrees,this.gameState.table.sticks[t].englishLength,!1),this.screen.elevationMeterDisplay.setDegree(this.gameState.table.sticks[t].elevation,!1)):(this.screen.pullMeterDisplay.setPct(0,!1),this.screen.rotationMeterDisplay.setDegree(0,!1),this.screen.spinMeterDisplay.setPolar(0,0,!1),this.screen.elevationMeterDisplay.setDegree(0,!1))}syncBallTray(){this.screen.ballTrayDisplay.clearBalls();for(var t of this.gameState.table.tray.ballNumbers)this.screen.ballTrayDisplay.addBall(t,!1)}syncPlayerInfos(){let t=0,e=1;4===this.gameState.gameMode&&this.room.sessionId!==this.roomState.players[0].sessionId&&(t=1,e=0),this.screen.leftPlayerInfoDisplay=this.screen.playerInfoDisplays[t],this.screen.rightPlayerInfoDisplay=this.screen.playerInfoDisplays[e],this.screen.leftPlayerInfoDisplay.setName(this.getTeamName(t)),this.screen.rightPlayerInfoDisplay.setName(this.getTeamName(e)),this.screen.shotsDisplay.setShots(this.getShotsToDisplay()),this.screen.playerInfoDisplays[t].setGroup(this.gameState.teams[t].group),this.screen.playerInfoDisplays[e].setGroup(this.gameState.teams[e].group),this.screen.leftPlayerInfoDisplay.clearBalls();for(var i of this.gameState.teams[t].sunk)8!==i&&Qi[i]!==this.gameState.teams[t].group||this.screen.leftPlayerInfoDisplay.addBall(i,!1);this.screen.rightPlayerInfoDisplay.clearBalls();for(var s of this.gameState.teams[e].sunk)8!==s&&Qi[s]!==this.gameState.teams[e].group||this.screen.rightPlayerInfoDisplay.addBall(s,!1);this.screen.leftPlayerInfoDisplay.setActiveTurn(2),this.screen.rightPlayerInfoDisplay.setActiveTurn(2),this.screen.rightPlayerInfoDisplay.visible=3!==this.gameState.gameMode&&2!==this.gameState.gameMode}joined(t){if(this.roomState.isLocal)this.roomState.players[0].isPresent=this.roomState.players[1].isPresent=!0,this.roomState.players[0].sessionId=this.roomState.players[1].sessionId=t;else for(var e of this.roomState.players)if(null===e.sessionId){e.isPresent=!0,e.sessionId=t;break}this.roomState.isGameFull()&&(this.wasRoomFull=!0),this.syncUI()}left(t){for(var e of this.roomState.players)e.sessionId===t&&(e.isPresent=!1,e.sessionId=null);this.syncUI()}exit(t){this.screen.isOpenedByJoinLink,M.instance.navBar.home.hide(),this.screen.doClose(new Js(!0),t)}save(){0===this.gameState.gameMode?(ms.onePlayer=this.gameState,ms.save()):1===this.gameState.gameMode&&(ms.twoPlayer=this.gameState,ms.save())}getTeamName(t){var e=this.room,i=this.roomState,s=i.gameState;if(3===s.gameMode)return"Challenge";if(2===s.gameMode)return"Practice";if(0===s.gameMode){if(0===t)return"Player";if(1===t)return"Computer"}else if(1===s.gameMode){if(0===t)return"Player 1";if(1===t)return"Player 2"}else if(4===s.gameMode)return i.players[0].sessionId===e.sessionId?0===t?"You":"Them":1===t?"You":"Them";throw new Error("Should not happen!")}getTeamController(t){if(0===this.gameState.gameMode)return 0===t?1:2;if(1===this.gameState.gameMode)return 1;if(2===this.gameState.gameMode)return 0===t?1:0;if(3===this.gameState.gameMode)return 0===t?1:0;if(4===this.gameState.gameMode)return this.room.sessionId===this.roomState.players[0].sessionId?0===t?1:3:1===t?1:3;throw new Error("Unsupported game mode")}getShotsToDisplay(){return 4===this.gameState.gameMode?this.room.sessionId===this.roomState.players[0].sessionId?this.gameState.teams[0].shots:this.room.sessionId===this.roomState.players[1].sessionId?this.gameState.teams[1].shots:0:0===this.gameState.gameMode?this.gameState.teams[0].shots:this.gameState.teams[0].shots+this.gameState.teams[1].shots}hasEvents(){return 0<this._queue.length}peekEvent(){return 0<this._queue.length?this._queue[0]:null}nextEvent(){return 0<this._queue.length?this._queue.shift():null}requeueEvent(t){this._queue.unshift(t)}room_onConnecting(t){this.debug&&l.info("GameplayController.room_onConnecting"),this._queue.push(new ws(0))}room_onConnected(t){this.debug&&l.info("GameplayController.room_onConnected"),this._queue.push(new ws(1))}room_onConnectFailed(t){this.debug&&l.info("GameplayController.room_onConnectFailed"),this._queue.push(new ws(2))}room_onDisconnected(t){this.debug&&l.info("GameplayController.room_onDisconnected"),this._queue.push(new ws(3))}room_onError(t,e,i){this.debug&&l.info("GameplayController.room_onError",e,i),this._queue.push(new vs(e,i))}room_onMessage(t,e,i){this.debug&&l.info("GameplayController.room_onMessage",e),this._queue.push(new bs(e,i))}}class fs{constructor(t){this.eventType=t}}class ws extends fs{constructor(t){super(t)}}class vs extends fs{constructor(t,e){super(4),this.code=t,this.message=e}}class bs extends fs{constructor(t,e){super(5),this.type=t,this.message=e}}class xs extends class{constructor(){this.controller=null,this.screen=null,this._consumed=!1}initialize(){}dispose(){}update(t){}toString(){try{return"["+this.constructor.name+"]"}catch(t){return"[GamePhase]"}}}{constructor(){super(...arguments),this.processRoomEventsEnabled=!1}initialize(){}dispose(){this.processRoomEventsEnabled=!1}disconnect(){0!==this.controller.room.connection.state&&this.controller.room.disconnect()}unexpectedMessage(t,e){l.warn("Unexpected Message: "+e.type),this.controller.requeueEvent(e),this.controller.next(new ks(t.preState,new Cs))}outOfSync(t,e){l.warn("Out of sync! Found on message: "+e.type),"Sync"!==e.type&&this.controller.requeueEvent(e),this.controller.next(new ks(t.preState,new Cs))}fatal(t){l.warn("Fatal Unhandled Action: "+t),this.disconnect(),this.controller.next(new Bs(1,!1))}onConnecting(t){this.fatal("onConnecting")}onConnected(t){this.fatal("onConnected")}onConnectFailed(t){this.fatal("onConnectFailed")}onDisconnected(t){this.disconnect(),this.controller.next(new Bs(1,!1))}onError(t){l.warn("Received room error (code="+t.code+"): "+t.message),this.disconnect(),this.controller.next(new Bs(1,!1))}onMessage(t){if("Join"===t.type&&t.message.sessionId===this.controller.room.sessionId)this.onJoinSelf(t.message,t);else if("Replay"===t.type)this.onReplay(t.message,t);else if("Leave"===t.type)this.onLeave(t.message,t);else if("Sync"===t.type)this.outOfSync(t.message,t);else if(this.controller.roomState.matches(t.message.preState,!0))if("Join"===t.type)this.onJoinOther(t.message,t);else if("RotateStick"===t.type)this.onRotateStick(t.message,t);else if("AdjustSpin"===t.type)this.onAdjustSpin(t.message,t);else if("AdjustElevation"===t.type)this.onAdjustElevation(t.message,t);else if("MoveCueBall"===t.type)this.onMoveCueBall(t.message,t);else if("Shot"===t.type)this.onShot(t.message,t);else{if("ResolveInvalidBreak"!==t.type)throw new Error("Unknown message type: "+t.type);this.onResolveInvalidBreak(t.message,t)}else this.outOfSync(t.message,t)}onJoinSelf(t,e){this.fatal("onJoinSelf")}onJoinOther(t,e){this.unexpectedMessage(t,e)}onLeave(t,e){this.processRoomEventsEnabled=!1,this.controller.next(new Ds(t,e))}onRotateStick(t,e){this.unexpectedMessage(t,e)}onAdjustSpin(t,e){this.unexpectedMessage(t,e)}onAdjustElevation(t,e){this.unexpectedMessage(t,e)}onMoveCueBall(t,e){this.unexpectedMessage(t,e)}onShot(t,e){this.unexpectedMessage(t,e)}onResolveInvalidBreak(t,e){this.unexpectedMessage(t,e)}onReplay(t,e){this.unexpectedMessage(t,e)}processRoomEvents(){for(;this.processRoomEventsEnabled&&this.controller&&this.controller.hasEvents();){var t=this.controller.nextEvent();if(0===t.eventType)xs.debug&&l.log("Process Room Event: Connecting"),this.onConnecting(t);else if(1===t.eventType)xs.debug&&l.log("Process Room Event: Connected"),this.onConnected(t);else if(2===t.eventType)xs.debug&&l.log("Process Room Event: ConnectFailed"),this.onConnectFailed(t);else if(3===t.eventType)xs.debug&&l.log("Process Room Event: Disconnected"),this.onDisconnected(t);else if(4===t.eventType)xs.debug&&l.log("Process Room Event: Error"),this.onError(t);else{if(5!==t.eventType)throw new Error("Unknown room event type: "+t.eventType);xs.debug&&l.log("Process Room Event: Message ("+t.type+")"),this.onMessage(t)}}}update(t){this.processRoomEvents()}}xs.debug=!1;class Ss extends xs{initialize(){this.controller.next(new Fs)}}class ks extends xs{constructor(t,e){super(),this.syncState=t,this.nextPhase=e}initialize(){this.controller.sync(this.syncState),this.controller.next(this.nextPhase)}}class Cs extends xs{initialize(){if(this.controller.roomState.isGameFull())if(0===this.controller.roomState.gameState.turnState)this.controller.next(new Rs);else if(2===this.controller.roomState.gameState.turnState||1===this.controller.roomState.gameState.turnState||3===this.controller.roomState.gameState.turnState)this.controller.next(new As);else if(4===this.controller.gameState.turnState||5===this.controller.gameState.turnState)this.controller.next(new qs);else if(6===this.controller.gameState.turnState){var t=this.controller.gameState.gameMode,e=this.controller.gameState.team;0===t?0===e?this.screen.tableMessageDisplay.show("Welcome back. It is your shot."):this.screen.tableMessageDisplay.show("Welcome back. It is the computer's shot."):1===t?0===e?this.screen.tableMessageDisplay.show("Welcome back. It is Player 1's shot."):this.screen.tableMessageDisplay.show("Welcome back. It is Player 2's shot."):4===t?(i=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,e===i?this.screen.tableMessageDisplay.show("Welcome back. It is your shot."):this.screen.tableMessageDisplay.show("Welcome back. It is their shot.")):3===t&&0===this.controller.gameState.teams[0].shots&&this.screen.tableMessageDisplay.show("Clear the table without scratching!"),this.controller.next(new Ls)}else if(7===this.controller.gameState.turnState){var e=this.controller.gameState.gameMode,i=this.controller.gameState.team;0===e?0===i?this.screen.tableMessageDisplay.show("Welcome back. It is your shot with ball in hand."):this.screen.tableMessageDisplay.show("Welcome back. It is the computer's shot with ball in hand."):1===e?0===i?this.screen.tableMessageDisplay.show("Welcome back. It is Player 1's shot with ball in hand."):this.screen.tableMessageDisplay.show("Welcome back. It is Player 2's shot with ball in hand."):4===e&&(t=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,i===t?this.screen.tableMessageDisplay.show("Welcome back. It is your shot with ball in hand."):this.screen.tableMessageDisplay.show("Welcome back. It is their shot with ball in hand.")),this.controller.next(new Ls)}else if(8===this.controller.gameState.turnState){e=this.controller.gameState.gameMode,i=this.controller.gameState.team;0===e?0===i?this.screen.tableMessageDisplay.show("Welcome back. It is your shot with the ball in the kitchen."):this.screen.tableMessageDisplay.show("Welcome back. It is their shot with the ball in the kitchen."):1===e?0===i?this.screen.tableMessageDisplay.show("Welcome back. It is Player 1's shot with the ball in the kitchen."):this.screen.tableMessageDisplay.show("Welcome back. It is Player 2's shot with the ball in the kitchen."):4===e&&(t=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,i===t?this.screen.tableMessageDisplay.show("Welcome back. It is your shot with the ball in the kitchen."):this.screen.tableMessageDisplay.show("Welcome back. It is their shot with the ball in the kitchen.")),this.controller.next(new Ls)}else{if(9!==this.controller.gameState.turnState)throw new Error("Could not determine next phase");this.controller.next(new Ts)}else this.controller.next(new Ps)}}class Ts extends xs{constructor(){super()}initialize(){super.initialize();var t=this.controller.gameState.gameMode,e=this.controller.gameState,i=e.team,s=this.controller.gameState.difficulty;let n=this.controller.gameState.teams[0].time,a=!1;if(0===t){var o=e.teams[0].shots;if(0===i){let t=zi[s]+" - Num Shots "+o;20<=o&&(t=zi[s]+" - Num Shots >= 20"),bi.track("ScoreTracking",t),a=!1,(null===ys.onePlayerShots[s]||o<ys.onePlayerShots[s])&&(a=!0,ys.onePlayerShots[s]=o,ys.save(),this.screen.recordDisplay.timeTextField.text=o+" Shots"),a&&new x(S.sounds.record.data).play();var r=zi[s],r=new an(o,r,n,a,M.instance.calcStarRating(n,o,s),S.sounds.win,"Play Again");r.onClosing.add(this.winScreen_onClosing,this),this.screen.screenManager.add(r),this.gameOverScreen=r}else{r=new pn(o,zi[s],n,S.sounds.lose,"Play Again");r.onClosing.add(this.winScreen_onClosing,this),this.screen.screenManager.add(r),this.gameOverScreen=r}}else if(1===t){o=e.teams[0===i?0:1].shots,r=(n+=this.controller.gameState.teams[1].time,new an(o,"2 Player",n,a,M.instance.calcStarRating(n,o,s),S.sounds.win,"Play Again"));r.onClosing.add(this.winScreen_onClosing,this),this.screen.screenManager.add(r),this.gameOverScreen=r}else if(3===t){let t=!1;A.hasBallOfTypeOnTable(e,0)||A.hasBallOfTypeOnTable(e,1)||(t=!0),(t?(D.submit(n),new x(S.sounds.win.data)):new x(S.sounds.lose.data)).play();o=new pi(!0,n);this.dcOverScreen=o,o.onClosing.add(this.dcCompleteScreen_onClosing,this),this.screen.screenManager.add(o),o.panel.viewBoardButton.label.text="View Table"}else{s=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,r=e.teams[s].shots;n=this.controller.gameState.teams[s].time,i!==s?(t=new pn(r,"Online",n,S.sounds.lose,"Play Again"),t.onClosing.add(this.winScreen_onClosing,this),this.screen.screenManager.add(t),this.gameOverScreen=t):(o=new an(r,"Online",n,a,-1,S.sounds.win,"Play Again"),o.onClosing.add(this.winScreen_onClosing,this),this.screen.screenManager.add(o),this.gameOverScreen=o)}}dispose(){this.gameOverScreen&&this.gameOverScreen.onClosing.contains(this.winScreen_onClosing,this)&&this.gameOverScreen.onClosing.remove(this.winScreen_onClosing,this),this.dcOverScreen&&this.dcOverScreen.onClosing.contains(this.dcCompleteScreen_onClosing,this)&&this.dcOverScreen.onClosing.remove(this.dcCompleteScreen_onClosing,this),super.dispose()}winScreen_onClosing(t){t.onClosing.remove(this.winScreen_onClosing,this),t.toNewGame?this.controller.exit([t]):(t.exit(),this.controller.next(new Es))}dcCompleteScreen_onClosing(t){t.onClosing.remove(this.dcCompleteScreen_onClosing,this),this.controller.exit([t])}update(t){super.update(t)}}class Fs extends xs{initialize(){this._connectingScreen=new rn,this._connectingScreen.onCancel.add(this.connectingScreen_onCancel,this),this.screen.screenManager.add(this._connectingScreen),this.processRoomEventsEnabled=!0,this.controller.room.connect(),this.processRoomEvents()}dispose(){this._connectingScreen&&(this._connectingScreen.onCancel.remove(this.connectingScreen_onCancel,this),this._connectingScreen.exit(),this._connectingScreen=null)}onConnecting(t){}onConnected(t){}onConnectFailed(t){this.controller.next(new Bs(0,!1))}onJoinSelf(t){this.processRoomEventsEnabled=!1,this._connectingScreen.doClose(),this.controller.sync(t.preState),this.controller.joined(t.sessionId),this.controller.next(new Cs)}connectingScreen_onCancel(){this.processRoomEventsEnabled=!1,this.disconnect(),this._connectingScreen.doClose(),this.controller.exit()}}class Bs extends xs{constructor(t,e){super(),this._reason=t,this._animateOn=e}initialize(){0===this._reason?this.screen.isOpenedByJoinLink?this._disconnectedScreen=new hn("Connect Failed Screen","Room Not Found","The join link is no longer valid.",this._animateOn):this.controller.isJoinById?this._disconnectedScreen=new hn("Connect Failed Screen","Room Not Found","Please check the game code and try again.",this._animateOn):this._disconnectedScreen=new hn("Connect Failed Screen","Couldn't Connect","Please try again later.",this._animateOn):2===this._reason?this._disconnectedScreen=new hn("No Opponent Screen","No Opponent","Nobody joined the game. Please try again later.",this._animateOn):3===this._reason?this._disconnectedScreen=new hn("Turn Timeout Screen","Turn Timeout","Your turn took too long and you left the game.",this._animateOn):4===this._reason?this._disconnectedScreen=new hn("Opponent Quit Screen","Opponent Quit","Your opponent left the game.",this._animateOn):5===this._reason?this._disconnectedScreen=new hn("Opponent No Replay Screen","Opponent Left","Your opponent decided not to play again.",this._animateOn):this._disconnectedScreen=new hn("Disconnected Screen","Disconnected","Please check your connection.",this._animateOn),this._disconnectedScreen.onClose.add(this.disconnectedScreen_onClose,this),this.screen.screenManager.add(this._disconnectedScreen),this.disconnect(),super.initialize()}dispose(){this._disconnectedScreen&&(this._disconnectedScreen.onClose.remove(this.disconnectedScreen_onClose,this),this._disconnectedScreen.exit(),this._disconnectedScreen=null)}disconnectedScreen_onClose(){this._disconnectedScreen.doClose(),this.screen.isOpenedByJoinLink||M.instance.navBar.home.hide(),this.screen.doClose(new Js(!0),[this._disconnectedScreen])}}class Ps extends xs{constructor(){super(),this.timeout=this.timeout.bind(this)}initialize(){this.controller.roomState.isLocal||this.controller.wasRoomFull||(this.controller.roomState.isPublic?this.controller.roomState.isPublic&&bi.track("GameTracking","Public - Create Game"):bi.track("GameTracking","Private - Create Game")),this._waitingForOpponentScreen=new dn(this.controller.roomState.isPrivateOnline()?this.controller.room.id:null,this.controller.wasRoomFull),this._waitingForOpponentScreen.onCancel.add(this.waitingForOpponentScreen_onCancel,this),this.screen.screenManager.add(this._waitingForOpponentScreen),this.processRoomEventsEnabled=!0,this.processRoomEvents(),d.setTimeout(this.timeout,6e5,!1)}dispose(){this._waitingForOpponentScreen&&(this._waitingForOpponentScreen.onCancel.remove(this.waitingForOpponentScreen_onCancel,this),this._waitingForOpponentScreen.exit(),this._waitingForOpponentScreen=null),d.containsTimeout(this.timeout)&&d.clearTimeout(this.timeout)}onJoinOther(t){this.processRoomEventsEnabled=!1,this._waitingForOpponentScreen.doClose(),this.controller.roomState.isLocal||this.controller.wasRoomFull||(this.controller.roomState.isPublic?this.controller.roomState.isPublic&&bi.track("GameTracking","Public - Opponent Joined"):bi.track("GameTracking","Private - Opponent Joined")),this.controller.sync(t.preState),this.controller.joined(t.sessionId),this.controller.next(new Cs)}waitingForOpponentScreen_onCancel(){this.controller.roomState.isLocal||this.controller.wasRoomFull||(this.controller.roomState.isPublic?this.controller.roomState.isPublic&&bi.track("GameTracking","Public - Cancel Waiting For Opponent"):bi.track("GameTracking","Private - Cancel Waiting For Opponent")),this.processRoomEventsEnabled=!1,this.disconnect(),this._waitingForOpponentScreen.doClose(),this.controller.exit()}timeout(){this.controller.roomState.isLocal||this.controller.wasRoomFull||(this.controller.roomState.isPublic?this.controller.roomState.isPublic&&bi.track("GameTracking","Public - Timeout Waiting For Opponent"):bi.track("GameTracking","Private - Timeout Waiting For Opponent")),this.disconnect(),this.controller.next(new Bs(2,!1))}}class Ds extends xs{constructor(t,e){super(),this._msg=t,this._evt=e}initialize(){super.initialize(),this.controller.sync(this._msg.preState),this.controller.left(this._msg.sessionId),this._msg.terminating?this.controller.next(new Bs(4,!0)):this.controller.next(new Cs)}}class Es extends xs{constructor(){super(),this._canceled=!1,this._waitTimeLeft=6e5,this._lastTick=0,this.timeout=this.timeout.bind(this)}initialize(){var t,e;this._lastTick=Date.now(),super.initialize(),this._waitingScreen=new ln,this.screen.screenManager.add(this._waitingScreen),4!==this.controller.gameState.gameMode?1===this.controller.gameState.gameMode?(this._waitingScreen.exit(),e=this.screen.screenManager,this.screen.tableMessageDisplay.hide(),t=new Ni(1),A.newGame(t,!0),ms.twoPlayer=t,ms.save(),t=new ds(1,t.pack()),this.screen.exit(),e.add(new en(new Qs(t,!1,!1)))):(this._waitingScreen.exit(),e=this.screen.screenManager,this.screen.tableMessageDisplay.hide(),t=new Ni(0,this.controller.gameState.difficulty),A.newGame(t,!0),ms.onePlayer=t,ms.save(),t=new ds(0,t.pack()),this.screen.exit(),e.add(new en(new Qs(t,!1,!1)))):(2===this.controller.room.connection.state&&(e=this.controller.roomState.players[0].sessionId===this.controller.room.sessionId?0:1,this.controller.roomState.players[e].wantsReplay=!0,this.controller.room.send("Replay",{playerIndex:e})),this._waitingScreen.cancelButton.input.onPointerClick.add(this.cancelButton_onClick,this),d.setTimeout(this.timeout,6e4,!1),this.processRoomEventsEnabled=!0)}dispose(){this._waitingScreen.cancelButton.input.onPointerClick.contains(this.cancelButton_onClick,this)&&this._waitingScreen.cancelButton.input.onPointerClick.remove(this.cancelButton_onClick,this),this._waitingScreen.screenManager&&this._waitingScreen.exit(),d.containsTimeout(this.timeout)&&d.clearTimeout(this.timeout),super.dispose()}cancelButton_onClick(){this._waitingScreen.track("Close Button Pressed"),this._canceled=!0,0!==this.controller.room.connection.state&&this.controller.room.disconnect(),this._waitingScreen.doClose(),M.instance.navBar.home.hide(),this.screen.doClose(new Js(!0))}timeout(){this.disconnect(),this.controller.next(new Bs(5,!1))}onReplay(t,e){this._waitingScreen.exit(),this.controller.sync(t.postState),this.controller.next(new Cs)}}class Rs extends xs{initialize(){this._determineBreakerScreen=new cn(this.controller.gameState.gameMode,!0),this.screen.screenManager.add(this._determineBreakerScreen),this._determineBreakerScreen.playerBreakButton.input.onPointerClick.add(this.playerBreakButton_onClick,this),this._determineBreakerScreen.opponentBreakButton.input.onPointerClick.add(this.opponentBreakButton_onClick,this),this._determineBreakerScreen.randomBreakerButton.input.onPointerClick.add(this.randomBreakerButton_onClick,this),this._determineBreakerScreen.onRemoved.add(this.determineBreakerScreen_onRemoved,this)}dispose(){this._determineBreakerScreen.playerBreakButton.input.onPointerClick.remove(this.playerBreakButton_onClick,this),this._determineBreakerScreen.opponentBreakButton.input.onPointerClick.remove(this.opponentBreakButton_onClick,this),this._determineBreakerScreen.randomBreakerButton.input.onPointerClick.remove(this.randomBreakerButton_onClick,this),this._determineBreakerScreen.onRemoved.remove(this.determineBreakerScreen_onRemoved,this)}setManualBreaker(t){A.setManualBreaker(this.controller.gameState,t,!0),this.controller.save(),this.controller.room.send("SetManualBreaker",{playerIndex:0,breaker:t}),this._determineBreakerScreen.doClose()}setRandomBreaker(){A.setRandomBreaker(this.controller.gameState,!0),this.controller.save(),this.controller.room.send("SetRandomBreaker",{playerIndex:0}),this._determineBreakerScreen.doClose()}playerBreakButton_onClick(){this.setManualBreaker(0)}opponentBreakButton_onClick(){this.setManualBreaker(1)}randomBreakerButton_onClick(){this.setRandomBreaker()}determineBreakerScreen_onRemoved(){this.controller.next(new Cs)}}class As extends xs{constructor(){super(...arguments),this._nextDelay=200}initialize(){let t;var e=Math.random(),e=(t=e<.5?new x(S.sounds["rack-01"].data):new x(S.sounds["rack-02"].data),t.play(),this.controller.gameState),i=e.gameMode,s=e.turnState,e=e.team;let n=null;0===i?2===s?0===e?n="You will break.":1===e&&(n="The computer will break."):1===s&&(0===e?n="You won the toss and will break.":1===e&&(n="The computer won the toss and will break.")):1===i?2===s?0===e?n="Player 1 will break.":1===e&&(n="Player 2 will break."):1===s&&(0===e?n="Player 1 won the toss and will break.":1===e&&(n="Player 2 won the toss and will break.")):4===i&&(s=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,n=e===s?"You won the toss and will break.":"They won the toss and will break."),n?this.controller.screen.tableMessageDisplay.show(n):this.controller.screen.tableMessageDisplay.hide()}update(t){0<this._nextDelay&&(this._nextDelay-=t,this._nextDelay<=0)&&this.controller.next(new Ls),super.update(t)}}class Is extends xs{constructor(){super(),this.playerIndex=-1,this.timeout=this.timeout.bind(this)}initialize(){0===this.controller.gameState.lastShooter?this.playerIndex=1:this.playerIndex=0,this.team=this.playerIndex,this.playerInfoDisplay=this.screen.playerInfoDisplays[this.playerIndex],this.controller.screen.playerInfoDisplays[0].setActiveTurn(this.team),this.controller.screen.playerInfoDisplays[1].setActiveTurn(this.team),this._decisionScreen=new un(this.controller.gameState.gameMode),this._decisionScreen.onClosing.add(this.decisionScreen_onClosing,this),this._decisionScreen.onRemoved.add(this.decisionScreen_onRemoved,this),this.screen.screenManager.add(this._decisionScreen),4===this.controller.gameState.gameMode&&(d.setTimeout(this.timeout,6e4,!1),this.playerInfoDisplay.startTurnTimer(this.team,6e4))}dispose(){this._decisionScreen&&(this._decisionScreen.onRemoved.remove(this.decisionScreen_onRemoved,this),this._decisionScreen.onClosing.remove(this.decisionScreen_onClosing,this),this._decisionScreen.exit(),this._decisionScreen=null),d.containsTimeout(this.timeout)&&(d.clearTimeout(this.timeout),this.playerInfoDisplay.stopTurnTimer())}decisionScreen_onClosing(){d.containsTimeout(this.timeout)&&(d.clearTimeout(this.timeout),this.playerInfoDisplay.stopTurnTimer())}decisionScreen_onRemoved(){var t=this.controller.gameState.gameMode,e=this.controller.gameState.lastShotCall,i=this.controller.gameState.lastShooter,s=this._decisionScreen.result,n=this.controller.gameState;let a=null,o=2;if(0===s)if(0===this.controller.gameState.gameMode)A.resolveInvalidBreak(n,o=0,this.playerIndex,!0);else if(1===this.controller.gameState.gameMode)A.resolveInvalidBreak(n,o=0,this.playerIndex,!0);else{if(4!==this.controller.gameState.gameMode)throw new Error("Should not happen!");A.resolveInvalidBreak(n,o=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,this.playerIndex,!0)}else if(1===this._decisionScreen.result)if(0===this.controller.gameState.gameMode)A.resolveInvalidBreak(this.controller.gameState,o=1,this.playerIndex,!0);else if(1===this.controller.gameState.gameMode)A.resolveInvalidBreak(this.controller.gameState,o=1,this.playerIndex,!0);else{if(4!==this.controller.gameState.gameMode)throw new Error("Should not happen!");A.resolveInvalidBreak(this.controller.gameState,o=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?1:0,this.playerIndex,!0)}else 2===this._decisionScreen.result&&A.resolveInvalidBreak(n,2,this.playerIndex,!0);0===t?7===e?1===i&&(0===s?a="You decided to break.":1===s?a="The computer is rebreaking.":2===s&&(a="You decided to play the table as is and will shoot from the kitchen.")):6===e&&1===i&&(0===s?a="You decided to break.":1===s?a="The computer is rebreaking.":2===s&&(a="You decided to play the table as is. Your shot.")):1===t?7===e?0===i?0===s?a="Player 1 is rebreaking.":1===s?a="Player 2 is breaking.":2===s&&(a="Player 2 decided to play the table as is from the kitchen."):1===i&&(0===s?a="Player 1 is breaking.":1===s?a="Player 2 is rebreaking.":2===s&&(a="Player 1 decided to play it as is from the kitchen.")):6===e&&(0===i?0===s?a="Player 1 is rebreaking.":1===s?a="Player 2 is breaking.":2===s&&(a="Player 2 decided to play it as is. Player 2's shot."):1===i&&(0===s?a="Player 1 is breaking.":1===s?a="Player 2 is rebreaking.":2===s&&(a="Player 1 decided to play the table as is. Player 1's shot."))):4===t&&(t=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,t=0==t?1:0,7===e?i===t&&(0===s?a="You decided to break.":1===s?a="They are rebreaking":2===s&&(a="You decided to play the table as is and will shoot from the kitchen")):6===e&&i===t&&(0===s?a="You decided to break.":1===s?a="They are rebreaking.":2===s&&(a="You decided to play the table as is. Your shot."))),a&&this.screen.tableMessageDisplay.show(a),2===this.controller.room.connection.state&&this.controller.room.send("ResolveInvalidBreak",{playerIndex:this.playerIndex,rebreaker:o}),this.controller.screen.playerInfoDisplays[0].setActiveTurn(o),this.controller.screen.playerInfoDisplays[1].setActiveTurn(o),n.team!==i?this.controller.next(new Hs):this.controller.next(new zs)}timeout(){this.disconnect(),this.controller.next(new Bs(3,!1))}}class Ms extends xs{initialize(){super.initialize();var t=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,t=0==t?1:0;this.controller.screen.playerInfoDisplays[0].setActiveTurn(t),this.controller.screen.playerInfoDisplays[1].setActiveTurn(t),this.processRoomEventsEnabled=!0}onResolveInvalidBreak(t,e){this.processRoomEventsEnabled=!1;var t=t.rebreaker,i=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1,s=0==i?1:0,n=this.controller.gameState,a=this.controller.gameState.lastShotCall,o=this.controller.gameState.lastShooter;A.resolveInvalidBreak(n,t,s,!0);let r=null;7===a?o===i&&(t===i?r="They decided you will rebreak.":t===s?r="They decided they will break this time.":2===t&&(r="They decided to play the table as is from the kitchen.")):6===a&&o===i&&(t===i?r="They decided you will rebreak.":t===s?r="They decided they will break this time.":2===t&&(r="They decided to play the table as is. Their shot.")),r&&this.screen.tableMessageDisplay.show(r),this.controller.screen.playerInfoDisplays[0].setActiveTurn(t),this.controller.screen.playerInfoDisplays[1].setActiveTurn(t),n.team!==o?this.controller.next(new Hs):this.controller.next(new zs)}}class Os extends xs{constructor(){super(...arguments),this.playerIndex=-1,this._nextDelay=750}initialize(){0===this.controller.gameState.lastShooter?this.playerIndex=1:this.playerIndex=0,this.team=this.playerIndex,this.playerInfoDisplay=this.screen.playerInfoDisplays[this.playerIndex],this.controller.screen.playerInfoDisplays[0].setActiveTurn(this.team),this.controller.screen.playerInfoDisplays[1].setActiveTurn(this.team)}next(){var t=this.controller.gameState.gameMode,e=this.controller.gameState.lastShotCall,i=this.controller.gameState.lastShooter,s=this.controller.gameState;let n=2;if(0!==this.controller.gameState.gameMode)throw new Error("Should not happen!");A.resolveInvalidBreak(s,n=0,this.playerIndex,!0);let a=null;0===t&&(7===e?0===i&&(a="The computer decided you will rebreak."):6===e&&0===i&&(a="The computer decided you will rebreak.")),a&&this.screen.tableMessageDisplay.show(a),2===this.controller.room.connection.state&&this.controller.room.send("ResolveInvalidBreak",{playerIndex:this.playerIndex,rebreaker:n}),this.controller.screen.playerInfoDisplays[0].setActiveTurn(n),this.controller.screen.playerInfoDisplays[1].setActiveTurn(n),s.team!==i?this.controller.next(new Hs):this.controller.next(new zs)}update(t){0<this._nextDelay&&(this._nextDelay-=t,this._nextDelay<=0)&&this.next(),super.update(t)}}class Ls extends xs{initialize(){super.initialize(),this.controller.screen.playerInfoDisplays[0].setActiveTurn(this.controller.gameState.team),this.controller.screen.playerInfoDisplays[1].setActiveTurn(this.controller.gameState.team),this.controller.next(new zs)}}class Hs extends xs{constructor(){super()}initialize(){super.initialize(),this.controller.screen.playerInfoDisplays[0].setActiveTurn(2),this.controller.screen.playerInfoDisplays[1].setActiveTurn(2),this.controller.next(new Ls)}}class zs extends xs{initialize(){super.initialize(),this.screen.tableDisplay.ballLayer.setChildIndex(this.screen.tableDisplay.ballDisplays[0],this.screen.tableDisplay.ballLayer.children.length-1),this.screen.tableDisplay.ballDisplays[0].setInvis(!1);var t=this.controller.getTeamController(this.controller.gameState.team);if(1===t)this.controller.next(new Ns);else if(2===t)this.controller.next(new Us);else{if(3!==t)throw new Error("Should not happen!");this.controller.next(new Vs)}}}class Gs extends xs{constructor(){super(),this.playerIndex=-1,this._timerRunning=!1,this._cueBallInvalid=!1,this.timeout=this.timeout.bind(this)}initialize(){super.initialize(),this.playerIndex=this.team=this.controller.gameState.team,this.teamState=this.controller.gameState.teams[this.team],this.stick=this.controller.gameState.table.sticks[this.playerIndex],this.stickDisplay=this.screen.tableDisplay.stickDisplays[this.playerIndex],this.cueBall=this.controller.gameState.table.balls[0],this.cueBallDisplay=this.screen.tableDisplay.ballDisplays[0],this.playerInfoDisplay=this.screen.playerInfoDisplays[this.playerIndex],this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.cueBallDisplay.setAiming(!0),this.processRoomEventsEnabled=!0}updateCueBallValidity(){let t=!1;this.isCueBallDraggableTurn()&&(t=this.isCueBallInvalidPos(this.cueBall.position.x,this.cueBall.position.y)),this._cueBallInvalid=t,t?this.cueBallDisplay.markInvalid():this.cueBallDisplay.markValid(),t?this.screen.invalidPositionMessage.isShowing||this.screen.invalidPositionMessage.show("Invalid Position"):this.screen.invalidPositionMessage.isShowing&&this.screen.invalidPositionMessage.hide()}updateState(t){this.updateCueBallValidity(),this.updateCueBallBallAiming(),this.updateStickVisibility(),this.updateStickInteraction(),this.updatePathVisibility(),this.updateBallsClickable(),t&&this.isPathVisibilityAllowed()&&this.updateTrajectory()}updateCueBallBallAiming(){this.cueBallDisplay.setAimVis(this.isStickVisibilityAllowed())}updateStickVisibility(){this.stickDisplay.setVisible(this.isStickVisibilityAllowed())}updateStickInteraction(){this.screen.tableDisplay.stickLayer.input.pointerChildrenEnabled=this.isStickInteractionAllowed()}updatePathVisibility(){this.screen.tableDisplay.pathDisplay.visible=this.isPathVisibilityAllowed()}updateBallsClickable(){var t,e=this.isCueBallClickAllowed(),i=this.isObjBallClickAllowed(),s=this.isAimDraggingAllowed();for(t of this.screen.tableDisplay.ballDisplays)3===t.group?t.input.pointerEnabled=e:t.input.pointerEnabled=i;this.cueBallDisplay.canPlace=e,this.screen.pointerCatchLayer.input.pointerEnabled=s}updateTrajectory(){this.screen.tableDisplay.pathDisplay.updatePath(this.computeTrajectory(this.stick.rotation)),this.screen.tableDisplay.pathDisplay.updatePull(this.stick.pull)}isCueBallDraggableTurn(){return 2===this.controller.gameState.turnState||1===this.controller.gameState.turnState||3===this.controller.gameState.turnState||7===this.controller.gameState.turnState||8===this.controller.gameState.turnState}isCueBallInvalidPos(t,e){var i,s=new v(t,e);let n=!1;for(i of this.controller.gameState.table.balls)if(3!==i.group&&i.isInPlay2()&&i.position.distance(s)<.05857875){n=!0;break}return n}computeTrajectory(t){for(var e of this.controller.gameState.table.balls){if(0!==e.motionState&&1!==e.motionState)throw new Error("some ball is in motion");if(2===e.playState)throw new Error("some ball is sinking")}if(1!==this.cueBall.motionState)throw new Error("cue ball not on table");var i,s=new cs;s.cueBall=this.cueBall,s.cueBallVelocity.unit(t).scale(2.143125),this.cueBall.angularVelocity.set(0,0,0),this.cueBall.velocity.set(s.cueBallVelocity.x,s.cueBallVelocity.y,0),this.cueBall.motionState=4;for(i of this.controller.gameState.table.balls)i.updateDelta(1);var n,a=[];let o=1;for(n of this.controller.gameState.table.intersections)n.ball===this.cueBall&&(n.test(),n.isCollision)&&(n.t<o?(o=n.t,a.length=0,a.push(n)):n.t===o&&a.push(n));if(0===a.length)throw new Error("could not find intersection!");var r,t=a[0];s.intersection=t,this.cueBall.angularVelocity.set(0,0,0),this.cueBall.velocity.set(0,0,0),this.cueBall.motionState=1;for(r of this.controller.gameState.table.balls)r.updateDelta(1);return s}startTimer(){this._timerRunning=!0,4===this.controller.gameState.gameMode&&(d.setTimeout(this.timeout,6e4,!1),this.playerInfoDisplay.startTurnTimer(this.team,6e4))}tickTimer(t){this._timerRunning&&(this.teamState.time+=t)}stopTimer(){this._timerRunning=!1,d.containsTimeout(this.timeout)&&d.clearTimeout(this.timeout),this.playerInfoDisplay.stopTurnTimer()}timeout(){this.onTurnTimeout()}update(t){this.tickTimer(t),super.update(t)}}class Ns extends Gs{constructor(){super(...arguments),this._draggingCueBall=!1,this._pickupOffsetCueBall=new v,this._cueBallSafePos=new v,this._aimDragging=!1,this._pickupOffsetAimDragging=new v,this._pickupNormOffsetAimDragging=new v,this._pickupRotationOffsetAimDragging=0,this._pickupStickRotationAimDragging=0,this._stickDragging=!1,this._pickupOffsetStick=new v,this.inputEnabled=!1,this._isPullMeterDragging=!1,this._isRotMeterDragging=!1,this._elevationScreen=null,this._spinScreen=null,this._highlightGroup=null}initialize(){super.initialize(),this.controller.syncMeters(this.team),this.enableInput(),this.startTimer(),4===this.controller.gameState.gameMode&&new x(S.sounds["turn-notification"].data).play(),this.updateState(!0)}dispose(){this.stopTimer(),this.disableInput(),this._elevationScreen&&this._elevationScreen.exit(),this._elevationScreen=null,this._spinScreen&&this._spinScreen.exit(),this._spinScreen=null,this.updateState(!0)}isStickVisibilityAllowed(){return!this._draggingCueBall&&!this._cueBallInvalid}isStickInteractionAllowed(){return!(!this.inputEnabled||this._draggingCueBall||this._cueBallInvalid||this._aimDragging||this._stickDragging||this._isRotMeterDragging||this._isPullMeterDragging)}isPathVisibilityAllowed(){return!(!this.inputEnabled||this._draggingCueBall||this._cueBallInvalid)}isCueBallClickAllowed(){let t=!1;return!(this.inputEnabled&&this.screen.pullMeterDisplay.pct<=0)||this._isRotMeterDragging||this._isPullMeterDragging||this._stickDragging||this._aimDragging||this._draggingCueBall||!this.isCueBallDraggableTurn()||(t=!0),t}isObjBallClickAllowed(){let t=!1;return!(this.inputEnabled&&this.screen.pullMeterDisplay.pct<=0)||this._isRotMeterDragging||this._isPullMeterDragging||this._stickDragging||this._aimDragging||this._draggingCueBall||this._cueBallInvalid||(t=!0),t}isAimDraggingAllowed(){let t=!1;return!(this.inputEnabled&&this.screen.pullMeterDisplay.pct<=0)||this._isRotMeterDragging||this._isPullMeterDragging||this._stickDragging||this._draggingCueBall||this._cueBallInvalid||(t=!0),t}adjustSpin(t,e){if(1<e&&(e=1),!A.adjustSpin(this.controller.gameState,t,e,this.team,!0))throw new Error("Stick spin rejected");this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick)}sendSpin(){2===this.controller.room.connection.state&&this.controller.room.send("AdjustSpin",{playerIndex:this.playerIndex,englishDegrees:this.stick.englishDegrees,englishLength:this.stick.englishLength})}spinMeterDisplay_onClicked(){var t=new Zs(this.screen,this.team);this._spinScreen=t,this.screen.screenManager.add(t),this.cueBallDisplay.updateHitFromStick(this.stick)}spinMeterDisplay_onChanged(){this.adjustSpin(this.screen.spinMeterDisplay.degree,this.screen.spinMeterDisplay.length)}spinMeterDisplay_onDropped(){this.sendSpin()}adjustElevation(t){if(t<0&&(t=0),85<t&&(t=85),!A.adjustElevation(this.controller.gameState,t,this.team,!0))throw new Error("Stick elevation rejected");this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick)}sendElevation(){2===this.controller.room.connection.state&&this.controller.room.send("AdjustElevation",{playerIndex:this.playerIndex,elevation:this.stick.elevation})}elevationMeterDisplay_onClicked(){var t=new tn(this.screen,this.team);this._elevationScreen=t,this.screen.screenManager.add(t),this.cueBallDisplay.updateHitFromStick(this.stick)}elevationMeterDisplay_onChanged(){this.adjustElevation(this.screen.elevationMeterDisplay.degree)}elevationMeterDisplay_onDropped(){this.sendElevation()}rotateStick(t){if(!A.rotateStick(this.controller.gameState,t,this.team,!0))throw new Error("Stick rotation rejected");this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick)}sendRotation(){2===this.controller.room.connection.state&&this.controller.room.send("RotateStick",{playerIndex:this.playerIndex,degree:this.stick.rotation})}rotationMeterDisplay_onPickedUp(){this._isRotMeterDragging=!0,this.updateState(!1)}rotationMeterDisplay_onChanged(){this.rotateStick(this.screen.rotationMeterDisplay.degree),this.updateState(!0)}rotationMeterDisplay_onDropped(){this._isRotMeterDragging=!1,this.updateState(!1),this.sendRotation()}objectBall_onClick(t){t=t.ball,t=t.position.clone().subtract(this.cueBall.position),t=t.rotation();this.controller.screen.rotationMeterDisplay.setDegree(t,!0),this.rotationMeterDisplay_onDropped()}moveCueBall(t,e){if(!A.moveCueBall(this.controller.gameState,t,e,this.team,!0))throw new Error("Cue ball movement rejected");this.stickDisplay.setOrientationFromStick(this.stick)}sendCueBallPosition(){2===this.controller.room.connection.state&&this.controller.room.send("MoveCueBall",{playerIndex:this.playerIndex,x:this.cueBall.position.x,y:this.cueBall.position.y})}pickupCueBall(){var t;this._draggingCueBall||this._aimDragging||this._stickDragging||(this._draggingCueBall=!0,this._cueBallSafePos.copy(this.cueBall.position),t=new v(w.primary.x,w.primary.y),this.screen.tableDisplay.ballLayer.globalToLocal(t),t.scale(.00142875),this._pickupOffsetCueBall.copy(t).subtract(this.cueBall.position),w.primary.onMove.add(this.primary_onMove_cueBall,this),w.primary.onRelease.add(this.primary_onReleaseCancel_cueBall,this),w.primary.onCancel.add(this.primary_onReleaseCancel_cueBall,this),this.screen.tableDisplay.ballDragLayer.addChild(this.cueBallDisplay),this.updateState(!1),P.overrideCursorType="grabbing")}dragCueBall(){if(this._draggingCueBall){var e=new v(w.primary.x,w.primary.y);this.screen.tableDisplay.ballLayer.globalToLocal(e),e.scale(.00142875),e.subtract(this._pickupOffsetCueBall);let t=this.controller.gameState.table.tableBallInHandRect;2!==this.controller.gameState.turnState&&1!==this.controller.gameState.turnState&&3!==this.controller.gameState.turnState&&8!==this.controller.gameState.turnState||(t=this.controller.gameState.table.kitchenBallInHandRect),e.x<t.x&&(e.x=t.x),e.x>t.right&&(e.x=t.right),e.y<t.y&&(e.y=t.y),e.y>t.bottom&&(e.y=t.bottom),this.moveCueBall(e.x,e.y),this.updateState(!1)}}dropCueBall(){this._draggingCueBall&&(this._draggingCueBall=!1,w.primary.onMove.remove(this.primary_onMove_cueBall,this),w.primary.onRelease.remove(this.primary_onReleaseCancel_cueBall,this),w.primary.onCancel.remove(this.primary_onReleaseCancel_cueBall,this),this.screen.tableDisplay.ballLayer.addChild(this.cueBallDisplay),P.overrideCursorType=null,this.updateState(!1),this._cueBallInvalid&&(this.moveCueBall(this._cueBallSafePos.x,this._cueBallSafePos.y),this.updateState(!1)),this.stickDisplay.setOrientationFromStick(this.stick),this.updateState(!0),this.sendCueBallPosition())}cueBall_onPointerPress(){this.pickupCueBall()}primary_onMove_cueBall(){this.dragCueBall()}primary_onReleaseCancel_cueBall(){this.dropCueBall()}pickupAimDragging(){var t;this._aimDragging||this._draggingCueBall||this._stickDragging||(this._aimDragging=!0,t=new v(w.primary.x,w.primary.y),this.screen.tableDisplay.ballLayer.globalToLocal(t),t.scale(.00142875),this._pickupOffsetAimDragging.copy(t).subtract(this.cueBall.position),this._pickupNormOffsetAimDragging.copy(this._pickupOffsetAimDragging).normalize(),this._pickupRotationOffsetAimDragging=this._pickupNormOffsetAimDragging.rotation(),this._pickupStickRotationAimDragging=this.stick.rotation,w.primary.onMove.add(this.pointerCatchLayer_onMove_aimDragging,this),w.primary.onRelease.add(this.pointerCatchLayer_onReleaseCancel_aimDragging,this),w.primary.onCancel.add(this.pointerCatchLayer_onReleaseCancel_aimDragging,this),this.updateState(!1),P.overrideCursorType="move")}dragAimDragging(){var t=new v(w.primary.x,w.primary.y),t=(this.screen.tableDisplay.ballLayer.globalToLocal(t),t.scale(.00142875),t.clone().subtract(this.cueBall.position)),t=t.clone().normalize(),t=t.rotation(),t=t-this._pickupRotationOffsetAimDragging,t=this._pickupStickRotationAimDragging+t;this.screen.rotationMeterDisplay.setDegree(t,!0)}dropAimDragging(){this._aimDragging&&(this._aimDragging=!1,w.primary.onMove.remove(this.pointerCatchLayer_onMove_aimDragging,this),w.primary.onRelease.remove(this.pointerCatchLayer_onReleaseCancel_aimDragging,this),w.primary.onCancel.remove(this.pointerCatchLayer_onReleaseCancel_aimDragging,this),P.overrideCursorType=null,this.updateState(!1),this.sendRotation())}pointerCatchLayer_onPointerPress(){this.pickupAimDragging()}pointerCatchLayer_onMove_aimDragging(){this.dragAimDragging()}pointerCatchLayer_onReleaseCancel_aimDragging(){this.dropAimDragging()}adjustPull(t){if(t<0&&(t=0),1<t&&(t=1),!A.adjustPull(this.controller.gameState,t,this.team,!0))throw new Error("Stick pull rejected");this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick)}sendPull(){}pullMeterDisplay_onPickedUp(){this._isPullMeterDragging=!0,this.updateState(!1)}pullMeterDisplay_onChanged(){this.adjustPull(this.screen.pullMeterDisplay.pct),this.updateState(!0)}pullMeterDisplay_onDropped(){this._isPullMeterDragging=!1,this.updateState(!1),0<this.stick.pull&&this.makeShot()}pickupStick(){var t;this._draggingCueBall||this._aimDragging||this._stickDragging||(this._stickDragging=!0,t=new v(w.primary.x,w.primary.y),this.screen.tableDisplay.ballLayer.globalToLocal(t),t.scale(.00142875),this._pickupOffsetStick.copy(t),w.primary.onMove.add(this.primary_onMove_stick,this),w.primary.onRelease.add(this.primary_onReleaseCancel_stick,this),w.primary.onCancel.add(this.primary_onReleaseCancel_stick,this),this.updateState(!1),P.overrideCursorType="grabbing")}dragStick(){var t=(new v).unit(this.stick.rotation),t=t.clone().scale(-1),e=this._pickupOffsetStick.clone(),t=this._pickupOffsetStick.clone().add(t.clone().scale(.2143125)),i=new v(w.primary.x,w.primary.y),s=(this.screen.tableDisplay.ballLayer.globalToLocal(i),i.scale(.00142875),new v),i=R.projectPointToLineSegment(i,e,t,s);this.screen.pullMeterDisplay.setPct(i,!0)}dropStick(t){this._stickDragging&&(this._stickDragging=!1,w.primary.onMove.remove(this.primary_onMove_stick,this),w.primary.onRelease.remove(this.primary_onReleaseCancel_stick,this),w.primary.onCancel.remove(this.primary_onReleaseCancel_stick,this),P.overrideCursorType=null,this.updateState(!1),t?this.screen.pullMeterDisplay.setPct(0,!0):0<this.stick.pull&&this.makeShot())}stick_onPointerPress(){this.pickupStick()}primary_onMove_stick(){this.dragStick()}primary_onReleaseCancel_stick(){this.dropStick(!1)}makeShot(){!this._aimDragging&&!this._draggingCueBall||!this._stickDragging&&this._cueBallInvalid&&0<this.stick.pull?this.controller.next(new Ws):this.screen.pullMeterDisplay.setPct(0,!0)}rerackButton_onClick(){var t=this.screen.screenManager,e=(this.screen.tableMessageDisplay.hide(),new Ni(2)),e=(A.newGame(e,!0),new ds(2,e.pack()));this.screen.exit(),t.add(new en(new Qs(e,!1,!1)))}onTurnTimeout(){this.disconnect(),this.controller.next(new Bs(3,!0))}enableInput(){if(this.inputEnabled)throw new Error("Already enabled!");this.inputEnabled=!0,this.screen.rotationMeterDisplay.onPickedUp.add(this.rotationMeterDisplay_onPickedUp,this),this.screen.rotationMeterDisplay.onChanged.add(this.rotationMeterDisplay_onChanged,this),this.screen.rotationMeterDisplay.onDropped.add(this.rotationMeterDisplay_onDropped,this),this.screen.rotationMeterDisplay.enableInput(),this.screen.pullMeterDisplay.onPickedUp.add(this.pullMeterDisplay_onPickedUp,this),this.screen.pullMeterDisplay.onChanged.add(this.pullMeterDisplay_onChanged,this),this.screen.pullMeterDisplay.onDropped.add(this.pullMeterDisplay_onDropped,this),this.screen.pullMeterDisplay.enableInput(),this.screen.spinMeterDisplay.onClicked.add(this.spinMeterDisplay_onClicked,this),this.screen.spinMeterDisplay.onChanged.add(this.spinMeterDisplay_onChanged,this),this.screen.spinMeterDisplay.onDropped.add(this.spinMeterDisplay_onDropped,this),this.screen.spinMeterDisplay.enableInput(),this.screen.elevationMeterDisplay.onClicked.add(this.elevationMeterDisplay_onClicked,this),this.screen.elevationMeterDisplay.onChanged.add(this.elevationMeterDisplay_onChanged,this),this.screen.elevationMeterDisplay.onDropped.add(this.elevationMeterDisplay_onDropped,this),this.screen.elevationMeterDisplay.enableInput(),this.screen.playerInfoDisplays[0].rerackButton.input.pointerEnabled=!0,this.screen.playerInfoDisplays[0].rerackButton.input.onPointerClick.add(this.rerackButton_onClick,this);for(var t of this.screen.tableDisplay.ballDisplays)3!==t.group?t.input.onPointerClick.add(this.objectBall_onClick,this):t.input.onPointerPress.add(this.cueBall_onPointerPress,this);this.screen.tableDisplay.ballLayer.input.pointerChildrenEnabled=!0,this.stickDisplay.input.onPointerPress.add(this.stick_onPointerPress,this),this.screen.pointerCatchLayer.input.onPointerPress.add(this.pointerCatchLayer_onPointerPress,this);let e=null;2!==this.controller.gameState.gameMode&&(e=(0===this.controller.gameState.team?this.controller.gameState.teams[0]:this.controller.gameState.teams[1]).group),null===e||A.hasBallOfTypeOnTable(this.controller.gameState,e)||(e=2),this._highlightGroup=e;for(var i of this.screen.tableDisplay.ballDisplays)i.group!==e?i.dehighlight(!1):i.highlight();this.screen.tableDisplay.setBallHighlightsEnabled(!0)}disableInput(){if(this.inputEnabled){this.inputEnabled=!1,this.dropAimDragging(),this.dropCueBall(),this.dropStick(!0),this.screen.rotationMeterDisplay.onPickedUp.remove(this.rotationMeterDisplay_onPickedUp,this),this.screen.rotationMeterDisplay.onChanged.remove(this.rotationMeterDisplay_onChanged,this),this.screen.rotationMeterDisplay.onDropped.remove(this.rotationMeterDisplay_onDropped,this),this.screen.rotationMeterDisplay.disableInput(),this.screen.pullMeterDisplay.onPickedUp.remove(this.pullMeterDisplay_onPickedUp,this),this.screen.pullMeterDisplay.onChanged.remove(this.pullMeterDisplay_onChanged,this),this.screen.pullMeterDisplay.onDropped.remove(this.pullMeterDisplay_onDropped,this),this.screen.pullMeterDisplay.disableInput(),this.screen.spinMeterDisplay.onClicked.remove(this.spinMeterDisplay_onClicked,this),this.screen.spinMeterDisplay.onChanged.remove(this.spinMeterDisplay_onChanged,this),this.screen.spinMeterDisplay.onDropped.remove(this.spinMeterDisplay_onDropped,this),this.screen.spinMeterDisplay.disableInput(),this.screen.elevationMeterDisplay.onClicked.remove(this.elevationMeterDisplay_onClicked,this),this.screen.elevationMeterDisplay.onChanged.remove(this.elevationMeterDisplay_onChanged,this),this.screen.elevationMeterDisplay.onDropped.remove(this.elevationMeterDisplay_onDropped,this),this.screen.elevationMeterDisplay.disableInput(),this.screen.playerInfoDisplays[0].rerackButton.input.pointerEnabled=!1,this.screen.playerInfoDisplays[0].rerackButton.input.onPointerClick.remove(this.rerackButton_onClick,this);for(var t of this.screen.tableDisplay.ballDisplays)3!==t.group?t.input.onPointerClick.remove(this.objectBall_onClick,this):t.input.onPointerPress.remove(this.cueBall_onPointerPress,this);this.screen.tableDisplay.ballLayer.input.pointerChildrenEnabled=!1,this.stickDisplay.input.onPointerPress.remove(this.stick_onPointerPress,this),this.screen.pointerCatchLayer.input.onPointerPress.remove(this.pointerCatchLayer_onPointerPress,this);var e,i=this._highlightGroup;for(e of this.screen.tableDisplay.ballDisplays)e.group!==i?e.dehighlight(!1):e.dehighlight();this.screen.tableDisplay.setBallHighlightsEnabled(!1)}}}class Vs extends Gs{constructor(){super(),this._draggingCueBall=!1,this._draggingCueBallXTween=null,this._draggingCueBallYTween=null,this._rotatingStick=!1,this._rotatingStickTween=null,this._elevatingStick=!1,this._elevatingStickTween=null,this._adjustingSpin=!1,this._adjustingSpinDegreesTween=null,this._adjustingSpinLengthTween=null,this._pullingStick=!1,this._pullingStickTween=null,this._pendingShot=!1}initialize(){super.initialize(),this.updateState(!0)}dispose(){super.dispose()}isStickVisibilityAllowed(){return!this._cueBallInvalid}isStickInteractionAllowed(){return!1}isPathVisibilityAllowed(){return!1}isCueBallClickAllowed(){return!1}isObjBallClickAllowed(){return!1}isAimDraggingAllowed(){return!1}updateProcessEvents(){this._draggingCueBall||this._rotatingStick||this._elevatingStick||this._adjustingSpin||this._pullingStick||this._pendingShot?this.processRoomEventsEnabled=!1:this.processRoomEventsEnabled=!0}dragCueBallTo(t,e){this._draggingCueBall&&this.dropCueBall(),this.screen.tableDisplay.ballLayer.setChildIndex(this.cueBallDisplay,this.screen.tableDisplay.ballLayer.children.length-1),this._draggingCueBall=!0,this._draggingCueBallXTween=new n(this.cueBall.position.x,t,200,0,p.Quadratic.easeInOut),this._draggingCueBallYTween=new n(this.cueBall.position.y,e,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}dropCueBall(){this._draggingCueBall&&(this._draggingCueBall=!1,this._draggingCueBallXTween=this._draggingCueBallYTween=null,this.updateState(!1),this.controller.gameState.table.sticks[0].position.copy(this.cueBall.position),this.controller.gameState.table.sticks[1].position.copy(this.cueBall.position),this.stickDisplay.setOrientationFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}moveCueBall(t,e){this.dragCueBallTo(t,e)}onMoveCueBall(t,e){this.moveCueBall(t.x,t.y)}rotateStickTo(t){this._rotatingStick&&this.stopRotatingStick(),this._rotatingStick=!0;let e=this.stick.rotation;for(;e<0;)e+=360;for(;360<=e;)e-=360;let i=t;for(;i<0;)i+=360;for(;360<=i;)i-=360;i>e?180<i-e&&(e+=360):i<e&&180<e-i&&(e-=360),this._rotatingStickTween=new n(e,i,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}stopRotatingStick(){this._rotatingStick&&(this._rotatingStick=!1,this._rotatingStickTween=null,this.updateState(!1),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}rotateStick(t){this.rotateStickTo(t)}onRotateStick(t,e){this.rotateStick(t.degree)}elevateStickTo(t){this._elevatingStick&&this.stopElevatingStick(),this._elevatingStick=!0;var e=this.stick.elevation;this._elevatingStickTween=new n(e,t,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}stopElevatingStick(){this._elevatingStick&&(this._elevatingStick=!1,this._elevatingStickTween=null,this.updateState(!1),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}adjustElevation(t){this.elevateStickTo(t)}onAdjustElevation(t,e){this.adjustElevation(t.elevation)}adjustSpinTo(t,e){this._adjustingSpin&&this.stopAdjustingSpin(),this._adjustingSpin=!0,this._adjustingSpinDegreesTween=new n(this.stick.englishDegrees,t,200,0,p.Quadratic.easeInOut),this._adjustingSpinLengthTween=new n(this.stick.englishLength,e,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}stopAdjustingSpin(){this._adjustingSpin&&(this._adjustingSpin=!1,this._adjustingSpinDegreesTween=null,this._adjustingSpinLengthTween=null,this.updateState(!1),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}adjustSpin(t,e){this.adjustSpinTo(t,e)}onAdjustSpin(t,e){this.adjustSpin(t.englishDegrees,t.englishLength)}pullStickTo(t){this._pullingStick&&this.stopPullingStick(),this._pullingStick=!0,this._pullingStickTween=new n(this.stick.pull,t,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}stopPullingStick(){this._pullingStick&&(this._pullingStick=!1,this._pullingStickTween=null,this.updateState(!1),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}pullStick(t){this.pullStickTo(t)}shot(t,e,i){this.pullStick(t),this._pendingShot=!0}onShot(t,e){this.shot(t.pull,t.call,t.postGameState)}onTurnTimeout(){}update(e){if(this._draggingCueBall)this.cueBall.position.x=this._draggingCueBallXTween.update(e),this.cueBall.position.y=this._draggingCueBallYTween.update(e),this.controller.gameState.table.sticks[0].position.copy(this.cueBall.position),this.controller.gameState.table.sticks[1].position.copy(this.cueBall.position),this.stickDisplay.setOrientationFromStick(this.stick),this._draggingCueBallXTween.isFinished&&this._draggingCueBallYTween.isFinished&&this.dropCueBall();else if(this._rotatingStick){let t=this._rotatingStickTween.update(e);for(;t<0;)t+=360;for(;360<=t;)t-=360;this.stick.rotation=t,this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this._rotatingStickTween.isFinished&&this.stopRotatingStick()}else this._elevatingStickTween?(this.stick.elevation=this._elevatingStickTween.update(e),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this._elevatingStickTween.isFinished&&this.stopElevatingStick()):this._adjustingSpin?(this.stick.englishDegrees=this._adjustingSpinDegreesTween.update(e),this.stick.englishLength=this._adjustingSpinLengthTween.update(e),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this._adjustingSpinDegreesTween.isFinished&&this._adjustingSpinLengthTween.isFinished&&this.stopAdjustingSpin()):this._pullingStick?(this.stick.pull=this._pullingStickTween.update(e),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this._pullingStickTween.isFinished&&this.stopPullingStick()):this._pendingShot?(this._pendingShot=!1,this.controller.next(new $s)):super.update(e)}}class js{isCueBallInvalidPos(t,e,i){var s,n=new v(e,i);let a=!1;for(s of t.table.balls)if(3!==s.group&&s.isInPlay2()&&s.position.distance(n)<.05857875){a=!0;break}return a}constructor(s){if(this._draggingCueBall=!1,this._draggingCueBallXTween=null,this._draggingCueBallYTween=null,this._rotatingStick=!1,this._rotatingStickTween=null,this.isFinished=!1,this.preDelay=0,this.postDelay=0,this._phase=s,2===s.controller.gameState.turnState||1===s.controller.gameState.turnState||3===s.controller.gameState.turnState)this.isFinished=!0;else if(7===s.controller.gameState.turnState||8===s.controller.gameState.turnState)if(this.preDelay=500,this.postDelay=500,this._phase._cueBallInvalid||Math.random()<.34){var n=s.controller.gameState;let t=n.table.balls[0].position.x,e=n.table.balls[0].position.y,i=this.isCueBallInvalidPos(n,t,e);for(;i;){if(8===n.turnState||2===n.turnState||1===n.turnState||3===n.turnState)t=Math.random()*n.table.kitchenBallInHandRect.width+n.table.kitchenBallInHandRect.x,e=Math.random()*n.table.kitchenBallInHandRect.height+n.table.kitchenBallInHandRect.y;else{if(7!==n.turnState)throw new Error("Should not happen");t=Math.random()*n.table.tableBallInHandRect.width+n.table.tableBallInHandRect.x,e=Math.random()*n.table.tableBallInHandRect.height+n.table.tableBallInHandRect.y}i=this.isCueBallInvalidPos(n,t,e)}this.moveCueBall(t,e)}else{s=360*Math.random();this.rotateStick(s)}else{this.preDelay=500,this.postDelay=500;s=360*Math.random();this.rotateStick(s)}this._phase.updateState(!0)}dragCueBallTo(t,e){this._draggingCueBall&&this.dropCueBall(),this._phase.screen.tableDisplay.ballLayer.setChildIndex(this._phase.cueBallDisplay,this._phase.screen.tableDisplay.ballLayer.children.length-1),this._draggingCueBall=!0,this._draggingCueBallXTween=new n(this._phase.cueBall.position.x,t,200,0,p.Quadratic.easeInOut),this._draggingCueBallYTween=new n(this._phase.cueBall.position.y,e,200,0,p.Quadratic.easeInOut),this._phase.updateState(!1)}dropCueBall(){this._draggingCueBall&&(this._draggingCueBall=!1,this._draggingCueBallXTween=this._draggingCueBallYTween=null,this._phase.updateState(!1),this._phase.controller.gameState.table.sticks[0].position.copy(this._phase.cueBall.position),this._phase.controller.gameState.table.sticks[1].position.copy(this._phase.cueBall.position),this._phase.stickDisplay.setOrientationFromStick(this._phase.stick),this._phase.updateState(!0))}moveCueBall(t,e){this.dragCueBallTo(t,e)}rotateStickTo(t){this._rotatingStick&&this.stopRotatingStick(),this._rotatingStick=!0;let e=this._phase.stick.rotation;for(;e<0;)e+=360;for(;360<=e;)e-=360;let i=t;for(;i<0;)i+=360;for(;360<=i;)i-=360;i>e?180<i-e&&(e+=360):i<e&&180<e-i&&(e-=360),this._rotatingStickTween=new n(e,i,200,0,p.Quadratic.easeInOut),this._phase.updateState(!1)}stopRotatingStick(){this._rotatingStick&&(this._rotatingStick=!1,this._rotatingStickTween=null,this._phase.updateState(!1),this._phase.stickDisplay.setOrientationFromStick(this._phase.stick),this._phase.cueBallDisplay.updateHitFromStick(this._phase.stick),this._phase.updateState(!0))}rotateStick(t){this.rotateStickTo(t)}update(e){if(0<this.preDelay)this.preDelay-=e;else if(this._draggingCueBall)this._phase.cueBall.position.x=this._draggingCueBallXTween.update(e),this._phase.cueBall.position.y=this._draggingCueBallYTween.update(e),this._phase.controller.gameState.table.sticks[0].position.copy(this._phase.cueBall.position),this._phase.controller.gameState.table.sticks[1].position.copy(this._phase.cueBall.position),this._phase.stickDisplay.setOrientationFromStick(this._phase.stick),this._draggingCueBallXTween.isFinished&&this._draggingCueBallYTween.isFinished&&this.dropCueBall();else if(this._rotatingStick){let t=this._rotatingStickTween.update(e);for(;t<0;)t+=360;for(;360<=t;)t-=360;this._phase.stick.rotation=t,this._phase.stickDisplay.setOrientationFromStick(this._phase.stick),this._phase.cueBallDisplay.updateHitFromStick(this._phase.stick),this._rotatingStickTween.isFinished&&this.stopRotatingStick()}else 0<this.postDelay?this.postDelay-=e:this.isFinished=!0}}class Us extends Gs{constructor(){super(),this._draggingCueBall=!1,this._draggingCueBallXTween=null,this._draggingCueBallYTween=null,this._rotatingStick=!1,this._rotatingStickTween=null,this._elevatingStick=!1,this._elevatingStickTween=null,this._adjustingSpin=!1,this._adjustingSpinDegreesTween=null,this._adjustingSpinLengthTween=null,this._pullingStick=!1,this._pullingStickTween=null,this._pendingShot=!1,this.pendingMsg=null,this.processedMsg=!1,this.idleAnim=null}initialize(){super.initialize(),this.updateState(!0),this.idleAnim=new js(this),this.controller.ai.onMessage.add(this.ai_onMessage,this),this.controller.ai.sendMessage("process",{packedGameState:this.controller.gameState.pack(),primaryDifficulty:this.controller.gameState.difficulty})}dispose(){this.controller.ai.onMessage.contains(this.ai_onMessage,this)&&this.controller.ai.onMessage.remove(this.ai_onMessage,this),super.dispose()}ai_onMessage(t){this.controller.ai.onMessage.remove(this.ai_onMessage,this),this.pendingMsg=t}processThreadMessage(){this.processedMsg=!0;var t=this.pendingMsg,e=(this.controller.gameState.team,t.data.packedGameState),i=t.data.call,s=t.data.pull,n=t.data.elevation,a=t.data.englishDegrees,o=t.data.englishLength,r=t.data.rotation,h=t.data.x,t=t.data.y;this.controller.gameState.table.balls[0].position.equals(h,t)||(2===this.controller.room.connection.state&&this.controller.room.send("MoveCueBall",{playerIndex:this.playerIndex,x:h,y:t}),this.moveCueBall(h,t)),this.controller.gameState.table.sticks[this.controller.gameState.team].rotation!==r&&(2===this.controller.room.connection.state&&this.controller.room.send("RotateStick",{playerIndex:this.playerIndex,degree:r}),this.rotateStick(r)),this.controller.gameState.table.sticks[this.controller.gameState.team].englishDegrees===a&&this.controller.gameState.table.sticks[this.controller.gameState.team].englishLength===o||(2===this.controller.room.connection.state&&this.controller.room.send("AdjustSpin",{playerIndex:this.playerIndex,englishDegrees:a,englishLength:o}),this.adjustSpin(a,o)),this.controller.gameState.table.sticks[this.controller.gameState.team].elevation!==n&&(2===this.controller.room.connection.state&&this.controller.room.send("AdjustElevation",{playerIndex:this.playerIndex,elevation:n}),this.adjustElevation(n)),2===this.controller.room.connection.state&&this.controller.room.send("Shot",{playerIndex:this.playerIndex,pull:s,call:i,postGameState:e}),this.shot(s,i,e)}isStickVisibilityAllowed(){return!this._cueBallInvalid}isStickInteractionAllowed(){return!1}isPathVisibilityAllowed(){return!1}isCueBallClickAllowed(){return!1}isObjBallClickAllowed(){return!1}isAimDraggingAllowed(){return!1}updateProcessEvents(){this.idleAnim||this._draggingCueBall||this._rotatingStick||this._elevatingStick||this._adjustingSpin||this._pullingStick||this._pendingShot?this.processRoomEventsEnabled=!1:this.processRoomEventsEnabled=!0}dragCueBallTo(t,e){this._draggingCueBall&&this.dropCueBall(),this.screen.tableDisplay.ballLayer.setChildIndex(this.cueBallDisplay,this.screen.tableDisplay.ballLayer.children.length-1),this._draggingCueBall=!0,this._draggingCueBallXTween=new n(this.cueBall.position.x,t,200,0,p.Quadratic.easeInOut),this._draggingCueBallYTween=new n(this.cueBall.position.y,e,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}dropCueBall(){this._draggingCueBall&&(this._draggingCueBall=!1,this._draggingCueBallXTween=this._draggingCueBallYTween=null,this.updateState(!1),this.controller.gameState.table.sticks[0].position.copy(this.cueBall.position),this.controller.gameState.table.sticks[1].position.copy(this.cueBall.position),this.stickDisplay.setOrientationFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}moveCueBall(t,e){this.dragCueBallTo(t,e)}onMoveCueBall(t,e){this.moveCueBall(t.x,t.y)}rotateStickTo(t){this._rotatingStick&&this.stopRotatingStick(),this._rotatingStick=!0;let e=this.stick.rotation;for(;e<0;)e+=360;for(;360<=e;)e-=360;let i=t;for(;i<0;)i+=360;for(;360<=i;)i-=360;i>e?180<i-e&&(e+=360):i<e&&180<e-i&&(e-=360),this._rotatingStickTween=new n(e,i,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}stopRotatingStick(){this._rotatingStick&&(this._rotatingStick=!1,this._rotatingStickTween=null,this.updateState(!1),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}rotateStick(t){this.rotateStickTo(t)}onRotateStick(t,e){this.rotateStick(t.degree)}elevateStickTo(t){this._elevatingStick&&this.stopElevatingStick(),this._elevatingStick=!0;var e=this.stick.elevation;this._elevatingStickTween=new n(e,t,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}stopElevatingStick(){this._elevatingStick&&(this._elevatingStick=!1,this._elevatingStickTween=null,this.updateState(!1),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}adjustElevation(t){this.elevateStickTo(t)}onAdjustElevation(t,e){this.adjustElevation(t.elevation)}adjustSpinTo(t,e){this._adjustingSpin&&this.stopAdjustingSpin(),this._adjustingSpin=!0,this._adjustingSpinDegreesTween=new n(this.stick.englishDegrees,t,200,0,p.Quadratic.easeInOut),this._adjustingSpinLengthTween=new n(this.stick.englishLength,e,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}stopAdjustingSpin(){this._adjustingSpin&&(this._adjustingSpin=!1,this._adjustingSpinDegreesTween=null,this._adjustingSpinLengthTween=null,this.updateState(!1),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}adjustSpin(t,e){this.adjustSpinTo(t,e)}onAdjustSpin(t,e){this.adjustSpin(t.englishDegrees,t.englishLength)}pullStickTo(t){this._pullingStick&&this.stopPullingStick(),this._pullingStick=!0,this._pullingStickTween=new n(this.stick.pull,t,200,0,p.Quadratic.easeInOut),this.updateState(!1),this.updateProcessEvents()}stopPullingStick(){this._pullingStick&&(this._pullingStick=!1,this._pullingStickTween=null,this.updateState(!1),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this.updateState(!0),this.updateProcessEvents())}pullStick(t){this.pullStickTo(t)}shot(t,e,i){this.pullStick(t),this._pendingShot=!0}onShot(t,e){this.shot(t.pull,t.call,t.postGameState)}onTurnTimeout(){}update(e){if(this.idleAnim)this.idleAnim.update(e),this.idleAnim.isFinished&&(this.idleAnim=null,this.pendingMsg?this.processThreadMessage():this.idleAnim=new js(this));else if(this._draggingCueBall)this.cueBall.position.x=this._draggingCueBallXTween.update(e),this.cueBall.position.y=this._draggingCueBallYTween.update(e),this.controller.gameState.table.sticks[0].position.copy(this.cueBall.position),this.controller.gameState.table.sticks[1].position.copy(this.cueBall.position),this.stickDisplay.setOrientationFromStick(this.stick),this._draggingCueBallXTween.isFinished&&this._draggingCueBallYTween.isFinished&&this.dropCueBall();else if(this._rotatingStick){let t=this._rotatingStickTween.update(e);for(;t<0;)t+=360;for(;360<=t;)t-=360;this.stick.rotation=t,this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this._rotatingStickTween.isFinished&&this.stopRotatingStick()}else this._elevatingStickTween?(this.stick.elevation=this._elevatingStickTween.update(e),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this._elevatingStickTween.isFinished&&this.stopElevatingStick()):this._adjustingSpin?(this.stick.englishDegrees=this._adjustingSpinDegreesTween.update(e),this.stick.englishLength=this._adjustingSpinLengthTween.update(e),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this._adjustingSpinDegreesTween.isFinished&&this._adjustingSpinLengthTween.isFinished&&this.stopAdjustingSpin()):this._pullingStick?(this.stick.pull=this._pullingStickTween.update(e),this.stickDisplay.setOrientationFromStick(this.stick),this.cueBallDisplay.updateHitFromStick(this.stick),this._pullingStickTween.isFinished&&this.stopPullingStick()):this._pendingShot?(this._pendingShot=!1,this.controller.next(new $s)):super.update(e)}}class Ws extends xs{constructor(){super(...arguments),this.playerIndex=-1}initialize(){this.playerIndex=this.team=this.controller.gameState.team,this.teamState=this.controller.gameState.teams[this.team],this.stick=this.controller.gameState.table.sticks[this.playerIndex];var t=this.stick.pull,e=(this.stick.pull=0,this.controller.gameState.pack());this.stick.pull=t,this.controller.shotRunner.onMessage.add(this.shotRunner_onMessage,this),this.controller.shotRunner.sendMessage("process",{packedGameState:e,pull:t})}dispose(){this.controller.shotRunner.onMessage.contains(this.shotRunner_onMessage,this)&&this.controller.shotRunner.onMessage.remove(this.shotRunner_onMessage,this),super.dispose()}shotRunner_onMessage(t){this.controller.shotRunner.onMessage.remove(this.shotRunner_onMessage,this);var e=t.data.call,t=t.data.packedGameState;if(!this.controller.gameState.validate(t,!0))throw this.controller.gameState.validate(t,!0),new Error("FAILED");2===this.controller.room.connection.state&&this.controller.room.send("Shot",{playerIndex:this.playerIndex,pull:this.stick.pull,call:e,postGameState:t}),this.controller.next(new $s)}}class $s extends xs{constructor(){super(),this.playerIndex=-1,this._pulledPct=0}initialize(){super.initialize(),this.playerIndex=0===this.controller.gameState.team?0:1,this.stick=this.controller.gameState.table.sticks[this.playerIndex],this.stickDisplay=this.screen.tableDisplay.stickDisplays[this.playerIndex],this.cueBall=this.controller.gameState.table.balls[0],this.cueBallDisplay=this.screen.tableDisplay.ballDisplays[0],this.playerInfoDisplay=this.screen.playerInfoDisplays[this.playerIndex],this._pulledPct=this.stick.pull,this.screen.tableMessageDisplay.hide(),this._stickReversePullTween=new n(this._pulledPct,0,75)}dispose(){this.screen.pullMeterDisplay.setPct(0,!1),this.stick.pull=this._pulledPct,this.stickDisplay.setVisible(!1),this.cueBallDisplay.setAiming(!1),super.dispose()}next(){this.stickDisplay.setVisible(!1),this.controller.next(new Ys),Jn.hit(this._pulledPct)}update(t){this._stickReversePullTween&&(t=this._stickReversePullTween.update(t),this.screen.pullMeterDisplay.setPct(t,!1),this.screen.pullMeterDisplay.valueTextField.text="0%",this.stick.pull=this.screen.pullMeterDisplay.pct,this.stickDisplay.setOrientationFromStick(this.stick),this._stickReversePullTween.isFinished)&&this.next()}}class Ys extends xs{constructor(){super(...arguments),this.playerIndex=-1,this.opponentPlayerIndex=-1}initialize(){this.playerIndex=this.team=this.controller.gameState.team,this.opponentPlayerIndex=0===this.playerIndex?1:0,this.teamState=this.controller.gameState.teams[this.team],this.stick=this.controller.gameState.table.sticks[this.playerIndex],this.playerInfoDisplay=this.screen.playerInfoDisplays[this.playerIndex],this.shootersGroup=this.controller.gameState.teams[this.playerIndex].group,this.opponentsGroup=this.controller.gameState.teams[this.opponentPlayerIndex].group;for(var t of this.controller.gameState.table.balls)t.onSunk.add(this.ballObject_onSunk,this),t.onCollision.add(this.ballObject_onCollision,this);this.screen.tableMessageDisplay.hide();var e=this.shot=new Ji(this.controller.gameState);if(!A.shot(e,!0))throw new Error("Shot failed to start!");this.screen.shotsDisplay.setShots(this.controller.getShotsToDisplay())}dispose(){for(var t of this.controller.gameState.table.balls)t.onSunk.remove(this.ballObject_onSunk,this),t.onCollision.remove(this.ballObject_onCollision,this);super.dispose()}ballObject_onSunk(t){2!==this.controller.gameState.gameMode?0!==t.num&&(this.controller.screen.ballTrayDisplay.addBall(t.num),8===t.num||t.group===this.shootersGroup?this.controller.screen.playerInfoDisplays[this.playerIndex].addBall(t.num):t.group===this.opponentsGroup&&this.controller.screen.playerInfoDisplays[this.opponentPlayerIndex].addBall(t.num)):0!==t.num&&this.controller.screen.ballTrayDisplay.addBall(t.num)}ballObject_onCollision(t){(0===t.type?Xn:qn).hit(t)}update(t){if(this.shot.running&&(A.simulate(this.shot,t),this.shot.running||(this.screen.tableDisplay.ballLayer.setChildIndex(this.screen.tableDisplay.ballDisplays[0],this.screen.tableDisplay.ballLayer.children.length-1),this.screen.tableDisplay.ballDisplays[0].setAimVis(!1),this.shot.scratched&&this.screen.tableDisplay.ballDisplays[0].setInvis(!0))),!this.shot.running&&!this.controller.screen.ballTrayDisplay.isTweening){if(2!==this.controller.gameState.gameMode&&16===this.controller.gameState.lastShotCall){var e,i=this.controller.gameState.teams[this.controller.gameState.lastShooter].group,s=0===i?1:0,n=this.controller.gameState.lastShooter,a=0===n?1:0,t=(this.controller.screen.playerInfoDisplays[n].setGroup(i),this.controller.screen.playerInfoDisplays[a].setGroup(s),this.controller.gameState.table.tray.ballNumbers);for(e of t){var o=Qi[e];8===e||o===i?this.controller.screen.playerInfoDisplays[n].addBall(e):o===s&&this.controller.screen.playerInfoDisplays[a].addBall(e)}}this.controller.save(),this.controller.next(new qs)}}}class qs extends xs{constructor(){super(...arguments),this._nextDelay=1e3,this._nextPhase=null}initialize(){super.initialize(),this.controller.gameState.lastShotScratched&&this.screen.tableDisplay.ballDisplays[0].setInvis(!0),this.determineResultMessage(),this.determineNextPhase()}determineResultMessage(){var i=this.controller.gameState,s=this.controller.gameState.gameMode,t=this.controller.gameState.lastShotCall,n=this.controller.gameState.lastShooter;let a=null,e=!1;if(2===s)A.hasBallOfTypeOnTable(i,0)||A.hasBallOfTypeOnTable(i,1)||A.hasBallOfTypeOnTable(i,2);else if(3===s)A.hasBallOfTypeOnTable(i,i.teams[0].group)?i.lastShotScratched&&(a="You scratched. Try again tomorrow!"):a="Challenge complete!";else if(0===s)1===t?a=0===n?"You sunk the 8 ball on the break for a win!":"The computer sunk the 8 ball on the break for a win!":2===t?a=0===n?"You sunk the 8 ball on the break, but also scratched. The computer wins!":"The computer sunk the 8 ball on the break, but also scratched. You win!":3===t?a=0===n?"Great break! Shoot again.":"The computer broke and shoots again.":4===t?a=0===n?"No balls sunk on the break. The computer shoots next.":"No balls sunk on the break. You shoot next.":5===t?(e=!0,a=0===n?"Foul! Scratch on the break. The computer shoots next.":"Foul! Scratch on the break. You shoot next."):6===t?a=0===n?"Invalid break! The computer is deciding what to do.":"Invalid break!":7===t?(e=!0,a=0===n?"Invalid break! The computer is deciding what to do.":"Invalid break!"):8===t?a=0===n?"Oh no! You hit the 8 ball in. The computer wins!":"The computer hit the 8 ball in. You win!":9===t?a=0===n?"You win!":"The computer wins!":10===t?a=0===n?"Oh no! You hit the 8 ball in, but also scratched. The computer wins!":"The computer scratched on the 8 ball. You win!":11===t?(e=!0,a=0===n?"Foul! No balls hit. The computer has ball in hand.":"Foul! No balls hit. You have ball in hand."):12===t?(e=!0,a=0===n?"Foul! Scratch. The computer has ball in hand.":"Foul! Scratch. You have ball in hand."):13===t?(e=!0,a=0===n?"Foul! Wrong ball group hit first. The computer has ball in hand.":"Foul! Wrong ball group hit first. You have ball in hand."):14===t?(e=!0,a=0===n?"Foul! Scratch. The computer has ball in hand.":"Foul! Scratch. You have ball in hand."):15===t?(e=!0,a=0===n?"Foul! No rails hit! The computer has ball in hand.":"Foul! No rails hit! You have ball in hand."):16===t?a=0===n?0===i.teams[0].group?"You are now solids. Shoot again.":"You are now stripes. Shoot again.":0===i.teams[1].group?"You are now stripes. The computer shoots again.":"You are now solids. The computer shoots again.":17===t?a=0===n?"Shoot again.":"The computer shoots again.":18===t&&(a=0===n?"Unsuccessful hit. Their shot.":"Unsuccessful hit. Your shot.");else if(1===s)1===t?a=0===n?"Player 1 sunk the 8 ball on the break for a win!":"Player 2 sunk the 8 ball on the break for a win!":2===t?a=0===n?"Player 1 sunk the 8 ball on the break, but also scratched. Player 2 wins!":"Player 2 sunk the 8 ball on the break, but also scratched. Player 1 wins!":3===t?a=0===n?"Great break! Shoot again.":"Successful break by Player 2. They will shoot again.":4===t?a=0===n?"No balls sunk on the break. Player 2 shoots next.":"No balls sunk on the break. Player 1 shoots next.":5===t?(e=!0,a=0===n?"Foul! Scratch on the break. Player 2 shoots next.":"Foul! Scratch on the break. Player 1 shoots next."):6===t?a=0===n?"Invalid break! Player 2 will decide what to do.":"Invalid break! Player 1 will decide what to do.":7===t?(e=!0,a=0===n?"Invalid break! Player 2 will decide what to do.":"Invalid break! Player 1 will decide what to do."):8===t?a=0===n?"Player 1 hit the 8 ball in. Player 2 wins!":"Player 2 hit the 8 ball in. Player 1 wins!":9===t?a=0===n?"Player 1 wins!":"Player 2 wins!":10===t?a=0===n?"Player 1 hit the 8 ball in but also scratched. Player 2 wins!":"Player 2 hit the 8 ball in but also scratched. Player 1 wins!":11===t?(e=!0,a=0===n?"Foul! No balls hit. Player 2 has ball in hand.":"Foul! No balls hit. Player 1 has ball in hand."):12===t?(e=!0,a=0===n?"Foul! Scratch. Player 2 has ball in hand.":"Foul! Scratch. Player 1 has ball in hand."):13===t?(e=!0,a=0===n?"Foul! Wrong ball group hit first. Player 2 has ball in hand.":"Foul! Wrong ball group hit first. Player 1 has ball in hand."):14===t?(e=!0,a=0===n?"Foul! Scratch. Player 2 has ball in hand.":"Foul! Scratch. Player 1 has ball in hand."):15===t?(e=!0,a=0===n?"Foul! No rails hit! Player 2 has ball in hand.":"Foul! No rails hit! Player 1 has ball in hand."):16===t?a=0===n?0===i.teams[0].group?"Player 1 is now solids. Player 1 shoots again.":"Player 1 is now stripes. Player 1 shoots again.":0===i.teams[1].group?"Player 2 is now solids. Player 2 shoots again.":"Player 2 is now stripes. Player 2 shoots again.":17===t?a=0===n?"Player 1 shoots again.":"Player 2 shoots again.":18===t&&(a=0===n?"Unsuccessful hit. Player 2's shot.":"Unsuccessful hit. Player 1's shot.");else if(4===s){s=this.controller.room.sessionId===this.controller.roomState.players[0].sessionId?0:1;if(1===t)a=n===s?"You sunk the 8 ball on the break for a win!":"They sunk the 8 ball on the break for a win!";else if(2===t)a=n===s?"You sunk the 8 ball on the break, but also scratched. They win!":"They sunk the 8 ball on the break, but also scratched. You win!";else if(3===t)a=n===s?"Great break! Shoot again.":"Successful break. They will shoot again.";else if(4===t)a=n===s?"No balls sunk on the break. They shoot next.":"No balls sunk on the break. You shoot next.";else if(5===t)e=!0,a=n===s?"Foul! Scratch on the break. They shoot next.":"Foul! Scratch on the break. You shoot next.";else if(6===t)a=n===s?"Invalid break! They are deciding what to do.":"Invalid break!";else if(7===t)e=!0,a=n===s?"Invalid break! They are deciding what to do.":"Invalid break!";else if(8===t)a=n===s?"Oh no! You hit the 8 ball in. They win!":"They hit the 8 ball in. You win!";else if(9===t)a=n===s?"You win!":"They win!";else if(10===t)a=n===s?"Oh no! You hit the 8 ball in but also scratched. They win!":"They scratched on the 8 ball. You win!";else if(11===t)e=!0,a=n===s?"Foul! No balls hit. They have ball in hand.":"Foul! No balls hit. You have ball in hand.";else if(12===t)e=!0,a=n===s?"Foul! Scratch. They have ball in hand.":"Foul! Scratch. You have ball in hand.";else if(13===t)e=!0,a=n===s?"Foul! Wrong ball group hit first. They have ball in hand.":"Foul! Wrong ball group hit first. You have ball in hand.";else if(14===t)e=!0,a=n===s?"Foul! Scratch. They have ball in hand.":"Foul! Scratch. You have ball in hand.";else if(15===t)e=!0,a=n===s?"Foul! No rails hit! They have ball in hand.":"Foul! No rails hit! You have ball in hand.";else if(16===t){let t,e;e=(0==s?(t=i.teams[0].group,i.teams[1]):(t=i.teams[1].group,i.teams[0])).group,a=n===s?0===t?"You are now solids. Shoot again.":"You are now stripes. Shoot again.":0===e?"You are now stripes. They shoot again.":"You are now solids. They shoot again."}else 17===t?a=n===s?"Shoot again.":"They shoot again.":18===t&&(a=n===s?"Unsuccessful hit. Their shot.":"Unsuccessful hit. Your shot.")}e&&(i=new x(S.sounds.foul.data),i.volume=.25,i.play()),a&&this.showResultMessage(a)}showResultMessage(t){this.screen.tableMessageDisplay.show(t)}determineNextPhase(){var e=this.controller.gameState.lastShooter;if(0===this.controller.gameState.turnState)throw new Error("Should not be in determine breaker turn state!");if(1===this.controller.gameState.turnState||2===this.controller.gameState.turnState||3===this.controller.gameState.turnState)throw new Error("Should not be in a break turn state!");if(4===this.controller.gameState.turnState||5===this.controller.gameState.turnState){this._nextDelay=2e3;let t=1;1===e&&(t=0);var i=this.controller.getTeamController(t);this._nextPhase=new(1===i?Is:3===i?Ms:Os)}else if(6===this.controller.gameState.turnState||7===this.controller.gameState.turnState||8===this.controller.gameState.turnState)if(this.controller.gameState.team!==e){if(2===this.controller.gameState.gameMode)throw new Error("should not happen!");this._nextPhase=new Hs}else this._nextPhase=new zs;else{if(9!==this.controller.gameState.turnState)throw new Error("Unknown turn state! "+this.controller.gameState.turnState);this._nextPhase=new Ts}2===this.controller.gameState.gameMode&&(this._nextDelay=1)}update(t){0<this._nextDelay&&(this._nextDelay-=t,this._nextDelay<=0)&&this.controller.next(this._nextPhase),super.update(t)}}class Xs extends ri{initialize(){this.soundsToggleButton=new re("Sounds",!Mt.isMuted),this.soundsToggleButton.input.onPointerClick.add(this.soundsToggleButton_onClick,this),this.buttons.push(this.soundsToggleButton),"GameBundle"===c.embed.type||!tt.isMobileDevice&&"StandaloneExe"!==c.embed.type||(this.fullscreenToggleButton=new re("Fullscreen",ps.fullscreen),this.fullscreenToggleButton.input.onPointerClick.add(this.fullscreenToggleButton_onClick,this),this.buttons.push(this.fullscreenToggleButton)),"GameBundle"!==c.embed.type&&(this.instructionsButton=new he("Instructions"),this.instructionsButton.input.onPointerClick.add(this.instructionsButton_onClick,this),this.instructionsButton.clickSound=null,this.buttons.push(this.instructionsButton)),"GameBundle"===c.embed.type||!tt.isMobileDevice&&"StandaloneExe"!==c.embed.type||(this.exitButton=new he("Exit Game"),this.exitButton.clickSound=null,this.exitButton.input.onPointerClick.add(this.exitButton_onClick,this),this.buttons.push(this.exitButton)),super.initialize()}added(){Xs.isOpen=!0,super.added()}removed(){Xs.isOpen=!1,super.removed()}fullscreenToggleButton_onClick(){this.track("Fullscreen Button Pressed"),ps.fullscreen=!ps.fullscreen,ps.save(),this.fullscreenToggleButton.isOn=ps.fullscreen,c.preferFullscreen=ps.fullscreen,ps.fullscreen?m.fullscreen.isFullscreen||m.fullscreen.requestFullscreen():m.fullscreen.isFullscreen&&m.fullscreen.exitFullscreen()}instructionsButton_onClick(){var t;this.track("Instructions Button Pressed"),"AndroidAuto"===c.embed.type||"StandaloneExe"===c.embed.type?(t="247"===k.info.theme?"":k.info.theme+"/",window.open("https://www.247pool.com/"+t+"#instructions","_blank")):(tt.isMobileDevice&&c.pause(),t=document.getElementById("instructions"),t&&t.scrollIntoView(!0))}exitButton_onClick(){this.track("Exit Game Button Pressed"),"AndroidAuto"===c.embed.type||"StandaloneExe"===c.embed.type?window.close():c.pause()}soundsToggleButton_onClick(){this.track("Mute Button Pressed"),Mt.isMuted=!Mt.isMuted,this.soundsToggleButton.isOn=!Mt.isMuted,ps.mute=Mt.isMuted,ps.save()}}Xs.isOpen=!1;class Js extends hi{constructor(t){super(t,{layout:2})}hasInProgressGame(t){return 1===t?ms.hasInProgressGame(!0):ms.hasInProgressGame(!1)}createLevelSelect(){return new Ks}createDailyChallengeGameplay(){throw new Error("Should not be used!")}createResumeGame(t){return 1===t?new sn(ms.onePlayer):new sn(ms.twoPlayer)}createResumedGameplay(t){return 1===t?(t=ms.onePlayer,t=new ds(0,t.pack()),new en(new Qs(t,!1,!0))):(t=ms.twoPlayer,t=new ds(1,t.pack()),new en(new Qs(t,!1,!0)))}createMultiplayerGameMode(){throw new Error("Should not be used!")}createPassAndPlayGame(){bi.track("GameTracking","Pass & Play - Create Game");var t=new Ni(1),t=(A.newGame(t,!0),ms.twoPlayer=t,ms.save(),new ds(1,t.pack()));return new en(new Qs(t,!1,!0))}createPlayOnline(){return new nn}createPlayOnlineAnyone(){var t=new ds(4,!0);return new en(new Qs(t,!1,!0))}createPlayOnlineInviteFriend(){var t=new ds(4,!1);return new en(new Qs(t,!1,!0))}}class Qs extends ai{constructor(t,e,i){super("Gameplay Screen",i),this.isOpenedByJoinLink=e,this.controller=new _s(this,t)}initialize(){this.display.addChild(this.pointerCatchLayer=new B).input=new C(this.pointerCatchLayer,!1,!1,new r),this.display.addChild(this.underworldLayer=new B).input=new C(this.passivesLayer,!1,!1),this.display.addChild(this.worldLayer=new B),this.display.addChild(this.metersLayer=new B),this.display.addChild(this.passivesLayer=new B).input=new C(this.passivesLayer,!1,!1),this.display.addChild(this.interactivesLayer=new B).input=new C(this.interactivesLayer,!1,!0),this.display.addChild(this.messagesLayer=new B).input=new C(this.messagesLayer,!1,!1),this.display.addChild(this.debugLayer=new B).input=new C(this.debugLayer,!1,!1),this.worldLayer.addChild(this.tableDisplay=new bn(this.controller.gameState.table)),this.metersLayer.addChild(this.pullMeterDisplay=new Dn),this.metersLayer.addChild(this.rotationMeterDisplay=new En),this.metersLayer.addChild(this.spinMeterDisplay=new Rn),this.metersLayer.addChild(this.elevationMeterDisplay=new An),this.underworldLayer.addChild(this.ballTrayDisplay=new Pn),this.playerInfoDisplays=[this.metersLayer.addChild(this.leftPlayerInfoDisplay=new Fn(this.controller.gameState.gameMode,0)),this.metersLayer.addChild(this.rightPlayerInfoDisplay=new Fn(this.controller.gameState.gameMode,1))],this.messagesLayer.addChild(this.tableMessageDisplay=new Cn),this.messagesLayer.addChild(this.invalidPositionMessage=new Sn(this.tableDisplay.ballDisplays[0])),this.interactivesLayer.addChild(this.shotsDisplay=new Mn(0,0,!this.controller.gameState.isPausable())).pauseButton.input.onPointerClick.add(this.pauseButton_onClick,this);0===this.controller.gameState.gameMode&&ys.onePlayerShots[this.controller.gameState.difficulty],this.passivesLayer.addChild(this.recordDisplay=new In(0===this.controller.gameState.gameMode?ys.onePlayerShots[this.controller.gameState.difficulty]:null,1,3===this.controller.gameState.gameMode,4===this.controller.gameState.gameMode,1===this.controller.gameState.gameMode)),2===this.controller.gameState.gameMode&&(this.recordDisplay.isPractice=!0,this.recordDisplay.setShots(null)),this.controller.next(new Ss),this.pullMeterDisplay.availMeterRect.visible=!1,this.pullMeterDisplay.scaledMeterRect.visible=!1,this.rotationMeterDisplay.availMeterRect.visible=!1,this.rotationMeterDisplay.scaledMeterRect.visible=!1,super.initialize()}removed(){this.ballTrayDisplay.dispose(),this.controller.next(null),this.controller.dispose(),super.removed()}gainFocus(){M.instance.navBar.settings.show(),M.instance.navBar.home.show(),super.gainFocus()}doClose(t,e=[]){this.nextScreen=t,this.childScreens=e,this.close()}homeClicked(){this.inputEnabled=!1,this.controller.exit(),super.homeClicked()}pauseButton_onClick(){this.track("Pause Button Pressed"),M.instance.navBar.settings.hide(),M.instance.navBar.home.hide(),this.screenManager.add(new on(this.controller.gameState))}anchor(){var t=new r(108,Oe.height+24,P.width-216,P.height-(Oe.height+24)-24-46-24),e=Math.min(t.width/1365,t.height/770),t=new r(t.x+t.width/2+1365*e*-.5,t.y+t.height/2+770*e*-.5,1365*e,770*e);this.tableDisplay.scaleX=this.tableDisplay.scaleY=e,this.tableDisplay.x=t.x+t.width/2,this.tableDisplay.y=t.y+t.height/2,this.pullMeterDisplay.anchor(t),this.rotationMeterDisplay.anchor(t),this.spinMeterDisplay.x=this.rotationMeterDisplay.holder.x,this.spinMeterDisplay.y=this.rotationMeterDisplay.holder.y+508*this.rotationMeterDisplay.meterHolder.scaleY+20,this.spinMeterDisplay.scaleX=this.spinMeterDisplay.scaleY=this.rotationMeterDisplay.meterHolder.scaleX,this.elevationMeterDisplay.x=this.pullMeterDisplay.holder.x,this.elevationMeterDisplay.y=this.pullMeterDisplay.holder.y+508*this.pullMeterDisplay.meterHolder.scaleY+20,this.elevationMeterDisplay.scaleX=this.elevationMeterDisplay.scaleY=this.pullMeterDisplay.meterHolder.scaleX,this.ballTrayDisplay.scaleX=this.ballTrayDisplay.scaleY=e,this.ballTrayDisplay.x=P.width/2,this.ballTrayDisplay.y=t.bottom+16,this.rightPlayerInfoDisplay.visible?(this.leftPlayerInfoDisplay.regX=0,this.leftPlayerInfoDisplay.x=t.x+20,this.leftPlayerInfoDisplay.y=t.y-16,this.leftPlayerInfoDisplay.scaleX=this.leftPlayerInfoDisplay.scaleY=e,this.rightPlayerInfoDisplay.regX=this.rightPlayerInfoDisplay.w,this.rightPlayerInfoDisplay.x=t.x+t.width-20,this.rightPlayerInfoDisplay.y=t.y-16,this.rightPlayerInfoDisplay.scaleX=this.playerInfoDisplays[1].scaleY=e):(this.leftPlayerInfoDisplay.regX=this.leftPlayerInfoDisplay.w/2,this.leftPlayerInfoDisplay.x=t.x+t.width/2,this.leftPlayerInfoDisplay.y=t.y-16,this.leftPlayerInfoDisplay.scaleX=this.leftPlayerInfoDisplay.scaleY=e),this.shotsDisplay.y=P.height,this.recordDisplay.x=P.width,this.recordDisplay.y=P.height,this.pointerCatchLayer.input.hitArea.set(0,0,P.width,P.height),this.tableMessageDisplay.x=P.width/2,this.tableMessageDisplay.y=t.y-100,super.anchor()}update(t){!this.isFocused&&4!==this.controller.gameState.gameMode||this.controller.update(t),this.tableDisplay.update(t),this.playerInfoDisplays[0].update(t),this.playerInfoDisplays[1].update(t),this.ballTrayDisplay.update(t),this.tableMessageDisplay.update(t),this.invalidPositionMessage.update(t),super.update(t)}draw(){this.tableDisplay.draw(),this.playerInfoDisplays[0].draw(),this.playerInfoDisplays[1].draw(),this.invalidPositionMessage.draw(),super.draw()}}class Ks extends di{constructor(){super([0,1,2,3],ps.levelSelectPage)}createItem(t){var e=ys.onePlayerShots[t],e=new ze(zi[t],"8 Ball - vs CPU",e?e+" Shots":"-- Shots",M.instance.calcStarRating(1,e,t),t);return e}carousel_onIndexChange(t,e){e?this.track("Next Arrow Button Pressed"):this.track("Previous Arrow Button Pressed"),ps.levelSelectPage=this.carousel.currentIndex,ps.save()}createNewGame(t){var e=t.value,t=(this.track(zi[e]+" Button Pressed"),new Ni(0,t.value)),t=(A.newGame(t,!0),ms.onePlayer=t,ms.save(),new ds(0,t.pack()));return bi.track("GameTracking","One Player - Create Game - "+zi[e]),new en(new Qs(t,!1,!0))}createDailyChallengeGameplay(){var t=new Ni(3,D.seed),t=(A.newGame(t,!0),new ds(3,t.pack()));return bi.track("GameTracking","One Player - Create Game - Daily Challenge"),new Qs(t,!1,!0)}createGameMode(){throw new Error("Should not be used!")}createTitle(){return new Js(!0)}}class Zs extends ai{constructor(t,e){super("Spin Screen",!0),this.isDragging=!1,this.hitVert=new v(0,0),this.isPopup=!0,this.gameplayScreen=t}initialize(){this.hitVert.unit(this.gameplayScreen.spinMeterDisplay.degree,this.gameplayScreen.spinMeterDisplay.length),this.dimmer=new ne(new jt(0,0,0,.6)),this.dimmer.cursor="pointer",this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this);this.w=300,this.h=300;this.panel=new Le(300,300),this.panel._face.visible=!1,this.panel._side.visible=!1,this.display.addChild(this.panel),this.ballBg=new ee(0,0,117,"#000000"),this.panel.addChild(this.ballBg),this.ballBg.x=150,this.ballBg.input=new C(this.ballBg,!1,!1),this.ballBg.y=24+this.ballBg.circle.radius,this.ballDisplay=new yn(0,!0),this.ballDisplay.scaleX=this.ballDisplay.scaleY=5.85,this.ballDisplay.x=this.ballBg.x,this.ballDisplay.y=this.ballBg.y+10,this.ballDisplay.input=new C(this.ballDisplay,!1,!1),this.panel.addChild(this.ballDisplay),this.hitCircleHolder=new B,this.hitCircleHolder.x=150,this.hitCircleHolder.y=this.ballDisplay.y,this.hitCircleDefault=new ee(0,0,18),this.hitCircleDefault.strokeStyle="rgba(0,0,0,.1)",this.hitCircleDefault.strokeWidth=1.5,this.hitCircleHolder.addChild(this.hitCircleDefault),this.hitCircle=new ee(0,0,20,"#CD0303"),this.hitCircleHolder.addChild(this.hitCircle);let t=new Qt(1-this.ballBg.circle.radius,-.5,this.ballBg.circle.radius-this.hitCircleDefault.circle.radius-1,1,this.hitCircleDefault.strokeStyle);t.x=this.ballDisplay.x,t.y=this.ballDisplay.y,t.input=new C(t,!1,!1),this.panel.addChild(t),t=new Qt(this.hitCircleDefault.circle.radius,-.5,this.ballBg.circle.radius-this.hitCircleDefault.circle.radius-1,1,this.hitCircleDefault.strokeStyle),t.x=this.ballDisplay.x,t.y=this.ballDisplay.y,t.input=new C(t,!1,!1),this.panel.addChild(t),t=new Qt(-.5,this.hitCircleDefault.circle.radius,1,this.ballBg.circle.radius-this.hitCircleDefault.circle.radius-1,this.hitCircleDefault.strokeStyle),t.x=this.ballDisplay.x,t.y=this.ballDisplay.y,t.input=new C(t,!1,!1),this.panel.addChild(t),t=new Qt(-.5,1-this.ballBg.circle.radius,1,this.ballBg.circle.radius-this.hitCircleDefault.circle.radius-1,this.hitCircleDefault.strokeStyle),t.x=this.ballDisplay.x,t.y=this.ballDisplay.y,t.input=new C(t,!1,!1),this.panel.addChild(t),this.panel.addChild(this.hitCircleHolder),this.titleTextField=new T("Spin",S.fonts["OpenSans-ExtraBold"].data,26),this.titleTextField.fill="#FFFFFF",this.titleTextField.align="left",this.titleTextField.baseline="top",this.titleTextField.x=12,this.titleTextField.y=8,this.titleTextField.input=new C(this.titleTextField,!1,!1),this.panel.addChild(this.titleTextField),this.instrTextField=new T("Drag Dot to Adjust Spin",S.fonts["OpenSans-ExtraBold"].data,36),this.instrTextField.fill="#FFFFFF",this.instrTextField.align="right",this.instrTextField.baseline="bottom",this.instrTextField.x=-32,this.instrTextField.y=this.h,this.instrTextField.input=new C(this.instrTextField,!1,!1),this.panel.addChild(this.instrTextField),this.dragRect=new r(0,0,this.w,this.h),this.panel.addChild(this.hitSprite=new B),this.hitSprite.input=new C(this.hitSprite,!0,!1,new r(0,0,this.w,this.h)),this.hitSprite.cursor="grab",this.hitSprite.input.onPointerPress.add(this.hitSprite_onPointerPress,this),this.hitCircle.x=194*this.hitVert.x/2,this.hitCircle.y=194*this.hitVert.y/2,super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),super.gainFocus()}loseFocus(){this.isDragging&&this.drop(),super.loseFocus()}doClose(){this.close()}dimmer_onClick(){this.doClose()}pickup(){var t;this.isDragging||(this.isDragging=!0,w.primary.onMove.add(this.primary_onMove,this),w.primary.onRelease.add(this.primary_onRelease,this),w.primary.onCancel.add(this.primary_onCancel,this),P.overrideCursorType="grabbing",t=new v(w.primary.x,w.primary.y),this.hitCircleHolder.globalToLocal(t),t.length()<20?this.hitCircle.x=this.hitCircle.y=0:this.drag(),this.updateHitPt())}drop(){this.isDragging&&(this.isDragging=!1,w.primary.onMove.remove(this.primary_onMove,this),w.primary.onRelease.remove(this.primary_onRelease,this),w.primary.onCancel.remove(this.primary_onCancel,this),P.overrideCursorType=null,this.gameplayScreen.spinMeterDisplay.onDropped.invoke())}drag(){var t=new v(w.primary.x,w.primary.y);this.hitCircleHolder.globalToLocal(t);9409<t.lengthSquared()&&t.normalize(97),this.hitCircle.x=t.x,this.hitCircle.y=t.y,this.updateHitPt()}primary_onMove(){this.drag()}primary_onRelease(){this.drop()}primary_onCancel(){this.drop()}hitSprite_onPointerPress(){this.pickup()}updateHitPt(){this.hitVert.set(this.hitCircle.x,this.hitCircle.y);var t=this.hitVert.rotation(),e=this.hitVert.length()/97;this.gameplayScreen.spinMeterDisplay.setPolar(t,e,!0),0<t&&t<180?(this.hitCircle.fillStyle="rgba(205, 3, 3, 0.5)",this.hitCircle.strokeStyle="#CD0303",this.hitCircle.strokeDash=[3,6]):(this.hitCircle.fillStyle="#CD0303",this.hitCircle.strokeStyle=null,this.hitCircle.strokeDash=null),this.hitCircle.strokeWidth=3}anchor(){this.panel.x=P.width-this.w/2-8,this.panel.y=Math.min(P.height-this.h/2-20,this.gameplayScreen.spinMeterDisplay.y+this.gameplayScreen.spinMeterDisplay.scaleY*this.gameplayScreen.spinMeterDisplay.h+20+this.h/2),super.anchor()}}class tn extends ai{constructor(t,e){super("Elevation Screen",!0),this.stickHolder=new B,this.degree=0,this.isDragging=!1,this.isPopup=!0,this.gameplayScreen=t}initialize(){this.degree=this.gameplayScreen.elevationMeterDisplay.degree,this.dimmer=new ne(new jt(0,0,0,.6)),this.dimmer.cursor="pointer",this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this);this.w=300,this.h=300;this.panel=new Le(300,300),this.panel._face.visible=!1,this.panel._side.visible=!1,this.display.addChild(this.panel),this.titleTextField=new T("Height Angle",S.fonts["OpenSans-ExtraBold"].data,26),this.titleTextField.fill="#FFFFFF",this.titleTextField.align="left",this.titleTextField.baseline="top",this.titleTextField.x=12,this.titleTextField.y=8,this.titleTextField.input=new C(this.titleTextField,!1,!1),this.panel.addChild(this.titleTextField),this.readingTextField=new T(Math.floor(Math.round(this.degree))+"",S.fonts["OpenSans-ExtraBold"].data,36),this.readingTextField.fill="#FFFF00",this.readingTextField.align="left",this.readingTextField.baseline="top",this.readingTextField.x=12,this.readingTextField.y=46,this.readingTextField.input=new C(this.readingTextField,!1,!1),this.panel.addChild(this.readingTextField),this.instrTextField=new T("Drag to Adjust Height Angle",S.fonts["OpenSans-ExtraBold"].data,36),this.instrTextField.fill="#FFFFFF",this.instrTextField.align="left",this.instrTextField.baseline="bottom",this.instrTextField.x=this.w+32,this.instrTextField.y=this.h,this.instrTextField.input=new C(this.instrTextField,!1,!1),this.panel.addChild(this.instrTextField),this.angledBg=new ee(0,0,Math.min(this.w-44,this.h-24+20),"rgba(255,255,255,0.05)"),this.angledBg.strokeStyle="#9A9A9A",this.angledBg.strokeDash=[6,8],this.angledBg.strokeWidth=3,this.angledBg.x=this.w-12,this.angledBg.y=this.h-12,this.angledBg.startAngle=180,this.angledBg.endAngle=270,this.angledBg.asPie=!0,this.angledBg.strokeBeforeClosePie=!0,this.angledBg.input=new C(this.instrTextField,!1,!1),this.panel.addChild(this.angledBg),this.dragRect=new r(this.angledBg.x-this.angledBg.circle.radius,this.angledBg.y-this.angledBg.circle.radius,this.angledBg.circle.radius,this.angledBg.circle.radius),this.stickHolder=new B,this.stickHolder.x=this.w-12,this.stickHolder.y=this.h-12,this.stickHolder.input=new C(this.instrTextField,!1,!1),this.panel.addChild(this.stickHolder),this.stickBmp=new F(S.images["@theme/cue"]),this.stickBmp.regX=this.stickBmp.width/2,this.stickBmp.regY=0,this.stickBmp.rotation=90,this.stickBmp.scaleX=this.stickBmp.scaleY=Math.min(this.w-24,this.h-24)/this.stickBmp.height,this.stickHolder.addChild(this.stickBmp),this.dragDot=new ee(0,0,12),this.dragDot.strokeWidth=3,this.dragDot.strokeStyle="#00FF00",this.dragDot.x=-this.angledBg.circle.radius,this.stickHolder.addChild(this.dragDot),this.stickHolder.rotation=this.degree,this.panel.addChild(this.hitSprite=new B),this.hitSprite.input=new C(this.hitSprite,!0,!1,new r(0,0,this.w,this.h)),this.hitSprite.cursor="grab",this.hitSprite.input.onPointerPress.add(this.hitSprite_onPointerPress,this),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),super.gainFocus()}loseFocus(){this.isDragging&&this.drop(),super.loseFocus()}doClose(){this.close()}dimmer_onClick(){this.doClose()}pickup(){this.isDragging||(this.isDragging=!0,w.primary.onMove.add(this.primary_onMove,this),w.primary.onRelease.add(this.primary_onRelease,this),w.primary.onCancel.add(this.primary_onCancel,this),P.overrideCursorType="grabbing",this.drag(),this.updateHitPt())}drop(){this.isDragging&&(this.isDragging=!1,w.primary.onMove.remove(this.primary_onMove,this),w.primary.onRelease.remove(this.primary_onRelease,this),w.primary.onCancel.remove(this.primary_onCancel,this),P.overrideCursorType=null,this.gameplayScreen.elevationMeterDisplay.onDropped.invoke())}drag(){var t=new v(w.primary.x,w.primary.y);this.panel.globalToLocal(t);let e=0;e=t.y<this.dragRect.y?85:t.y>this.dragRect.bottom?0:(t=t.y-this.dragRect.y,t=1-t/this.dragRect.height,0+85*t),this.degree=e,this.updateHitPt()}primary_onMove(){this.drag()}primary_onRelease(){this.drop()}primary_onCancel(){this.drop()}hitSprite_onPointerPress(){this.pickup()}updateHitPt(){this.stickHolder.rotation=this.degree,this.readingTextField.text=Math.round(this.degree)+"",this.gameplayScreen.elevationMeterDisplay.setDegree(this.degree,!0)}anchor(){this.panel.x=this.w/2+8,this.panel.y=Math.min(P.height-this.h/2-20,this.gameplayScreen.elevationMeterDisplay.y+this.gameplayScreen.elevationMeterDisplay.scaleY*this.gameplayScreen.elevationMeterDisplay.h+20+this.h/2),super.anchor()}}class en extends wi{initialize(){document.documentElement.classList.contains("desktop")&&(this.useAdStack=!0),super.initialize()}markPlacementOpportunity(){gs.adPlacementOpportunities++,gs.save()}shouldShowAd(){let t=!1;return fi.enabled&&1<gs.adPlacementOpportunities&&1<=gs.launches&&(t=!0),t}}class sn extends li{constructor(t){let e,i=t.teams[0].time;t.teams[0].shots;e=0===t.gameMode?zi[t.difficulty]:(i+=t.teams[1].time,t.teams[1].shots,"2 Player"),super(e,i,!0),this._gameState=t,this._panelWidth=1160}initialize(){super.initialize();var t=this._gameState;let e=t.teams[0].shots,i="Open Table";0===t.gameMode?(this.panel.timeLabelTextField.text="Shots:",0===t.teams[0].group?i="Solids":1===t.teams[0].group&&(i="Stripes")):(this.panel.timeLabelTextField.text="Total Shots:",e+=t.teams[1].shots,0===t.teams[0].group?i="Solids / Stripes":1===t.teams[0].group&&(i="Stripes / Solids")),this.panel.timeTextField.text=e.toString()+" - "+i}}class nn extends yi{constructor(){super(!0)}}class an extends gi{constructor(t,e,i,s,n,a,o="Replay",r=null,h="Win Screen"){super(e,i,s,n,a,o,r,h),this.shots=t}initialize(){super.initialize(),this.panel.viewBoardButton.label.text="View Table",this.panel.timeTextField.text=this.shots+" Shots",this.panel.repositionMedals()}}class on extends ci{constructor(t){let e,i=t.teams[0].time;t.teams[0].shots;e=0===t.gameMode?zi[t.difficulty]:(i+=t.teams[1].time,t.teams[1].shots,"2 Player"),super(e,i),this._gameState=t,this._panelWidth=1160}initialize(){super.initialize();var t=this._gameState;let e=t.teams[0].shots,i="Open Table";0===t.gameMode?(this.panel.timeLabelTextField.text="Shots:",0===t.teams[0].group?i="Solids":1===t.teams[0].group&&(i="Stripes")):(this.panel.timeLabelTextField.text="Total Shots:",e+=t.teams[1].shots,0===t.teams[0].group?i="Solids / Stripes":1===t.teams[0].group&&(i="Stripes / Solids")),this.panel.timeTextField.text=e.toString()+" - "+i}added(){on.isOpen=!0,super.added()}removed(){on.isOpen=!1,super.removed()}}on.isOpen=!1;class rn extends ai{constructor(){super("Connecting Screen",!0),this.onCancel=new h,this.isPopup=!0}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);this.panel=new Le(640,360),this.display.addChild(this.panel),this.titleTextField=new T("Connecting",S.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=320,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new T("Just a moment...",S.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=320,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.cancelButton=new E("Cancel",340,90),this.cancelButton.x=320-this.cancelButton.w/2,this.cancelButton.y=360-this.cancelButton.h-32,this.panel.content.addChild(this.cancelButton),this.cancelButton.input.onPointerClick.add(this.cancelButton_onClick,this),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}cancelButton_onClick(){this.track("Cancel Button Pressed"),this.onCancel.invoke(this)}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}}class hn extends ai{constructor(t,e,i,s){super(t,s),this.onClose=new h,this.isPopup=!0,this._title=e,this._caption=i}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);this.panel=new Le(1080,360),this.display.addChild(this.panel),this.titleTextField=new T(this._title,S.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=540,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new T(this._caption,S.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=540,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.closeButton=new E("Close",340,90),this.closeButton.x=540-this.closeButton.w/2,this.closeButton.y=360-this.closeButton.h-32,this.panel.content.addChild(this.closeButton),this.closeButton.input.onPointerClick.add(this.closeButton_onClick,this),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}closeButton_onClick(){this.track("Close Button Pressed"),this.onClose.invoke(this)}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}}class ln extends ai{constructor(){super("Waiting For Replay Screen",!1),this.isPopup=!0,this.startTime=Date.now()}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);this.panel=new Le(1080,380),this.display.addChild(this.panel),this.titleTextField=new T("Waiting to Play Again",S.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=540,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new T("Waiting for your opponent to choose play again.",S.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=540,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.timerTextField=new T("",S.fonts["Asap-Regular"].data,32),this.timerTextField.fill="#888888",this.timerTextField.align="center",this.timerTextField.baseline="bottom",this.timerTextField.x=540,this.timerTextField.y=238,this.panel.addChild(this.timerTextField),this.cancelButton=new E("Cancel",340,90),this.cancelButton.x=540-this.cancelButton.w/2,this.cancelButton.y=380-this.cancelButton.h-32,this.panel.content.addChild(this.cancelButton),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}update(t){super.update(t)}draw(){var t=Date.now()-this.startTime;let e=6e4-t;e<0&&(e=0),this.timerTextField.text=a.toTimerString(e,0)+" Remaining"}}class dn extends ai{constructor(t,e){super("Waiting For Opponent Screen",!1),this.onCancel=new h,this.linkField=new B,this.hideCopiedIn=0,this.isPopup=!0,this.roomId=t,this.canCopy=!0,this.hadOpponent=e,this.startTime=Date.now()}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);let t=800,e=380;var i;this.roomId&&(t=1080,e=560),this.panel=new Le(t,e),this.display.addChild(this.panel),this.titleTextField=new T("Finding Opponent",S.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=t/2,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new T("Please wait while your opponent joins.",S.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=t/2,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.timerTextField=new T("",S.fonts["Asap-Regular"].data,32),this.timerTextField.fill="#CCCCCC",this.timerTextField.align="center",this.timerTextField.baseline="bottom",this.timerTextField.x=t/2,this.timerTextField.y=e-32-90-20,this.panel.addChild(this.timerTextField),this.roomId&&(this.titleTextField.text="Invite a Friend",this.captionTextField.text="Share this link to play with a friend",this.hadOpponent&&(this.titleTextField.text="Your Friend Left"),this.linkField=new B,this.panel.addChild(this.linkField),this.linkTextField=new T(this.getLinkText(),S.fonts["Asap-Regular"].data,34),this.linkTextField.fill="#03a9f4",this.linkTextField.align="left",this.linkTextField.x=18,this.linkTextField.y=18,i=Math.ceil(this.linkTextField.measure().width),this.linkCopyButton=new E("Copy",200,90),this.linkCopyButton.x=this.linkTextField.x+i+36,this.linkCopyButton.y=-6,i=i+36,this.linkFieldBackground=new Kt(0,0,i,82,6,"#222222"),this.linkFieldBackground.y=-2,this.linkFieldBackground.strokeStyle="#AAAAAA",this.linkFieldBackground.strokeWidth=2,i=this.linkCopyButton.x+this.linkCopyButton.w,this.linkField.y=240,this.linkField.x=t/2-i/2,this.linkField.addChild(this.linkFieldBackground),this.linkField.addChild(this.linkTextField),this.linkField.addChild(this.linkCopyButton),this.linkField.input=new C(this.linkField,!0,!0,this.linkFieldBackground.rectangle),this.linkField.cursor="pointer",this.linkField.input.onPointerClick.add(this.linkField_onPointerClick,this),this.copiedTextField=new T("Link copied to clipboard!",S.fonts["Asap-Regular"].data,30),this.copiedTextField.fill="#34ea3a",this.copiedTextField.align="center",this.copiedTextField.x=i/2,this.copiedTextField.y=this.linkFieldBackground.rectangle.height+12,this.linkField.addChild(this.copiedTextField),this.copiedTextField.visible=!1),this.cancelButton=new E("Cancel",340,90),this.cancelButton.x=t/2-this.cancelButton.w/2,this.cancelButton.y=e-this.cancelButton.h-32,this.panel.content.addChild(this.cancelButton),this.cancelButton.input.onPointerClick.add(this.cancelButton_onClick,this),super.initialize()}getLinkText(){if("GameBundle"===c.embed.type){let t=M.remoteHost.host,e=(0<=t.indexOf(":")&&(t=t.substring(0,t.indexOf(":"))),t=t.replace("room.",""),k.info.theme+"/");return"247"===k.info.theme&&(e=""),t+"/"+e+"?room="+this.roomId}if("AndroidAuto"===c.embed.type||"StandaloneExe"===c.embed.type){let t=M.remoteHost.host,e=(0<=t.indexOf(":")&&(t=t.substring(0,t.indexOf(":"))),t=t.replace("room.",""),k.info.theme+"/");return"247"===k.info.theme&&(e=""),"Development"===M.remoteHost.envName?t+":8081//"+e+"?room="+this.roomId:(M.remoteHost.envName,t+"/"+e+"?room="+this.roomId)}if("Development"===M.remoteHost.envName)return location.host+location.pathname+"?room="+this.roomId;if("Staging"===M.remoteHost.envName)return location.host+location.pathname+"?room="+this.roomId;{let t=location.host+location.pathname+"?room="+this.roomId;return 0!==t.indexOf("www.")&&(t="www."+t),t}}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}copy(t,e,i){let s=this;function n(){s.copiedTextField.visible=!0,s.hideCopiedIn=5e3}if(navigator.clipboard)a=navigator.clipboard.writeText(t),a&&d.promise(a,function(){n()},function(t){l.info("copy failed",t)});else{a=document.createElement("textarea");a.value=t,a.style.cssText="position: absolute; top: 0px; left: 0px; width: 100px; z-index: 9999999;",document.body.appendChild(a),a.select();try{document.execCommand("copy")}catch(t){l.info("failed to execute copy command")}document.body.removeChild(a),l.info("Legacy copy run..."),n()}var a}linkField_onPointerClick(t,e){var i=this.linkTextField.text,s="Join My Game",n="Join my "+k.info.name+" game\nGame Code: "+this.roomId+"\nGame Link: "+i;"GameBundle"===c.embed.type||"AndroidAuto"===c.embed.type||"StandaloneExe"===c.embed.type?this.copy("https://"+i,s,n):this.copy(location.protocol+"//"+i,s,n)}cancelButton_onClick(){this.track("Cancel Button Pressed"),this.onCancel.invoke(this)}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}update(t){0<this.hideCopiedIn&&(this.hideCopiedIn-=t,this.hideCopiedIn<=0)&&(this.copiedTextField.visible=!1),super.update(t)}draw(){var t=Date.now()-this.startTime;let e=6e5-t;e<0&&(e=0),this.timerTextField.text=a.toTimerString(e,0)+" Remaining"}}class cn extends ai{constructor(t,e){super("Determine Breaker Screen",e),this.isPopup=!0,this.gameMode=t}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);this.panel=new Le(548,506),this.display.addChild(this.panel),this.titleTextField=new T("Who Breaks?",S.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=274,this.titleTextField.y=9,this.panel.addChild(this.titleTextField);let t,e;if(1===this.gameMode)t="Player 1",e="Player 2";else{if(0!==this.gameMode)throw new Error("Unsupported game mode");t="You Break",e="CPU Breaks"}this.playerBreakButton=new E(t,340,90),this.playerBreakButton.x=274-this.playerBreakButton.w/2,this.playerBreakButton.y=140,this.panel.content.addChild(this.playerBreakButton),this.opponentBreakButton=new E(e,340,90),this.opponentBreakButton.x=274-this.opponentBreakButton.w/2,this.opponentBreakButton.y=this.playerBreakButton.y+this.playerBreakButton.h+32,this.panel.content.addChild(this.opponentBreakButton),this.randomBreakerButton=new E("Flip Coin",340,90),this.randomBreakerButton.x=274-this.randomBreakerButton.w/2,this.randomBreakerButton.y=this.opponentBreakButton.y+this.opponentBreakButton.h+32,this.panel.content.addChild(this.randomBreakerButton),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,super.anchor()}}class un extends ai{constructor(t){super("Invalid Break Decision Screen",!0),this.result=null,this._viewingTable=!1,this.isPopup=!0,this.gameMode=t,this.startTime=Date.now()}initialize(){this.dimmer=new ne(new jt(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);this.panel=new Le(728,728),this.display.addChild(this.panel),this.titleTextField=new T("Invalid Break",S.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=364,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new T("What would you like to do?",S.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=364,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.timerTextField=new T(a.toTimerString(6e4)+" Remaining",S.fonts["Asap-Regular"].data,32),this.timerTextField.fill="#888888",this.timerTextField.align="center",this.timerTextField.baseline="bottom",this.timerTextField.x=364,this.timerTextField.y=218,this.panel.addChild(this.timerTextField);let t,e;if(1===this.gameMode)t="Player 1 Breaks",e="Player 2 Breaks";else if(0===this.gameMode)t="You Break",e="CPU Breaks";else{if(4!==this.gameMode)throw new Error("Unsupported game mode");t="You Break",e="They Break"}this.viewTableButton=new E("View Table",500,90),this.viewTableButton.x=364-this.viewTableButton.w/2,this.viewTableButton.y=240,this.panel.content.addChild(this.viewTableButton),this.asIsButton=new E("Play As Is",500,90),this.asIsButton.x=364-this.asIsButton.w/2,this.asIsButton.y=this.viewTableButton.y+this.viewTableButton.h+32,this.panel.content.addChild(this.asIsButton),this.playerBreakButton=new E(t,500,90),this.playerBreakButton.x=364-this.playerBreakButton.w/2,this.playerBreakButton.y=this.asIsButton.y+this.asIsButton.h+32,this.panel.content.addChild(this.playerBreakButton),this.opponentBreakButton=new E(e,500,90),this.opponentBreakButton.x=364-this.opponentBreakButton.w/2,this.opponentBreakButton.y=this.playerBreakButton.y+this.playerBreakButton.h+32,this.panel.content.addChild(this.opponentBreakButton),this.tableView=new B,this.display.addChild(this.tableView),this.tableViewHitCatcher=new B,this.tableView.addChild(this.tableViewHitCatcher),this.tableViewHitCatcher.input=new C(this.tableViewHitCatcher,!0,!1,new r),this.tableViewHitCatcher.cursor="pointer",this.viewTableButton.input.onPointerClick.add(this.viewTableButton_onClick,this),this.tableViewHitCatcher.input.onPointerClick.add(this.tableViewHitCatcher_onClick,this),this.asIsButton.input.onPointerClick.add(this.asIsButton_onClick,this),this.playerBreakButton.input.onPointerClick.add(this.playerBreakButton_onClick,this),this.opponentBreakButton.input.onPointerClick.add(this.opponentBreakButton_onClick,this),this.tableView.visible=!1,4!==this.gameMode&&(this.timerTextField.visible=!1),super.initialize()}gainFocus(){o._instance.navBar.home.hide(),o._instance.navBar.settings.hide(),this._viewingTable?o._instance.navBar.close.show():o._instance.navBar.close.hide(),super.gainFocus()}loseFocus(){o._instance.navBar.close.hide(),super.loseFocus()}doClose(){this.setViewTable(!1),this.close()}setViewTable(t){t!==this._viewingTable&&(this._viewingTable=t,this._viewingTable?(this.panel.visible=!1,this.dimmer.visible=!1,this.tableView.visible=!0,o._instance.navBar.close.show()):(this.tableView.visible=!1,o._instance.navBar.close.hide(),this.dimmer.visible=!0,this.panel.visible=!0))}viewTableButton_onClick(){this.setViewTable(!0)}tableViewHitCatcher_onClick(){this.setViewTable(!1)}playerBreakButton_onClick(){this.result=0,this.doClose()}opponentBreakButton_onClick(){this.result=1,this.doClose()}asIsButton_onClick(){this.result=2,this.doClose()}closeClicked(){this.track("Close Button Pressed"),this.setViewTable(!1)}anchor(){this.panel.x=P.width/2,this.panel.y=P.height/2,this.tableViewHitCatcher.input.hitArea.set(0,0,P.width,P.height),super.anchor()}draw(){var t=Date.now()-this.startTime;let e=6e4-t;e<0&&(e=0),this.timerTextField.text=a.toTimerString(e,0)+" Remaining"}}class pn extends mi{constructor(t,e,i,s,n="Replay",a=null,o="Lose Screen"){super(e,i,s,n,a,o),this.shots=t}initialize(){super.initialize(),this.panel.viewBoardButton.label.text="View Table",this.panel.timeTextField.text=this.shots+" Shots"}}class gn extends B{constructor(t,e,i){super(),this.w=1,this.h=1,this.pressCount=0,this.isKeyboardKeyDown=!1,this.wRatio=1,this.upColor="#FFFFFF",this.downColor="#BBBBBB",this.pointers={},this.icon=null,this.letter=t,e||""===e||(e=t),i=i||1,this.wRatio=i,this.shadow=new Kt(0,0,1,1,10,"rgba(0, 0, 0, 0.3)"),this.addChild(this.shadow),this.bg=new Kt(0,0,1,1,10,this.upColor),this.addChild(this.bg),this.textField=new T(e,S.fonts["Asap-Regular"].data,38),this.textField.fill="#000000",this.textField.align="center",this.textField.baseline="middle",this.addChild(this.textField),""===e&&(this.textField.visible=!1),this.hitRect=new r(0,0,1,1)}anchor(t,e,i,s,n,a){i*=this.wRatio,this.w=i,this.h=s,this.hitRect.x=t,this.hitRect.y=e,this.hitRect.width=i,this.hitRect.height=s;t=i/100,e=s/76,t=Math.min(t,e);this.textField.x=i/2-2*t,this.textField.y=s/2-2*t,this.textField.fontSize=37.8*t,this.icon&&(this.icon.x=i/2-2*t,this.icon.y=s/2-2*t,this.icon.scaleX=this.icon.scaleY=t),this.shadow.rectangle.x=-4,this.shadow.rectangle.y=0,this.shadow.rectangle.width=this.w+4,this.shadow.rectangle.height=this.h+4,this.bg.rectangle.x=0,this.bg.rectangle.y=0,this.bg.rectangle.width=this.w,this.bg.rectangle.height=this.h,0<this.pressCount?(this.bg.fillStyle=this.downColor,this.textField.y+=2,this.bg.rectangle.y+=2,this.shadow.rectangle.y+=2,this.shadow.rectangle.height-=2,this.icon&&(this.icon.y+=2)):this.bg.fillStyle=this.upColor}}class mn extends B{constructor(){super(),this.onLetter=new h,this.onDelete=new h,this.onEnter=new h,this.letterButtonMap={},this.letterButtons=[],this._isEnabled=!1,this._isEnterEnabled=!0,this.height=1,this.buttonTray=new B,this.addChild(this.buttonTray),this.dimmerBase=new Qt(0,0,1,1,"rgba(0,0,0,0.3)"),this.buttonTray.addChild(this.dimmerBase),this.dimmer=new Qt(0,0,1,1,"rgba(0,0,0,0.3)"),this.buttonTray.addChild(this.dimmer);var i=mn.letters.slice(0);for(let t=0;t<3;++t){var s=[];let e=10;1===t&&(e=9),2===t&&(e=7);for(let t=0;t<e;++t){var n=i.shift(),a=new gn(n);this.buttonTray.addChild(a),s.push(a),this.letterButtonMap[n]=a}this.letterButtons.push(s)}this.deleteButton=new gn("BACKSPACE","",1.33),this.buttonTray.addChild(this.deleteButton),this.letterButtonMap.BACKSPACE=this.deleteButton,this.deleteButton.upColor="#CCCCCC",this.deleteButton.downColor="#AAAAAA",this.deleteButton.icon=new F(S.images.kb_delete),this.deleteButton.addChild(this.deleteButton.icon),this.deleteButton.icon.regX=this.deleteButton.icon.width/2,this.deleteButton.icon.regY=this.deleteButton.icon.height/2,this.enterButton=new gn("ENTER","Done",2.57),this.buttonTray.addChild(this.enterButton),this.letterButtonMap.ENTER=this.enterButton,this.enterButton.upColor="#067afe",this.enterButton.downColor="#0162d0",this.enterButton.textField.fill="#FFFFFF",this.used=!!(tt.isMobileDevice||0<=o.getInstance().urlVars.indexOf("kb")),this.used||(this.visible=!1)}dispose(){this.disable()}enable(){if(!this._isEnabled){this._isEnabled=!0;var t,e="QWERTYUIOPASDFGHJKLZXCVBNM".split("");for(t of e){var i=_.keys[t];i.onPress.add(this.key_onPress,this),i.onRelease.add(this.key_onRelease,this),i.onCancel.add(this.key_onRelease,this)}_.keys.Backspace.onPress.add(this.key_onPress,this),_.keys.Backspace.onRelease.add(this.key_onRelease,this),_.keys.Backspace.onCancel.add(this.key_onRelease,this),_.keys.Enter.onPress.add(this.key_onPress,this),_.keys.Enter.onRelease.add(this.key_onRelease,this),_.keys.Enter.onCancel.add(this.key_onRelease,this);for(let t=0;t<w.pointers.length;++t){var s=w.pointers[t];s.onPress.add(this.pointer_onPress,this),s.onRelease.add(this.pointer_onRelease,this),s.onCancel.add(this.pointer_onRelease,this),s.onMove.add(this.pointer_onMove,this)}}}disable(){if(this._isEnabled){this._isEnabled=!1,this.releaseKeys();var t,e="QWERTYUIOPASDFGHJKLZXCVBNM".split("");for(t of e){var i=_.keys[t];i.onPress.remove(this.key_onPress,this),i.onRelease.remove(this.key_onRelease,this),i.onCancel.remove(this.key_onRelease,this)}_.keys.Backspace.onPress.remove(this.key_onPress,this),_.keys.Backspace.onRelease.remove(this.key_onRelease,this),_.keys.Backspace.onCancel.remove(this.key_onRelease,this),_.keys.Enter.onPress.remove(this.key_onPress,this),_.keys.Enter.onRelease.remove(this.key_onRelease,this),_.keys.Enter.onCancel.remove(this.key_onRelease,this);for(let t=0;t<w.pointers.length;++t){var s=w.pointers[t];s.onPress.remove(this.pointer_onPress,this),s.onRelease.remove(this.pointer_onRelease,this),s.onCancel.remove(this.pointer_onRelease,this),s.onMove.remove(this.pointer_onMove,this)}}}enableEnter(){this._isEnterEnabled||(this._isEnterEnabled=!0,this.enterButton.upColor="#067afe",this.enterButton.downColor="#0162d0",this.enterButton.textField.fill="#FFFFFF")}disableEnter(){this._isEnterEnabled&&(this._isEnterEnabled=!1,this.enterButton.upColor="#555555",this.enterButton.downColor="#555555",this.enterButton.textField.fill="#DDDDDD",this.enterButton.pressCount=0,this.enterButton.isKeyboardKeyDown=!1,this.enterButton.pointers={})}releaseKeys(){for(var t of this.letterButtons)for(var e of t)e.pressCount=0,e.isKeyboardKeyDown=!1,e.pointers={};this.deleteButton.pressCount=0,this.deleteButton.isKeyboardKeyDown=!1,this.deleteButton.pointers={},this.enterButton.pressCount=0,this.enterButton.isKeyboardKeyDown=!1,this.enterButton.pointers={}}pointer_onPress(t){var e,i;this.visible&&(i=t.x/P.scaleFactor,e=t.y/P.scaleFactor,i=this.getKeyAt(i,e),!i||i===this.enterButton&&!this._isEnterEnabled||i.pointers[t.index+""]||(i.pointers[t.index+""]=!0,this.press(i,!1)))}pointer_onRelease(t){if(this.visible)for(var e in this.letterButtonMap){e=this.letterButtonMap[e];e.pointers[t.index+""]&&(e.pointers[t.index+""]=!1,e.pressCount--,e.pressCount<0)&&(e.pressCount=0)}}pointer_onMove(t){if(this.visible){var e,i=t.x/P.scaleFactor,s=t.y/P.scaleFactor,n=new v(i,s);for(e in this.letterButtonMap){var a=this.letterButtonMap[e];!a.pointers[t.index+""]||a.hitRect.containsVector(n)||(a.pointers[t.index+""]=!1,a.pressCount--,a.pressCount<0&&(a.pressCount=0))}}}getKeyAt(t,e){var i=new v(t,e);for(let t=0;t<this.letterButtons.length;++t){var s=this.letterButtons[t];for(let t=0;t<s.length;++t){var n=s[t];if(n.hitRect.containsVector(i))return n}}return this.deleteButton.hitRect.containsVector(i)?this.deleteButton:this.enterButton.hitRect.containsVector(i)?this.enterButton:null}key_onPress(t){_.keys.LeftCtrl.isPressed||_.keys.RightCtrl.isPressed||_.keys.LeftOS.isPressed||_.keys.RightOS.isPressed||(t=this.letterButtonMap[t.name.toUpperCase()],!t)||t.isKeyboardKeyDown||t===this.enterButton&&!this._isEnterEnabled||(t.isKeyboardKeyDown=!0,this.press(t,!0))}key_onRelease(t){t=this.letterButtonMap[t.name.toUpperCase()];t&&t.isKeyboardKeyDown&&(t.isKeyboardKeyDown=!1,t.pressCount--,t.pressCount<0)&&(t.pressCount=0)}press(t,e){t.pressCount++,1===t.pressCount&&(e||(e=new x(S.sounds.keypress.data),e.volume=.4,e.play(),window.navigator.vibrate&&window.navigator.vibrate(10)),t===this.deleteButton?this.onDelete.invoke():t===this.enterButton?this.onEnter.invoke():this.onLetter.invoke(t.letter))}anchor(){if(this.used){var s=P.width,e=P.height,n=P.scaleFactor,a=s;let t=.3*e;var o=5*devicePixelRatio/n,r=5*devicePixelRatio/n,h=(a-11*o)/10;let i=(t-5*r)/4;1.3<i/h&&(i=1.3*h,t=r+4*i+2*r+r+r);var l=e-t;for(let t=0;t<this.letterButtons.length;++t){var d=this.letterButtons[t],c=d.length*h+(d.length-1)*o;let e=(s-c)/2;var u=t*(i+r)+r+l;for(let t=0;t<d.length;++t){var p=d[t];p.anchor(e,u,h,i,o,r),p.x=e,p.y=u,e+=p.w+o}}var e=this.letterButtonMap.P.x+this.letterButtonMap.P.w-h*this.deleteButton.wRatio,g=this.letterButtons[2][6].y,e=(this.deleteButton.anchor(e,g,h,i,o,r),this.deleteButton.x=e,this.deleteButton.y=g,this.letterButtonMap.P.x+this.letterButtonMap.P.w-h*this.enterButton.wRatio),g=3*(i+r)+r+l,e=(this.enterButton.anchor(e,g,h,i,o,r),this.enterButton.x=e,this.enterButton.y=g,this.height=t+0,3*devicePixelRatio/n);this.dimmerBase.rectangle.set(0,l-e,a,t+e),this.dimmer.rectangle.set(0,0+l,a,t)}}}mn.letters="QWERTYUIOPASDFGHJKLZXCVBNM".split("");class yn extends B{constructor(t,e){super(),this._frontRenderer=null,this._backRenderer=null,this._topRenderer=null,this._bottomRenderer=null,this._frontNumRenderer=null,this._backNumRenderer=null,this._hitRenderer=null,this.placerDisplay=null,this.num=null,this.group=null,this.id=null,this._highlightCircleRadiusTween=null,this._hoverCircleTween=null,this._orientation=new K,this._hasHitSet=!1,this.isInvis=!1,this.canPlace=!1;let i,s=null,n=!1;"number"==typeof t?(i=t,0===i&&e&&(n=!0)):(s=t,i=s.num),this.num=i,this.group=Qi[i],this.id=Ki[i],this.ball=s,this._ballColorHex=ce.game[this.id],0===i?n||(this._hitRenderer=new fn("hit"),this.placerDisplay=new _n):(this._backRenderer=new fn("back"),this._frontRenderer=new fn("front"),1===this.group&&(this._topRenderer=new fn("top"),this._bottomRenderer=new fn("bottom")),this._frontNumRenderer=new wn(this.num,!1),this._backNumRenderer=new wn(this.num,!0)),this.shadingBmp=new F(S.images.ball_fade),this.shadingBmp.regX=this.shadingBmp.width/2,this.shadingBmp.regY=this.shadingBmp.height/2,this.shadingBmp.scaleX=this.shadingBmp.scaleY=1.025,this.addChild(this.shadingBmp),this.sheenBmp=new F(S.images.ball_sheen),this.sheenBmp.regX=this.sheenBmp.width/2,this.sheenBmp.regY=this.sheenBmp.height/2,this.addChild(this.sheenBmp),this.shadowBmp=new F(S.images.ball_shadow),this.shadowBmp.regX=35,this.shadowBmp.regY=35,this.hoverCircle=new ee(0,0,24),this.hoverCircle.strokeStyle="rgba(255, 255, 0, 1)",this.hoverCircle.strokeWidth=3,this.hoverCircle.visible=!1,this.highlightCircle=new ee(0,0,26),this.highlightCircle.strokeStyle="#FFFFFF",this.highlightCircle.strokeWidth=16,this.highlightCircle.visible=!1,this.input=new C(this,!1,!1,new J(0,0,20)),0===this.num?this.cursor="grab":this.cursor="pointer",this.input.onPointerOver.add(this.input_onPointerOver,this),this.input.onPointerOut.add(this.input_onPointerOut,this)}markInvalid(){this._ballColorHex="#FF0000",this.alpha=.8}markValid(){this._ballColorHex=ce.game[this.id],this.alpha=1}updateHitFromStick(t){this.updateHit(t.rotation,t.englishDegrees,t.englishLength,t.elevation)}updateHit(t,e,i,s){this._hitRenderer&&(this._hitRenderer.updateHit(t,e,i,s),this._hasHitSet=!0)}clearHit(){this._hasHitSet=!1}setAiming(t){this._hitRenderer&&(this._hitRenderer.isAiming=t)}setAimVis(t){this._hitRenderer&&(this._hitRenderer.aimVis=t)}setInvis(t){this.isInvis!==t&&(this.isInvis=t,t?(this.visible=!1,this.shadowBmp.visible=!1,this.hoverCircle.visible=!1,this.highlightCircle.visible=!1):(this.visible=!1,this.shadowBmp.visible=!1,this.hoverCircle.visible=!1,this.highlightCircle.visible=!1,this.placerDisplay.visible=!1))}highlight(){this._highlightCircleRadiusTween=new n(36,26,250,0,p.Quadratic.easeOut),this.highlightCircle.circle.radius=this._highlightCircleRadiusTween.start,this.highlightCircle.visible=!0,this.isInvis&&(this.highlightCircle.visible=!1)}dehighlight(t=!0){t?this._highlightCircleRadiusTween=new n(this.highlightCircle.circle.radius,16,60,0,p.Quadratic.easeOut):(this._highlightCircleRadiusTween=null,this.highlightCircle.visible=!1)}updateOrientation(t){this._orientation.equals(t)||(this._orientation.copy(t),this._orientation.normalize(),this._backRenderer&&this._backRenderer.updatePoints(this._orientation),this._frontRenderer&&this._frontRenderer.updatePoints(this._orientation),this._topRenderer&&this._topRenderer.updatePoints(this._orientation),this._bottomRenderer&&this._bottomRenderer.updatePoints(this._orientation),this._frontNumRenderer&&this._frontNumRenderer.updatePoints(this._orientation),this._backNumRenderer&&this._backNumRenderer.updatePoints(this._orientation),this._hitRenderer&&this._hitRenderer.updatePoints(this._orientation))}input_onPointerOver(){this._hoverCircleTween=new n(this.hoverCircle.circle.radius,24,50,0,p.Quadratic.easeOut),this.hoverCircle.visible=!0,this.isInvis&&(this.hoverCircle.visible=!1)}input_onPointerOut(){this._hoverCircleTween=new n(this.hoverCircle.circle.radius,16,100,0,p.Quadratic.easeOut)}update(t){this._hoverCircleTween&&(this.hoverCircle.circle.radius=this._hoverCircleTween.update(t),this._hoverCircleTween.isFinished)&&(this._hoverCircleTween.value<20&&(this.hoverCircle.visible=!1),this._hoverCircleTween=null),this._highlightCircleRadiusTween&&(this.highlightCircle.circle.radius=this._highlightCircleRadiusTween.update(t),this._highlightCircleRadiusTween.isFinished)&&(this._highlightCircleRadiusTween.value<20&&(this.highlightCircle.visible=!1),this._highlightCircleRadiusTween=null)}render(t,e,i){t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i,t.fillStyle=this._ballColorHex,t.save(),t.beginPath(),t.arc(0,0,20,0,b.TWO_PI),t.fill(),t.clip(),this._topRenderer&&this._topRenderer.render(t),this._bottomRenderer&&this._bottomRenderer.render(t),this._backRenderer&&this._backRenderer.render(t),this._frontRenderer&&this._frontRenderer.render(t),this._frontNumRenderer&&this._frontNumRenderer.render(t,e,i),this._backNumRenderer&&this._backNumRenderer.render(t,e,i),this._hitRenderer&&this._hasHitSet&&this._hitRenderer.render(t),super.render(t,e,i),t.restore()}}class _n extends B{constructor(){super(),this.isInvalid=!1,this.tris=[];let t=this.createTri();this.addChild(t),this.tris.push(t),t=this.createTri(),t.rotation=90,this.addChild(t),this.tris.push(t),t=this.createTri(),t.rotation=180,this.addChild(t),this.tris.push(t),t=this.createTri(),t.rotation=270,this.addChild(t),this.tris.push(t),this.input=new C(this,!1,!1),this.alpha=.5}setInvalid(t){this.isInvalid=t;for(var e of this.tris)e.fillStyle=t?"#FF0000":"#FFFFFF"}createTri(){return new Zt(24,-12,34,0,24,12,"#FFFFFF")}}class fn{constructor(i){if(this._isHit=!1,this._rays=[],this._points=[],this._hex="#0000FF",this._lastQuat=new K,this._hitVec=null,this._hitPt=null,this.isAiming=!1,this.aimVis=!0,"front"===i||"back"===i){this._hex=ce.game.numberCircleColor;let e=0;for(let t=0;t<16;++t){var s=(new v).unit(e,.6),s=new g(s.x,s.y,"front"===i?1:-1);s.normalize(),this._rays.push(s),this._points.push(new g),e+=22.5}}else if("top"===i||"bottom"===i){this._hex=ce.game.stripesBaseColor;let e=0;for(let t=0;t<16;++t){var n=(new v).unit(e,1.35),n=new g(n.x,"top"===i?-1:1,n.y);n.normalize(),this._rays.push(n),this._points.push(new g),e+=22.5}}else"hit"===i&&(this._isHit=!0,this._hex=ce.game.cueBallHitPoint,this._hitVec=new g(-1,0,0),this._hitPt=new g(-1,0,0));this.updatePoints(new K)}updateHit(t,e,i,s){var n=new K,e=(new v).unit(e,i);this._hitVec.set(.65*e.length()-1,e.x,-e.y),this._hitVec.normalize(),n.setFromEuler(0,0,t*b.DEG_TO_RAD,0).normalize().transformVector(this._hitVec),this.updatePoints(this._lastQuat)}updatePoints(e){this._lastQuat.copy(e);for(let t=0;t<this._rays.length;++t)e.transformVector(this._points[t].copy(this._rays[t]));this._isHit&&this._lastQuat.transformVector(this._hitPt.copy(this._hitVec))}render(i){if(this._isHit)this.aimVis&&(0<=this._hitPt.z?(i.fillStyle=this._hex,i.beginPath(),i.arc(.028575*this._hitPt.x*699.912510936133,.028575*this._hitPt.y*699.912510936133,4,0,b.TWO_PI),i.fill()):this.isAiming&&(i.strokeStyle=this._hex,i.lineWidth=2,i.setLineDash([2,4]),i.beginPath(),i.arc(.028575*this._hitPt.x*699.912510936133,.028575*this._hitPt.y*699.912510936133,4,0,b.TWO_PI),i.stroke(),i.setLineDash([])));else{i.fillStyle=this._hex,i.beginPath();var s,n=new v;let e=0;for(let t=0;t<this._points.length;++t)n.x=this._points[t].x,n.y=this._points[t].y,this._points[t].z<0?(s=n.length(),s=1-s,n.normalize(1+s)):0<this._points[t].z&&e++,0===t?i.moveTo(.028575*n.x*699.912510936133,.028575*n.y*699.912510936133):i.lineTo(.028575*n.x*699.912510936133,.028575*n.y*699.912510936133);i.closePath(),6<e&&i.fill()}}}class wn{constructor(t,e){this.frontVec=new g(0,0,1),this.frontPt=new g(0,0,1),this.topVec=new g(0,-1,0),this.topPt=new g(0,-1,0),this.bottomVec=new g(0,1,0),this.bottomPt=new g(0,1,0),this.rightVec=new g(1,0,0),this.rightPt=new g(1,0,0),this._wvp=new Q,this.last=0,e&&(this.frontVec.scale(-1),this.frontPt.scale(-1),this.topVec.scale(-1),this.topPt.scale(-1),this.bottomVec.scale(-1),this.bottomPt.scale(-1),this.rightVec.scale(-1),this.rightPt.scale(-1));var e=document.createElement("canvas"),i=(e.width=20,e.height=20,new Vt(e.getContext("2d"))),s=new T(t.toString(),S.fonts["AsapCondensed-SemiBold"].data,17),n=(s.baseline="middle",s.align="center",s.fill=ce.game.numberColor,new Q(1,0,0,1,e.width/2,e.height/2));9!==t&&6!==t||(t=new Q,i.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),i.strokeStyle=s.fill,i.lineWidth=1.25,i.beginPath(),i.moveTo(.325*e.width,e.height-2.75),i.lineTo(e.width/2,e.height-2),i.lineTo(e.width-.325*e.width,e.height-2.75),i.stroke(),n.appendTransform(0,-.5,1,1,0,0,0,0,0)),s.render(i,n,1),this.numberImage=e,this.updatePoints(new K)}updatePoints(t){t.transformVector(this.frontPt.copy(this.frontVec)),t.transformVector(this.topPt.copy(this.topVec)),t.transformVector(this.bottomPt.copy(this.bottomVec)),t.transformVector(this.rightPt.copy(this.rightVec));t=new v(this.topPt.x-this.bottomPt.x,this.topPt.y-this.bottomPt.y),t=t.rotation()+90;this.last!==t&&(this.last=t)}render(s,n,a){if(.3<this.frontPt.z){var o=Math.abs(.3),r=Math.abs(.6),r=r-o,o=Math.abs(this.frontPt.z)-o;let t=o/r,e=(1<t&&(t=1),t<0&&(t=0),s.globalAlpha=a*t,this._wvp.copy(n).appendTransform(.028575*this.frontPt.x*699.912510936133,.028575*this.frontPt.y*699.912510936133,1,1,0,0,0,0,0),Math.min(1-+Math.abs(this.topPt.z),1-+Math.abs(this.rightPt.z))),i=(e<0&&(e=0),1<e&&(e=1),e=.25*e+.75,this._wvp.appendTransform(0,0,e,e,0,0,0,0,0),this._wvp.appendTransform(0,0,1,1,this.last,0,0,0,0),s.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty),this.frontPt.z);i<.2&&(i=.2),i=1,0<i&&s.drawImage(this.numberImage,0,0,this.numberImage.width,this.numberImage.height,-(this.numberImage.width*i)/2,-this.numberImage.height/2,this.numberImage.width*i,this.numberImage.height)}}}class vn extends B{constructor(t,e=null){super(),this.isShadow=null,this.shadowCaster=null,this._position=new v,this._rotation=0,this._pull=null,this._englishDegress=0,this._englishLength=0,this._elevation=0,this.hoverRectOnRect=new r,this.hoverRectOffRect=new r,this.hoverRectTweenY=null,this.hoverRectTweenH=null,this.hoverRectTweenA=null,this.hoverRectTweeningOn=!1,this.team=t,this.shadowCaster=e,this.isShadow=!!e,this.shadowTransformHolder=new B,this.addChild(this.shadowTransformHolder),this.stickPosHolder=new B,this.shadowTransformHolder.addChild(this.stickPosHolder),this.stickRotHolder=new B,this.stickPosHolder.addChild(this.stickRotHolder),this.stickPullHolder=new B,this.stickRotHolder.addChild(this.stickPullHolder),this.stickEnglishHolder=new B,this.stickPullHolder.addChild(this.stickEnglishHolder),this.stickElevationHolder=new B,this.stickEnglishHolder.addChild(this.stickElevationHolder),this.stickImgHolder=new B,this.stickElevationHolder.addChild(this.stickImgHolder),this.isShadow?(this.stickBmp=new F(S.images.cue_shadow),this.stickBmp.regX=this.stickBmp.width/2,this.stickBmp.regY=15,this.stickBmp.rotation=90,this.stickImgHolder.addChild(this.stickBmp)):(this.stickBmp=new F(S.images["@theme/cue"]),this.stickBmp.regX=this.stickBmp.width/2,this.stickBmp.regY=0,this.stickBmp.rotation=90,this.stickImgHolder.addChild(this.stickBmp),this.input=new C(this,!0,!0),this.cursor="grab",this.stickImgHolder.input=new C(this.stickImgHolder,!0,!1,new r(-this.stickBmp.height,-this.stickBmp.width,this.stickBmp.height,2*this.stickBmp.width)),this.hoverRect=new Kt(0,0,0,0,8),this.hoverRect.strokeStyle="#FFFF00",this.hoverRect.strokeWidth=3,this.stickImgHolder.addChild(this.hoverRect),this.stickImgHolder.setChildIndex(this.hoverRect,0),this.hoverRect.input=new C(this.hoverRect,!1,!1),this.hoverRectOnRect.copy(this.stickImgHolder.input.hitArea),this.hoverRectOnRect.x-=6,this.hoverRectOnRect.y-=3,this.hoverRectOnRect.width+=12,this.hoverRectOnRect.height+=6,this.hoverRectOffRect.copy(this.hoverRectOnRect),this.hoverRectOffRect.y+=10,this.hoverRectOffRect.height-=20,this.hoverRect.rectangle.copy(this.hoverRectOffRect),this.hoverRect.visible=!1,this.hoverRect.alpha=0,this.shadow=new vn(this.team,this),this.input.onPointerOver.add(this.input_onPointerOver,this),this.input.onPointerOut.add(this.input_onPointerOut,this))}setOrientation(t,e,i,s,n,a,o){if(this._position.set(t,e),this._rotation=i,this._pull=s,this._englishDegress=n,this._englishLength=a,this._elevation=o,this.isShadow){var r=S.images["@theme/cue"].naturalHeight,h=this.globalToLocal(this.shadowCaster.stickImgHolder.localToGlobal(new v(0,0))),l=this.globalToLocal(this.shadowCaster.stickImgHolder.localToGlobal(new v(-r,0)));let t=h.clone().subtract(l).rotation();for(var d=h.clone().subtract(l).length()/r;t<0;)t+=360;for(;360<=t;)t-=360;var h=h.clone(),l=l.clone(),c=new v(-4,2),c=(h.add(c),l.add(c),l.addValues(0,6),new v(-this.shadowCaster._elevation/85*r,this.shadowCaster._elevation/85*r)),r=(l.add(c),new v(-this.shadowCaster._elevation/85*20,this.shadowCaster._elevation/85*20));r.addValues(-this.shadowCaster._elevation/85*this.shadowCaster._pull*150*d,this.shadowCaster._elevation/85*this.shadowCaster._pull*150*d),h.add(r),l.add(r);let e=d;e=this.shadowCaster._elevation<42.5?(c=d,r=c-1,c=this.shadowCaster._elevation/42.5,p.none(c,1,r,1)):(c=d,r=1-c,d=(this.shadowCaster._elevation-42.5)/42.5,p.none(d,c,r,1));d=h.clone().subtract(l).rotation();this.shadowTransformHolder.x=h.x,this.shadowTransformHolder.y=h.y,this.shadowTransformHolder.rotation=d,this.shadowTransformHolder.scaleX=e}else{this.stickPosHolder.x=699.912510936133*t,this.stickPosHolder.y=699.912510936133*e,this.stickRotHolder.rotation=i;c=1-o/85,r=.5+.5*c,l=(null!==s?this.stickPullHolder.x=-(22+150*s*r):this.stickPullHolder.x=0,(new v).unit(n,a));this.stickEnglishHolder.y=16*l.x,this.stickElevationHolder.scaleX=r,this.shadow.setOrientation(t,e,i,s,n,a,o)}}setOrientationFromStick(t){this.setOrientation(t.position.x,t.position.y,t.rotation,t.pull,t.englishDegrees,t.englishLength,t.elevation)}setStickPosition(t,e){this.setOrientation(t,e,this._rotation,this._pull,this._englishDegress,this._englishLength,this._elevation)}setStickRotation(t){this.setOrientation(this._position.x,this._position.y,t,this._pull,this._englishDegress,this._englishLength,this._elevation)}setPull(t){this.setOrientation(this._position.x,this._position.y,this._rotation,t,this._englishDegress,this._englishLength,this._elevation)}setEnglish(t,e){this.setOrientation(this._position.x,this._position.y,this._rotation,this._pull,t,e,this._elevation)}setElevation(t){this.setOrientation(this._position.x,this._position.y,this._rotation,this._pull,this._englishDegress,this._englishLength,t)}setVisible(t){this.visible=t,this.shadow&&(this.shadow.visible=t)}input_onPointerOver(){this.hoverRectTweenY=new n(this.hoverRect.rectangle.y,this.hoverRectOnRect.y,50,0,p.Quadratic.easeOut),this.hoverRectTweenH=new n(this.hoverRect.rectangle.height,this.hoverRectOnRect.height,50,0,p.Quadratic.easeOut),this.hoverRectTweenA=new n(this.hoverRect.alpha,1,50,0,p.none),this.hoverRect.visible=!0,this.hoverRectTweeningOn=!0}input_onPointerOut(){this.hoverRectTweenY=new n(this.hoverRect.rectangle.y,this.hoverRectOffRect.y,100,0,p.Quadratic.easeOut),this.hoverRectTweenH=new n(this.hoverRect.rectangle.height,this.hoverRectOffRect.height,100,0,p.Quadratic.easeOut),this.hoverRectTweenA=new n(this.hoverRect.alpha,0,100,0,p.none),this.hoverRectTweeningOn=!1}update(t){this.isShadow||this.hoverRectTweenH&&(this.hoverRect.rectangle.y=this.hoverRectTweenY.update(t),this.hoverRect.rectangle.height=this.hoverRectTweenH.update(t),this.hoverRect.alpha=this.hoverRectTweenA.update(t),this.hoverRectTweenH.isFinished)&&(this.hoverRectTweenY=this.hoverRectTweenA=this.hoverRectTweenH=null,this.hoverRectTweeningOn||(this.hoverRect.visible=!1))}}class bn extends B{constructor(t){super(),this.ballHighlightAlphaTween=null,this.addChild(this.groundShadowsLayer=new B),this.addChild(this.tabletopLayer=new B),this.addChild(this.ballHighlightLayer=new xn),this.addChild(this.pullLineLayer=new B),this.addChild(this.draggerLayer=new B),this.addChild(this.tabletopShadowsLayer=new B),this.addChild(this.ballHoverLayer=new B),this.addChild(this.pathLayer=new B),this.addChild(this.ballLayer=new B),this.addChild(this.tableFrameLayer=new B),this.addChild(this.stickShadowLayer=new B),this.addChild(this.stickLayer=new B),this.addChild(this.ballDragLayer=new B),this.groundShadowsLayer.input=new C(this.groundShadowsLayer,!1,!1),this.tabletopLayer.input=new C(this.tabletopLayer,!1,!1),this.tabletopShadowsLayer.input=new C(this.tabletopShadowsLayer,!1,!1),this.pathLayer.input=new C(this.pathLayer,!1,!1),this.draggerLayer.input=new C(this.draggerLayer,!1,!1),this.ballLayer.input=new C(this.ballLayer,!1,!1),this.tableFrameLayer.input=new C(this.tableFrameLayer,!1,!1),this.stickShadowLayer.input=new C(this.stickShadowLayer,!1,!1),this.stickLayer.input=new C(this.stickLayer,!1,!1),this.ballHoverLayer.input=new C(this.ballHoverLayer,!1,!1),this.ballHighlightLayer.input=new C(this.ballHighlightLayer,!1,!1),this.ballDragLayer.input=new C(this.ballDragLayer,!1,!1),this.pullLineLayer.input=new C(this.pullLineLayer,!1,!1),this.ballHighlightLayer.alpha=0,this.ballHighlightLayer.visible=!1,this.tableShadowBmp=new F(S.images.table_shadow),this.tableShadowBmp.regX=this.tableShadowBmp.img.width/2,this.tableShadowBmp.regY=this.tableShadowBmp.img.height/2,this.groundShadowsLayer.addChild(this.tableShadowBmp),this.tabletopBmp=new F(S.images["@theme/table_top"]),this.tabletopBmp.regX=this.tabletopBmp.img.width/2,this.tabletopBmp.regY=this.tabletopBmp.img.height/2,this.tabletopLayer.addChild(this.tabletopBmp),this.tableFrameBmp=new F(S.images["@theme/table_frame"]),this.tableFrameBmp.regX=this.tableFrameBmp.img.width/2,this.tableFrameBmp.regY=this.tableFrameBmp.img.height/2,this.tableFrameLayer.addChild(this.tableFrameBmp),this.pathLayer.addChild(this.pathDisplay=new kn),this.ballDisplays=new Array(t.balls.length);for(var e of t.balls){var i=new yn(e);this.ballDisplays[e.num]=i,this.ballLayer.addChild(i),this.tabletopShadowsLayer.addChild(i.shadowBmp),this.ballHoverLayer.addChild(i.hoverCircle),this.ballHighlightLayer.addChild(i.highlightCircle),i.placerDisplay&&this.draggerLayer.addChild(i.placerDisplay)}this.stickDisplays=[];for(var s of t.sticks){s=new vn(s.team,null);this.stickDisplays.push(s),s.setOrientation(0,0,0,0,0,0,0),s.setVisible(!1),this.stickLayer.addChild(s),this.stickShadowLayer.addChild(s.shadow)}}setBallHighlightsEnabled(t){t?(this.ballHighlightLayer.visible=!0,this.ballHighlightLayer.alpha=0,this.ballHighlightAlphaTween=new n(0,1,100,0)):this.ballHighlightAlphaTween=new n(this.ballHighlightLayer.alpha,0,60,0)}update(t){for(var e of this.ballDisplays)e.update(t);for(var i of this.stickDisplays)i.update(t);this.ballHighlightAlphaTween&&(this.ballHighlightLayer.alpha=this.ballHighlightAlphaTween.update(t),0===this.ballHighlightLayer.alpha?this.ballHighlightLayer.visible=!1:this.ballHighlightLayer.visible=!0,this.ballHighlightAlphaTween.isFinished)&&(this.ballHighlightAlphaTween=null)}draw(){for(var t of this.ballDisplays){var e=t.ball;0===e.motionState?(t.visible=!1,t.shadowBmp.visible=!1,t.hoverCircle.visible=!1,t.highlightCircle.visible=!1,t.placerDisplay&&(t.placerDisplay.visible=!1)):(t.visible=!0,t.x=699.912510936133*e.position.x,t.y=699.912510936133*e.position.y,t.alpha=p.Quadratic.easeIn(e.depth,1,-1,1),t.updateOrientation(e.quaternion),t.shadowBmp.visible=2!==e.playState,t.highlightCircle.alpha=t.alpha,t.shadowBmp.x=t.highlightCircle.x=t.hoverCircle.x=t.x,t.shadowBmp.y=t.highlightCircle.y=t.hoverCircle.y=t.y,t.placerDisplay&&(t.canPlace?(t.placerDisplay.visible=!0,t.placerDisplay.x=t.x,t.placerDisplay.y=t.y):t.placerDisplay.visible=!1))}}}class xn extends B{constructor(){super(),this._cvs=document.createElement("canvas"),this._ctx=new Vt(this._cvs.getContext("2d"))}render(t,e,i){var s=P.canvas.width,n=P.canvas.height;this._cvs.width===s&&this._cvs.height===n||(this._cvs.width=s,this._cvs.height=n,this._ctx.resetState()),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._cvs.width,this._cvs.height),this._ctx.setTransform(1,0,0,1,0,0),super.render(this._ctx,e,i),this._ctx.globalCompositeOperation="destination-out";for(let t=0;t<this.children.length;++t){var a=this.children[t];a.strokeStyle=null,a.fillStyle="#FF00FF"}super.render(this._ctx,e,i);for(let t=0;t<this.children.length;++t){var o=this.children[t];o.strokeStyle="#FFFFFF",o.fillStyle=null}this._ctx.globalCompositeOperation="source-over",t.globalAlpha=.3*i,t.setTransform(1,0,0,1,0,0),t.drawImage(this._cvs,0,0)}}class Sn extends B{constructor(t){super(),this._isTweeningOn=!1,this.isShowing=!1,this.currentText="",this.currentShowTime=0,this.currentlyOnOrTweeningOn=!1,this.cueBallDisplay=t,this.mainTextField=new T("",S.fonts["OpenSans-ExtraBold"].data,36),this.mainTextField.fill="#FF0000",this.mainTextField.shadowFill="rgba(0,0,0,0.85)",this.mainTextField.shadowX=-9,this.mainTextField.shadowY=9,this.mainTextField.underStroke="#FFFFFF",this.mainTextField.underStrokeWidth=6,this.mainTextField.y=-2,this.mainTextField.align="center",this.mainTextField.baseline="middle",this.addChild(this.mainTextField),this.input=new C(this,!1,!1),this.visible=!1}show(t){this.isShowing||(this.isShowing=!0,this.alphaTween=new n(0,1,100,0,p.none),this.yTween=new n(-20,0,100,0,p.Quadratic.easeOut),this.scaleTween=new n(.5,1,100,0,p.Quadratic.easeOut),this._isTweeningOn=!0,this.mainTextField.text=t,this.mainTextField.alpha=this.alphaTween.start,this.mainTextField.y=this.yTween.start,this.mainTextField.scaleX=this.mainTextField.scaleY=this.scaleTween.start,this.visible=!0,this.currentlyOnOrTweeningOn=!0,this.currentText=t,this.updatePos())}hide(){this.isShowing&&(this.isShowing=!1,this.alphaTween=new n(this.mainTextField.alpha,0,50,0,p.none),this.yTween=new n(this.mainTextField.y,20,50,0,p.Quadratic.easeIn),this.scaleTween=new n(this.mainTextField.scaleX,.5,50,0,p.Quadratic.easeIn),this._isTweeningOn=!1,this.currentlyOnOrTweeningOn=!1)}updatePos(){var t=new v;this.cueBallDisplay.localToGlobal(t),this.parent.globalToLocal(t),this.x=t.x,this.y=t.y-80}update(t){(this.alphaTween||this.yTween||this.scaleTween)&&(this.alphaTween&&(this.mainTextField.alpha=this.alphaTween.update(t),this.alphaTween.isFinished&&(this.alphaTween=null),this.mainTextField.y=this.yTween.update(t),this.yTween.isFinished&&(this.yTween=null),this.mainTextField.scaleX=this.mainTextField.scaleY=this.scaleTween.update(t),this.scaleTween.isFinished)&&(this.scaleTween=null),this.alphaTween||this.yTween||this.scaleTween||this._isTweeningOn||(this.visible=!1))}draw(){this.visible&&this.updatePos()}}class kn extends B{constructor(){super(),this._cueBallStartPos=new v(0,0),this._cueBallColPos=new v(100,0),this._cueBallEndPos=new v(100,100),this._hasCueBallEndPos=!1,this._objBallStartPos=new v,this._objBallEndPos=new v,this._hasObjBallPositions=!1,this._aCuePath=new v,this._bCuePath=new v,this._cCuePath=new v,this._dCuePath=new v,this._bRotCuePath=0,this._cRotCuePath=0,this._aCueResp=new v,this._bCueResp=new v,this._cCueResp=new v,this._dCueResp=new v,this._aRotCueResp=0,this._dRotCueResp=0,this._cueRespRotation=0,this._cueRespLength=0,this._aObjResp=new v,this._bObjResp=new v,this._cObjResp=new v,this._dObjResp=new v,this._objRespRotation=0,this._objRespLength=0,this._cuePathFill="rgba(255,255,255,0.3)",this._cuePathStroke="rgba(255,255,255,0.6)",this._fillStop0=(new jt).fromStyleHexRGB(ce.game.pullMeter0Pct),this._fillStop50=(new jt).fromStyleHexRGB(ce.game.pullMeter50Pct),this._fillStop100=(new jt).fromStyleHexRGB(ce.game.pullMeter100Pct),this.visible=!1}updatePath(t){var e,i;this._cueBallStartPos.copy(t.cueBall.position),this._cueBallColPos.copy(t.cueBall.position).addValues(t.cueBallVelocity.x*t.intersection.t,t.cueBallVelocity.y*t.intersection.t),this._cueBallEndPos.set(0,0),this._objBallStartPos.set(0,0),this._objBallEndPos.set(0,0),1===t.intersection.type?(e=t.intersection.getCueBallResponseDirection(t.cueBallVelocity.clone().normalize()),this._cueBallEndPos.copy(this._cueBallColPos),this._cueBallEndPos.add(e.clone().scale(.28575)),this._hasCueBallEndPos=!0,this._hasObjBallPositions=!1):(e=t.cueBallVelocity.clone().normalize(),i=t.intersection.getCueBallTangentDirection(this._cueBallColPos,e),this._cueBallEndPos.copy(this._cueBallColPos),e=e.dot(i),e<=0||R.fequal(e,0)?this._hasCueBallEndPos=!1:(this._hasCueBallEndPos=!0,e=125*e+75,this._cueBallEndPos.add(i.clone().scale(.00142875*e))),this._hasObjBallPositions=!0,this._objBallStartPos.copy(t.intersection.otherBall.position),i=t.intersection.getObjBallResponseDirection(this._cueBallColPos),this._objBallEndPos.copy(this._objBallStartPos).add(i.clone().scale(.3571875))),this._cueBallStartPos.scale(699.912510936133),this._cueBallColPos.scale(699.912510936133),this._cueBallEndPos.scale(699.912510936133),this._objBallStartPos.scale(699.912510936133),this._objBallEndPos.scale(699.912510936133),this.updatePoints()}updatePoints(){(new v).unit(-36,20).distance((new v).unit(36,20));var t=this._cueBallColPos.clone().subtract(this._cueBallStartPos),t=t.clone().normalize(),e=t.rotation(),t=t.clone().scale(-1),t=t.rotation();this._aCuePath.unit(e-36,20).add(this._cueBallStartPos),this._bCuePath.unit(t+36,20).add(this._cueBallColPos),this._cCuePath.unit(t-36,20).add(this._cueBallColPos),this._dCuePath.unit(e+36,20).add(this._cueBallStartPos),this._bRotCuePath=this._bCuePath.clone().subtract(this._cueBallColPos).rotation(),this._cRotCuePath=this._cCuePath.clone().subtract(this._cueBallColPos).rotation(),this._hasCueBallEndPos&&(t=this._cueBallEndPos.clone().subtract(this._cueBallColPos),this._cueRespLength=t.length(),e=t.clone().normalize(),t=this._cueRespRotation=e.rotation(),e=e.clone().scale(-1),e=e.rotation(),this._aCueResp.unit(t-36,20).add(this._cueBallColPos),this._bCueResp.unit(e+36,20).add(this._cueBallEndPos),this._cCueResp.unit(e-36,20).add(this._cueBallEndPos),this._dCueResp.unit(t+36,20).add(this._cueBallColPos),this._aRotCueResp=this._aCueResp.clone().subtract(this._cueBallColPos).rotation(),this._dRotCueResp=this._dCueResp.clone().subtract(this._cueBallColPos).rotation()),this._hasObjBallPositions&&(e=this._objBallEndPos.clone().subtract(this._objBallStartPos),this._objRespLength=e.length(),t=e.clone().normalize(),e=this._objRespRotation=t.rotation(),t=t.clone().scale(-1),t=t.rotation(),this._aObjResp.unit(e-36,20).add(this._objBallStartPos),this._bObjResp.unit(t+36,20).add(this._objBallEndPos),this._cObjResp.unit(t-36,20).add(this._objBallEndPos),this._dObjResp.unit(e+36,20).add(this._objBallStartPos))}updatePull(t){var e;t<=0?(this._cuePathFill="rgba(255,255,255,0.3)",this._cuePathStroke="rgba(255,255,255,0.6)"):(e=new jt,t<=.5?e.interpolateFromTo(this._fillStop0,this._fillStop50,t/.5):e.interpolateFromTo(this._fillStop50,this._fillStop100,(t-.5)/.5),this._cuePathFill=e.toStyleFuncRGBA(),this._cuePathStroke="rgba(255,255,255,0.5)")}render(t,e,i){t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i,t.save(),t.rect(-650,-350,1300,700),t.clip(),t.beginPath(),t.moveTo(this._aCuePath.x,this._aCuePath.y),t.lineTo(this._bCuePath.x,this._bCuePath.y),t.arc(this._cueBallColPos.x,this._cueBallColPos.y,20,this._bRotCuePath*b.DEG_TO_RAD,this._cRotCuePath*b.DEG_TO_RAD,!0),t.lineTo(this._dCuePath.x,this._dCuePath.y),t.fillStyle=this._cuePathFill,t.fill(),t.beginPath(),t.moveTo(this._aCuePath.x,this._aCuePath.y),t.lineTo(this._bCuePath.x,this._bCuePath.y),t.lineTo(this._cCuePath.x,this._cCuePath.y),t.lineTo(this._dCuePath.x,this._dCuePath.y),t.save(),t.clip(),t.beginPath(),t.moveTo(this._aCuePath.x,this._aCuePath.y),t.lineTo(this._bCuePath.x,this._bCuePath.y),t.moveTo(this._cCuePath.x,this._cCuePath.y),t.lineTo(this._dCuePath.x,this._dCuePath.y),t.lineWidth=6,t.strokeStyle=this._cuePathStroke,t.stroke(),t.restore(),this._hasCueBallEndPos&&(t.beginPath(),t.moveTo(this._aCueResp.x,this._aCueResp.y),t.lineTo(this._bCueResp.x,this._bCueResp.y),t.lineTo(this._cCueResp.x,this._cCueResp.y),t.lineTo(this._dCueResp.x,this._dCueResp.y),t.arc(this._cueBallColPos.x,this._cueBallColPos.y,20,this._dRotCueResp*b.DEG_TO_RAD,this._aRotCueResp*b.DEG_TO_RAD,!0),this._wvp.copy(e),this._wvp.appendTransform(this._cueBallColPos.x,this._cueBallColPos.y,this._cueRespLength/100,this._cueRespLength/100,this._cueRespRotation,0,0,0,0),t.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty),t.fillStyle=M.resPathGradient,t.fill(),t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.beginPath(),t.moveTo(this._aCueResp.x,this._aCueResp.y),t.lineTo(this._bCueResp.x,this._bCueResp.y),t.lineTo(this._cCueResp.x,this._cCueResp.y),t.lineTo(this._dCueResp.x,this._dCueResp.y),t.save(),t.clip(),t.beginPath(),t.moveTo(this._aCueResp.x,this._aCueResp.y),t.lineTo(this._bCueResp.x,this._bCueResp.y),t.moveTo(this._cCueResp.x,this._cCueResp.y),t.lineTo(this._dCueResp.x,this._dCueResp.y),this._wvp.copy(e),this._wvp.appendTransform(this._cueBallColPos.x,this._cueBallColPos.y,this._cueRespLength/100,this._cueRespLength/100,this._cueRespRotation,0,0,0,0),t.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty),t.strokeStyle=M.resPathStrokeGradient,t.lineWidth=5/(this._cueRespLength/100),t.stroke(),t.restore()),t.beginPath(),t.arc(this._cueBallColPos.x,this._cueBallColPos.y,20,0,b.TWO_PI),t.lineWidth=3,t.strokeStyle="#FFFFFF",t.stroke(),this._hasObjBallPositions&&(t.beginPath(),t.moveTo(this._aObjResp.x,this._aObjResp.y),t.lineTo(this._bObjResp.x,this._bObjResp.y),t.lineTo(this._cObjResp.x,this._cObjResp.y),t.lineTo(this._dObjResp.x,this._dObjResp.y),this._wvp.copy(e),this._wvp.appendTransform(this._objBallStartPos.x,this._objBallStartPos.y,this._objRespLength/100,this._objRespLength/100,this._objRespRotation,0,0,0,0),t.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty),t.fillStyle=M.resPathGradient,t.fill(),t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.beginPath(),t.moveTo(this._aObjResp.x,this._aObjResp.y),t.lineTo(this._bObjResp.x,this._bObjResp.y),t.lineTo(this._cObjResp.x,this._cObjResp.y),t.lineTo(this._dObjResp.x,this._dObjResp.y),t.save(),t.clip(),t.beginPath(),t.moveTo(this._aObjResp.x,this._aObjResp.y),t.lineTo(this._bObjResp.x,this._bObjResp.y),t.moveTo(this._cObjResp.x,this._cObjResp.y),t.lineTo(this._dObjResp.x,this._dObjResp.y),this._wvp.copy(e),this._wvp.appendTransform(this._objBallStartPos.x,this._objBallStartPos.y,this._objRespLength/100,this._objRespLength/100,this._objRespRotation,0,0,0,0),t.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty),t.strokeStyle=M.resPathStrokeGradient,t.lineWidth=5/(this._objRespLength/100),t.stroke(),t.restore()),t.restore(),super.render(t,e,i)}}class Cn extends B{constructor(){super(),this._isTweeningOn=!1,this._showTime=1e3,this._isShowing=!1,this.currentText="",this.currentShowTime=0,this.currentlyOnOrTweeningOn=!1,this.mainTextField=new T("",S.fonts["AsapCondensed-SemiBold"].data,36),this.mainTextField.fill="#FFFF00",this.mainTextField.shadowFill="rgba(0,0,0,0.85)",this.mainTextField.shadowX=-3,this.mainTextField.shadowY=3,this.mainTextField.y=-2,this.mainTextField.align="center",this.mainTextField.baseline="middle",this.addChild(this.mainTextField),this.input=new C(this,!1,!1),this.visible=!1}show(t,e=0){this.alphaTween=new n(0,1,250,0,p.none),this.yTween=new n(-20,0,250,0,p.Quadratic.easeOut),this.scaleTween=new n(.5,1,250,0,p.Quadratic.easeOut),this._isTweeningOn=!0,this._showTime=-1,this._isShowing=!0,this.mainTextField.text=t,this.mainTextField.alpha=this.alphaTween.start,this.mainTextField.y=this.yTween.start,this.mainTextField.scaleX=this.mainTextField.scaleY=this.scaleTween.start,this.visible=!0,this.currentlyOnOrTweeningOn=!0,this.currentText=t,this.currentShowTime=-1}resetTime(){this.currentlyOnOrTweeningOn&&(this._showTime=this.currentShowTime)}hide(){this._showTime=0,this._isShowing&&this._isTweeningOn&&(this.alphaTween=new n(this.mainTextField.alpha,0,100,0,p.none),this.yTween=new n(this.mainTextField.y,20,100,0,p.Quadratic.easeIn),this.scaleTween=new n(this.mainTextField.scaleX,.5,100,0,p.Quadratic.easeIn),this._isTweeningOn=!1,this.currentlyOnOrTweeningOn=!1)}update(t){this.alphaTween||this.yTween||this.scaleTween?(this.alphaTween&&(this.mainTextField.alpha=this.alphaTween.update(t),this.alphaTween.isFinished&&(this.alphaTween=null),this.mainTextField.y=this.yTween.update(t),this.yTween.isFinished&&(this.yTween=null),this.mainTextField.scaleX=this.mainTextField.scaleY=this.scaleTween.update(t),this.scaleTween.isFinished)&&(this.scaleTween=null),this.alphaTween||this.yTween||this.scaleTween||this._isTweeningOn||(this.visible=!1,this._isShowing=!1)):0<this._showTime&&(this._showTime-=t,this._showTime<=0)&&this.hide()}}class Tn extends B{constructor(){super(),this.scaleTween=null,this.num=null,this._bezelBmp=new F(S.images.ball_bezel),this.addChild(this._bezelBmp),this.bezelWidth=.87*this._bezelBmp.width,this.bezelHeight=.87*this._bezelBmp.height,this._bezelBmp.scaleX=this._bezelBmp.scaleY=this.bezelWidth/this._bezelBmp.width,this.ballHolder=new B,this.ballHolder.x=this.bezelWidth/2,this.ballHolder.y=this.bezelHeight/2,this.ballHolder.scaleX=this.ballHolder.scaleY=.76,this.addChild(this.ballHolder)}addBall(t,e=!0){t=new yn(t);this.ballHolder.addChild(t),e?(this.scaleTween=new n(.1,.76,250,0,p.Overshoot.medEaseOut),this.ballHolder.scaleX=this.ballHolder.scaleY=this.scaleTween.start):(this.scaleTween=null,this.ballHolder.scaleX=this.ballHolder.scaleY=.76)}clearBall(){0<this.ballHolder.children.length&&this.ballHolder.removeChildAt(0),this.num=null,this.scaleTween=null,this.ballHolder.scaleX=this.ballHolder.scaleY=.76}update(t){this.scaleTween&&(this.ballHolder.scaleX=this.ballHolder.scaleY=this.scaleTween.update(t),this.scaleTween.isFinished)&&(this.scaleTween=null)}}class Fn extends B{constructor(t,e){super(),this.ballSlots=[],this.isRight=!1,this.isMarkedActiveTurn=!0,this.w=0,this._turnTimerStartTime=0,this._isLocalTurnTimer=!1,this._lastTickTimeRem=6e4,this._timeoutTime=6e4;var i=2===t,t=3===t;this.playerIndex=this.team=e,this.isPractice=i,this.nameTextField=new T("",S.fonts["OpenSans-ExtraBold"].data,30),this.groupTextField=new T("",S.fonts["OpenSans-ExtraBold"].data,30),this.nameTextField.align="left",this.nameTextField.baseline="bottom",this.nameTextField.fill="#FFFFFF",this.nameTextField.shadowFill="rgba(0,0,0,0.75)",this.nameTextField.shadowX=-4,this.nameTextField.shadowY=6,this.addChild(this.nameTextField),this.addChild(this.ballSlotsHolder=new B);let s=8;t&&(s=7);for(let t=0;t<s;++t){var n=new Tn;n.y=-n.bezelHeight,n.x=(n.bezelWidth+2)*t,this.ballSlotsHolder.addChild(n),this.ballSlots.push(n)}this.groupTextField.align="left",this.groupTextField.baseline="bottom",this.groupTextField.fill="#FFFFFF",this.groupTextField.shadowFill="rgba(0,0,0,0.75)",this.groupTextField.shadowX=-4,this.groupTextField.shadowY=6,this.addChild(this.groupTextField),this.addChild(this.turnTimerDisplay=new B),this.turnTimerDisplay.addChild(this.turnTimerText=new T("01:00",S.fonts["OpenSans-ExtraBold"].data,30)),this.turnTimerText.align="center",this.turnTimerText.baseline="top",this.turnTimerText.fill="#FFFFFF",this.turnTimerText.shadowFill="rgba(0,0,0,0.75)",this.turnTimerText.shadowX=-4,this.turnTimerText.shadowY=6,this.turnTimerDisplay.y=30,this.turnTimerDisplay.visible=!1,this.rerackButton=new E("Rerack",340,75),this.addChild(this.rerackButton),this.rerackButton.visible=!1,this.nameTextField.input=new C(this.nameTextField,!1,!1),this.groupTextField.input=new C(this.groupTextField,!1,!1),this.ballSlotsHolder.input=new C(this.ballSlotsHolder,!1,!1),this.rerackButton.input.pointerEnabled=!1,this.relayout()}startTurnTimer(t,e){t===this.team?this._isLocalTurnTimer=!0:this._isLocalTurnTimer=!1,this._turnTimerStartTime=Date.now(),this._lastTickTimeRem=e,this._timeoutTime=e,this.turnTimerDisplay.visible=!0}stopTurnTimer(){this.turnTimerDisplay.visible=!1}setName(t){this.nameTextField.text=t,this.relayout()}setActiveTurn(t){let e=!1;2!==t&&t!==this.team||(e=!0),this.nameTextField.fill=this.groupTextField.fill=e?"#FFFFFF":"#918F8F"}relayout(){var t,e,i;this.isPractice?(t=0,this.nameTextField.x=0,this.ballSlotsHolder.x=0,this.groupTextField.x=0,this.ballSlotsHolder.visible=!1,this.groupTextField.visible=!1,this.nameTextField.visible=!1,this.turnTimerDisplay.x=0,this.turnTimerDisplay.visible=!1,this.rerackButton.visible=!0,t=this.rerackButton.w,this.rerackButton.y=-(this.rerackButton.h+5),this.w=t):(this.rerackButton.visible=!1,t=this.nameTextField.measure().width,i=this.groupTextField.measure().width,e=this.ballSlots.length*this.ballSlots[0].bezelWidth+2*(this.ballSlots.length-1),i=t+16+e+16+i,this.nameTextField.x=0,this.ballSlotsHolder.x=t+16,this.groupTextField.x=t+16+e+16,this.turnTimerDisplay.x=t+16+e/2,this.w=i)}setGroup(t){this.groupTextField.text=null===t?"Open":0===t?"Solids":"Stripes",this.relayout()}addBall(t,e=!0){for(var i of this.ballSlots)if(i.num===t)return;for(var s of this.ballSlots)if(0===s.ballHolder.children.length){s.addBall(t,e);break}}clearBalls(){for(var t of this.ballSlots)t.clearBall()}update(t){for(var e of this.ballSlots)e.update(t)}draw(){if(this.turnTimerDisplay.visible){var e,i=Date.now()-this._turnTimerStartTime;let t=this._timeoutTime-i;t<0&&(t=0),this.turnTimerText.text=a.toTimerString(t),k.isActive&&(i=Math.floor(this._lastTickTimeRem/1e3),e=Math.floor(t/1e3),this._isLocalTurnTimer)&&e<=10&&e<i&&(i=new x(S.sounds.countdown.data),i.volume=.1+(10-e)/10*.9,i.play()),this._lastTickTimeRem=t}}}class Bn extends B{constructor(t,e,i){super(),this.num=null,this._dropInTween=null,this._moveTween=null,this._rotTween=null,this.isTweening=!1,this.inTheWay=!0,this.allowedToTween=!1,this._rollingSound=null,this._lastDropInTweenValue=0,this._prevDropInTweenValue=0,this._bounces=0,this.num=t,this.addChild(this.ballHolder=new B),this.ballHolder.scaleX=this.ballHolder.scaleY=.85,this.ballDisplay=new yn(t),this.ballHolder.addChild(this.ballDisplay),this._dropInTween=new n(-46,0,300,0,p.Bounce.easeOut),this._prevDropInTweenValue=this._lastDropInTweenValue=this._dropInTween.value,this._bounces=0,this.ballHolder.y=this._dropInTween.start;var t=499-34*e,e=t-23,s=e/476*1e3;this.ballHolder.x=23,0<s&&(this._moveTween=new n(0,t,s,this._dropInTween.delay+this._dropInTween.duration/3,p.none),t=e/125.66370614359172,this._rotTween=new n(360*-t,0,this._moveTween.duration,this._moveTween.delay,this._moveTween.ease),this.ballHolder.rotation=this._rotTween.start),i&&(this._rollingSound=new x(S.sounds["ball-tray-roll-01"].data),this._rollingSound.volume=.075,this._rollingSound.play()),this.isTweening=!0,this.checkOutOfTheWay(),this.ballDisplay.sheenBmp.rotation=-this.ballHolder.rotation,this.ballDisplay.shadingBmp.rotation=-this.ballHolder.rotation,i||(this.ballHolder.y=this._dropInTween.end,this._dropInTween=null,this.ballHolder.x=this._moveTween.end,this._moveTween=null,this.ballHolder.rotation=this._rotTween.end,this._rotTween=null,this.checkOutOfTheWay(),this.isTweening=!1,this.ballDisplay.sheenBmp.rotation=-this.ballHolder.rotation,this.ballDisplay.shadingBmp.rotation=-this.ballHolder.rotation)}dispose(){this._rollingSound&&this._rollingSound.stop(),this._rollingSound=null}checkOutOfTheWay(){33.5<=this.ballHolder.x||!1===this.isTweening?this.inTheWay=!1:this.inTheWay=!0}update(t){if(this.allowedToTween){if(this._dropInTween){var e=this._prevDropInTweenValue<this._lastDropInTweenValue,i=(this.ballHolder.y=this._dropInTween.update(t),this._lastDropInTweenValue<this._dropInTween.value);if(e&&!i){let t=null;0===this._bounces&&(t=new x(S.sounds["ball-tray-bounce-01"].data)),1===this._bounces&&(t=new x(S.sounds["ball-tray-bounce-02"].data)),t&&t.play(),this._bounces++}this._prevDropInTweenValue=this._lastDropInTweenValue,this._lastDropInTweenValue=this._dropInTween.value,this._dropInTween.isFinished&&(this._dropInTween=null)}this._moveTween&&(this.ballHolder.x=this._moveTween.update(t),this._moveTween.isFinished)&&(this._moveTween=null),this._rotTween&&(this.ballHolder.rotation=this._rotTween.update(t),this._rotTween.isFinished)&&(this._rotTween=null,Xn.trayHit()),this._rotTween||(this._rollingSound&&this._rollingSound.stop(),this._rollingSound=null),this.checkOutOfTheWay(),this._dropInTween||this._moveTween||this._rotTween||(this.isTweening=!1)}this.ballDisplay.sheenBmp.rotation=-this.ballHolder.rotation,this.ballDisplay.shadingBmp.rotation=-this.ballHolder.rotation}}class Pn extends B{constructor(){super(),this.entries=[],this.isTweening=!1,this.addChild(this.bezelBmp=new F(S.images.tray_bezel)),this.addChild(this.entryHolder=new B),this.entryHolder.x=0,this.entryHolder.y=this.bezelBmp.height/2,this.regX=this.bezelBmp.width/2,this.entryHolder.maskShape=new r(3,3,516,40),this.bezelBmp.input=new C(this.bezelBmp,!1,!1),this.entryHolder.input=new C(this.entryHolder,!1,!1)}dispose(){for(var t of this.entries)t.dispose()}getAllSunkPoolBalls(){var t,e=[];for(t of this.entries)null!==t.num&&e.push(t.num);return e}addBall(t,e=!0){e&&(this.isTweening=!0);t=new Bn(t,this.entries.length,e);this.entryHolder.addChild(t),this.entries.push(t)}clearBalls(){for(var t of this.entries)t.dispose(),this.entryHolder.removeChild(t);this.entries.length=0,this.isTweening=!1}update(t){for(var e of this.entries)if(e.inTheWay){e.allowedToTween=!0;break}this.isTweening=!1;for(var i of this.entries)i.update(t),i.isTweening&&(this.isTweening=!0)}}class Dn extends B{constructor(){super(),this.onPickedUp=new h,this.onChanged=new h,this.onDropped=new h,this.tickLines=[],this.inputEnabled=!1,this.dragging=!1,this._pickupPoint=new v,this._pickupPct=0,this._pxPerPercent=0,this.pct=0,this.fillColor=new jt(0,0,0,1),this.fillStopNone=(new jt).fromStyleHexRGB("#222222"),this.fillStop0=(new jt).fromStyleHexRGB("#00FF00"),this.fillStop50=(new jt).fromStyleHexRGB("#FFFD00"),this.fillStop100=(new jt).fromStyleHexRGB("#FF0000"),this.holder=new B,this.addChild(this.holder),this.valueTextField=new T("100%",S.fonts["OpenSans-ExtraBold"].data,36),this.valueTextField.align="center",this.valueTextField.baseline="bottom",this.valueTextField.fill="#FFFF00",this.valueTextField.shadowFill="rgba(0,0,0,0.75)",this.valueTextField.shadowX=-4,this.valueTextField.shadowY=6,this.valueTextField.y=-20,this.valueTextField.x=30,this.holder.addChild(this.valueTextField),this.meterHolder=new B,this.holder.addChild(this.meterHolder),this.meterFill=new Kt(5,5,50,498,12,"#000000"),this.meterHolder.addChild(this.meterFill),this.gradBmp=new F(S.images.pull_gradient),this.gradBmp.x=3,this.gradBmp.y=3,this.meterHolder.addChild(this.gradBmp);for(let t=1;t<10;++t){var e=new Qt(5,0,50,2,"#FFFFFF"),e=(e.regY=1,e.y=8+49.4*t-1,this.meterHolder.addChild(e),this.tickLines.push(e),new Qt(5,0,50,2,"#000000"));e.regY=1,e.y=8+49.4*t,this.meterHolder.addChild(e),this.tickLines.push(e)}this.stickBmp=new F(S.images.pull_stick),this.stickBmp.regX=this.stickBmp.width/2,this.stickBmp.x=30,this.stickBmp.y=8,this.stickBmp.maskShape=new r(7,7,46,493),this.meterHolder.addChild(this.stickBmp),this.bezelBmp=new F(S.images.pull_bezel),this.meterHolder.addChild(this.bezelBmp),this.availMeterRect=new Qt(0,0,0,0),this.availMeterRect.strokeStyle="#FFFF00",this.availMeterRect.strokeWidth=1,this.availMeterRect.input=new C(this.availMeterRect,!1,!1),this.addChild(this.availMeterRect),this.scaledMeterRect=new Qt(0,0,0,0),this.scaledMeterRect.strokeStyle="#FF0000",this.scaledMeterRect.strokeWidth=1,this.scaledMeterRect.input=new C(this.scaledMeterRect,!1,!1),this.addChild(this.scaledMeterRect),this.input=new C(this,!1,!1,new r(this.bezelBmp.x,this.bezelBmp.y,this.bezelBmp.width,this.bezelBmp.height)),this.input.onPointerPress.add(this.input_onPointerPress,this),this.input.onPointerRelease.add(this.input_onPointerRelease,this),this.input.onPointerCancel.add(this.input_onPointerCancel,this),this.cursor="grab",this._minY=8,this._maxY=this.bezelBmp.height-this._minY-20,this._rngY=this._maxY-this._minY,this._pxPerPercent=this._rngY/100,this.setPct(0,!1)}enableInput(){this.inputEnabled||(this.inputEnabled=!0,this.input.pointerEnabled=!0)}disableInput(){this.inputEnabled&&(this.inputEnabled=!1,this.input.pointerEnabled=!1)}pickup(){this.dragging||(this.dragging=!0,P.overrideCursorType="grabbing",w.primary.onMove.add(this.primary_onMove,this),this.globalToLocal(this._pickupPoint.set(w.primary.x,w.primary.y)),this._pickupPct=this.pct,this.onPickedUp.invoke())}drop(t){this.dragging&&(this.dragging=!1,P.overrideCursorType=null,w.primary.onMove.remove(this.primary_onMove,this),this.onDropped.invoke())}drag(){var t=new v(w.primary.x,w.primary.y),t=(this.globalToLocal(t),-((t.y-this._pickupPoint.y)/this._pxPerPercent));t/=100,this.setPct(this._pickupPct-t,!0)}input_onPointerPress(){this.pickup()}input_onPointerRelease(){this.drop(!1)}input_onPointerCancel(){this.drop(!1)}primary_onMove(){this.drag()}setPct(t,e){t<0&&(t=0),1<t&&(t=1),this.pct=t,this.stickBmp.y=t*this._rngY+this._minY,this.valueTextField.text=Math.ceil(100*t)+"%",0===t?this.fillColor.copy(this.fillStopNone):t<=.5?this.fillColor.interpolateFromTo(this.fillStop0,this.fillStop50,t/.5):this.fillColor.interpolateFromTo(this.fillStop50,this.fillStop100,(t-.5)/.5),this.meterFill.fillStyle=this.fillColor.toStyleFuncRGBA(),e&&this.onChanged.invoke()}anchor(t){var e=508/770*t.height,i=t.y+(t.height-e)/2,i=new r(24,i,t.x-24-24,e),t=Math.min(i.height/508,i.width/60),e=new r(i.x,i.y+(i.height-508*t)/2,60*t,508*t);this.holder.x=e.x,this.holder.y=e.y,this.meterHolder.scaleX=this.meterHolder.scaleY=t,this.input.hitArea.copy(e),this.availMeterRect.rectangle.copy(i),this.scaledMeterRect.rectangle.copy(e)}update(t){}}class En extends B{constructor(){super(),this.onPickedUp=new h,this.onChanged=new h,this.onDropped=new h,this.tickMarks=[],this.inputEnabled=!1,this.dragging=!1,this._pickupPoint=new v,this._pickupDegree=0,this._pxPerPerDegree=0,this.degree=0,this.holder=new B,this.addChild(this.holder),this.valueTextField=new T("0",S.fonts["OpenSans-ExtraBold"].data,36),this.valueTextField.align="center",this.valueTextField.baseline="bottom",this.valueTextField.fill="#FFFF00",this.valueTextField.shadowFill="rgba(0,0,0,0.75)",this.valueTextField.shadowX=-4,this.valueTextField.shadowY=6,this.valueTextField.y=-20,this.valueTextField.x=30,this.holder.addChild(this.valueTextField),this.meterHolder=new B,this.holder.addChild(this.meterHolder),this.meterFill=new Kt(10,8,40,492,6,"#CCCCCC"),this.meterFill.strokeWidth=5,this.meterFill.strokeStyle="#999999",this.meterHolder.addChild(this.meterFill),this.tickArea=new r(6,9,48,490),this.tickSpacing=this.tickArea.height/10;var e=this.tickArea.height/this.tickSpacing+1;this.tickHolder=new B,this.tickHolder.x=this.tickArea.x,this.tickHolder.y=this.tickArea.y,this.meterHolder.addChild(this.tickHolder);for(let t=0;t<e;++t){var i=new B,s=(this.tickHolder.addChild(i),new Qt(0,0,this.tickArea.width,2,"#FFFFFF")),s=(s.regY=s.rectangle.height/2,s.y=-1,i.addChild(s),new Qt(0,0,this.tickArea.width,2,"#000000"));s.regY=s.rectangle.height/2,i.addChild(s),i.y=this.tickSpacing*t,this.tickMarks.push(i)}this.bezelBmp=new F(S.images.rotation_bezel),this.meterHolder.addChild(this.bezelBmp),this.arrowShadowBmp=new F(S.images.rotation_arrow_shadow),this.arrowBmp=new F(S.images.rotation_arrow),this.arrowShadowBmp.regY=this.arrowShadowBmp.height/2,this.meterHolder.addChild(this.arrowShadowBmp),this.arrowBmp.regY=this.arrowBmp.height/2,this.meterHolder.addChild(this.arrowBmp),this.arrowBmp.y=this.bezelBmp.height/2,this.arrowShadowBmp.y=this.arrowBmp.y+5,this.arrowBmp.x=this.arrowShadowBmp.x=3,this.availMeterRect=new Qt(0,0,0,0),this.availMeterRect.strokeStyle="#FFFF00",this.availMeterRect.strokeWidth=1,this.availMeterRect.input=new C(this.availMeterRect,!1,!1),this.addChild(this.availMeterRect),this.scaledMeterRect=new Qt(0,0,0,0),this.scaledMeterRect.strokeStyle="#FF0000",this.scaledMeterRect.strokeWidth=1,this.scaledMeterRect.input=new C(this.availMeterRect,!1,!1),this.addChild(this.scaledMeterRect),this.input=new C(this,!1,!1,new r(this.bezelBmp.x,this.bezelBmp.y,this.bezelBmp.width,this.bezelBmp.height)),this.input.onPointerPress.add(this.input_onPointerPress,this),this.input.onPointerRelease.add(this.input_onPointerRelease,this),this.input.onPointerCancel.add(this.input_onPointerCancel,this),this.cursor="grab",this._pxPerPerDegree=this.tickSpacing,this.setDegree(0,!1)}enableInput(){this.inputEnabled||(this.inputEnabled=!0,this.input.pointerEnabled=!0)}disableInput(){this.inputEnabled&&(this.inputEnabled=!1,this.input.pointerEnabled=!1)}pickup(){this.dragging||(this.dragging=!0,P.overrideCursorType="grabbing",w.primary.onMove.add(this.primary_onMove,this),this.globalToLocal(this._pickupPoint.set(w.primary.x,w.primary.y)),this._pickupDegree=this.degree,this.onPickedUp.invoke())}drop(t){this.dragging&&(this.dragging=!1,P.overrideCursorType=null,w.primary.onMove.remove(this.primary_onMove,this),this.onDropped.invoke())}drag(){var t=new v(w.primary.x,w.primary.y),t=(this.globalToLocal(t),-((t.y-this._pickupPoint.y)/this._pxPerPerDegree));this.setDegree(this._pickupDegree-t,!0)}input_onPointerPress(){this.pickup()}input_onPointerRelease(){this.drop(!1)}input_onPointerCancel(){this.drop(!1)}primary_onMove(){this.drag()}setDegree(t,e){for(;t<0;)t+=360;for(;360<=t;)t-=360;this.degree=t;var i=t%1,s=i*this.tickSpacing;for(let t=0;t<this.tickMarks.length;++t)this.tickMarks[t].y=s+t*this.tickSpacing,this.tickMarks[t].y>=this.tickArea.height||this.tickMarks[t].y<=0?this.tickMarks[t].visible=!1:this.tickMarks[t].visible=!0;let n=Math.round(t);360===n&&(n=0),this.valueTextField.text=n+"",e&&this.onChanged.invoke()}setPct(t,e){t<0&&(t=0),1<t&&(t=1),this.valueTextField.text=Math.ceil(100*t)+"%",e&&this.onChanged.invoke()}anchor(t){var e=508/770*t.height,i=t.y+(t.height-e)/2,t=t.x+t.width,i=new r(t+24,i,P.width-t-24-24,e),t=Math.min(i.height/508,i.width/60),e=new r(i.x+i.width-60*t,i.y+(i.height-508*t)/2,60*t,508*t);this.holder.x=e.x,this.holder.y=e.y,this.meterHolder.scaleX=this.meterHolder.scaleY=t,this.input.hitArea.copy(e),this.availMeterRect.rectangle.copy(i),this.scaledMeterRect.rectangle.copy(e)}update(t){}}class Rn extends B{constructor(){super(),this.onChanged=new h,this.onClicked=new h,this.onDropped=new h,this.inputEnabled=!1,this.degree=0,this.length=0,this.bezelBmp=new F(S.images.spin_bezel),this.addChild(this.bezelBmp),this.w=this.bezelBmp.width*this.bezelBmp.scaleX,this.h=this.w,this.regX=13;var t=new yn(0,!0);t.x=this.w/2,t.y=this.h/2,t.scaleX=t.scaleY=1.6,this.addChild(t),this.hitCircleHolder=new B,this.addChild(this.hitCircleHolder),this.hitCircleHolder.x=this.w/2,this.hitCircleHolder.y=this.h/2,this.hitCircle=new ee(0,0,5,"#CD0303"),this.hitCircleHolder.addChild(this.hitCircle),this.input=new C(this,!1,!1,new J(40,40,43)),this.cursor="pointer"}enableInput(){this.inputEnabled||(this.inputEnabled=!0,this.input.pointerEnabled=!0,this.input.onPointerClick.add(this.input_onPointerClick,this))}disableInput(){this.inputEnabled&&(this.inputEnabled=!1,this.input.pointerEnabled=!1,this.input.onPointerClick.remove(this.input_onPointerClick,this))}setPolar(t,e,i){this.degree=t,this.length=e;t=(new v).unit(t,e);this.hitCircle.x=27*t.x,this.hitCircle.y=27*t.y,i&&this.onChanged.invoke()}input_onPointerClick(){this.onClicked.invoke()}reset(){this.setPolar(0,0,!0)}}class An extends B{constructor(){super(),this.onChanged=new h,this.onClicked=new h,this.onDropped=new h,this.inputEnabled=!1,this.degree=0,this.bezelBmp=new F(S.images.spin_bezel),this.addChild(this.bezelBmp),this.w=this.bezelBmp.width*this.bezelBmp.scaleX,this.h=this.w,this.regX=13;var t=new yn(0,!0);t.x=this.w/2,t.y=this.h/2,t.scaleX=t.scaleY=1.6,this.addChild(t),this.input=new C(this,!1,!1,new J(40,40,43)),this.cursor="pointer",this.setDegree(0,!1)}enableInput(){this.inputEnabled||(this.inputEnabled=!0,this.input.pointerEnabled=!0,this.input.onPointerClick.add(this.input_onPointerClick,this))}disableInput(){this.inputEnabled&&(this.inputEnabled=!1,this.input.pointerEnabled=!1,this.input.onPointerClick.remove(this.input_onPointerClick,this))}setDegree(t,e){this.degree=t,e&&this.onChanged.invoke()}input_onPointerClick(){this.onClicked.invoke()}reset(){this.degree=0}render(t,e,i){super.render(t,e,i);var s=(new v).unit(-50,1),n=26*Math.abs(s.y);this._wvp.copy(e),this._wvp.appendTransform(this.w/2-13,this.h/2-n/2-2,1,1,0,0,0,0,0),t.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty),t.strokeStyle="#CD0303",t.lineWidth=4,t.globalAlpha=i,t.lineCap="square",t.lineJoin="miter",t.beginPath(),t.moveTo(26,n),t.lineTo(0,n),t.lineTo(26*s.x,n+26*s.y),t.stroke(),t.lineCap="butt",t.beginPath(),t.arc(0,n,15.6,0,-50*b.DEG_TO_RAD,!0),t.stroke(),t.lineCap="round",t.lineJoin="round"}}class In extends si{constructor(t,e,i,s,n,a="Daily Challenge"){super(e,i,s,n,a),this.setShots(t)}setTime(t){}setShots(t){this.isDailyChallenge?this.timeTextField.text=this._dailyChallengeText:this.isOnline?this.timeTextField.text="Online Game":this.isTwoPlayer?this.timeTextField.text="2 Player":this.isPractice?this.timeTextField.text="Practice":this.timeTextField.text=null===t?"-- Shots":t+" Shots"}}class Mn extends ii{constructor(t,e,i,s=null){super(e,i,s),this.setShots(t)}setTime(t){}setShots(t){this.timeTextField.text=t+" Shots"}}const On=new class{run(t,e){var i=Nn.generate(e);return Un.evaluate(t,e,i)}},Ln=new class{run(t,e){var i=Vn.generate(e),s=[],n=[],a=[];Wn.evaluate(t,e,i);for(let t=0;t<i.length;++t){var o=i[t];9!==o.call&&16!==o.call&&17!==o.call?(18===o.call&&s.push(o),i.splice(t,1),t--):1!==o.pocketOrder.length||o.pocketOrder[0]!==o.target.num?(n.push(o),i.splice(t,1),t--):8<o.numBallColsUnpocketed+o.numRailColsUnpocketed&&(a.push(o),i.splice(t,1),t--)}if(0<i.length)return i.sort(function(t,e){var i=t.numBallColsUnpocketed+t.numRailColsUnpocketed,s=e.numBallColsUnpocketed+e.numRailColsUnpocketed;return i<s?-1:s<i?1:t.pull<e.pull?-1:t.pull>e.pull?1:0}),i[0];var r,h=$n.generate(t,e),l=[];for(r of[.1,.25,.5,.7,.9])for(var d of h)l.push(new Xi(2,d.target,d.rotation,r,d.x,d.y));Wn.evaluate(t,e,l);var c=[],u=[],p=[];for(let t=0;t<l.length;++t){var g=l[t];9!==g.call&&16!==g.call&&17!==g.call?(18===g.call&&c.push(g),l.splice(t,1),t--):1!==g.pocketOrder.length||g.pocketOrder[0]!==g.target.num?(u.push(g),l.splice(t,1),t--):16<g.numBallColsUnpocketed+g.numRailColsUnpocketed&&(p.push(g),l.splice(t,1),t--)}return 0<l.length?(l.sort(function(t,e){var i=t.numBallColsUnpocketed+t.numRailColsUnpocketed,s=e.numBallColsUnpocketed+e.numRailColsUnpocketed;return i<s?-1:s<i?1:t.pull<e.pull?-1:t.pull>e.pull?1:0}),l[0]):(t=a.concat(p),0<t.length?(t.sort(function(t,e){var i=t.numBallColsUnpocketed+t.numRailColsUnpocketed,s=e.numBallColsUnpocketed+e.numRailColsUnpocketed;return i<s?-1:s<i?1:t.pull<e.pull?-1:t.pull>e.pull?1:0}),t[0]):(e=n.concat(u),0<e.length?(e.sort(function(t,e){var i=t.numBallColsUnpocketed+t.numRailColsUnpocketed,s=e.numBallColsUnpocketed+e.numRailColsUnpocketed;return i<s?-1:s<i?1:t.pull<e.pull?-1:t.pull>e.pull?1:0}),e[0]):(t=s.concat(c),0<t.length?(t.sort(function(t,e){var i=t.numBallColsUnpocketed+t.numRailColsUnpocketed,s=e.numBallColsUnpocketed+e.numRailColsUnpocketed;return i<s?-1:s<i?1:t.pull<e.pull?-1:t.pull>e.pull?1:0}),t[0]):null)))}};class Hn{constructor(t,e,i,s){this.target=t,this.x=e,this.y=i,this.rotation=s}}const zn=new class{run(t,e){var i,s=Date.now(),n=[],a=[];for(i of e.elligible)for(let t=0;t<360;t+=1/3)this.checkPos(e,n,a,i,t,1)&&this.checkPos(e,n,a,i,t,2)&&this.checkPos(e,n,a,i,t,3);return Date.now(),0<a.length?N.nextItem(a):0<n.length?N.nextItem(n):null}checkPos(t,e,i,s,n,a){var o=new v;return o.unit(n,.05715*a),Yn.isCueBallInvalidPos(t.gameState,o.x,o.y)||(n=new v(s.position.x-o.x,s.position.y-o.y),a=n.rotation(),n=new Hn(s,o.x,o.y,a),e.push(n),this.checkValidStraightShot(t,s,a,o.x,o.y)&&i.push(n)),!1}checkValidStraightShot(t,e,i,s,n){var a,o=t.gameState,r=t.gameState.table.balls[0];for(a of o.table.balls){if(0!==a.motionState&&1!==a.motionState)throw new Error("some ball is in motion");if(2===a.playState)throw new Error("some ball is sinking")}if(1!==r.motionState)throw new Error("cue ball not on table");var h,t=new cs,i=(t.cueBall=r,t.cueBallVelocity.unit(i).scale(2.143125),r.angularVelocity.set(0,0,0),r.velocity.set(t.cueBallVelocity.x,t.cueBallVelocity.y,0),r.motionState=4,r.position.clone());r.position.set(s,n);for(h of o.table.balls)h.updateDelta(1);var l,d=[];let c=1;for(l of o.table.intersections)l.ball===r&&(l.test(),l.isCollision)&&(l.t<c?(c=l.t,d.length=0,d.push(l)):l.t===c&&d.push(l));if(0===d.length)throw new Error("could not find intersection!");var u,s=d[0];t.intersection=s,r.angularVelocity.set(0,0,0),r.velocity.set(0,0,0),r.motionState=1,r.position.copy(i);for(u of o.table.balls)u.updateDelta(1);return 0===s.type&&s.ball===r&&(s.ball===e||s.otherBall===e)}};class Gn{constructor(t,e){this.breakShotsGenerated=0,this.breakShotsGenerationTime=0,this.straightShotsGenerated=0,this.straightShotsGenerationTime=0,this.bruteShotsGenerated=0,this.bruteShotsGenerationTime=0,this.difficulty=e,this.gameState=t,this.elligible=A.getElligibleFirstHitBalls(t),this.isBreaking=2===t.turnState||1===t.turnState||3===t.turnState,this.isBreaking?this.isBallInHand=this.isKitchenOnly=!0:(this.isBallInHand=7===t.turnState||8===t.turnState,this.isBallInHand&&(this.isKitchenOnly=8===t.turnState))}}const Nn=new class{generate(i){var t=Date.now();let e=[.7,.8,.9,1],s=[-1,-.75,-.5,-.25,0,.25,.5,.75,1],n=[-1,-.5,0],a=[-1,-.5,0,.5,1];i.gameState.table.balls[0];var o=new v,r=[];let h=[];for(;h.length<3;){let e=null;for(let t=0;t<i.gameState.table.balls.length;++t){var l=i.gameState.table.balls[t];3!==l.group&&2!==l.group&&h.indexOf(l)<0&&(null===e||l.position.x<e.position.x)&&(e=l)}h.push(e)}s=0===i.difficulty?(h=[h[0]],n=[0],a=[0],e=[1],[0]):1===i.difficulty?(h=[h[0]],e=[1],[0]):(h.shift(),h=[h[Math.floor(Math.random()*h.length)]],e=[1],s=[-1,-.5,0,.5,1],0<h[0].position.y?(n=[-1*Math.random(),-1*Math.random()],a=[.25*Math.random()+.75,.25*Math.random()+.75],[0,.25,.5,.75,1]):h[0].position.y<0?(n=[-1*Math.random(),-1*Math.random()],a=[-(.25*Math.random()+.75),-(.25*Math.random()+.75)],[0,-.25,-.5,-.75,-1]):(n=[-1*Math.random(),-1*Math.random(),-1*Math.random()],a=[-(.25*Math.random()+.75),-(.25*Math.random()+.75),-(.25*Math.random()+.75),.25*Math.random()+.75,.25*Math.random()+.75,.25*Math.random()+.75],[0]));var d;for(d of h)for(var c of n)for(var u of a){var p,g=.05715*c*2-.417195,m=0+.05715*u*2,u=o.copy(d.position).subtractValues(g,m),y=u.rotation(),u=u.length(),u=b.TWO_PI*u,u=u/360,_=.05715/u;for(p of s){var f,w=y+p*_;for(f of e)r.push(new Xi(0,d,w,f,g,m))}}return t=Date.now()-t,i.breakShotsGenerated=r.length,i.breakShotsGenerationTime=t,r}},Vn=new class{generate(t){var e,i=Date.now(),s=[.04,.2,.4,.6,.8,1],n=[-1,-.75,-.5,-.25,0,.25,.5,.75,1],a=t.gameState.table.balls[0],o=new v,r=[];for(e of t.elligible){var h,l=o.copy(e.position).subtract(a.position),d=l.rotation(),l=l.length(),l=b.TWO_PI*l,l=l/360,c=.05715/l;for(h of n){var u=d+h*c;if(this.checkValidStraightShot(t,e,u))for(var p of s)r.push(new Xi(1,e,u,p))}}return i=Date.now()-i,t.straightShotsGenerated=r.length,t.straightShotsGenerationTime=i,r}checkValidStraightShot(t,e,i){var s,n=t.gameState,a=t.gameState.table.balls[0];for(s of n.table.balls){if(0!==s.motionState&&1!==s.motionState)throw new Error("some ball is in motion");if(2===s.playState)throw new Error("some ball is sinking")}if(1!==a.motionState)throw new Error("cue ball not on table");var o,t=new cs;t.cueBall=a,t.cueBallVelocity.unit(i).scale(2.143125),a.angularVelocity.set(0,0,0),a.velocity.set(t.cueBallVelocity.x,t.cueBallVelocity.y,0),a.motionState=4;for(o of n.table.balls)o.updateDelta(1);var r,h=[];let l=1;for(r of n.table.intersections)r.ball===a&&(r.test(),r.isCollision)&&(r.t<l?(l=r.t,h.length=0,h.push(r)):r.t===l&&h.push(r));if(0===h.length)throw new Error("could not find intersection!");var d,i=h[0];t.intersection=i,a.angularVelocity.set(0,0,0),a.velocity.set(0,0,0),a.motionState=1;for(d of n.table.balls)d.updateDelta(1);return 0===i.type&&i.ball===a&&(i.ball===e||i.otherBall===e)}};class jn{evaluate(t,e,i){var s,n=Date.now();let a=0;for(s of i)this.simShot(t,e,i,s),a++;return Date.now(),this.chooseShot(t,e,i)}simShot(t,e,i,s){for(;s.rotation<0;)s.rotation+=360;for(;360<=s.rotation;)s.rotation-=360;var n=new Ni;n.unpack(t.data.packedGameState);let a=n.table.balls[0].position.x,o=n.table.balls[0].position.y;null!==s.x&&n.table.balls[0].position.set(a=s.x,o=s.y),n.table.sticks[n.team].position.x=a,n.table.sticks[n.team].position.y=o,n.table.sticks[n.team].rotation=s.rotation,n.table.sticks[n.team].pull=s.pull;var r=new Ji(n);if(!A.fullySimulateShot(r,!0))throw new Error("Test Simulation rejected!");this.evaluateShot(t,e,i,s,n,r)}evaluateShot(t,e,i,s,n,a){s.call=n.lastShotCall,s.pocketOrder=a.pocketOrder.slice(0),s.numRailColsUnpocketed=a.numRailColsUnpocketed,s.numBallColsUnpocketed=a.numBallColsUnpocketed}chooseShot(t,e,i){return i[0]}}const Un=new class extends jn{evaluateShot(t,e,i,s,n,a){s.call=n.lastShotCall}chooseShot(t,e,i){return N.nextItem(i)}},Wn=new class extends jn{chooseShot(t,e,i){return 0===i.length?null:N.nextItem(i)}},$n=new class{generate(e,i){var t,s=i.gameState.table.balls[0].position.x,n=i.gameState.table.balls[0].position.y,a=new Array(i.gameState.table.balls.length);for(let t=0;t<a.length;++t)a[t]=!1;for(t of i.elligible)a[t.num]=!0;var o=Date.now(),r=new Array(i.gameState.table.balls.length);for(let t=0;t<r.length;++t)r[t]=[];for(let t=0;t<360;t+=1/3)this.checkRotation(e,i,t,r,a);var h,l=[];for(h of i.elligible){var d,c=r[h.num];for(d of c){var u=new Xi(2,h,d.rotation,1,s,n);u.firstColPos=d.firstColPos,u.numRailsHit=d.numRailsHit,l.push(u)}}return o=Date.now()-o,i.bruteShotsGenerated=l.length,i.bruteShotsGenerationTime=o,l}checkRotation(t,e,i,s,n){var a=new Ni,t=(a.unpack(t.data.packedGameState),a.table.balls[0].position.x),o=a.table.balls[0].position.y,t=(a.table.sticks[a.team].position.x=t,a.table.sticks[a.team].position.y=o,a.table.sticks[a.team].rotation=i,a.table.sticks[a.team].pull=1,new Ji(a));return A.fullySimulateShot(t,!0,!0),!!(t.anyBallBallCol&&0<t.numRailCols&&n[t.lastAnyBallHitNum])&&(s[t.lastAnyBallHitNum].push({rotation:i,firstColPos:t.firstColPos,numRailsHit:t.numRailCols}),!0)}};class Yn{static main(t){u.onMessage.add(this.Thread_onMessage,this)}static Thread_onMessage(t){Date.now();var e=new Ni;if(!e.validate(t.data.packedGameState,!0))throw new Error("Game state validation failed");e.unpack(t.data.packedGameState);var i=t.data.primaryDifficulty;e.table.sticks[e.team].elevation=0,e.table.sticks[e.team].englishDegrees=0,e.table.sticks[e.team].englishLength=0;let s=e.table.balls[0].position.x,n=e.table.balls[0].position.y,a=0,o=1;i=new Gn(e,i);let r=null;if(i.isBreaking)r=On.run(t,i);else{if(i.isBallInHand){if(i.isBallInHand&&i.isKitchenOnly){let t=this.isCueBallInvalidPos(e,s,n);for(;t;){if(8===e.turnState||2===e.turnState||1===e.turnState||3===e.turnState)s=Math.random()*e.table.kitchenBallInHandRect.width+e.table.kitchenBallInHandRect.x,n=Math.random()*e.table.kitchenBallInHandRect.height+e.table.kitchenBallInHandRect.y;else{if(7!==e.turnState)throw new Error("Should not happen");s=Math.random()*e.table.tableBallInHandRect.width+e.table.tableBallInHandRect.x,n=Math.random()*e.table.tableBallInHandRect.height+e.table.tableBallInHandRect.y}t=this.isCueBallInvalidPos(e,s,n)}i.gameState.table.balls[0].position.set(s,n)}else{var h=zn.run(t,i);h&&i.gameState.table.balls[0].position.set(h.x,h.y),s=h.x,n=h.y}t.data.packedGameState=i.gameState.pack()}r=Ln.run(t,i)}if(r)null!==r.x&&(s=r.x),null!==r.y&&(n=r.y),a=r.rotation,o=r.pull;else{let t=this.isCueBallInvalidPos(e,s,n);for(;t;){if(8===e.turnState||2===e.turnState||1===e.turnState||3===e.turnState)s=Math.random()*e.table.kitchenBallInHandRect.width+e.table.kitchenBallInHandRect.x,n=Math.random()*e.table.kitchenBallInHandRect.height+e.table.kitchenBallInHandRect.y;else{if(7!==e.turnState)throw new Error("Should not happen");s=Math.random()*e.table.tableBallInHandRect.width+e.table.tableBallInHandRect.x,n=Math.random()*e.table.tableBallInHandRect.height+e.table.tableBallInHandRect.y}t=this.isCueBallInvalidPos(e,s,n)}a=e.table.sticks[e.team].rotation=360*Math.random(),o=e.table.sticks[e.team].pull=.9*Math.random()+.1,a=0,o=.01}let l=0,d=0,c=0;for(0===i.difficulty?(c=.2,l=-.5*c+Math.random()*c,c=6,d=-.5*c+Math.random()*c):1===i.difficulty?(c=.1,l=-.5*c+Math.random()*c,c=3,d=-.5*c+Math.random()*c):2===i.difficulty&&(c=.05,l=-.5*c+Math.random()*c,c=1,d=-.5*c+Math.random()*c),o+=l,o<.01&&(o=.01),1<o&&(o=1),a+=d;a<0;)a+=360;for(;360<=a;)a-=360;e.table.balls[0].position.set(s,n),e.table.sticks[e.team].rotation=a,e.table.sticks[e.team].pull=o,e.table.sticks[e.team].position.x=s,e.table.sticks[e.team].position.y=n;h=new Ji(e);if(!A.fullySimulateShot(h,!0))throw new Error("Simulation rejected!");u.sendMessage("done",{packedGameState:h.gameState.pack(),call:h.call,pull:o,elevation:0,englishDegrees:0,englishLength:0,rotation:a,x:s,y:n})}static isCueBallInvalidPos(t,e,i){var s,n=new v(e,i);let a=!1;for(s of t.table.balls)if(3!==s.group&&s.isInPlay2()&&s.position.distance(n)<.05857875){a=!0;break}return a}}Yn.classpath="AI",u.register(Yn);const qn=new class{constructor(){this._pending=[],this._pocketPending=[]}hit(t){0===this._pending.length&&this.reload(),0===this._pocketPending.length&&this.reloadPocket();var e=N.removeNextItem(this._pending),i=t.ball.velocity.length();let s=i/4*.8;if(1<s&&(s=1),s<.05&&(s=.05),e.volume=s,e.play(),0===t.edge.rail){i=N.removeNextItem(this._pocketPending);let t=.5*s;t<0&&(t=0),1<t&&(t=1),i.volume=t,i.play()}return e}reload(){this._pending.push(new x(S.sounds["ball-cushion-01"].data)),this._pending.push(new x(S.sounds["ball-cushion-02"].data)),this._pending.push(new x(S.sounds["ball-cushion-03"].data)),this._pending.push(new x(S.sounds["ball-cushion-04"].data)),this._pending.push(new x(S.sounds["ball-cushion-05"].data))}reloadPocket(){this._pocketPending.push(new x(S.sounds["ball-pocket-01"].data)),this._pocketPending.push(new x(S.sounds["ball-pocket-02"].data)),this._pocketPending.push(new x(S.sounds["ball-pocket-03"].data)),this._pocketPending.push(new x(S.sounds["ball-pocket-04"].data))}},Xn=new class{constructor(){this._pending=[]}hit(t){0===this._pending.length&&this.reload();var e=N.removeNextItem(this._pending),t=t.ball.velocity.length();let i=t/4;return 1<i&&(i=1),i<.1&&(i=.1),e.volume=i,e.play(),e}trayHit(){0===this._pending.length&&this.reload();var t=N.removeNextItem(this._pending);let e=.5;return 1<e&&(e=1),e<.1&&(e=.1),t.volume=e,t.play(),t}reload(){this._pending.push(new x(S.sounds["ball-ball-01"].data)),this._pending.push(new x(S.sounds["ball-ball-02"].data)),this._pending.push(new x(S.sounds["ball-ball-03"].data))}},Jn=new class{constructor(){this._pending=[]}hit(t){0===this._pending.length&&this.reload();var e=N.removeNextItem(this._pending);let i=t;return 1<i&&(i=1),i<.05&&(i=.05),e.volume=i,e.play(),e}reload(){this._pending.push(new x(S.sounds["stick-ball-03"].data))}};class M extends o{constructor(){super(M,Xs);let t=location.host,e=(0===t.indexOf("www.")&&(t=t.replace("www.","")),"GameBundle"===c.embed.type?(l.info("Running in a GameBundle (capacitor), forcing production game server"),M.remoteHost=Hi.production):"AndroidAuto"===c.embed.type||"StandaloneExe"===c.embed.type||0<=Hi.production.allowedDomains.indexOf(t)?M.remoteHost=Hi.production:0<=Hi.staging.allowedDomains.indexOf(t)?M.remoteHost=Hi.staging:(0<=Hi.development.allowedDomains.indexOf(t)||l.info("Could not identify game server host using allowedDomains, falling back to dev"),M.remoteHost=Hi.development),l.info("Chose Game Server Host: "+M.remoteHost.envName),this._usesDailyChallenge=!0,ys.load(),ps.load(),ms.load(),"GameBundle"!==c.embed.type&&gs.load(),D.load(),"GameBundle"!==c.embed.type&&"AndroidAuto"!==c.embed.type&&"StandaloneExe"!==c.embed.type||(ps.fullscreen=!1),c.preferFullscreen=ps.fullscreen,Mt.isMuted=ps.mute,S.sounds["turn-notification"].data.volume=.35,M.resPathStrokeGradient=P.ctx.createLinearGradient(0,0,100,0),M.resPathStrokeGradient.addColorStop(0,"rgba(255,255,255,1)"),M.resPathStrokeGradient.addColorStop(.9,"rgba(255,255,255,0)"),M.resPathGradient=P.ctx.createLinearGradient(0,0,100,0),M.resPathGradient.addColorStop(0,"rgba(255,255,255,0.5)"),M.resPathGradient.addColorStop(.9,"rgba(255,255,255,0)"),c.closeSplash(),new x(S.sounds.welcome.data).play(),null);for(var i of this.urlVars)0===i.indexOf("room=")&&i.replace("room=","").length===Si.roomIdLength&&(e=i.replace("room=",""));var s;e?(s=new ds(4,!1,e),this.screenManager.add(new Qs(s,!0,!1))):this.screenManager.add(new Js(!1))}cancelExpanderFullscreen(){ps.fullscreen=!1,ps.save()}calcStarRating(t,e,i){return null==e?0:e<=8?3:e<=16?2:1}handleGameIntent(t){}getGameIntent(t){return null}static main(){new M}}M.localServer=new ki("local")})();